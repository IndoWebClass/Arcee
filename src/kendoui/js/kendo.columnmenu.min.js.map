{"version":3,"file":"kendo.columnmenu.min.js","sources":["kendo.columnmenu.js"],"sourcesContent":["/*!\n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n\n*/\n(function(f, define){\n    define('kendo.columnmenu',[ \"./kendo.popup\", \"./kendo.filtermenu\", \"./kendo.menu\", \"./kendo.expansionpanel\" ], f);\n})(function(){\n\nvar __meta__ = { // jshint ignore:line\n    id: \"columnmenu\",\n    name: \"Column Menu\",\n    category: \"framework\",\n    depends: [ \"popup\", \"filtermenu\", \"menu\", 'expansionpanel' ],\n    advanced: true\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        proxy = $.proxy,\n        extend = $.extend,\n        grep = $.grep,\n        map = $.map,\n        inArray = $.inArray,\n        Comparer = kendo.data.Comparer,\n        ACTIVE = \"k-state-selected\",\n        ASC = \"asc\",\n        DESC = \"desc\",\n        CHANGE = \"change\",\n        INIT = \"init\",\n        OPEN = \"open\",\n        SELECT = \"select\",\n        STICK = \"stick\",\n        UNSTICK= \"unstick\",\n        POPUP = \"kendoPopup\",\n        FILTERMENU = \"kendoFilterMenu\",\n        MENU = \"kendoMenu\",\n        EXPANSIONPANEL = \"kendoExpansionPanel\",\n        NS = \".kendoColumnMenu\",\n        Widget = ui.Widget;\n\n    function trim(text) {\n        return kendo.trim(text).replace(/&nbsp;/gi, \"\");\n    }\n\n    function toHash(arr, key) {\n        var result = {};\n        var idx, len, current;\n        for (idx = 0, len = arr.length; idx < len; idx ++) {\n            current = arr[idx];\n            result[current[key]] = current;\n        }\n        return result;\n    }\n\n    function columnsGroupFilterHandler(column) {\n        return this.columns.indexOf(column.title) >= 0 || this.columns.indexOf(column.field) >= 0;\n    }\n\n    function leafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (!columns[idx].columns) {\n                result.push(columns[idx]);\n                continue;\n            }\n            result = result.concat(leafColumns(columns[idx].columns));\n        }\n\n        return result;\n    }\n\n    function attrEquals(attrName, attrValue) {\n        return \"[\" + kendo.attr(attrName) + \"='\" + (attrValue || \"\").replace(/'/g, \"\\\"\") + \"']\";\n    }\n\n    function insertElementAt(index, element, container) {\n        if (index > 0) {\n            element.insertAfter(container.children().eq(index - 1));\n        } else {\n            container.prepend(element);\n        }\n    }\n\n    function columnOccurrences(columns) {\n        var columnDict = {};\n        var signature;\n\n        for (var i = 0; i < columns.length; i++) {\n            signature = JSON.stringify(columns[i]);\n\n            if (columnDict[signature]) {\n                columnDict[signature].push(i);\n            } else {\n                columnDict[signature] = [i];\n            }\n        }\n\n        return columnDict;\n    }\n\n    function oldColumnOccurrences(renderedListElements, checkBoxes) {\n        var indexAttr = kendo.attr(\"index\");\n        var fieldAttr = kendo.attr(\"field\");\n        var columnDict = {};\n        var signature;\n        var columCheckbox;\n        var index;\n        var field;\n        var title;\n\n        for (var j = 0; j < renderedListElements.length; j++) {\n            columCheckbox = checkBoxes.eq(j);\n            index = parseInt(columCheckbox.attr(indexAttr), 10);\n            field = columCheckbox.attr(fieldAttr);\n            title = columCheckbox.attr(\"title\");\n            signature = field ? field : title;\n\n            if (columnDict[signature]) {\n                columnDict[signature].push(index);\n            } else {\n                columnDict[signature] = [index];\n            }\n        }\n\n        return columnDict;\n    }\n\n    var ColumnMenu = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            options = options || {};\n            options.componentType = options.componentType || \"classic\";\n            Widget.fn.init.call(that, element, options);\n\n            element = that.element;\n            options = that.options;\n            that.owner = options.owner;\n            that.dataSource = options.dataSource;\n\n            that.field = element.attr(kendo.attr(\"field\"));\n            that.title = element.attr(kendo.attr(\"title\"));\n\n            that.appendTo = $(options.appendTo);\n            that.link = that._createLink();\n\n            that.wrapper = $('<div class=\"k-column-menu\"/>');\n\n            that._refreshHandler = proxy(that.refresh, that);\n\n            that.dataSource.bind(CHANGE, that._refreshHandler);\n        },\n\n        _init: function() {\n            var that = this;\n\n            that.pane = that.options.pane;\n            if (that.pane) {\n                that._isMobile = true;\n            }\n\n            if (that._isMobile) {\n                that._createMobileMenu();\n            } else {\n                that._createMenu();\n            }\n\n            that.owner._muteAngularRebind(function() {\n                that._angularItems(\"compile\");\n            });\n\n            that._sort();\n\n            that._columns();\n\n            that._filter();\n\n            that._lockColumns();\n\n            that._stickyColumns();\n\n            that.trigger(INIT, { field: that.field, container: that.wrapper });\n        },\n\n        events: [ INIT, OPEN, \"sort\", \"filtering\", STICK, UNSTICK ],\n\n        options: {\n            name: \"ColumnMenu\",\n            messages: {\n                sortAscending: \"Sort Ascending\",\n                sortDescending: \"Sort Descending\",\n                filter: \"Filter\",\n                column: \"Column\",\n                columns: \"Columns\",\n                columnVisibility: \"Column Visibility\",\n                clear: \"Clear\",\n                cancel: \"Cancel\",\n                done: \"Done\",\n                settings: \"Edit Column Settings\",\n                lock: \"Lock Column\",\n                unlock: \"Unlock Column\",\n                stick: \"Stick Column\",\n                unstick: \"Unstick Column\",\n                setColumnPosition: \"Set Column Position\",\n                apply: \"Apply\",\n                reset: \"Reset\",\n                buttonTitle: \"{0} edit column settings\"\n            },\n            filter: \"\",\n            columns: true,\n            sortable: true,\n            filterable: true,\n            animations: {\n                left: \"slide\"\n            },\n            encodeTitles: false,\n            componentType: \"classic\",\n            appendTo: null\n        },\n\n        _createMenu: function() {\n            var that = this,\n                options = that.options,\n                columns = that._ownerColumns(),\n                flattenMenuCols,\n                menuTemplate;\n\n            if (that._hasGroups()) {\n                columns = that._groupColumns(columns);\n                flattenMenuCols = that._flattenMenuCols(columns);\n                if (flattenMenuCols.length !== that.owner.columns.length) {\n                    that._syncMenuCols(flattenMenuCols, that.owner.columns);\n                }\n            }\n\n            if (that._isModernComponentType()) {\n                menuTemplate = kendo.template(modernTemplate);\n            } else {\n                menuTemplate = kendo.template(template);\n            }\n\n            that.wrapper.html(menuTemplate({\n                uid: kendo.guid(),\n                ns: kendo.ns,\n                messages: options.messages,\n                sortable: options.sortable,\n                filterable: options.filterable,\n                columns: columns,\n                showColumns: options.columns,\n                hasLockableColumns: options.hasLockableColumns,\n                hasStickableColumns: options.hasStickableColumns,\n                encodeTitles: options.encodeTitles,\n                omitWrapAttribute: kendo.attr(\"omit-wrap\")\n            }));\n\n            that.popup = that.wrapper[POPUP]({\n                anchor: that.link,\n                copyAnchorStyles: false,\n                open: proxy(that._open, that),\n                activate: proxy(that._activate, that),\n                deactivate: proxy(that._deactivate, that),\n                close: function(e) {\n                    if (that.menu) {\n                        that.menu._closing = e.sender.element;\n                    }\n                    if (that.options.closeCallback) {\n                        that.options.closeCallback(that.element);\n                    }\n                }\n            }).data(POPUP);\n\n            if (that._isModernComponentType()) {\n                that.popup.element.addClass(\"k-grid-columnmenu-popup\");\n                that._createExpanders();\n            } else {\n                that.menu = that.wrapper.children()[MENU]({\n                    orientation: \"vertical\",\n                    closeOnClick: false,\n                    open: function() {\n                        that._updateMenuItems();\n                    }\n                }).data(MENU);\n            }\n        },\n\n        _createLink: function() {\n            var that = this,\n                element = that.element,\n                appendTarget = that.appendTo.length ? element.find(that.appendTo) : element,\n                link = element.find(\".k-header-column-menu\"),\n                title = kendo.format(that.options.messages.buttonTitle, that.title || that.field);\n\n            if (!link[0]) {\n                element.addClass(\"k-filterable\");\n\n                link = appendTarget\n                    .append('<a class=\"k-header-column-menu\" href=\"#\" title=\"' +\n                                title + '\" aria-label=\"' +\n                                title + '\"><span class=\"k-icon k-i-more-vertical\"></span></a>')\n                    .find(\".k-header-column-menu\");\n            }\n\n            link.attr(\"tabindex\", -1)\n                .on(\"click\" + NS, proxy(that._click, that));\n\n            return link;\n        },\n\n        _createExpanders: function() {\n            var that = this;\n            var options = that.options;\n            var expanderOptions = {\n                expanded: false,\n                headerClass: \"k-columnmenu-item\",\n                useBareTemplate: true\n            };\n\n            that.wrapper.find(\".k-columns-item\")[EXPANSIONPANEL]($.extend(true, {}, expanderOptions,{\n                title:'<span class=\"k-icon k-i-columns\"></span><span>' + options.messages.columns + '</span>'\n            }));\n            that.wrapper.find(\".k-column-menu-filter\")[EXPANSIONPANEL]($.extend(true, {}, expanderOptions,{\n                title:'<span class=\"k-icon k-i-filter\"></span><span>' + options.messages.filter + '</span>'\n            }));\n            that.wrapper.find(\".k-column-menu-position\")[EXPANSIONPANEL]($.extend(true, {}, expanderOptions,{\n                title:'<span class=\"k-icon k-i-set-column-position\"></span><span>' + options.messages.setColumnPosition + '</span>'\n            }));\n        },\n\n        _syncMenuCols: function (menuCols, ownerCols) {\n            var length = ownerCols.length;\n            var ownerCol;\n            var menuColsFields = menuCols.map(function (col) {\n                return col.field;\n            });\n\n            for (var i = 0; i < length; i++) {\n                ownerCol = ownerCols[i];\n                if (menuColsFields.indexOf(ownerCol.field) < 0) {\n                    ownerCol.menu = false;\n                }\n            }\n        },\n\n        _flattenMenuCols: function (cols) {\n            var result = [];\n            var length = cols.length;\n\n            for (var i = 0; i < length; i++) {\n                if (cols[i].columns) {\n                    result = result.concat(this._flattenMenuCols(cols[i].columns));\n                } else if (!cols[i].groupHeader) {\n                    result.push(cols[i]);\n                }\n            }\n            return result;\n        },\n\n        _groupColumns: function(columns, nest) {\n            var result = [];\n            var groups = this.options.columns.groups;\n            var length = groups.length;\n            var i;\n            var currGroup;\n            var filterHandler;\n            var group;\n            var groupColumns;\n\n            for (i = 0; i < length; i++) {\n                currGroup = groups[i];\n                filterHandler = columnsGroupFilterHandler.bind(currGroup);\n                group = { title: currGroup.title, groupHeader: true };\n                groupColumns = columns.filter(filterHandler);\n                result.push(group);\n\n                if (nest) {\n                    group.columns = groupColumns;\n                } else {\n                    result = result.concat(groupColumns);\n                }\n            }\n\n            return result;\n        },\n\n        _hasGroups: function() {\n            return this.options.columns && this.options.columns.groups && this.options.columns.groups.length;\n        },\n\n        _isModernComponentType: function() {\n            return this.options.componentType === 'modern' && !this._isMobile;\n        },\n\n        _deactivate: function() {\n            if (this.menu) {\n                this.menu._closing = false;\n            }\n        },\n\n        _createMobileMenu: function() {\n            var that = this,\n                options = that.options,\n                columns = that._ownerColumns(),\n                groups,\n                flattenMenuCols;\n\n            if (that._hasGroups()) {\n                groups = that._groupColumns(columns, true);\n                flattenMenuCols = that._flattenMenuCols(groups);\n                if (flattenMenuCols.length !== that.owner.columns.length) {\n                    that._syncMenuCols(flattenMenuCols, that.owner.columns);\n                }\n            }\n\n            var html = kendo.template(mobileTemplate)({\n                ns: kendo.ns,\n                field: that.field,\n                title: that.title || that.field,\n                messages: options.messages,\n                sortable: options.sortable,\n                filterable: options.filterable,\n                columns: columns,\n                showColumns: options.columns,\n                hasLockableColumns: options.hasLockableColumns,\n                hasStickableColumns: options.hasStickableColumns,\n                hasGroups: that._hasGroups(),\n                groups: groups\n            });\n\n            that.view = that.pane.append(html);\n            that.view.state = { columns: {} };\n\n            that.wrapper = that.view.element.find(\".k-column-menu\");\n\n            that.menu = new MobileMenu(that.wrapper.children(), {\n                pane: that.pane,\n                columnMenu: that\n            });\n\n            // The toggle animation of the switches should not propagate to the view\n            that.menu.element.on(\"transitionend\" + NS, function(e) {\n                e.stopPropagation();\n            });\n\n            var viewElement = that.view.wrapper && that.view.wrapper[0] ? that.view.wrapper : that.view.element;\n\n            viewElement.on(\"click\", \".k-header-done\", function(e) {\n                e.preventDefault();\n\n                that.menu._applyChanges();\n                that.menu._cancelChanges(false);\n                that.close();\n            });\n\n            viewElement.on(\"click\", \".k-header-cancel\", function(e) {\n                e.preventDefault();\n\n                that.menu._cancelChanges(true);\n                that.close();\n            });\n\n            that.view.bind(\"showStart\", function() {\n                var view = that.view || { columns: {} };\n\n                if (that.options.hasLockableColumns) {\n                    that._updateLockedColumns();\n                }\n\n                if (that.options.hasStickableColumns) {\n                    that._updateStickyColumns();\n                }\n\n                if (view.element.find(\".k-sort-asc.k-state-selected\").length) {\n                    view.state.initialSort = \"asc\";\n                } else if (view.element.find(\".k-sort-desc.k-state-selected\").length) {\n                    view.state.initialSort = \"desc\";\n                }\n            });\n        },\n\n        _angularItems: function(action) {\n            var that = this;\n            that.angular(action, function(){\n                var items = that.wrapper.find(\".k-columns-item input[\" + kendo.attr(\"field\") + \"]\").map(function(){\n                    return $(this).closest(\"li\");\n                });\n                var data = map(that._ownerColumns(), function(col){\n                    return { column: col._originalObject };\n                });\n                return {\n                    elements: items,\n                    data: data\n                };\n            });\n        },\n\n        destroy: function() {\n            var that = this;\n\n            that._angularItems(\"cleanup\");\n\n            Widget.fn.destroy.call(that);\n\n            if (that.filterMenu) {\n                that.filterMenu.destroy();\n            }\n\n            if (that._refreshHandler) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler);\n            }\n\n            if (that.options.columns && that.owner) {\n                if (that._updateColumnsMenuHandler) {\n                    that.owner.unbind(\"columnShow\", that._updateColumnsMenuHandler);\n                    that.owner.unbind(\"columnHide\", that._updateColumnsMenuHandler);\n                }\n\n                if (that._updateColumnsLockedStateHandler) {\n                    that.owner.unbind(\"columnLock\", that._updateColumnsLockedStateHandler);\n                    that.owner.unbind(\"columnUnlock\", that._updateColumnsLockedStateHandler);\n                }\n            }\n\n            if (that.menu) {\n                that.menu.element.off(NS);\n                that.menu.destroy();\n            }\n\n            that.wrapper.off(NS);\n\n            if (that.popup) {\n                that.popup.destroy();\n            }\n\n            if (that.view) {\n                that.view.purge();\n            }\n\n            that.link.off(NS);\n            that.owner = null;\n            that.wrapper = null;\n            that.element = null;\n        },\n\n        close: function() {\n            if (this.menu) {\n                this.menu.close();\n            }\n            if (this.popup) {\n                this.popup.close();\n                this.popup.element.off(\"keydown\" + NS);\n            }\n        },\n\n        _click: function(e) {\n            var that = this;\n\n            e.preventDefault();\n            e.stopPropagation();\n\n            var options = this.options;\n\n            if (options.filter && this.element.is(!options.filter)) {\n                return;\n            }\n\n            if (!this.popup && !this.pane) {\n                this._init();\n            } else {\n                that._updateMenuItems();\n            }\n\n            if (this._isMobile) {\n                this.pane.navigate(this.view, this.options.animations.left);\n            } else {\n                this.popup.toggle();\n            }\n        },\n\n        _updateMenuItems: function() {\n            var that = this;\n            if (that.options.columns) {\n                that._setMenuItemsVisibility();\n                if (!that.options.columns.sort && !that.options.columns.groups) {\n                    that._reorderMenuItems();\n                } else {\n                    that._updateDataIndexes();\n                }\n            }\n        },\n\n        _setMenuItemsVisibility: function() {\n            var that = this;\n\n            that._eachRenderedMenuItem(function(index, column, renderedListElement) {\n                if (column.matchesMedia === false) {\n                    renderedListElement.hide();\n                } else {\n                    renderedListElement.show();\n                }\n            });\n        },\n\n        _reorderMenuItems: function() {\n            var that = this;\n\n            that._eachRenderedMenuItem(function(index, column, renderedListElement, renderedList) {\n                if (renderedListElement[0] && renderedListElement.index() !== index) {\n                    insertElementAt(index, renderedListElement, renderedList);\n                }\n            });\n            that._updateDataIndexes();\n        },\n\n        _updateDataIndexes: function () {\n            var that = this;\n            var renderedList = that._isMobile && that.view ?\n                $(that.view.element).find(\".k-columns-item\").children(\"ul\") :\n                $(that.wrapper).find(\".k-menu-group\").first(),\n                mappedColumns = that._ownerColumns(true).map(function(x) {\n                    return x.title || x.field;\n                });\n\n            renderedList.find(\"span.\" + (this._isMobile ? \"k-listgroup-form-field-wrapper\" : \"k-menu-link\") +\n                \" input\").each(function (i) {\n                var columns;\n                var index;\n                if (that.options.columns.sort) {\n                    columns = that._ownerColumns();\n                    index = mappedColumns.indexOf(columns[i].title);\n                    $(this).attr(kendo.attr(\"index\"), index);\n                } else {\n                    $(this).attr(kendo.attr(\"index\"), i);\n                }\n            });\n        },\n\n        _eachRenderedMenuItem: function(callback) {\n            var that = this;\n            var renderedListElement;\n            var duplicateColumnIndex;\n            var fieldValue;\n            var currentColumn;\n            var columns = grep(leafColumns(that.owner.columns), function(col) {\n                var result = true,\n                    title = trim(col.title || \"\");\n\n                if (col.menu === false || (!col.field && !title.length)) {\n                    result = false;\n                }\n\n                return result;\n            }).map(function(col) {\n                return  {\n                     field: col.field,\n                     title: col.title,\n                     matchesMedia: col.matchesMedia\n                   };\n            });\n            var renderedList = that._getRenderedList();\n            var renderedListElements = that._getRenderedListElements(renderedList);\n            var oldOccurances = oldColumnOccurrences(renderedListElements, renderedList.find(\"input[type=checkbox]\"));\n            var columnOccurrence = columnOccurrences(columns);\n            var columnElements;\n\n            for (var i = 0; i < columns.length; i++) {\n                currentColumn = columns[i];\n                fieldValue = currentColumn.field ? currentColumn.field : currentColumn.title;\n                duplicateColumnIndex = $.inArray(i, columnOccurrence[JSON.stringify(currentColumn)]);\n                columnElements = $();\n\n                for (var idx = 0; idx < oldOccurances[fieldValue].length; idx++) {\n                    columnElements = columnElements.add(renderedListElements.eq(oldOccurances[fieldValue][idx]));\n                }\n                renderedListElement = columnElements.find(attrEquals(\"field\", fieldValue)).closest(that._isModernComponentType() ? \"label\" : \"li\").eq(duplicateColumnIndex);\n                callback(i, currentColumn, renderedListElement, renderedList);\n            }\n        },\n\n        _getRenderedList: function() {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                return $(that.wrapper).find('.k-columns-item');\n            } else {\n                return that._isMobile && that.view ?\n                $(that.view.element).find(\".k-columns-item\").children(\"ul\") :\n                $(that.wrapper).find(\".k-menu-group\").first();\n            }\n        },\n\n        _getRenderedListElements: function(renderedList) {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                return renderedList.find('label');\n            } else {\n                return renderedList.find(\"span.\" + (this._isMobile ? \"k-listgroup-form-field-wrapper\" : \"k-menu-link\"));\n            }\n        },\n\n        _open: function() {\n            var that = this;\n            $(\".k-column-menu\").not(that.wrapper).each(function() {\n                $(this).data(POPUP).close();\n            });\n            that.popup.element.on(\"keydown\" + NS, function(e) {\n                if (that._isModernComponentType() && e.keyCode === kendo.keys.ENTER) {\n                    $(e.target).click();\n                }\n                if (e.keyCode == kendo.keys.ESC) {\n                    that.close();\n                }\n            });\n\n            if (that.options.hasLockableColumns) {\n                that._updateLockedColumns();\n            }\n\n            if (that.options.hasStickableColumns) {\n                that._updateStickyColumns();\n            }\n        },\n\n        _activate: function() {\n            if (this.menu) {\n                this.menu.element.trigger(\"focus\");\n            } else{\n                this.popup.element.find('[tabindex=0]').eq(0).trigger(\"focus\");\n            }\n\n            this.trigger(OPEN, { field: this.field, container: this.wrapper });\n        },\n\n        _ownerColumns: function(omitSort) {\n            var columns = leafColumns(this.owner.columns),\n                menuColumns = grep(columns, function(col) {\n                    var result = true,\n                        title = trim(col.title || \"\");\n\n                    if (col.menu === false || (!col.field && !title.length)) {\n                        result = false;\n                    }\n\n                    return result;\n                }),\n                result,\n                sort = this.options.columns.sort;\n\n            result = map(menuColumns, function(col) {\n                return {\n                    originalField: col.field,\n                    field: col.field || col.title,\n                    title: col.title || col.field,\n                    hidden: col.hidden,\n                    matchesMedia: col.matchesMedia,\n                    index: inArray(col, columns),\n                    locked: !!col.locked,\n                    _originalObject: col,\n                    uid: col.headerAttributes.id\n                };\n            });\n\n            if (sort && !omitSort) {\n                result.sort(Comparer.create({ field: \"title\", dir: sort }));\n            }\n\n            return result;\n        },\n\n        _sort: function() {\n            var that = this;\n\n            if (that.options.sortable) {\n                that.refresh();\n\n                if (that._isModernComponentType()) {\n                    that.wrapper.on(\"click\" + NS, \".k-sort-asc, .k-sort-desc\", proxy(that._sortHandler, that));\n                } else {\n                    that.menu.bind(SELECT, proxy(that._sortHandler, that));\n                }\n            }\n        },\n\n        _sortHandler: function(e) {\n            var that = this,\n                item = e.item ? $(e.item) : $(e.target),\n                dir;\n\n            if (item.hasClass(\"k-sort-asc\")) {\n                dir = ASC;\n            } else if (item.hasClass(\"k-sort-desc\")) {\n                dir = DESC;\n            }\n\n            if (!dir) {\n                return;\n            }\n\n            that._getSortItemsContainer(item).find(\".k-sort-\" + (dir == ASC ? DESC : ASC)).removeClass(ACTIVE);\n\n            that._sortDataSource(item, dir);\n\n            if (!that._isMobile) {\n                that.close();\n            }\n        },\n\n        _getSortItemsContainer: function(item) {\n            return this._isModernComponentType() ? item.parents('.k-columnmenu-item-wrapper').first() : item.parent();\n        },\n\n        _sortDataSource: function(item, dir) {\n            var that = this,\n                sortable = that.options.sortable,\n                compare = sortable.compare === null ? undefined : sortable.compare,\n                dataSource = that.dataSource,\n                idx,\n                length,\n                sort = dataSource.sort() || [];\n\n            var removeClass = item.hasClass(ACTIVE) && sortable && sortable.allowUnsort !== false;\n\n            dir = !removeClass ? dir : undefined;\n\n            if (that.trigger(\"sort\", { sort: { field: that.field, dir: dir, compare: compare } })) {\n                return;\n            }\n\n            if (removeClass) {\n                item.removeClass(ACTIVE);\n            } else {\n                item.addClass(ACTIVE);\n            }\n\n            if (sortable.mode === \"multiple\") {\n                for (idx = 0, length = sort.length; idx < length; idx++) {\n                    if (sort[idx].field === that.field) {\n                        sort.splice(idx, 1);\n                        break;\n                    }\n                }\n                sort.push({ field: that.field, dir: dir, compare: compare });\n            } else {\n                sort = [ { field: that.field, dir: dir, compare: compare} ];\n            }\n\n            dataSource.sort(sort);\n        },\n\n        _columns: function() {\n            var that = this;\n\n            if (that.options.columns) {\n\n                that._updateColumnsMenu();\n\n                that._updateColumnsMenuHandler = proxy(that._updateColumnsMenu, that);\n\n                that.owner.bind([\"columnHide\", \"columnShow\"], that._updateColumnsMenuHandler);\n\n                that._updateColumnsLockedStateHandler = proxy(that._updateColumnsLockedState, that);\n\n                that.owner.bind([\"columnUnlock\", \"columnLock\" ], that._updateColumnsLockedStateHandler);\n\n                if (that._isModernComponentType()) {\n                    that.wrapper.on(\"click\" + NS, '.k-columns-item .k-button:not(.k-button-solid-primary)', function () {\n                        that._updateColumnsMenu();\n                    });\n                    that.wrapper.on(\"click\" + NS, '.k-columns-item .k-button.k-button-solid-primary', proxy(that._applyColumnVisibility, that));\n                    that.wrapper.on(\"click\" + NS, '.k-columns-item .k-checkbox', function () {\n                        that._updateColumnsMenu(true);\n                    });\n                } else {\n                    that.menu.bind(SELECT, function(e) {\n                        var item = $(e.item),\n                            input,\n                            column,\n                            uidAttr = kendo.attr(\"uid\"),\n                            colIdx = 0,\n                            columns = grep(leafColumns(that.owner.columns), function(col) {\n                                var result = true,\n                                    title = trim(col.title || \"\");\n\n                                if (col.menu === false || (!col.field && !title.length)) {\n                                    result = false;\n                                }\n\n                                return result;\n                            });\n\n                        if (that._isMobile) {\n                            e.preventDefault();\n                        }\n\n                        if (!item.parent().closest(\"li.k-columns-item\")[0]) {\n                            return;\n                        }\n\n                        input = item.find(\":checkbox\");\n                        if (input.attr(\"disabled\")) {\n                            return;\n                        }\n\n                        colIdx = columns.map(function (col) {\n                            return col.headerAttributes.id;\n                        }).indexOf(input.attr(uidAttr));\n                        column = columns[colIdx];\n\n                        if (column.hidden === true) {\n                            that.owner.showColumn(column);\n                        } else {\n                            that.owner.hideColumn(column);\n                        }\n                    });\n                }\n            }\n        },\n\n        _applyColumnVisibility: function () {\n            var that = this;\n            var fieldAttr = kendo.attr(\"field\");\n            var uidAttr = kendo.attr(\"uid\");\n            var checkboxes = that.wrapper.find(\".k-columns-item input[\" + fieldAttr + \"]\");\n            var columnsInMenu = grep(leafColumns(this.owner.columns), function(col) {\n                var result = true,\n                    title = trim(col.title || \"\");\n\n                if (col.menu === false || (!col.field && !title.length)) {\n                    result = false;\n                }\n\n                return result;\n            });\n            var length = checkboxes.length;\n            var idx;\n            var colIdx;\n            var checkbox;\n            var column;\n\n            that.owner.unbind(\"columnShow\", that._updateColumnsMenuHandler);\n            that.owner.unbind(\"columnHide\", that._updateColumnsMenuHandler);\n\n            for (idx = 0; idx < length; idx++) {\n                checkbox = $(checkboxes[idx]);\n                colIdx = columnsInMenu.map(function (col) {\n                    return col.headerAttributes.id;\n                }).indexOf(checkbox.attr(uidAttr));\n                column = columnsInMenu[colIdx];\n\n               if (checkbox.is(\":checked\") && column.hidden) {\n                   that.owner.showColumn(column);\n               } else if (checkbox.is(\":not(:checked)\") && !column.hidden) {\n                   that.owner.hideColumn(column);\n               }\n            }\n            that.popup.close();\n            that.owner.bind([\"columnHide\", \"columnShow\"], that._updateColumnsMenuHandler);\n        },\n\n        _updateColumnsMenu: function(omitCheckState) {\n            var idx, length, current, checked, locked, that = this;\n            var fieldAttr = kendo.attr(\"field\"),\n                lockedAttr = kendo.attr(\"locked\"),\n                uidAttr = kendo.attr(\"uid\"),\n                columnIndexMap = {},\n                columnsCount = 0,\n                colIdx = 0;\n                omitCheckState = omitCheckState === true;\n                var columnsInMenu = grep(leafColumns(this.owner.columns), function(col, idx) {\n                    var result = true,\n                        title = trim(col.title || \"\");\n\n                    if (col.menu === false || (!col.field && !title.length)) {\n                        result = false;\n                    }\n\n                    if (result) {\n                        columnIndexMap[idx] = columnsCount;\n                        columnsCount++;\n                    }\n\n                    return result;\n                }),\n                visibleFields = grep(this._ownerColumns(), function(field) {\n                    if (omitCheckState) {\n                         return that.wrapper.find(\"[role='menuitemcheckbox'] [\" + uidAttr + \"='\" + field.uid + \"']\").prop('checked');\n                    }\n                    return !field.hidden && field.matchesMedia !== false;\n                }),\n                visibleDataFields = grep(visibleFields, function(field) {\n                    return field.originalField;\n                }),\n                lockedCount = grep(visibleDataFields, function(col) {\n                    return col.locked === true;\n                }).length,\n                nonLockedCount = grep(visibleDataFields, function(col) {\n                    return col.locked !== true;\n                }).length,\n                columnsNotInMenu = grep(this.owner.columns, function(col) {\n                    return col.menu === false;\n                }),\n                hiddenColumnsNotInMenu = grep(columnsNotInMenu, function(col) {\n                    return col.hidden;\n                });\n\n            this.wrapper.find(\"[role='menuitemcheckbox']\").attr(\"aria-checked\", false);\n\n            var checkboxes = this.wrapper\n                .find(\".k-columns-item input[\" + fieldAttr + \"]\")\n                .prop(\"disabled\", false);\n\n            if (!omitCheckState) {\n                checkboxes.prop(\"checked\", false);\n            }\n\n            var switchWidget;\n\n            for (idx = 0, length = checkboxes.length; idx < length; idx ++) {\n                current = checkboxes.eq(idx);\n                locked = current.attr(lockedAttr) === \"true\";\n                checked = false;\n                switchWidget = current.data(\"kendoSwitch\");\n                colIdx = columnsInMenu.map(function (col) {\n                    return col.headerAttributes.id;\n                }).indexOf(current.attr(uidAttr));\n\n                checked = omitCheckState ? current.prop('checked') : !columnsInMenu[colIdx].hidden && columnsInMenu[colIdx].matchesMedia !== false;\n                current.prop(\"checked\", checked);\n\n                if (switchWidget) {\n                    switchWidget.enable(true);\n                    switchWidget.check(checked);\n                }\n\n                current.closest(\"[role='menuitemcheckbox']\").attr(\"aria-checked\", checked);\n\n                if (checked) {\n                    if (lockedCount == 1 && locked) {\n                        current.prop(\"disabled\", true);\n\n                        if (switchWidget) {\n                            switchWidget.enable(false);\n                        }\n                    }\n\n                    if ((columnsNotInMenu.length === 0 || (columnsNotInMenu.length ===  hiddenColumnsNotInMenu.length)) && nonLockedCount == 1 && !locked) {\n                        current.prop(\"disabled\", true);\n\n                        if (switchWidget) {\n                            switchWidget.enable(false);\n                        }\n                    }\n                }\n            }\n        },\n\n        _updateColumnsLockedState: function() {\n            var idx, length, current, column;\n            var fieldAttr = kendo.attr(\"field\");\n            var lockedAttr = kendo.attr(\"locked\");\n            var columns = toHash(this._ownerColumns(), \"field\");\n            var checkboxes = this.wrapper\n                .find(\".k-columns-item input[type=checkbox]\");\n\n            for (idx = 0, length = checkboxes.length; idx < length; idx ++ ) {\n                current = checkboxes.eq(idx);\n                column = columns[current.attr(fieldAttr)];\n                if (column) {\n                    current.attr(lockedAttr, column.locked);\n                }\n            }\n\n            this._updateColumnsMenu();\n        },\n\n        _filter: function() {\n            var that = this,\n                widget = FILTERMENU,\n                options = that.options;\n\n            if (options.filterable !== false) {\n\n                if (options.filterable.multi) {\n                    widget = \"kendoFilterMultiCheck\";\n                    if (options.filterable.dataSource) {\n                        options.filterable.checkSource = options.filterable.dataSource;\n                        delete options.filterable.dataSource;\n                    }\n                }\n                that.filterMenu = that.wrapper.find(\".k-filterable\")[widget](\n                    extend(true, {}, {\n                        appendToElement: true,\n                        dataSource: options.dataSource,\n                        values: options.values,\n                        field: that.field,\n                        title: that.title,\n                        change: function(e) {\n                            if (that.trigger(\"filtering\", { filter: e.filter, field: e.field })) {\n                                e.preventDefault();\n                            }\n                        },\n                        componentType: that.options.componentType,\n                        cycleForm: !that._isModernComponentType()\n                    },\n                    options.filterable)\n                    ).data(widget);\n\n                if (that._isMobile) {\n                    that.menu.bind(SELECT, function(e) {\n                        var item = $(e.item);\n\n                        if (item.hasClass(\"k-filter-item\")) {\n                            that.pane.navigate(that.filterMenu.view, that.options.animations.left);\n                        }\n                    });\n                }\n            }\n        },\n\n        _lockColumns: function() {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                that.wrapper.on(\"click\" + NS, \".k-lock, .k-unlock\", proxy(that._lockableHandler, that));\n            } else {\n                that.menu.bind(SELECT, proxy(that._lockableHandler, that));\n            }\n        },\n\n        _lockableHandler: function(e) {\n            var that = this;\n            var item = e.item ? $(e.item) : $(e.target);\n\n            if (item.hasClass(\"k-lock\")) {\n                that.owner.lockColumn(that.field);\n                if (!that._isMobile) {\n                    that.close();\n                }\n            } else if (item.hasClass(\"k-unlock\")) {\n                that.owner.unlockColumn(that.field);\n                if (!that._isMobile) {\n                    that.close();\n                }\n            }\n        },\n\n        _stickyColumns: function() {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                that.wrapper.on(\"click\" + NS, \".k-stick, .k-unstick\", proxy(that._stickableHandler, that));\n            } else {\n                that.menu.bind(SELECT, proxy(that._stickableHandler, that));\n            }\n        },\n\n        _stickableHandler: function(e) {\n            var that = this;\n            var item = e.item ? $(e.item) :$(e.target);\n            var field = that.field;\n            var columns = that.owner.columns;\n            var column = grep(columns, function(column) {\n                return column.field == field || column.title == field;\n            })[0];\n\n            if (item.hasClass(\"k-stick\")) {\n                that.owner.stickColumn(that.field);\n                that.trigger(STICK, { column: column });\n                if (!that._isMobile) {\n                    that.close();\n                }\n            } else if (item.hasClass(\"k-unstick\")) {\n                that.owner.unstickColumn(that.field);\n                that.trigger(UNSTICK, { column: column });\n                if (!that._isMobile) {\n                    that.close();\n                }\n            }\n        },\n\n        _updateLockedColumns: function() {\n            var field = this.field;\n            var columns = this.owner.columns;\n            var column = grep(columns, function(column) {\n                return column.field == field || column.title == field;\n            })[0];\n\n            if (!column) {\n                return;\n            }\n\n            var locked = column.locked === true;\n            var length = grep(columns, function(column) {\n                return !column.hidden && ((column.locked && locked) || (!column.locked && !locked));\n            }).length;\n            var notLockable = column.lockable === false;\n\n            var lockItem = this.wrapper.find(\".k-lock\").removeClass(\"k-state-disabled\");\n            var unlockItem = this.wrapper.find(\".k-unlock\").removeClass(\"k-state-disabled\");\n\n            if (locked || length == 1 || notLockable) {\n                lockItem.addClass(\"k-state-disabled\");\n            }\n\n            if (!locked || length == 1 || notLockable) {\n                unlockItem.addClass(\"k-state-disabled\");\n            }\n\n            this._updateColumnsLockedState();\n        },\n\n        _updateStickyColumns: function() {\n            var field = this.field;\n            var columns = this.owner.columns;\n            var column = grep(columns, function(column) {\n                return column.field == field || column.title == field;\n            })[0];\n\n            if (!column) {\n                return;\n            }\n\n            var sticky = column.sticky === true;\n            var stickable  = column.stickable  === true;\n            var locked = column.locked === true;\n            var length = grep(columns, function(column) {\n                return !column.hidden && ((column.locked && locked) || (!column.locked && !locked));\n            }).length;\n\n            var stickItem = this.wrapper.find(\".k-stick\").removeClass(\"k-state-disabled\");\n            var unstickItem = this.wrapper.find(\".k-unstick\").removeClass(\"k-state-disabled\");\n\n            if (sticky || !stickable || (locked && length === 1)) {\n                stickItem.addClass(\"k-state-disabled\");\n            }\n\n            if (!sticky || !stickable) {\n                unstickItem.addClass(\"k-state-disabled\");\n            }\n        },\n\n        refresh: function() {\n            var that = this,\n                sort = that.options.dataSource.sort() || [],\n                descriptor,\n                field = that.field,\n                idx,\n                length;\n\n            that.wrapper.find(\".k-sort-asc, .k-sort-desc\").removeClass(ACTIVE);\n\n            for (idx = 0, length = sort.length; idx < length; idx++) {\n               descriptor = sort[idx];\n\n               if (field == descriptor.field) {\n                    that.wrapper.find(\".k-sort-\" + descriptor.dir).addClass(ACTIVE);\n               }\n            }\n\n            that.link[that._filterExist(that.dataSource.filter()) ? \"addClass\" : \"removeClass\"](\"k-state-active\");\n        },\n\n        _filterExist: function(filters) {\n            var found = false;\n            var filter;\n\n            if (!filters) {\n                return;\n            }\n\n            filters = filters.filters;\n\n            for (var idx = 0, length = filters.length; idx < length; idx++) {\n                filter = filters[idx];\n\n                if (filter.field == this.field) {\n                    found = true;\n                } else if (filter.filters) {\n                    found = found || this._filterExist(filter);\n                }\n            }\n\n            return found;\n        }\n    });\n\n    var modernTemplate =    '#if(sortable){#'+\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div>' +\n                                        '<div class=\"k-columnmenu-item k-sort-asc\" tabindex=\"0\">' +\n                                            '<span class=\"k-icon k-i-sort-asc-sm\"></span>${messages.sortAscending}' +\n                                        '</div>' +\n                                    '</div>' +\n                                    '<div>' +\n                                        '<div class=\"k-columnmenu-item k-sort-desc\" tabindex=\"0\">' +\n                                            '<span class=\"k-icon k-i-sort-desc-sm\"></span>${messages.sortDescending}' +\n                                        '</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#'+\n                            '#if(showColumns){#'+\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div>' +\n                                        '<div class=\"k-columnmenu-item-content k-columns-item\">' +\n                                            '<div class=\"k-column-list-wrapper\">'+\n                                                '<div class=\"k-column-list\" role=\"menu\">' +\n                                                '#for (var idx = 0; idx < columns.length; idx++) {#'+\n                                                    '#if(columns[idx].groupHeader){#' +\n                                                        '<span class=\"k-column-menu-group-header\"><span class=\"k-column-menu-group-header-text\">#=columns[idx].title#</span></span>'+\n                                                    '#} else {#' +\n                                                        '<label class=\"k-column-list-item\" role=\"menuitemcheckbox\" aria-checked=\"false\" #=columns[idx].matchesMedia === false ? \"style=\\'display:none;\\'\" : \"\"#><input class=\"k-checkbox k-checkbox-md k-rounded-md\" type=\"checkbox\" title=\"#=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#\" data-#=ns#field=\"#=columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\" data-#=ns#index=\"#=columns[idx].index#\" data-#=ns#locked=\"#=columns[idx].locked#\" data-#=ns#uid=\"#=columns[idx].uid#\"/><span class=\"k-checkbox-label\"> #=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#</span></label>'+\n                                                    '#}#'+\n                                                '#}#'+\n                                                '</div>' +\n                                            '</div>'+\n                                            '<div class=\"k-columnmenu-actions\">' +\n                                                '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\" type=\"button\">${messages.reset}</button>' +\n                                                '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\" type=\"button\">${messages.apply}</button>' +\n                                            '</div>' +\n                                        '</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#'+\n                            '#if(filterable){#'+\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div class=\"k-columnmenu-item-content k-column-menu-filter\">' +\n                                        '<div class=\"k-filterable\"></div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#'+\n                            '#if(hasLockableColumns || hasStickableColumns){#'+\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div class=\"k-column-menu-position\">' +\n                                        '#if(hasLockableColumns){#'+\n                                            '<div class=\"k-columnmenu-item k-lock\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-lock\"></span>${messages.lock}' +\n                                            '</div>' +\n                                            '<div class=\"k-columnmenu-item k-unlock\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-unlock\"></span>${messages.unlock}' +\n                                            '</div>' +\n                                        '#}#'+\n                                        '#if(hasStickableColumns){#'+\n                                            '<div class=\"k-columnmenu-item k-stick\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-stick\"></span>${messages.stick}' +\n                                            '</div>' +\n                                            '<div class=\"k-columnmenu-item k-unstick\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-unstick\"></span>${messages.unstick}' +\n                                            '</div>' +\n                                        '#}#'+\n                                    '</div>' +\n                                '</div>' +\n                            '#}#';\n\n    var template = '<ul id=\"#=uid#\">'+\n                          '#if(sortable){#'+\n                              '<li class=\"k-item k-menu-item k-sort-asc\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-sort-asc-sm\"></span><span class=\"k-menu-link-text\">${messages.sortAscending}</span></span></li>'+\n                              '<li class=\"k-item k-menu-item k-sort-desc\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-sort-desc-sm\"></span><span class=\"k-menu-link-text\">${messages.sortDescending}</span></span></li>'+\n                              '#if(showColumns || filterable){#'+\n                                  '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>'+\n                              '#}#'+\n                          '#}#'+\n                          '#if(showColumns){#'+\n                              '<li class=\"k-item k-menu-item k-columns-item\" aria-haspopup=\"true\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-columns\"></span><span class=\"k-menu-link-text\">${messages.columns}</span></span><ul>'+\n                              '#for (var idx = 0; idx < columns.length; idx++) {#'+\n                                  '#if(columns[idx].groupHeader){#' +\n                                      '<li class=\"k-column-menu-group-header\" #=omitWrapAttribute#=\"true\" ><span class=\"k-column-menu-group-header-text\">#=columns[idx].title#</span></li>'+\n                                  '#} else {#' +\n                                      '<li role=\"menuitemcheckbox\" aria-checked=\"false\" #=columns[idx].matchesMedia === false ? \"style=\\'display:none;\\'\" : \"\"#><input type=\"checkbox\" class=\"k-checkbox k-checkbox-md k-rounded-md\" title=\"#=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#\" data-#=ns#field=\"#=columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\" data-#=ns#index=\"#=columns[idx].index#\" data-#=ns#locked=\"#=columns[idx].locked#\" data-#=ns#uid=\"#=columns[idx].uid#\"/>#=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#</li>'+\n                                  '#}#'+\n                              '#}#'+\n                              '</ul></li>'+\n                              '#if(filterable || hasLockableColumns || hasStickableColumns){#'+\n                                  '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>'+\n                              '#}#'+\n                          '#}#'+\n                          '#if(filterable){#'+\n                              '<li class=\"k-item k-menu-item k-filter-item\" aria-haspopup=\"true\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-filter\"></span><span class=\"k-menu-link-text\">${messages.filter}</span></span><ul>'+\n                                  '<li><div class=\"k-filterable\"></div></li>'+\n                              '</ul></li>'+\n                              '#if(hasLockableColumns || hasStickableColumns){#'+\n                                  '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>'+\n                              '#}#'+\n                          '#}#'+\n                          '#if(hasLockableColumns || hasStickableColumns){#'+\n                              '<li class=\"k-item k-menu-item k-position-item\" aria-haspopup=\"true\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-set-column-position\"></span><span class=\"k-menu-link-text\">${messages.setColumnPosition}</span></span><ul>'+\n                                  '#if(hasLockableColumns){#'+\n                                      '<li class=\"k-item k-menu-item k-lock\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-lock\"></span><span class=\"k-menu-link-text\">${messages.lock}</span></span></li>'+\n                                      '<li class=\"k-item k-menu-item k-unlock\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-unlock\"></span><span class=\"k-menu-link-text\">${messages.unlock}</span></span></li>'+\n                                      '#if(hasStickableColumns){#'+\n                                          '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>'+\n                                      '#}#'+\n                                  '#}#'+\n                                  '#if(hasStickableColumns){#'+\n                                      '<li class=\"k-item k-menu-item k-stick\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-stick\"></span><span class=\"k-menu-link-text\">${messages.stick}</span></span></li>'+\n                                      '<li class=\"k-item k-menu-item k-unstick\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-unstick\"></span><span class=\"k-menu-link-text\">${messages.unstick}</span></span></li>'+\n                                  '#}#'+\n                              '</ul></li>'+\n                          '#}#'+\n                    '</ul>';\n\n    var mobileTemplate =\n            '<div data-#=ns#role=\"view\" class=\"k-grid-column-menu\">' +\n                '<div data-#=ns#role=\"header\" class=\"k-header\">' +\n                    '<a href=\"\\\\#\" class=\"k-header-cancel k-link\" title=\"#=messages.cancel#\" ' +\n                    'aria-label=\"#=messages.cancel#\"><span class=\"k-icon k-i-arrow-chevron-left\"></span></a>' +\n                    '${messages.settings}' +\n                    '<a href=\"\\\\#\" class=\"k-header-done k-link\" title=\"#=messages.done#\" ' +\n                    'aria-label=\"#=messages.done#\"><span class=\"k-icon k-i-check\"></span></a>' +\n                '</div>' +\n                '<div class=\"k-column-menu\">' +\n                    '<ul class=\"k-reset\">' +\n                        '<li>' +\n                            '<span class=\"k-list-title\">#=messages.column#: ${title}</span>' +\n                            '<ul class=\"k-listgroup k-listgroup-flush k-mb-4\">' +\n                                '#if(sortable){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-sort-asc\"><span class=\"k-link\"><span class=\"k-icon k-i-sort-asc-sm\"></span><span class=\"k-item-title\">${messages.sortAscending}</span></span></li>' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-sort-desc\"><span class=\"k-link\"><span class=\"k-icon k-i-sort-desc-sm\"></span><span class=\"k-item-title\">${messages.sortDescending}</span></span></li>' +\n                                '#}#' +\n                                '#if(hasLockableColumns){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-lock\"><span class=\"k-link\"><span class=\"k-icon k-i-lock\"></span><span class=\"k-item-title\">${messages.lock}</span></span></li>' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-unlock\"><span class=\"k-link\"><span class=\"k-icon k-i-unlock\"></span><span class=\"k-item-title\">${messages.unlock}</span></span></li>' +\n                                '#}#' +\n                                '#if(hasStickableColumns){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-stick\"><span class=\"k-link\"><span class=\"k-icon k-i-stick\"></span><span class=\"k-item-title\">${messages.stick}</span></span></li>' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-unstick\"><span class=\"k-link\"><span class=\"k-icon k-i-unstick\"></span><span class=\"k-item-title\">${messages.unstick}</span></span></li>' +\n                                '#}#' +\n                                '#if(filterable){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-filter-item\">' +\n                                        '<span class=\"k-link k-filterable\">' +\n                                            '<span class=\"k-icon k-i-filter\"></span>' +\n                                            '<span class=\"k-item-title\">${messages.filter}</span>' +\n                                            '<span class=\"k-select\"><span class=\"k-icon k-i-arrow-chevron-right\"></span></span>' +\n                                        '</span>' +\n                                    '</li>' +\n                                '#}#' +\n                            '</ul>' +\n                        '</li>' +\n                        '#if(showColumns){#' +\n                            '<li class=\"k-columns-item\"><span class=\"k-list-title\">${messages.columnVisibility}</span>' +\n                                '#if(hasGroups){#' +\n                                    '#for (var i = 0; i < groups.length; i++) {#' +\n                                        '<span class=\"k-list-group-header k-pb-1\">#:groups[i].title#</span>' +\n                                        '<ul class=\"k-listgroup k-listgroup-flush k-mb-4\">' +\n                                            '#for (var idx = 0; idx < groups[i].columns.length; idx++) {#' +\n                                                '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item\">' +\n                                                    '<span class=\"k-listgroup-form-row\">' +\n                                                        '<span class=\"k-listgroup-form-field-label k-item-title\">' +\n                                                            '#=groups[i].columns[idx].title#' +\n                                                        '</span>' +\n                                                        '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                                            '<input type=\"checkbox\" title=\"#=groups[i].columns[idx].title#\" ' +\n                                                                ' data-#=ns#field=\"#=groups[i].columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\"' +\n                                                                ' data-#=ns#index=\"#=groups[i].columns[idx].index#\"' +\n                                                                ' data-#=ns#uid=\"#=groups[i].columns[idx].uid#\"' +\n                                                                ' data-#=ns#locked=\"#=groups[i].columns[idx].locked#\" />' +\n                                                        '</span>' +\n                                                    '</span>' +\n                                                '</li>' +\n                                            '#}#' +\n                                        '</ul>' +\n                                    '#}#' +\n                                '#} else {#' +\n                                    '<ul class=\"k-listgroup k-listgroup-flush k-mb-4\">' +\n                                    '#for (var idx = 0; idx < columns.length; idx++) {#' +\n                                        '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item\">' +\n                                            '<span class=\"k-listgroup-form-row\">' +\n                                                '<span class=\"k-listgroup-form-field-label k-item-title\">' +\n                                                    '#=columns[idx].title#' +\n                                                '</span>' +\n                                                '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                                    '<input type=\"checkbox\" title=\"#=columns[idx].title#\" ' +\n                                                        ' data-#=ns#field=\"#=columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\"' +\n                                                        ' data-#=ns#index=\"#=columns[idx].index#\"' +\n                                                        ' data-#=ns#uid=\"#=columns[idx].uid#\"' +\n                                                        ' data-#=ns#locked=\"#=columns[idx].locked#\" />' +\n                                                '</span>' +\n                                            '</span>' +\n                                        '</li>' +\n                                    '#}#' +\n                                    '</ul>' +\n                                '#}#'+\n                            '</li>'+\n                        '#}#'+\n                        '<li class=\"k-item k-clear-wrap\">' +\n                            '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                                '<li class=\"k-listgroup-item\">' +\n                                    '<span class=\"k-link k-label k-clear\" title=\"#=messages.clear#\" aria-label=\"#=messages.clear#\">' +\n                                        '#=messages.clear#' +\n                                    '</span>' +\n                                '</li>' +\n                            '</ul>' +\n                        '</li>' +\n                    '</ul>' +\n                '</div>'+\n            '</div>';\n\n    var MobileMenu = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            Widget.fn.init.call(that, element, options);\n\n            that._createCheckBoxes();\n\n            that.element.on(\"click\" + NS, \"li.k-item:not(.k-separator):not(.k-state-disabled):not(:has(.k-switch))\", \"_click\");\n        },\n\n        events: [ SELECT ],\n\n        _click: function(e) {\n            var that = this;\n\n            if (!$(e.target).is(\"[type=checkbox]\")) {\n                e.preventDefault();\n            }\n\n            if ($(e.target).hasClass(\"k-clear\")) {\n                that._cancelChanges(true);\n\n                return;\n            }\n\n            if ($(e.target).hasClass(\"k-filterable\")) {\n                that._cancelChanges(true);\n                that.trigger(SELECT, { item: e.currentTarget });\n\n                return;\n            }\n\n            that._updateSelectedItems(e.currentTarget);\n        },\n\n        _updateSelectedItems: function(el) {\n            var that = this;\n            var item = $(el);\n            var state = that.options.columnMenu.view.state || { columns: {} };\n            var id = item.prop(\"id\");\n\n            if (item.hasClass(\"k-filter-item\")) {\n                return;\n            }\n\n            if (state[id]) {\n                state[id] = false;\n            } else {\n                state[id] = true;\n            }\n\n            if (item.hasClass(\"k-sort-asc\") || item.hasClass(\"k-sort-desc\")) {\n                var dir;\n                var otherItem;\n                var otherItemId;\n\n                if (item.hasClass(\"k-sort-asc\")) {\n                    dir = \"asc\";\n                    otherItem = that.element.find(\".k-sort-desc\");\n                } else {\n                    dir = \"desc\";\n                    otherItem = that.element.find(\".k-sort-asc\");\n                }\n\n                otherItemId = otherItem.prop(\"id\");\n\n                if (dir === state.initialSort && !item.hasClass(\"k-state-selected\")) {\n                    state[id] = false;\n                }\n\n                if (state[otherItemId]) {\n                    state[otherItemId] = false;\n                }\n\n                otherItem.removeClass(ACTIVE);\n            }\n\n            if (item.hasClass(ACTIVE)) {\n                item.removeClass(ACTIVE);\n            } else {\n                item.addClass(ACTIVE);\n            }\n        },\n\n        _cancelChanges: function(force) {\n            var that = this;\n            var menu = that.options.columnMenu;\n            var view = menu.view;\n            var state = view.state || { columns: {} };\n            var columns = state.columns;\n\n            that.element.find(\".\" + ACTIVE).removeClass(ACTIVE);\n            menu.refresh();\n\n            if (force) {\n                var selectedItems = [];\n\n                for (var key in columns) {\n                    if (columns.hasOwnProperty(key)) {\n                        if (columns[key] === true) {\n                            var item = view.element.find(\"#\" + key);\n\n                            selectedItems.push(item[0]);\n                        }\n                    }\n                }\n                // In order to use the columns hide/show validation,\n                // triggering the Select event must be done backwards\n                for (var i = selectedItems.length - 1; i >= 0; i--) {\n                    that.trigger(SELECT, { item: selectedItems[i] });\n                }\n\n                if (menu.options.hasLockableColumns) {\n                    menu._updateLockedColumns();\n                }\n\n                if (menu.options.hasStickableColumns) {\n                    menu._updateStickyColumns();\n                }\n            }\n\n            that.options.columnMenu.view.state = { columns: {} };\n        },\n\n        _applyChanges: function() {\n            var that = this;\n            var view = that.options.columnMenu.view;\n            var state = view.state || { columns: {} };\n\n            for (var key in state) {\n                if (state.hasOwnProperty(key)) {\n                    if (key !== \"initialSort\" && key !== \"columns\" && state[key] === true) {\n                        var item = view.element.find(\"#\" + key);\n\n                        if (item.hasClass(ACTIVE)) {\n                            item.removeClass(ACTIVE);\n                        } else {\n                            item.addClass(ACTIVE);\n                        }\n\n                        that.trigger(SELECT, { item: item[0] });\n                    }\n                }\n            }\n        },\n\n        _createCheckBoxes: function() {\n            var that = this;\n\n            that.element.find(\".k-columns-item\").find(\"[type='checkbox']\").kendoSwitch({\n                messages: {\n                    checked: \"\",\n                    unchecked: \"\"\n                },\n                change: function(e) {\n                    var item = e.sender.element.closest(\".k-item\");\n                    var state = that.options.columnMenu.view.state || { columns: {} };\n                    var id = item.prop(\"id\");\n\n                    if (state.columns[id]) {\n                        state.columns[id] = false;\n                    } else {\n                        state.columns[id] = true;\n                    }\n\n                    that.trigger(SELECT, { item: item });\n                }\n            });\n        },\n\n        _destroyCheckBoxes: function() {\n            var that = this;\n            var elements = that.element.find(\".k-columns-item\").find(\"[type='checkbox']\");\n            var switchWidget;\n\n            for (var i = 0; i < elements.length; i++) {\n                switchWidget = elements.eq(i).data(\"kendoSwitch\");\n\n                if (switchWidget) {\n                    switchWidget.destroy();\n                }\n            }\n        },\n\n        close: function() {\n            this.options.pane.navigate(\"\");\n        },\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            that.element.off(NS);\n            that._destroyCheckBoxes();\n        }\n    });\n\n    ui.plugin(ColumnMenu);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","advanced","$","window","kendo","jQuery","undefined","ui","proxy","extend","grep","map","inArray","Comparer","data","ACTIVE","ASC","DESC","CHANGE","INIT","OPEN","SELECT","STICK","UNSTICK","POPUP","FILTERMENU","MENU","EXPANSIONPANEL","NS","Widget","trim","text","replace","toHash","arr","key","result","idx","len","current","length","columnsGroupFilterHandler","column","this","columns","indexOf","title","field","leafColumns","push","concat","attrEquals","attrName","attrValue","attr","insertElementAt","index","element","container","insertAfter","children","eq","prepend","columnOccurrences","columnDict","signature","i","JSON","stringify","oldColumnOccurrences","renderedListElements","checkBoxes","indexAttr","fieldAttr","columCheckbox","j","parseInt","ColumnMenu","init","options","that","componentType","fn","call","owner","dataSource","appendTo","link","_createLink","wrapper","_refreshHandler","refresh","bind","_init","pane","_isMobile","_createMobileMenu","_createMenu","_muteAngularRebind","_angularItems","_sort","_columns","_filter","_lockColumns","_stickyColumns","trigger","events","messages","sortAscending","sortDescending","filter","columnVisibility","clear","cancel","done","settings","lock","unlock","stick","unstick","setColumnPosition","apply","reset","buttonTitle","sortable","filterable","animations","left","encodeTitles","_ownerColumns","flattenMenuCols","menuTemplate","_hasGroups","_groupColumns","_flattenMenuCols","_syncMenuCols","_isModernComponentType","template","modernTemplate","html","uid","guid","ns","showColumns","hasLockableColumns","hasStickableColumns","omitWrapAttribute","popup","anchor","copyAnchorStyles","open","_open","activate","_activate","deactivate","_deactivate","close","e","menu","_closing","sender","closeCallback","addClass","_createExpanders","orientation","closeOnClick","_updateMenuItems","appendTarget","find","format","append","on","_click","expanderOptions","expanded","headerClass","useBareTemplate","menuCols","ownerCols","ownerCol","menuColsFields","col","cols","groupHeader","nest","groups","currGroup","filterHandler","group","groupColumns","mobileTemplate","hasGroups","view","state","MobileMenu","columnMenu","stopPropagation","viewElement","preventDefault","_applyChanges","_cancelChanges","_updateLockedColumns","_updateStickyColumns","initialSort","action","angular","items","closest","_originalObject","elements","destroy","filterMenu","unbind","_updateColumnsMenuHandler","_updateColumnsLockedStateHandler","off","purge","is","navigate","toggle","_setMenuItemsVisibility","sort","_reorderMenuItems","_updateDataIndexes","_eachRenderedMenuItem","renderedListElement","matchesMedia","hide","show","renderedList","first","mappedColumns","x","each","callback","duplicateColumnIndex","fieldValue","currentColumn","_getRenderedList","_getRenderedListElements","oldOccurances","columnOccurrence","columnElements","add","not","keyCode","keys","ENTER","target","click","ESC","omitSort","menuColumns","originalField","hidden","locked","headerAttributes","create","dir","_sortHandler","item","hasClass","_getSortItemsContainer","removeClass","_sortDataSource","parents","parent","compare","allowUnsort","mode","splice","_updateColumnsMenu","_updateColumnsLockedState","_applyColumnVisibility","input","uidAttr","colIdx","showColumn","hideColumn","checkboxes","columnsInMenu","checkbox","omitCheckState","checked","lockedAttr","columnIndexMap","columnsCount","visibleFields","prop","visibleDataFields","lockedCount","nonLockedCount","columnsNotInMenu","hiddenColumnsNotInMenu","switchWidget","enable","check","widget","multi","checkSource","appendToElement","values","change","cycleForm","_lockableHandler","lockColumn","unlockColumn","_stickableHandler","stickColumn","unstickColumn","notLockable","lockable","lockItem","unlockItem","sticky","stickable","stickItem","unstickItem","descriptor","_filterExist","filters","found","_createCheckBoxes","currentTarget","_updateSelectedItems","el","otherItem","otherItemId","force","selectedItems","hasOwnProperty","kendoSwitch","unchecked","_destroyCheckBoxes","plugin","amd","a1","a2","a3"],"mappings":"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"}