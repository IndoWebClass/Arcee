{"version":3,"file":"kendo.filebrowser.min.js","sources":["kendo.filebrowser.js"],"sourcesContent":["/*!\n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n\n*/\n(function(f, define){\n    define('kendo.filebrowser',[ \"./kendo.listview\", \"./kendo.dropdownlist\", \"./kendo.upload\", \"./kendo.breadcrumb\" ], f);\n})(function(){\n\nvar __meta__ = { // jshint ignore:line\n    id: \"filebrowser\",\n    name: \"FileBrowser\",\n    category: \"web\",\n    description: \"\",\n    hidden: true,\n    depends: [ \"selectable\", \"listview\", \"dropdownlist\", \"upload\", \"breadcrumb\" ]\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        Widget = kendo.ui.Widget,\n        isPlainObject = $.isPlainObject,\n        proxy = $.proxy,\n        extend = $.extend,\n        placeholderSupported = kendo.support.placeholder,\n        isFunction = kendo.isFunction,\n        trimSlashesRegExp = /(^\\/|\\/$)/g,\n        CHANGE = \"change\",\n        APPLY = \"apply\",\n        ERROR = \"error\",\n        CLICK = \"click\",\n        NS = \".kendoFileBrowser\",\n        SEARCHBOXNS = \".kendoSearchBox\",\n        NAMEFIELD = \"name\",\n        SIZEFIELD = \"size\",\n        TYPEFIELD = \"type\",\n        DEFAULTSORTORDER = { field: TYPEFIELD, dir: \"asc\" },\n        EMPTYTILE = kendo.template('<div class=\"k-listview-item k-listview-item-empty\"><span class=\"k-file-preview\"><span class=\"k-file-icon k-icon k-i-none\"></span></span><span class=\"k-file-name\">${text}</span></div>'),\n        TOOLBARTMPL = '<div class=\"k-widget k-filebrowser-toolbar k-toolbar k-floatwrap\">' +\n\n                            '# if (showCreate) { #' +\n                                '<button type=\"button\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button\"><span class=\"k-i-button-icon k-icon k-i-folder-add\"></span></button>' +\n                            '# } #' +\n\n                            '# if (showUpload) { # ' +\n                                '<div class=\"k-widget k-upload\">' +\n                                    '<div class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-upload-button\">' +\n                                        '<span class=\"k-button-icon k-icon k-i-plus\"></span>' +\n                                        '<span class=\"k-button-text\">#=messages.uploadFile#</span>' +\n                                        '<input type=\"file\" name=\"file\" />' +\n                                    '</div>' +\n                                '</div>' +\n                            '# } #' +\n\n                            '# if (showDelete) { #' +\n                                '<button type=\"button\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button k-disabled\"><span class=\"k-button-icon k-icon k-i-close\"></span></button>' +\n                            '# } #' +\n                            '<div class=\"k-tiles-arrange\">' +\n                                '<label>#=messages.orderBy#: <select></select></label>' +\n                            '</div>' +\n\n                            '<span class=\"k-toolbar-spacer\"></span>' +\n\n                            '<input data-role=\"searchbox\" />' +\n\n                        '</div>';\n\n    extend(true, kendo.data, {\n        schemas: {\n            \"filebrowser\": {\n                data: function(data) {\n                    return data.items || data || [];\n                },\n                model: {\n                    id: \"name\",\n                    fields: {\n                        name: \"name\",\n                        size: \"size\",\n                        type: \"type\"\n                    }\n                }\n            }\n        }\n    });\n\n    extend(true, kendo.data, {\n        transports: {\n            \"filebrowser\": kendo.data.RemoteTransport.extend({\n                init: function(options) {\n                    kendo.data.RemoteTransport.fn.init.call(this, $.extend(true, {}, this.options, options));\n                },\n                _call: function(type, options) {\n                    options.data = $.extend({}, options.data, { path: this.options.path() });\n\n                    if (isFunction(this.options[type])) {\n                        this.options[type].call(this, options);\n                    } else {\n                        kendo.data.RemoteTransport.fn[type].call(this, options);\n                    }\n                },\n                read: function(options) {\n                    this._call(\"read\", options);\n                },\n                create: function(options) {\n                    this._call(\"create\", options);\n                },\n                destroy: function(options) {\n                    this._call(\"destroy\", options);\n                },\n                update: function() {\n                    //updates are handled by the upload\n                },\n                options: {\n                    read: {\n                        type: \"POST\"\n                    },\n                    update: {\n                        type: \"POST\"\n                    },\n                    create: {\n                        type: \"POST\"\n                    },\n                    destroy: {\n                        type: \"POST\"\n                    }\n                }\n            })\n        }\n    });\n\n    function bindDragEventWrappers(element, onDragEnter, onDragLeave) {\n        var hideInterval, lastDrag;\n\n        element\n            .on(\"dragenter\" + NS, function() {\n                onDragEnter();\n                lastDrag = new Date();\n\n                if (!hideInterval) {\n                    hideInterval = setInterval(function() {\n                        var sinceLastDrag = new Date() - lastDrag;\n                        if (sinceLastDrag > 100) {\n                            onDragLeave();\n\n                            clearInterval(hideInterval);\n                            hideInterval = null;\n                        }\n                    }, 100);\n                }\n            })\n            .on(\"dragover\" + NS, function() {\n                lastDrag = new Date();\n            });\n    }\n\n    function concatPaths(path, name) {\n        if(path === undefined || !path.match(/\\/$/)) {\n            path = (path || \"\") + \"/\";\n        }\n        return path + name;\n    }\n\n    function sizeFormatter(value) {\n        if(!value) {\n            return \"\";\n        }\n\n        var suffix = \" bytes\";\n\n        if (value >= 1073741824) {\n            suffix = \" GB\";\n            value /= 1073741824;\n        } else if (value >= 1048576) {\n            suffix = \" MB\";\n            value /= 1048576;\n        } else  if (value >= 1024) {\n            suffix = \" KB\";\n            value /= 1024;\n        }\n\n        return Math.round(value * 100) / 100 + suffix;\n    }\n\n    function fieldName(fields, name) {\n        var descriptor = fields[name];\n\n        if (isPlainObject(descriptor)) {\n            return descriptor.from || descriptor.field || name;\n        }\n        return descriptor;\n    }\n\n    var FileBrowser = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            options = options || {};\n\n            Widget.fn.init.call(that, element, options);\n\n            that.element.addClass(\"k-filebrowser\");\n\n            that.element\n                .on(CLICK + NS, \".k-filebrowser-toolbar button:not(.k-disabled):has(.k-i-close)\", proxy(that._deleteClick, that))\n                .on(CLICK + NS, \".k-filebrowser-toolbar button:not(.k-disabled):has(.k-i-folder-add)\", proxy(that._addClick, that))\n                .on(\"keydown\" + NS, \".k-listview-item.k-state-selected input\", proxy(that._directoryKeyDown, that))\n                .on(\"blur\" + NS, \".k-listview-item.k-state-selected input\", proxy(that._directoryBlur, that));\n\n            that._dataSource();\n\n            that.refresh();\n\n            that.path(that.options.path);\n        },\n\n        options: {\n            name: \"FileBrowser\",\n            messages: {\n                uploadFile: \"Upload\",\n                orderBy: \"Arrange by\",\n                orderByName: \"Name\",\n                orderBySize: \"Size\",\n                directoryNotFound: \"A directory with this name was not found.\",\n                emptyFolder: \"Empty Folder\",\n                deleteFile: 'Are you sure you want to delete \"{0}\"?',\n                invalidFileType: \"The selected file \\\"{0}\\\" is not valid. Supported file types are {1}.\",\n                overwriteFile: \"A file with name \\\"{0}\\\" already exists in the current directory. Do you want to overwrite it?\",\n                dropFilesHere: \"drop file here to upload\",\n                search: \"Search\"\n            },\n            transport: {},\n            path: \"/\",\n            fileTypes: \"*.*\"\n        },\n\n        events: [ERROR, CHANGE, APPLY],\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            that.dataSource\n                .unbind(ERROR, that._errorHandler);\n\n            that.element\n                .add(that.list)\n                .add(that.toolbar)\n                .off(NS);\n\n            kendo.destroy(that.element);\n        },\n\n        value: function() {\n            var that = this,\n                selected = that._selectedItem(),\n                path,\n                fileUrl = that.options.transport.fileUrl;\n\n            if (selected && selected.get(TYPEFIELD) === \"f\") {\n                path = concatPaths(that.path(), selected.get(NAMEFIELD)).replace(trimSlashesRegExp, \"\");\n                if (fileUrl) {\n                    path = isFunction(fileUrl) ? fileUrl(path) : kendo.format(fileUrl, encodeURIComponent(path));\n                }\n                return path;\n            }\n        },\n\n        _selectedItem: function() {\n            var listView = this.listView,\n                selected = listView.select();\n\n            if (selected.length) {\n                return this.dataSource.getByUid(selected.attr(kendo.attr(\"uid\")));\n            }\n        },\n\n        _toolbar: function() {\n            var that = this,\n                template = kendo.template(TOOLBARTMPL),\n                messages = that.options.messages,\n                arrangeBy = [\n                    { text: messages.orderByName, value: \"name\" },\n                    { text: messages.orderBySize, value: \"size\" }\n                ];\n\n            that.toolbar = $(template({\n                    messages: messages,\n                    showUpload: that.options.transport.uploadUrl,\n                    showCreate: that.options.transport.create,\n                    showDelete: that.options.transport.destroy\n                }))\n                .appendTo(that.element)\n                .find(\".k-upload input\")\n                .kendoUpload({\n                    multiple: false,\n                    localization: {\n                        dropFilesHere: messages.dropFilesHere\n                    },\n                    async: {\n                        saveUrl: that.options.transport.uploadUrl,\n                        autoUpload: true\n                    },\n                    upload: proxy(that._fileUpload, that),\n                    error: function(e) {\n                        that._error({ xhr: e.XMLHttpRequest, status: \"error\" });\n                    }\n                }).end();\n\n            that.upload = that.toolbar\n                .find(\".k-upload input\")\n                .data(\"kendoUpload\");\n\n            that.arrangeBy = that.toolbar.find(\".k-tiles-arrange select\")\n                .kendoDropDownList({\n                    dataSource: arrangeBy,\n                    dataTextField: \"text\",\n                    dataValueField: \"value\",\n                    change: function() {\n                        that.orderBy(this.value());\n                    }\n                })\n                .data(\"kendoDropDownList\");\n\n            that.searchBox = that.toolbar.find(\"input[data-role='searchbox']\")\n                .kendoSearchBox({\n                    label: that.options.messages.search,\n                    change: function() {\n                        that.search(this.value());\n                    }\n                }).data(\"kendoSearchBox\");\n\n            that._attachDropzoneEvents();\n        },\n\n        _attachDropzoneEvents: function() {\n            var that = this;\n\n            if (that.options.transport.uploadUrl) {\n                bindDragEventWrappers($(document.documentElement),\n                    $.proxy(that._dropEnter, that),\n                    $.proxy(that._dropLeave, that)\n                );\n                that._scrollHandler = proxy(that._positionDropzone, that);\n            }\n        },\n\n        _dropEnter: function() {\n            this._positionDropzone();\n            $(document).on(\"scroll\" + NS, this._scrollHandler);\n        },\n\n        _dropLeave: function() {\n            this._removeDropzone();\n            $(document).off(\"scroll\" + NS, this._scrollHandler);\n        },\n\n        _positionDropzone: function() {\n            var that = this,\n                element = that.element,\n                offset = element.offset();\n\n            that.toolbar.find(\".k-dropzone\")\n                .addClass(\"k-filebrowser-dropzone\")\n                .offset(offset)\n                .css({\n                    width: element[0].clientWidth,\n                    height: element[0].clientHeight,\n                    lineHeight: element[0].clientHeight + \"px\"\n                });\n        },\n\n        _removeDropzone: function() {\n            this.toolbar.find(\".k-dropzone\")\n                .removeClass(\"k-filebrowser-dropzone\")\n                .css({ width: \"\", height: \"\", lineHeight: \"\", top: \"\", left: \"\" });\n        },\n\n        _deleteClick: function() {\n            var that = this,\n                item = that.listView.select(),\n                message = kendo.format(that.options.messages.deleteFile, item.find(\".k-file-name\").text());\n\n            if (item.length && that._showMessage(message, \"confirm\")) {\n                that.listView.remove(item);\n            }\n        },\n\n        _addClick: function() {\n            this.createDirectory();\n        },\n\n        _getFieldName: function(name) {\n            return fieldName(this.dataSource.reader.model.fields, name);\n        },\n\n        _fileUpload: function(e) {\n            var that = this,\n                options = that.options,\n                fileTypes = options.fileTypes,\n                filterRegExp = new RegExp((\"(\" + fileTypes.split(\",\").join(\")|(\") + \")\").replace(/\\*\\./g , \".*.\"), \"i\"),\n                fileName = e.files[0].name,\n                fileSize = e.files[0].size,\n                fileNameField = NAMEFIELD,\n                sizeField = SIZEFIELD,\n                file;\n\n            if (filterRegExp.test(fileName)) {\n                e.data = { path: that.path() };\n\n                file = that._createFile(fileName, fileSize);\n\n                if (!file) {\n                    e.preventDefault();\n                } else {\n                    that.upload.one(\"success\", function(e) {\n                        var model = that._insertFileToList(file);\n\n                        if(model._override) {\n                            model.set(fileNameField, e.response[that._getFieldName(fileNameField)]);\n                            model.set(sizeField, e.response[that._getFieldName(sizeField)]);\n\n                            that.listView.dataSource.pushUpdate(model);\n                        }\n\n                        that._tiles = that.listView.items().filter(\"[\" + kendo.attr(\"type\") + \"=f]\");\n                    });\n                }\n            } else {\n                e.preventDefault();\n                that._showMessage(kendo.format(options.messages.invalidFileType, fileName, fileTypes));\n            }\n        },\n\n        _findFile: function(name) {\n            var data = this.dataSource.data(),\n                idx,\n                result,\n                typeField = TYPEFIELD,\n                nameField = NAMEFIELD,\n                length;\n\n            name = name.toLowerCase();\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (data[idx].get(typeField) === \"f\" &&\n                    data[idx].get(nameField).toLowerCase() === name) {\n\n                    result = data[idx];\n                    break;\n                }\n            }\n            return result;\n        },\n\n        _createFile: function(fileName, fileSize) {\n            var that = this,\n                model = {},\n                typeField = TYPEFIELD,\n                file = that._findFile(fileName);\n\n            if (file) {\n                if (!that._showMessage(kendo.format(that.options.messages.overwriteFile, fileName), \"confirm\")) {\n                    return null;\n                } else {\n                    file._override = true;\n                    return file;\n                }\n            }\n\n            model[typeField] = \"f\";\n            model[NAMEFIELD] = fileName;\n            model[SIZEFIELD] = fileSize;\n\n            return model;\n        },\n\n        _insertFileToList: function(model) {\n            var index;\n            if(model._override) {\n                return model;\n            }\n\n            var dataSource = this.dataSource;\n            var view = dataSource.view();\n\n            for (var i = 0, length = view.length; i < length; i++) {\n                if (view[i].get(TYPEFIELD) === \"f\") {\n                    index = i;\n                    break;\n                }\n            }\n\n            return dataSource.insert(++index, model);\n        },\n\n        createDirectory: function() {\n            var that = this,\n                idx,\n                length,\n                lastDirectoryIdx = 0,\n                typeField = TYPEFIELD,\n                nameField = NAMEFIELD,\n                view = that.dataSource.data(),\n                name = that._nameDirectory(),\n                model = new that.dataSource.reader.model();\n\n            for (idx = 0, length = view.length; idx < length; idx++) {\n                if (view[idx].get(typeField) === \"d\") {\n                    lastDirectoryIdx = idx;\n                }\n            }\n\n            model.set(typeField, \"d\");\n            model.set(nameField, name);\n\n            that.listView.one(\"dataBound\", function() {\n                var selected = that.listView.items()\n                    .filter(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n\n                if (selected.length) {\n                    this.edit(selected);\n                }\n\n                this.element.scrollTop(selected.attr(\"offsetTop\") - this.element[0].offsetHeight);\n\n                setTimeout(function() {\n                    that.listView.element.find('.k-edit-item input').select();\n                });\n            })\n            .one(\"save\", function(e) {\n                var value = e.model.get(nameField);\n\n                if (!value) {\n                    e.model.set(nameField, name);\n                } else {\n                    e.model.set(nameField, that._nameExists(value, model.uid) ? that._nameDirectory() : value);\n                }\n            });\n\n            that.dataSource.insert(++lastDirectoryIdx, model);\n        },\n\n        _directoryKeyDown: function(e) {\n            if (e.keyCode == 13) {\n                e.currentTarget.blur();\n            }\n        },\n\n        _directoryBlur: function() {\n            this.listView.save();\n        },\n\n        _nameExists: function(name, uid) {\n            var data = this.dataSource.data(),\n                typeField = TYPEFIELD,\n                nameField = NAMEFIELD,\n                idx,\n                length;\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (data[idx].get(typeField) === \"d\" &&\n                    data[idx].get(nameField).toLowerCase() === name.toLowerCase() &&\n                    data[idx].uid !== uid) {\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        _nameDirectory: function() {\n            var name = \"New folder\",\n                data = this.dataSource.data(),\n                directoryNames = [],\n                typeField = TYPEFIELD,\n                nameField = NAMEFIELD,\n                candidate,\n                idx,\n                length;\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (data[idx].get(typeField) === \"d\" && data[idx].get(nameField).toLowerCase().indexOf(name.toLowerCase()) > -1) {\n                    directoryNames.push(data[idx].get(nameField));\n                }\n            }\n\n            if ($.inArray(name, directoryNames) > -1) {\n                idx = 2;\n\n                do {\n                    candidate = name + \" (\" + idx + \")\";\n                    idx++;\n                } while ($.inArray(candidate, directoryNames) > -1);\n\n                name = candidate;\n            }\n\n            return name;\n        },\n\n        orderBy: function(field) {\n            this.dataSource.sort([\n                { field: TYPEFIELD, dir: \"asc\" },\n                { field: field, dir: \"asc\" }\n            ]);\n        },\n\n        search: function(name) {\n            this.dataSource.filter({\n                field: NAMEFIELD,\n                operator: \"contains\",\n                value: name\n            });\n        },\n\n        _content: function() {\n            var that = this;\n\n            that.list = $('<div class=\"k-filemanager-listview\" />')\n                .appendTo(that.element)\n                .on(\"dblclick\" + NS, \".k-listview-item\", proxy(that._dblClick, that));\n\n            that.listView = new kendo.ui.ListView(that.list, {\n                layout: \"flex\",\n                flex: {\n                    direction: \"row\",\n                    wrap: \"wrap\"\n                },\n                dataSource: that.dataSource,\n                template: that._itemTmpl(),\n                editTemplate: that._editTmpl(),\n                selectable: true,\n                autoBind: false,\n                dataBinding: function(e) {\n                    that.toolbar.find(\".k-i-close\").parent().addClass(\"k-disabled\");\n\n                    if (e.action === \"remove\" || e.action === \"sync\") {\n                        e.preventDefault();\n                        kendo.ui.progress(that.listView.content, false);\n                    }\n                },\n                dataBound: function() {\n                    if (that.dataSource.view().length) {\n                        that._tiles = this.items().filter(\"[\" + kendo.attr(\"type\") + \"=f]\");\n                    } else {\n                        this.content.append(EMPTYTILE({ text: that.options.messages.emptyFolder }));\n                    }\n                },\n                change: proxy(that._listViewChange, that)\n            });\n        },\n\n        _dblClick: function(e) {\n            var that = this,\n                li = $(e.currentTarget);\n\n            if (li.hasClass(\"k-edit-item\")) {\n                that._directoryBlur();\n            }\n\n            if (li.filter(\"[\" + kendo.attr(\"type\") + \"=d]\").length) {\n                var folder = that.dataSource.getByUid(li.attr(kendo.attr(\"uid\")));\n                if (folder) {\n                    that.path(concatPaths(that.path(), folder.get(NAMEFIELD)));\n                    that.breadcrumbs.value(\"/\" + that.path());\n                }\n            } else if (li.filter(\"[\" + kendo.attr(\"type\") + \"=f]\").length) {\n                that.trigger(APPLY);\n            }\n        },\n\n        _listViewChange: function() {\n            var selected = this._selectedItem();\n\n            if (selected) {\n                this.toolbar.find(\".k-i-close\").parent().removeClass(\"k-disabled\");\n                this.trigger(CHANGE, { selected: selected });\n            }\n        },\n\n        _dataSource: function() {\n            var that = this,\n                options = that.options,\n                transport = options.transport,\n                typeSortOrder = extend({}, DEFAULTSORTORDER),\n                nameSortOrder = { field: NAMEFIELD, dir: \"asc\" },\n                schema,\n                dataSource = {\n                    type: transport.type || \"filebrowser\",\n                    sort: [typeSortOrder, nameSortOrder]\n                };\n\n            if (isPlainObject(transport)) {\n                transport.path = proxy(that.path, that);\n                dataSource.transport = transport;\n            }\n\n            if (isPlainObject(options.schema)) {\n                dataSource.schema = options.schema;\n            } else if (transport.type && isPlainObject(kendo.data.schemas[transport.type])) {\n                schema = kendo.data.schemas[transport.type];\n            }\n\n            if (that.dataSource && that._errorHandler) {\n                that.dataSource.unbind(ERROR, that._errorHandler);\n            } else {\n                that._errorHandler = proxy(that._error, that);\n            }\n\n            that.dataSource = kendo.data.DataSource.create(dataSource)\n                .bind(ERROR, that._errorHandler);\n        },\n\n        _navigation: function() {\n            var that = this,\n                navigation = $('<div class=\"k-floatwrap\"><nav></nav></div>')\n                    .appendTo(this.element);\n\n            that.breadcrumbs = navigation.find(\"nav\").first()\n                    .kendoBreadcrumb({\n                        editable: true,\n                        gap: 50,\n                        value: that.options.path || \"/\",\n                        change: function() {\n                            that.path(this.value());\n                        }\n                    }).data(\"kendoBreadcrumb\");\n        },\n\n        _error: function(e) {\n            var that = this,\n                status;\n\n            if (!that.trigger(ERROR, e)) {\n                status = e.xhr.status;\n\n                if (e.status == 'error') {\n                    if (status == '404') {\n                        that._showMessage(that.options.messages.directoryNotFound);\n                    } else if (status != '0') {\n                        that._showMessage('Error! The requested URL returned ' + status + ' - ' + e.xhr.statusText);\n                    }\n                } else if (status == 'timeout') {\n                    that._showMessage('Error! Server timeout.');\n                }\n\n                var dataSource = that.dataSource;\n                if (dataSource.hasChanges()) {\n                    dataSource.cancelChanges();\n                }\n            }\n        },\n\n        _showMessage: function(message, type) {\n            return window[type || \"alert\"](message);\n        },\n\n        refresh: function() {\n            var that = this;\n            that._navigation();\n            that._toolbar();\n            that._content();\n        },\n\n        _editTmpl: function() {\n            var html = '<div class=\"k-listview-item k-state-selected\" ' + kendo.attr(\"uid\") + '=\"#=uid#\" ';\n\n            html += kendo.attr(\"type\") + '=\"${' + TYPEFIELD + '}\">';\n            html += '#if(' + TYPEFIELD + ' == \"d\") { #';\n            html += '<div class=\"k-file-preview\"><span class=\"k-file-icon k-icon k-i-folder\"></span></div>';\n            html += \"#}else{#\";\n            html += '<div class=\"k-file-preview\"><span class=\"k-file-icon k-icon k-i-loading\"></span></div>';\n            html += \"#}#\";\n            html += '#if(' + TYPEFIELD + ' == \"d\") { #';\n            html += '<span class=\"k-file-name\"><span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input class=\"k-input-inner\" ' + kendo.attr(\"bind\") + '=\"value:' + NAMEFIELD + '\"/></span></span>';\n            html += \"#}#\";\n            html += '</div>';\n\n            return proxy(kendo.template(html), { sizeFormatter: sizeFormatter } );\n        },\n\n        _itemTmpl: function() {\n            var html = '<div class=\"k-listview-item\" ' + kendo.attr(\"uid\") + '=\"#=uid#\" ';\n\n            html += kendo.attr(\"type\") + '=\"${' + TYPEFIELD + '}\">';\n            html += '#if(' + TYPEFIELD + ' == \"d\") { #';\n            html += '<div class=\"k-file-preview\"><span class=\"k-file-icon k-icon k-i-folder\"></span></div>';\n            html += \"#}else{#\";\n            html += '<div class=\"k-file-preview\"><span class=\"k-file-icon k-icon k-i-file\"></span></div>';\n            html += \"#}#\";\n            html += '<span class=\"k-file-name\">${' + NAMEFIELD + '}</span>';\n            html += '#if(' + TYPEFIELD + ' == \"f\") { # <span class=\"k-file-size\">${this.sizeFormatter(' + SIZEFIELD + ')}</span> #}#';\n            html += '</div>';\n\n            return proxy(kendo.template(html), { sizeFormatter: sizeFormatter } );\n        },\n\n        path: function(value) {\n            var that = this,\n                path = that._path || \"\";\n\n            if (value !== undefined) {\n                that._path = value.replace(trimSlashesRegExp, \"\") + \"/\";\n                that.dataSource.read({ path: that._path });\n                return;\n            }\n\n            if (path) {\n                path = path.replace(trimSlashesRegExp, \"\");\n            }\n\n            return path === \"/\" || path === \"\" ? \"\" : (path + \"/\");\n        }\n    });\n\n    var SearchBox = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            options = options || {};\n\n            Widget.fn.init.call(that, element, options);\n\n            if (placeholderSupported) {\n                that.element.attr(\"placeholder\", that.options.label);\n            }\n\n            that._wrapper();\n\n            that.element\n                .on(\"keydown\" + SEARCHBOXNS, proxy(that._keydown, that))\n                .on(\"change\" + SEARCHBOXNS, proxy(that._updateValue, that));\n\n            that.wrapper\n                .on(CLICK + SEARCHBOXNS, \"a\", proxy(that._click, that));\n\n            if (!placeholderSupported) {\n                that.element.on(\"focus\" + SEARCHBOXNS, proxy(that._focus, that))\n                    .on(\"blur\" + SEARCHBOXNS, proxy(that._blur, that));\n            }\n        },\n\n        options: {\n            name: \"SearchBox\",\n            label: \"Search\",\n            value: \"\"\n        },\n\n        events: [ CHANGE ],\n\n        destroy: function() {\n            var that = this;\n\n            that.wrapper\n                .add(that.element)\n                .add(that.label)\n                .off(SEARCHBOXNS);\n\n            Widget.fn.destroy.call(that);\n        },\n\n        _keydown: function(e) {\n            if (e.keyCode === 13) {\n                this._updateValue();\n            }\n        },\n\n        _click: function(e) {\n            e.preventDefault();\n            this._updateValue();\n        },\n\n        _updateValue: function() {\n            var that = this,\n                value = that.element.val();\n\n            if (value !== that.value()) {\n                that.value(value);\n\n                that.trigger(CHANGE);\n            }\n        },\n\n        _blur: function() {\n            this._updateValue();\n            this._toggleLabel();\n        },\n\n        _toggleLabel: function() {\n            if (!placeholderSupported) {\n                this.label.toggle(!this.element.val());\n            }\n        },\n\n        _focus: function() {\n            this.label.hide();\n        },\n\n        _wrapper: function() {\n            var element = this.element,\n                wrapper = element.parents(\".k-search-wrap\");\n\n            element[0].style.width = \"\";\n            element.addClass(\"k-input-inner\");\n\n            if (!wrapper.length) {\n                wrapper = element.wrap($('<div class=\"k-widget k-search-wrap\"><span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"></span></div>')).parents(\".k-search-wrap\");\n                if (!placeholderSupported) {\n                    $('<label style=\"display:block\">' + this.options.label + '</label>').insertBefore(element);\n                }\n                $('<span class=\"k-input-suffix\"><a href=\"#\" class=\"k-icon k-i-zoom k-search\"/></span>').appendTo(wrapper.find(\".k-textbox\"));\n            }\n\n            this.wrapper = wrapper;\n            this.label = wrapper.find(\">label\");\n        },\n\n        value: function(value) {\n            var that = this;\n\n            if (value !== undefined) {\n                that.options.value = value;\n                that.element.val(value);\n                that._toggleLabel();\n                return;\n            }\n            return that.options.value;\n        }\n    });\n\n    kendo.ui.plugin(FileBrowser);\n    kendo.ui.plugin(SearchBox);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","hidden","depends","$","window","kendo","jQuery","undefined","Widget","ui","isPlainObject","proxy","extend","placeholderSupported","support","placeholder","isFunction","trimSlashesRegExp","CHANGE","APPLY","ERROR","CLICK","NS","SEARCHBOXNS","NAMEFIELD","SIZEFIELD","TYPEFIELD","DEFAULTSORTORDER","field","dir","EMPTYTILE","template","TOOLBARTMPL","bindDragEventWrappers","element","onDragEnter","onDragLeave","hideInterval","lastDrag","on","Date","setInterval","sinceLastDrag","clearInterval","concatPaths","path","match","sizeFormatter","value","suffix","Math","round","fieldName","fields","descriptor","from","data","schemas","filebrowser","items","model","size","type","transports","RemoteTransport","init","options","fn","call","this","_call","read","create","destroy","update","FileBrowser","that","addClass","_deleteClick","_addClick","_directoryKeyDown","_directoryBlur","_dataSource","refresh","messages","uploadFile","orderBy","orderByName","orderBySize","directoryNotFound","emptyFolder","deleteFile","invalidFileType","overwriteFile","dropFilesHere","search","transport","fileTypes","events","dataSource","unbind","_errorHandler","add","list","toolbar","off","selected","_selectedItem","fileUrl","get","replace","format","encodeURIComponent","listView","select","length","getByUid","attr","_toolbar","arrangeBy","text","showUpload","uploadUrl","showCreate","showDelete","appendTo","find","kendoUpload","multiple","localization","async","saveUrl","autoUpload","upload","_fileUpload","error","e","_error","xhr","XMLHttpRequest","status","end","kendoDropDownList","dataTextField","dataValueField","change","searchBox","kendoSearchBox","label","_attachDropzoneEvents","document","documentElement","_dropEnter","_dropLeave","_scrollHandler","_positionDropzone","_removeDropzone","offset","css","width","clientWidth","height","clientHeight","lineHeight","removeClass","top","left","item","message","_showMessage","remove","createDirectory","_getFieldName","reader","filterRegExp","RegExp","split","join","fileName","files","fileSize","fileNameField","sizeField","file","test","_createFile","preventDefault","one","_insertFileToList","_override","set","response","pushUpdate","_tiles","filter","_findFile","idx","result","typeField","nameField","toLowerCase","index","view","i","insert","lastDirectoryIdx","_nameDirectory","uid","edit","scrollTop","offsetHeight","setTimeout","_nameExists","keyCode","currentTarget","blur","save","directoryNames","candidate","indexOf","push","inArray","sort","operator","_content","_dblClick","ListView","layout","flex","direction","wrap","_itemTmpl","editTemplate","_editTmpl","selectable","autoBind","dataBinding","parent","action","progress","content","dataBound","append","_listViewChange","li","hasClass","folder","breadcrumbs","trigger","typeSortOrder","nameSortOrder","schema","DataSource","bind","_navigation","navigation","first","kendoBreadcrumb","editable","gap","statusText","hasChanges","cancelChanges","html","_path","SearchBox","_wrapper","_keydown","_updateValue","wrapper","_click","_focus","_blur","val","_toggleLabel","toggle","hide","parents","style","insertBefore","plugin","amd","a1","a2","a3"],"mappings":"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"}