{"version":3,"file":"kendo.listbox.min.js","sources":["kendo.listbox.js"],"sourcesContent":["/*!\n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n\n*/\n/* jshint eqnull: true */\n(function(f, define) {\n    define('kendo.listbox',[ \"./kendo.draganddrop\", \"./kendo.data\", \"./kendo.selectable\" ], f);\n})(function() {\n\nvar __meta__ = { // jshint ignore:line\n    id: \"listbox\",\n    name: \"ListBox\",\n    category: \"web\",\n    depends: [\"draganddrop\", \"data\", \"selectable\"]\n};\n\n(function($, undefined) {\n    var kendo = window.kendo;\n    var kendoAttr = kendo.attr;\n    var data = kendo.data;\n    var keys = kendo.keys;\n    var kendoTemplate = kendo.template;\n    var Widget = kendo.ui.Widget;\n    var DataSource = data.DataSource;\n    var Selectable = kendo.ui.Selectable;\n    var DataBoundWidget = kendo.ui.DataBoundWidget;\n    var Class = kendo.Class;\n\n    var extend = $.extend;\n    var noop = $.noop;\n    var proxy = $.proxy;\n\n    var DASH = \"-\";\n    var DOT = \".\";\n    var SPACE = \" \";\n    var HASH = \"#\";\n\n    var KENDO_LISTBOX = \"kendoListBox\";\n    var NS = DOT + KENDO_LISTBOX;\n    var DISABLED_STATE_CLASS = \"k-disabled\";\n    var SELECTED_STATE_CLASS = \"k-selected\";\n    var ENABLED_ITEM_SELECTOR = \".k-list-item:not(.k-disabled)\";\n    var ENABLED_ITEMS_SELECTOR = \".k-list-ul:not(.k-disabled) >\" + ENABLED_ITEM_SELECTOR;\n    var TOOLBAR_CLASS = \"k-listbox-toolbar\";\n    var TOOL_SELECTOR = \"li > a.k-button:not(.k-disabled)\";\n    var FOCUSED_CLASS = \"k-focus\";\n    var DRAG_CLUE_CLASS = \"k-drag-clue\";\n    var DROP_HINT_CLASS = \"k-drop-hint\";\n    var LIST_CLASS = \"k-list-ul\";\n    var LIST_SELECTOR = \".k-list-ul\";\n\n    var CLICK = \"click\" + NS;\n    var KEYDOWN = \"keydown\" + NS;\n    var BLUR = \"blur\" + NS;\n    var outerWidth = kendo._outerWidth;\n    var outerHeight = kendo._outerHeight;\n    var CHANGE = \"change\";\n    var DATABOUND = \"dataBound\";\n    var ADD = \"add\";\n    var REMOVE = \"remove\";\n    var REORDER = \"reorder\";\n    var MOVE_UP = \"moveUp\";\n    var MOVE_DOWN = \"moveDown\";\n    var TRANSFER_TO = \"transferTo\";\n    var TRANSFER_FROM = \"transferFrom\";\n    var TRANSFER_ALL_TO = \"transferAllTo\";\n    var TRANSFER_ALL_FROM = \"transferAllFrom\";\n    var DRAGGEDCLASS = \"k-ghost\";\n    var UNIQUE_ID = \"uid\";\n    var ID = \"id\";\n    var TABINDEX = \"tabindex\";\n    var COMMAND = \"command\";\n\n    var MOVE_UP_OFFSET = -1;\n    var MOVE_DOWN_OFFSET = 1;\n    var DRAGSTART = \"dragstart\";\n    var DRAG = \"drag\";\n    var DROP = \"drop\";\n    var DRAGEND = \"dragend\";\n    var DEFAULT_FILTER = \"ul.k-list-ul>li.k-list-item\";\n\n    var RIGHT = \"right\";\n    var BOTTOM = \"bottom\";\n\n    var TOOLBAR_POSITION_CLASS_NAMES = [\n        TOOLBAR_CLASS + DASH + \"left\",\n        TOOLBAR_CLASS + DASH + RIGHT,\n        TOOLBAR_CLASS + DASH + \"top\",\n        TOOLBAR_CLASS + DASH + BOTTOM\n    ];\n\n    function getSortedDomIndices(items) {\n        var indices = $.map(items, function(item) {\n            return $(item).index();\n        });\n\n        return indices;\n    }\n\n    function isUndefined(value) {\n        return (typeof value === \"undefined\");\n    }\n\n    function defaultHint(element) {\n        return element.clone()\n            .attr('class', '')\n            .addClass(DRAG_CLUE_CLASS);\n    }\n\n    function defaultPlaceholder() {\n        return $('<li>').addClass(DROP_HINT_CLASS);\n    }\n\n    var ListBox = DataBoundWidget.extend({\n        init: function(element, options) {\n            var that = this;\n            Widget.fn.init.call(that, element, options);\n\n            that._wrapper();\n            that._list();\n            that._ariaLabel();\n            element = that.element.attr(\"multiple\", \"multiple\").hide();\n\n            if (element[0] && !that.options.dataSource) {\n                that.options.dataTextField = that.options.dataTextField || \"text\";\n                that.options.dataValueField = that.options.dataValueField || \"value\";\n            }\n            that._templates();\n            that._selectable();\n            that._dataSource();\n            that._createToolbar();\n            that._createDraggable();\n            that._createNavigatable();\n        },\n\n        destroy: function() {\n            var that = this;\n\n            DataBoundWidget.fn.destroy.call(that);\n            if (!isNaN(that._listTabIndex)) {\n                that._getList().off();\n                that._listTabIndex = null;\n            }\n            that._unbindDataSource();\n            that._destroySelectable();\n            that._destroyToolbar();\n            that.wrapper.off(NS);\n            if (that._target) {\n                that._target = null;\n            }\n            if (that._draggable) {\n                that._draggable.destroy();\n                that.placeholder = null;\n            }\n\n            kendo.destroy(that.element);\n        },\n\n        setOptions: function(options) {\n            Widget.fn.setOptions.call(this, options);\n            this._templates();\n            this._dataSource();\n        },\n\n        events: [\n            CHANGE,\n            DATABOUND,\n            ADD,\n            REMOVE,\n            REORDER,\n            DRAGSTART,\n            DRAG,\n            DROP,\n            DRAGEND\n        ],\n\n        options: {\n            name: \"ListBox\",\n            autoBind: true,\n            template: \"\",\n            dataTextField: \"\",\n            dataValueField: \"\",\n            selectable: \"single\",\n            draggable: null,\n            dropSources: [],\n            connectWith: \"\",\n            navigatable: true,\n            toolbar: {\n                position: RIGHT,\n                tools: []\n            },\n            messages: {\n                tools: {\n                    remove: \"Delete\",\n                    moveUp: \"Move Up\",\n                    moveDown: \"Move Down\",\n                    transferTo: \"Transfer To\",\n                    transferFrom: \"Transfer From\",\n                    transferAllTo: \"Transfer All To\",\n                    transferAllFrom: \"Transfer All From\"\n                }\n            }\n        },\n\n        add: function(dataItems) {\n            var that = this;\n            var items = dataItems && dataItems.length ? dataItems : [dataItems];\n            var itemsLength = items.length;\n            var list = that._getList();\n            var i;\n\n            that._unbindDataSource();\n            that._unbindDataChange();\n            for (i = 0; i < itemsLength; i++) {\n                that._addItem(items[i], list);\n            }\n            that._bindDataChange();\n            that._bindDataSource();\n            that._syncElement();\n        },\n\n        _addItem: function(dataItem, list) {\n            var that = this;\n            var item = $(that.templates.itemTemplate({ item: dataItem, r: that.templates.itemContent }));\n\n            that._setItemId(item, dataItem.uid);\n\n            item.appendTo(list);\n\n            if (typeof dataItem === typeof \"\") {\n                that.dataSource._data.push(dataItem);\n            } else {\n                that.dataSource.add(dataItem);\n            }\n        },\n\n        _addItemAt: function(dataItem, index) {\n            var that = this;\n            var item = $(that.templates.itemTemplate({ item: dataItem, r: that.templates.itemContent }));\n            that._unbindDataSource();\n            if (typeof dataItem === typeof \"\") {\n                that._insertElementAt(item, index);\n                that.dataSource._data.push(dataItem);\n            } else {\n                that._setItemId(item, dataItem.uid);\n                that._insertElementAt(item, index);\n                that.dataSource.add(dataItem);\n            }\n            that._bindDataSource();\n            that._syncElement();\n        },\n\n        _insertElementAt: function(item, index) {\n            var that = this;\n            var list = that._getList();\n\n            if (index > 0) {\n                $(item).insertAfter(list.children().eq(index - 1));\n            } else {\n                $(list).prepend(item);\n            }\n        },\n\n        _createNavigatable: function() {\n            var that = this;\n            var options = that.options;\n\n            if (options.navigatable) {\n                that._getList().on(CLICK, ENABLED_ITEM_SELECTOR, proxy(that._click, that))\n                            .on(KEYDOWN, proxy(that._keyDown, that))\n                            .on(BLUR, proxy(that._blur, that));\n            }\n        },\n\n        _getTabIndex: function() {\n            var that = this;\n            var tabindex;\n\n            if (!isNaN(that._listTabIndex))\n            {\n                return that._listTabIndex;\n            }\n\n            tabindex = that.element.attr(TABINDEX);\n            that._listTabIndex = !isNaN(tabindex) ? tabindex : 0;\n\n            that.element.removeAttr(TABINDEX);\n\n            return that._listTabIndex;\n        },\n\n        _blur: function() {\n            if (this._target) {\n                this._target.removeClass(FOCUSED_CLASS);\n                this._getList().removeAttr(\"aria-activedescendant\");\n            }\n            this._target = null;\n        },\n\n        _click: function(e) {\n            var that = this;\n            var target = $(e.currentTarget);\n            var oldTarget = that._target;\n            var activeEl = kendo._activeElement();\n            var isContained = $.contains(that.wrapper[0], activeEl);\n\n            if (oldTarget) {\n                oldTarget.removeClass(FOCUSED_CLASS);\n            }\n\n            that._target = target;\n            target.addClass(FOCUSED_CLASS);\n            that._getList().attr(\"aria-activedescendant\", target.attr(ID));\n\n            if (that._getList()[0] !== kendo._activeElement() && (!isContained || !isInputElement(activeEl))) {\n                that.focus();\n            }\n        },\n\n        _getNavigatableItem: function(key) {\n            var that = this;\n            var current;\n\n            if (!that._target) {\n                current = that.items().filter(ENABLED_ITEM_SELECTOR).first();\n            } else {\n                current = that._target;\n            }\n\n            if (key === keys.UP && that._target) {\n                current = that._target.prevAll(ENABLED_ITEM_SELECTOR).first();\n            }\n\n            if (key === keys.DOWN && that._target) {\n                current = that._target.nextAll(ENABLED_ITEM_SELECTOR).first();\n            }\n\n            return current.length ? current : null;\n        },\n\n        _scrollIntoView: function(item) {\n            if (!item) {\n                return;\n            }\n\n            if (item[0]) {\n                item = item[0];\n            }\n\n            var list = this._getList().parent()[0];\n            var itemOffsetTop = item.offsetTop;\n            var contentScrollTop = list.scrollTop;\n            var contentOffsetHeight = list.clientHeight;\n            var bottomDistance = itemOffsetTop + item.offsetHeight;\n\n            if (contentScrollTop > itemOffsetTop) {\n                contentScrollTop = itemOffsetTop;\n            } else if (bottomDistance > (contentScrollTop + contentOffsetHeight)) {\n                contentScrollTop = (bottomDistance - contentOffsetHeight);\n            }\n\n            list.scrollTop = contentScrollTop;\n        },\n\n        _keyDown: function(e) {\n            var that = this;\n            var key = e.keyCode;\n            var current = that._getNavigatableItem(key);\n            var shouldPreventDefault;\n\n            if (that._target) {\n                that._target.removeClass(FOCUSED_CLASS);\n            }\n\n            if (!(e.shiftKey && !e.ctrlKey && (key === keys.DOWN || key === keys.UP))) {\n                that._shiftSelecting = false;\n            }\n\n            if (key == keys.DELETE) {\n                that._executeCommand(REMOVE);\n                if (that._target) {\n                    that._target.removeClass(FOCUSED_CLASS);\n                    that._getList().removeAttr(\"aria-activedescendant\");\n                    that._target = null;\n                }\n                shouldPreventDefault = true;\n            } else if (key === keys.DOWN || key === keys.UP) {\n                if (!current) {\n                    e.preventDefault();\n                    return;\n                }\n                if (e.shiftKey && !e.ctrlKey) {\n                    if (!that._shiftSelecting) {\n                        that.clearSelection();\n                        that._shiftSelecting = true;\n                    }\n                    if (that._target && current.hasClass(\"k-selected\")) {\n                        that._target.removeClass(SELECTED_STATE_CLASS);\n                        that.trigger(CHANGE);\n                    } else if (that.options.selectable == \"single\") {\n                       that.select(current);\n                    } else {\n                       that.select(current.add(that._target));\n                    }\n                } else if (e.shiftKey && e.ctrlKey) {\n                    that._executeCommand(key === keys.DOWN ? MOVE_DOWN : MOVE_UP);\n                    that._scrollIntoView(that._target);\n                    e.preventDefault();\n                    return;\n                } else if (!e.shiftKey && !e.ctrlKey) {\n                    if (that.options.selectable === \"multiple\") {\n                        that.clearSelection();\n                    }\n                    that.select(current);\n                }\n\n                that._target = current;\n                if (that._target) {\n                    that._target.addClass(FOCUSED_CLASS);\n                    that._scrollIntoView(that._target);\n                    that._getList().attr(\"aria-activedescendant\", that._target.attr(ID));\n                } else {\n                    that._getList().removeAttr(\"aria-activedescendant\");\n                }\n                shouldPreventDefault = true;\n            } else if (key == keys.SPACEBAR) {\n                if (e.ctrlKey && that._target) {\n                   if (that._target.hasClass(SELECTED_STATE_CLASS)) {\n                       that._target.removeClass(SELECTED_STATE_CLASS);\n                       that.trigger(CHANGE);\n                   } else {\n                       that.select(that._target);\n                   }\n                } else {\n                   that.clearSelection();\n                   that.select(that._target);\n                }\n                shouldPreventDefault = true;\n            } else if (e.ctrlKey && key == keys.RIGHT) {\n                if (e.shiftKey) {\n                   that._executeCommand(TRANSFER_ALL_TO);\n                } else {\n                   that._executeCommand(TRANSFER_TO);\n                }\n                that._target = that.select().length ? that.select() : null;\n                shouldPreventDefault = true;\n            } else if (e.ctrlKey && key == keys.LEFT) {\n                if (e.shiftKey) {\n                   that._executeCommand(TRANSFER_ALL_FROM);\n                } else {\n                   that._executeCommand(TRANSFER_FROM);\n                }\n                shouldPreventDefault = true;\n            }\n\n            if (shouldPreventDefault) {\n                e.preventDefault();\n            }\n        },\n\n        focus: function() {\n            kendo.focusElement(this._getList());\n        },\n\n        _createDraggable: function() {\n            var that = this;\n            var draggable = that.options.draggable;\n            var hint;\n\n            if (draggable) {\n                hint = draggable.hint;\n                if (!that.options.selectable) {\n                    throw new Error(\"Dragging requires selection to be enabled\");\n                }\n\n                if (!hint) {\n                    hint = defaultHint;\n                }\n\n                that._draggable = new kendo.ui.Draggable(that.wrapper, {\n                    filter: draggable.filter ? draggable.filter : DEFAULT_FILTER,\n                    hint: kendo.isFunction(hint) ? hint : $(hint),\n                    dragstart: proxy(that._dragstart, that),\n                    dragcancel: proxy(that._clear, that),\n                    drag: proxy(that._drag, that),\n                    dragend: proxy(that._dragend, that)\n                });\n            }\n        },\n\n        _dragstart: function(e) {\n            var that = this;\n            var draggedElement = that.draggedElement = e.currentTarget;\n            var placeholder = that.options.draggable.placeholder;\n            var dataItem = that.dataItem(draggedElement);\n            var eventData = { dataItems: dataItem, items: $(draggedElement), draggableEvent: e };\n\n            if (that.options.draggable.enabled === false) {\n                e.preventDefault();\n                return;\n            }\n\n            if (!placeholder) {\n                placeholder = defaultPlaceholder;\n            }\n\n            that.placeholder = kendo.isFunction(placeholder) ? $(placeholder.call(that, draggedElement)) : $(placeholder);\n\n            if (draggedElement.is(DOT + DISABLED_STATE_CLASS)) {\n                e.preventDefault();\n            } else {\n                if (that.trigger(DRAGSTART, eventData)) {\n                    e.preventDefault();\n                } else {\n                    that.clearSelection();\n                    that.select(draggedElement);\n                    draggedElement.addClass(DRAGGEDCLASS);\n                }\n            }\n        },\n\n        _clear: function() {\n            this.draggedElement.removeClass(DRAGGEDCLASS);\n            this.placeholder.remove();\n        },\n\n        _findElementUnderCursor: function(e) {\n            var elementUnderCursor = kendo.elementUnderCursor(e);\n            var draggable = e.sender;\n\n            if ($.contains(draggable.hint[0], elementUnderCursor) || draggable.hint[0] === elementUnderCursor) {\n                draggable.hint.hide();\n                elementUnderCursor = kendo.elementUnderCursor(e);\n                draggable.hint.show();\n            }\n\n            return elementUnderCursor;\n        },\n\n        _findTarget: function(e) {\n            var that = this;\n            var element = that._findElementUnderCursor(e);\n            var elementNode = $(element);\n            var list = that._getList();\n            var items;\n            var node;\n\n            if ($.contains(list[0], element)) {\n                items = that.items();\n                element = elementNode.is(\"li\") ? element : elementNode.closest(\"li\")[0];\n                node = items.filter(element)[0] || items.has(element)[0];\n                if (node) {\n                    node = $(node);\n                    return !node.hasClass(DISABLED_STATE_CLASS) ? { element: node, listBox: that } : null;\n                } else {\n                    return null;\n                }\n            } else if (list[0] == element || list.parent()[0] == element) {\n                return { element: $(list), appendToBottom: true, listBox: that };\n            } else {\n                return that._searchConnectedListBox(elementNode);\n            }\n        },\n\n        _getElementCenter: function(element) {\n            var center = element.length ? kendo.getOffset(element) : null;\n            if (center) {\n                center.top += outerHeight(element) / 2;\n                center.left += outerWidth(element) / 2;\n            }\n\n            return center;\n        },\n\n        _searchConnectedListBox: function(element) {\n            var connectedListBox;\n            var items;\n            var node;\n            var originalElement = element;\n            var closestContainer;\n\n            if (element.hasClass(\"k-list-scroller k-selectable\")) {\n                closestContainer = element;\n            } else {\n                closestContainer = element.closest(\".k-list-scroller.k-selectable\");\n            }\n\n            if (closestContainer.length) {\n                connectedListBox = closestContainer.parent().find(\"[data-role='listbox']\").getKendoListBox();\n            } else {\n                return null;\n            }\n\n            if (connectedListBox && $.inArray(this.element[0].id, connectedListBox.options.dropSources) !== -1) {\n                items = connectedListBox.items();\n                element = element.is(\"li\") ? element[0] : element.closest(\"li\")[0];\n                node = items.filter(element)[0] || items.has(element)[0];\n                if (node) {\n                    node = $(node);\n                    return !node.hasClass(DISABLED_STATE_CLASS) ? { element: node, listBox: connectedListBox } : null;\n                } else if (!items.length ||\n                            originalElement.hasClass(\"k-list-scroller k-selectable\") ||\n                            originalElement.hasClass(\"k-list-content\")) {\n                    return { element: connectedListBox._getList(), listBox: connectedListBox, appendToBottom: true };\n                } else {\n                    return null;\n                }\n            }\n            return null;\n        },\n\n        _drag: function(e) {\n            var that = this;\n            var draggedElement = that.draggedElement;\n            var target = that._findTarget(e);\n            var cursorOffset = { left: e.x.location, top: e.y.location };\n            var dataItem = that.dataItem(draggedElement);\n            var eventData = { dataItems: [dataItem], items: $(draggedElement), draggableEvent: e };\n            var targetCenter;\n            var offsetDelta;\n            var direction;\n\n            if (that.trigger(DRAG, eventData)) {\n                e.preventDefault();\n                return;\n            }\n\n            if (target) {\n                targetCenter = this._getElementCenter(target.element);\n\n                offsetDelta = {\n                    left: Math.round(cursorOffset.left - targetCenter.left),\n                    top: Math.round(cursorOffset.top - targetCenter.top)\n                };\n\n                if (target.appendToBottom) {\n                    that._movePlaceholder(target, null , draggedElement);\n                    return;\n                }\n\n                if (offsetDelta.top < 0) {\n                    direction = \"prev\";\n                } else if (offsetDelta.top > 0) {\n                    direction = \"next\";\n                }\n\n                if (direction) {\n                    if (target.element[0] != that.placeholder[0]) {\n                        that._movePlaceholder(target, direction, draggedElement);\n                    }\n                }\n             }\n             else if (that.placeholder.parent().length) {\n                that.placeholder.remove();\n             }\n        },\n\n        _movePlaceholder: function(target, direction, draggedElement) {\n            var that = this;\n            var placeholder = that.placeholder;\n            var draggableOptions = target.listBox.options.draggable;\n\n            if (placeholder.parent().length) {\n                that.placeholder.remove();\n                if (draggableOptions && draggableOptions.placeholder) {\n                    that.placeholder = kendo.isFunction(draggableOptions.placeholder) ? $(draggableOptions.placeholder.call(that, draggedElement)) : $(draggableOptions.placeholder);\n                } else {\n                    that.placeholder = $(defaultPlaceholder.call(that, draggedElement));\n                }\n            }\n\n            if (!direction) {\n                target.element.append(that.placeholder);\n            } else if (direction === \"prev\") {\n                target.element.before(that.placeholder);\n            } else if (direction === \"next\") {\n                target.element.after(that.placeholder);\n            }\n        },\n\n        _dragend: function(e) {\n            var that = this;\n            var draggedItem = that.draggedElement;\n            var items = that.items();\n            var placeholderIndex = items.not(that.draggedElement).index(that.placeholder);\n            var draggedIndex = items.not(that.placeholder).index(that.draggedElement);\n            var dataItem = that.dataItem(draggedItem);\n            var eventData = { dataItems: [dataItem], items: $(draggedItem) };\n            var connectedListBox = that.placeholder.closest(\".k-widget.k-listbox\").find(\"[data-role='listbox']\").getKendoListBox();\n\n            if (that.trigger(DROP, extend({}, eventData, { draggableEvent: e }))) {\n                e.preventDefault();\n                this._clear();\n                return;\n            }\n\n            if (placeholderIndex >= 0) {\n                if (placeholderIndex !== draggedIndex && !that.trigger(REORDER, extend({}, eventData, { offset: placeholderIndex - draggedIndex }))) {\n                    draggedItem.removeClass(DRAGGEDCLASS);\n                    that.reorder(draggedItem, placeholderIndex);\n                }\n            } else if (connectedListBox) {\n                if (!that.trigger(REMOVE, eventData)) {\n                    that.remove($(draggedItem));\n                }\n\n                if (!connectedListBox.trigger(ADD, eventData)) {\n                    connectedListBox._addItemAt(dataItem, connectedListBox.items().index(that.placeholder));\n                }\n            }\n\n            that._clear();\n            that._draggable.dropped = true;\n\n            that.trigger(DRAGEND, extend({}, eventData, { draggableEvent: e }));\n\n            that._updateToolbar();\n            that._updateAllToolbars();\n        },\n\n        reorder: function(item, index) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var dataItem = that.dataItem(item);\n            var dataItemAtIndex = dataSource.at(index);\n            var itemAtIndex = that.items()[index];\n            var listItem = $(item);\n\n            if (dataItem && itemAtIndex && dataItemAtIndex) {\n                that._removeElement(listItem);\n                that._insertElementAt(listItem, index);\n                that._updateToolbar();\n            }\n        },\n\n        remove: function(items) {\n            var that = this;\n            var listItems = that._getItems(items);\n            var itemsLength = listItems.length;\n            var i;\n\n            that._unbindDataSource();\n            that._unbindDataChange();\n            for (i = 0; i < itemsLength; i++) {\n                that._removeItem($(listItems[i]));\n            }\n            that._bindDataChange();\n            that._bindDataSource();\n            that._syncElement();\n            that._updateToolbar();\n            that._updateAllToolbars();\n        },\n\n        _removeItem: function(item) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var dataItem = that.dataItem(item);\n            var transport = dataSource.transport;\n\n            if (!dataItem || !dataSource) {\n                return;\n            }\n            if (typeof dataItem === typeof \"\") {\n                var data = dataSource._data;\n                for (var i = 0; i < data.length; i++) {\n                    if (dataItem === data[i]) {\n                        data[i] = data[data.length - 1];\n                        data.pop();\n                        break;\n                    }\n                }\n            } else {\n                dataSource.remove(dataItem);\n                if (transport && (transport.destroy || (transport.options || {}).destroy) &&\n                    (!dataItem.isNew || !dataItem.isNew())) {\n                    dataSource._destroyed.push(dataItem);\n                }\n            }\n            that._removeElement(item);\n        },\n\n        _removeElement: function(item) {\n            kendo.destroy(item);\n            $(item).off().remove();\n        },\n\n        dataItem: function(element) {\n            var uniqueIdAttr = kendoAttr(UNIQUE_ID);\n            var uid = $(element).attr(uniqueIdAttr) || $(element).closest(\"[\" + uniqueIdAttr + \"]\").attr(uniqueIdAttr);\n            if (uid) {\n                return this.dataSource.getByUid(uid);\n            }\n            else {\n                return $(element).html();\n            }\n        },\n\n        _dataItems: function(items) {\n            var dataItems = [];\n            var listItems = $(items);\n            var itemsLength = listItems.length;\n            var i;\n\n            for (i = 0; i < itemsLength; i++) {\n                dataItems.push(this.dataItem(listItems.eq(i)));\n            }\n\n            return dataItems;\n        },\n\n        items: function() {\n            var list = this._getList();\n            return list.children();\n        },\n\n        select: function(items) {\n            var that = this;\n            var selectable = that.selectable;\n            var enabledItems;\n\n            if (isUndefined(items)) {\n                return selectable.value();\n            }\n\n            enabledItems = that.items().filter(items).filter(ENABLED_ITEMS_SELECTOR);\n\n            if (!selectable.options.multiple) {\n                selectable.clear();\n                enabledItems = enabledItems.first();\n            }\n\n            return selectable.value(enabledItems);\n        },\n\n        clearSelection: function() {\n            var that = this;\n            var selectable = that.selectable;\n\n            if (selectable) {\n                selectable.clear();\n            }\n        },\n\n        enable: function(items, enable) {\n            var that = this;\n            var enabled = isUndefined(enable) ? true : !!enable;\n            var listItems = that._getItems(items);\n            var itemsLength = listItems.length;\n            var i;\n\n            for (i = 0; i < itemsLength; i++) {\n                that._enableItem($(listItems[i]), enabled);\n            }\n\n            that._updateAllToolbars();\n        },\n\n        _enableItem: function(item, enable) {\n            var that = this;\n            var dataItem = that.dataItem(item);\n\n            if (dataItem) {\n                if (enable) {\n                    $(item).removeClass(DISABLED_STATE_CLASS);\n                } else {\n                    $(item)\n                        .addClass(DISABLED_STATE_CLASS)\n                        .removeClass(SELECTED_STATE_CLASS);\n                }\n            }\n        },\n\n        setDataSource: function(dataSource) {\n            var that = this;\n\n            that.options.dataSource = dataSource;\n\n            that._dataSource();\n        },\n\n        _dataSource: function() {\n            var that = this;\n            var options = that.options;\n            var dataSource = options.dataSource || {};\n\n            dataSource = Array.isArray(dataSource) ? { data: dataSource } : dataSource;\n            dataSource.select = that.element;\n            dataSource.fields = [\n                { field: options.dataTextField },\n                { field: options.dataValueField }];\n\n            that._unbindDataSource();\n            that.dataSource = DataSource.create(dataSource);\n            that._bindDataSource();\n\n            if (that.options.autoBind) {\n                that.wrapper.attr(\"aria-busy\", true);\n                that.dataSource.fetch();\n            }\n        },\n\n        _bindDataChange: function() {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.bind(CHANGE, dataSource._changeHandler);\n                dataSource._data.trigger(CHANGE);\n            }\n        },\n\n        _unbindDataChange: function() {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.unbind(CHANGE, dataSource._changeHandler);\n            }\n        },\n\n        _bindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            that._dataChangeHandler = proxy(that.refresh, that);\n\n            if (dataSource) {\n                dataSource.bind(CHANGE, that._dataChangeHandler);\n            }\n        },\n\n        _unbindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.unbind(CHANGE, that._dataChangeHandler);\n            }\n        },\n\n        _wrapper: function() {\n            var that = this,\n                element = that.element,\n                wrapper = element.parent(\"div.k-listbox\");\n\n            if (!wrapper[0]) {\n                wrapper = element.wrap('<div class=\"k-widget k-listbox\" unselectable=\"on\" />').parent();\n                wrapper[0].style.cssText = element[0].style.cssText;\n                wrapper[0].title = element[0].title;\n                $('<div class=\"k-list-scroller\"><div class=\"k-list k-list-md\"><div class=\"k-list-content\"></div></div></div>').insertBefore(element);\n            }\n\n            that.wrapper = wrapper.addClass(element[0].className).css(\"display\", \"\");\n            that._innerWrapper = $(wrapper[0].firstChild);\n        },\n\n        _list: function() {\n            var that = this,\n                list = $(\"<ul class='\" + LIST_CLASS + \"' role='listbox'></ul>\"),\n                selectable = that.options.selectable,\n                selectableOptions = Selectable.parseOptions(selectable);\n\n            if (selectableOptions.multiple) {\n                list.attr(\"aria-multiselectable\", \"true\");\n            }\n\n            list.appendTo(that.wrapper.find(\".k-list-content\"));\n\n            if (that.options.navigatable) {\n                that._getList().attr(TABINDEX, that._getTabIndex());\n            }\n        },\n\n        _ariaLabel: function() {\n            var that = this;\n            var inputElm = that.element;\n            var ul = that._getList();\n            var id = inputElm.attr(\"id\");\n            var labelElm = $(\"label[for=\\'\" + id + \"\\']\");\n            var ariaLabel = inputElm.attr(\"aria-label\");\n            var ariaLabelledBy = inputElm.attr(\"aria-labelledby\");\n            var labelId;\n\n            if (ariaLabel) {\n                ul.attr(\"aria-label\", ariaLabel);\n            } else if (ariaLabelledBy) {\n                ul.attr(\"aria-labelledby\", ariaLabelledBy);\n            } else if (labelElm.length) {\n                labelId = labelElm.attr(\"id\");\n                if (labelId) {\n                    ul.attr(\"aria-labelledby\", labelId);\n                } else {\n                    labelId = kendo.guid();\n                    labelElm.attr(\"id\", labelId);\n                    ul.attr(\"aria-labelledby\", labelId);\n                }\n            }\n        },\n\n        _templates: function() {\n            var that = this;\n            var options = this.options;\n            var template;\n\n            if (options.template && typeof options.template == \"string\") {\n                template = kendo.template(options.template);\n            } else if (!options.template) {\n                template = kendo.template('${' + kendo.expr(options.dataTextField, \"data\") + \"}\", { useWithBlock: false });\n            } else {\n                template = options.template;\n            }\n\n            that.templates = {\n                itemTemplate: kendo.template(\"# var item = data.item, r = data.r; # <li class='k-list-item' role='option' aria-selected='false'><span class='k-list-item-text'>#=r(item)#</span></li>\", { useWithBlock: false }),\n                itemContent: template,\n                toolbar: \"<div class='\" + TOOLBAR_CLASS + \"'></div>\"\n            };\n        },\n\n        refresh: function() {\n            var that = this;\n            var view = that.dataSource.view();\n            var template = that.templates.itemTemplate;\n            var html = \"\";\n\n            for (var idx = 0; idx < view.length; idx++) {\n                html += template({ item: view[idx], r: that.templates.itemContent });\n            }\n            that._getList().html(html);\n            that._setItemIds();\n            that._createToolbar();\n            that._syncElement();\n            that._updateToolbar();\n            that._updateAllToolbars();\n            that.trigger(DATABOUND);\n\n            that.wrapper.attr(\"aria-busy\", false);\n        },\n\n        _syncElement: function() {\n            var options = \"\";\n            var view = this.dataSource.view();\n            for (var idx = 0; idx < view.length; idx++) {\n                options += this._option(view[idx][this.options.dataValueField] || view[idx], view[idx][this.options.dataTextField] || view[idx], true);\n            }\n            this.element.html(options);\n        },\n\n        _option: function(dataValue, dataText) {\n            var option = \"<option\";\n\n            if (dataValue !== undefined) {\n                dataValue += \"\";\n\n                if (dataValue.indexOf('\"') !== -1) {\n                    dataValue = dataValue.replace(/\"/g, \"&quot;\");\n                }\n\n                option += ' value=\"' + dataValue + '\"';\n            }\n            option += \" selected>\";\n\n            if (dataText !== undefined) {\n                option += kendo.htmlEncode(dataText);\n            }\n\n            return option += \"</option>\";\n        },\n\n        _setItemId: function(item, id) {\n            if (!item.length) {\n                return;\n            }\n\n            item.attr(kendoAttr(UNIQUE_ID), id).attr(ID, id);\n        },\n\n        _setItemIds: function() {\n            var that = this;\n            var items = that.items();\n            var view = that.dataSource.view();\n            var viewLength = view.length;\n            var i;\n\n            for (i = 0; i < viewLength; i++) {\n                that._setItemId(items.eq(i), view[i].uid);\n            }\n        },\n\n        _selectable: function() {\n            var that = this;\n            var selectable = that.options.selectable;\n            var selectableOptions = Selectable.parseOptions(selectable);\n\n            that.selectable = new Selectable(that._innerWrapper, {\n                aria: true,\n                selectedClass: \"k-selected\",\n                multiple: selectableOptions.multiple,\n                filter: ENABLED_ITEM_SELECTOR,\n                change: proxy(that._onSelect, that)\n            });\n        },\n\n        _onSelect: function() {\n            var that = this;\n\n            that._updateToolbar();\n            that._updateAllToolbars();\n            that.trigger(CHANGE);\n        },\n\n        _destroySelectable: function() {\n            var that = this;\n\n            if (that.selectable && that.selectable.element) {\n                that.selectable.destroy();\n                that.selectable = null;\n            }\n        },\n\n        _getList: function() {\n            return this.wrapper.find(LIST_SELECTOR);\n        },\n\n        _getItems: function(items) {\n            return this.items().filter(items);\n        },\n\n        _createToolbar: function() {\n            var that = this;\n            var toolbarOptions = that.options.toolbar;\n            var position = toolbarOptions.position || RIGHT;\n            var toolbarInsertion = position === BOTTOM ? \"insertAfter\" : \"insertBefore\";\n            var tools = toolbarOptions.tools || [];\n            var messages = that.options.messages;\n\n            that._destroyToolbar();\n            that.wrapper.removeClass(TOOLBAR_POSITION_CLASS_NAMES.join(SPACE));\n\n            if (tools.length && tools.length > 0) {\n                var toolbarElement = $(that.templates.toolbar)[toolbarInsertion](that._innerWrapper);\n                that.toolbar = new ToolBar(toolbarElement, extend({}, toolbarOptions, { listBox: that, messages: messages }));\n                that.wrapper.addClass(TOOLBAR_CLASS + DASH + position);\n            }\n        },\n\n        _destroyToolbar: function() {\n            var that = this;\n\n            if (that.toolbar) {\n                that.toolbar.destroy();\n                that.toolbar = null;\n            }\n        },\n\n        _executeCommand: function(commandName) {\n            var that = this;\n            var command = CommandFactory.current.create(commandName, { listBox: that });\n\n            if (command) {\n                command.execute();\n                that._updateToolbar();\n                that._updateAllToolbars();\n            }\n        },\n\n        _updateToolbar: function() {\n            var toolbar = this.toolbar;\n\n            if (toolbar) {\n                toolbar._updateToolStates();\n            }\n        },\n\n        _updateAllToolbars: function() {\n            var listBoxElements = $(\"select[data-role='listbox']\");\n            var elementsLength = listBoxElements.length;\n            var listBox;\n            var i;\n\n            for (i = 0; i < elementsLength; i++) {\n                listBox = $(listBoxElements[i]).data(KENDO_LISTBOX);\n\n                if (listBox) {\n                    listBox._updateToolbar();\n                }\n            }\n        }\n    });\n\n    kendo.ui.plugin(ListBox);\n\n    var CommandFactory = Class.extend({\n        init: function() {\n            this._commands = [];\n        },\n\n        register: function(commandName, commandType) {\n            this._commands.push({\n                commandName: commandName,\n                commandType: commandType\n            });\n        },\n\n        create: function(commandName, options) {\n            var commands = this._commands;\n            var itemsLength = commands.length;\n            var name = commandName ? commandName.toLowerCase() : \"\";\n            var match;\n            var command;\n            var i;\n\n            for (i = 0; i < itemsLength; i++) {\n                command = commands[i];\n\n                if (command.commandName.toLowerCase() === name) {\n                    match = command;\n                    break;\n                }\n            }\n\n            if (match) {\n                return new match.commandType(options);\n            }\n        }\n    });\n    CommandFactory.current = new CommandFactory();\n\n    var ListBoxCommand = Class.extend({\n        init: function(options) {\n            var that = this;\n\n            that.options = extend({}, that.options, options);\n            that.listBox = that.options.listBox;\n        },\n\n        options: {\n            listBox: null\n        },\n\n        getItems: function() {\n            return $(this.listBox.select());\n        },\n\n        execute: noop,\n        canExecute: noop\n    });\n\n    var RemoveItemsCommand = ListBoxCommand.extend({\n        execute: function() {\n            var that = this;\n            var listBox = that.listBox;\n            var items = that.getItems();\n\n            if (!listBox.trigger(REMOVE, { dataItems: listBox._dataItems(items), items: items })) {\n                listBox.remove(items);\n            }\n        },\n\n        canExecute: function() {\n            return this.listBox.select().length > 0;\n        }\n    });\n    CommandFactory.current.register(REMOVE, RemoveItemsCommand);\n\n    var MoveItemsCommand = ListBoxCommand.extend({\n        execute: function() {\n            var that = this;\n\n            if (that.canExecute()) {\n                that.moveItems();\n            }\n        },\n\n        canExecute: noop,\n\n        moveItems: function() {\n            var that = this;\n            var listBox = that.listBox;\n            var options = that.options;\n            var items = that.getItems();\n            var offset = options.offset;\n            var indecesInDom = getSortedDomIndices(items);\n            var movedItems = $.makeArray(items.sort(that.itemComparer));\n            var moveAction = options.moveAction;\n            var movedItem;\n\n            if (!listBox.trigger(REORDER, { dataItems: listBox._dataItems(movedItems), items: $(movedItems), offset: offset })) {\n                while (movedItems.length > 0 && indecesInDom.length > 0) {\n                    movedItem = movedItems[moveAction]();\n\n                    listBox.reorder(movedItem, indecesInDom[moveAction]() + offset);\n                }\n            }\n        },\n\n        options: {\n            offset: 0,\n            moveAction: \"pop\"\n        },\n\n        itemComparer: function(item1, item2) {\n            var indexItem1 = $(item1).index();\n            var indexItem2 = $(item2).index();\n\n            if (indexItem1 === indexItem2) {\n                return 0;\n            } else {\n                return (indexItem1 > indexItem2 ? 1 : (-1));\n            }\n        }\n    });\n\n    var MoveUpItemsCommand = MoveItemsCommand.extend({\n        options: {\n            offset: MOVE_UP_OFFSET,\n            moveAction: \"shift\"\n        },\n\n        canExecute: function() {\n            var items = this.getItems();\n            var domIndices = getSortedDomIndices(items);\n\n            return (domIndices.length > 0 && domIndices[0] > 0);\n        }\n    });\n    CommandFactory.current.register(MOVE_UP, MoveUpItemsCommand);\n\n    var MoveDownItemsCommand = MoveItemsCommand.extend({\n        options: {\n            offset: MOVE_DOWN_OFFSET,\n            moveAction: \"pop\"\n        },\n\n        canExecute: function() {\n            var that = this;\n            var items = that.getItems();\n            var domIndices = getSortedDomIndices(items);\n\n            return (domIndices.length > 0 && $(domIndices).last()[0] < (that.listBox.items().length - 1));\n        }\n    });\n    CommandFactory.current.register(MOVE_DOWN, MoveDownItemsCommand);\n\n    var TransferItemsCommand = ListBoxCommand.extend({\n        options: {\n            filter: ENABLED_ITEM_SELECTOR\n        },\n\n        execute: function() {\n            var that = this;\n            var sourceListBox = that.getSourceListBox();\n            var items = that.getItems().filter(that.options.filter);\n            var dataItems = sourceListBox ? sourceListBox._dataItems(items) : [];\n            var destinationListBox = that.getDestinationListBox();\n            var updatedSelection = that.getUpdatedSelection(items);\n\n            if (destinationListBox && items.length > 0) {\n                if (!destinationListBox.trigger(ADD, { dataItems: dataItems, items: items })) {\n                    destinationListBox.add(dataItems);\n                }\n\n                if (!sourceListBox.trigger(REMOVE, { dataItems: dataItems, items: items })) {\n                    sourceListBox.remove(items);\n                    that.updateSelection(updatedSelection);\n                }\n            }\n        },\n\n        getUpdatedSelection: function(items) {\n\n            if (items.length !== 1) {\n                return null;\n            }\n            var that = this;\n            var itemFilter = that.options.filter;\n            var sourceListBox = that.getSourceListBox();\n            var lastEnabledItem = sourceListBox ? sourceListBox.items().filter(itemFilter).last() : null;\n            var containsLastItem = $(items).filter(lastEnabledItem).length > 0;\n            var itemToSelect = containsLastItem ? $(items).prevAll(itemFilter)[0] : $(items).nextAll(itemFilter)[0];\n\n            if (itemToSelect) {\n                return itemToSelect;\n            } else {\n                return null;\n            }\n        },\n\n        updateSelection: function(item) {\n            var sourceListBox = this.getSourceListBox();\n\n            if (sourceListBox && item) {\n                $(sourceListBox.select($(item)));\n                sourceListBox._scrollIntoView(item);\n            }\n        },\n\n        getSourceListBox: noop,\n        getDestinationListBox: noop\n    });\n\n    var TransferItemsToCommand = TransferItemsCommand.extend({\n        canExecute: function() {\n            var sourceListBox = this.getSourceListBox();\n\n            return (sourceListBox ? sourceListBox.select().length > 0 : false);\n        },\n\n        getSourceListBox: function() {\n            return this.listBox;\n        },\n\n        getDestinationListBox: function() {\n            var sourceListBox = this.getSourceListBox();\n            return sourceListBox && sourceListBox.options.connectWith ? $(HASH + sourceListBox.options.connectWith).data(KENDO_LISTBOX) : null;\n        },\n\n        getItems: function() {\n            var sourceListBox = this.getSourceListBox();\n            return sourceListBox ? $(sourceListBox.select()) : $();\n        }\n    });\n    CommandFactory.current.register(TRANSFER_TO, TransferItemsToCommand);\n\n    var TransferItemsFromCommand = TransferItemsCommand.extend({\n        canExecute: function() {\n            var sourceListBox = this.getSourceListBox();\n\n            return (sourceListBox ? sourceListBox.select().length > 0 : false);\n        },\n\n        getSourceListBox: function() {\n            var destinationListBox = this.getDestinationListBox();\n            return (destinationListBox && destinationListBox.options.connectWith) ? $(HASH + destinationListBox.options.connectWith).data(KENDO_LISTBOX) : null;\n        },\n\n        getDestinationListBox: function() {\n            return this.listBox;\n        },\n\n        getItems: function() {\n            var sourceListBox = this.getSourceListBox();\n            return sourceListBox ? $(sourceListBox.select()) : $();\n        }\n    });\n    CommandFactory.current.register(TRANSFER_FROM, TransferItemsFromCommand);\n\n    var TransferAllItemsToCommand = TransferItemsToCommand.extend({\n        canExecute: function() {\n            var sourceListBox = this.getSourceListBox();\n\n            return (sourceListBox ? sourceListBox.wrapper.find(ENABLED_ITEMS_SELECTOR).length > 0 : false);\n        },\n\n        getItems: function() {\n            var sourceListBox = this.getSourceListBox();\n            return sourceListBox ? sourceListBox.items() : $();\n        },\n\n        getUpdatedSelection: noop,\n        updateSelection: noop\n    });\n    CommandFactory.current.register(TRANSFER_ALL_TO, TransferAllItemsToCommand);\n\n    var TransferAllItemsFromCommand = TransferItemsFromCommand.extend({\n        canExecute: function() {\n            var sourceListBox = this.getSourceListBox();\n\n            return (sourceListBox ? sourceListBox.wrapper.find(ENABLED_ITEMS_SELECTOR).length > 0 : false);\n        },\n\n        getItems: function() {\n            var sourceListBox = this.getSourceListBox();\n            return sourceListBox ? sourceListBox.items() : $();\n        },\n\n        getUpdatedSelection: noop,\n        updateSelection: noop\n    });\n    CommandFactory.current.register(TRANSFER_ALL_FROM, TransferAllItemsFromCommand);\n\n    var ToolBar = Class.extend({\n        init: function(element, options) {\n            var that = this;\n\n            that.element = $(element).addClass(TOOLBAR_CLASS);\n            that.options = extend({}, that.options, options);\n            that.listBox = that.options.listBox;\n\n            that._initTemplates();\n            that._createTools();\n            that._updateToolStates();\n            that._attachEventHandlers();\n        },\n\n        destroy: function() {\n            var that = this;\n\n            that._detachEventHandlers();\n            kendo.destroy(that.element);\n            that.element.remove();\n            that.element = null;\n        },\n\n        options: {\n            position: RIGHT,\n            tools: []\n        },\n\n        _initTemplates: function() {\n            this.templates = {\n                tool: kendoTemplate(\n                    \"<li>\" +\n                        \"<a href='\\\\\\\\#' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button' data-command='#= command #' title='#= text #' aria-label='#= text #' role='button'>\" +\n                            \"<span class='k-button-icon k-icon #= iconClass #'></span>\" +\n                        \"</a>\" +\n                    \"</li>\")\n            };\n        },\n\n        _createTools: function() {\n            var that = this;\n            var tools = that.options.tools;\n            var toolsLength = tools.length;\n            var toolsMessages = that.options.messages.tools;\n            var toolList = that._createToolList();\n            var tool;\n            var i;\n\n            for (i = 0; i < toolsLength; i++) {\n                tool = extend({}, ToolBar.defaultTools[tools[i]], { text: toolsMessages[tools[i]] });\n\n                if (tool) {\n                    toolList.append($(that.templates.tool(tool)));\n                }\n            }\n\n            that.element.append(toolList);\n        },\n\n        _createToolList: function() {\n            return $(\"<ul class='k-reset' />\");\n        },\n\n        _attachEventHandlers: function() {\n            var that = this;\n\n            that.element.on(CLICK, TOOL_SELECTOR, proxy(that._onToolClick, that));\n        },\n\n        _detachEventHandlers: function() {\n            this.element.off(NS).find(\"*\").off(NS);\n        },\n\n        _onToolClick: function(e) {\n            e.preventDefault();\n\n            this._executeToolCommand($(e.currentTarget).data(COMMAND));\n        },\n\n        _executeToolCommand: function(command) {\n            var that = this;\n            var listBox = that.listBox;\n\n            if (listBox) {\n                listBox._executeCommand(command);\n            }\n        },\n\n        _updateToolStates: function() {\n            var that = this;\n            var tools = that.options.tools;\n            var toolsLength = tools.length;\n            var i;\n\n            for (i = 0; i < toolsLength; i++) {\n                that._updateToolState(tools[i]);\n            }\n        },\n\n        _updateToolState: function(toolName) {\n            var that = this;\n            var command = CommandFactory.current.create(toolName, { listBox: that.listBox });\n            var tool = that.element.find(\"[data-command='\" + toolName + \"']\");\n            var toolElement = tool[0];\n\n            if (toolElement && command && command.canExecute) {\n                if (command.canExecute()) {\n                    tool.removeClass(DISABLED_STATE_CLASS).removeAttr(TABINDEX);\n                } else {\n                    tool.addClass(DISABLED_STATE_CLASS).attr(TABINDEX, \"-1\");\n                }\n            }\n        }\n    });\n\n    ToolBar.defaultTools = {\n        remove: {\n            command: REMOVE,\n            iconClass: \"k-i-x\"\n        },\n        moveUp: {\n            command: MOVE_UP,\n            iconClass: \"k-i-arrow-60-up\"\n        },\n        moveDown: {\n            command: MOVE_DOWN,\n            iconClass: \"k-i-arrow-60-down\"\n        },\n        transferTo: {\n            command: TRANSFER_TO,\n            iconClass: \"k-i-arrow-60-right\"\n        },\n        transferFrom: {\n            command: TRANSFER_FROM,\n            iconClass: \"k-i-arrow-60-left\"\n        },\n        transferAllTo: {\n            command: TRANSFER_ALL_TO,\n            iconClass: \"k-i-arrow-double-60-right\"\n        },\n        transferAllFrom: {\n            command: TRANSFER_ALL_FROM,\n            iconClass: \"k-i-arrow-double-60-left\"\n        }\n    };\n\n    extend(ListBox, {\n        ToolBar: ToolBar\n    });\n\n    function isInputElement(element) {\n        return $(element).is(\":button,a,:input,a>.k-icon,textarea,span.k-select,span.k-icon,span.k-link,label.k-checkbox-label,.k-input,.k-multiselect-wrap,.k-picker-wrap,.k-picker-wrap>.k-selected-color,.k-tool-icon,.k-dropdown\");\n    }\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","$","window","kendo","jQuery","undefined","kendoAttr","attr","data","keys","kendoTemplate","template","Widget","ui","DataSource","Selectable","DataBoundWidget","Class","extend","noop","proxy","DASH","DOT","SPACE","HASH","KENDO_LISTBOX","NS","DISABLED_STATE_CLASS","SELECTED_STATE_CLASS","ENABLED_ITEM_SELECTOR","ENABLED_ITEMS_SELECTOR","TOOLBAR_CLASS","TOOL_SELECTOR","FOCUSED_CLASS","DRAG_CLUE_CLASS","DROP_HINT_CLASS","LIST_CLASS","LIST_SELECTOR","CLICK","KEYDOWN","BLUR","outerWidth","_outerWidth","outerHeight","_outerHeight","CHANGE","DATABOUND","ADD","REMOVE","REORDER","MOVE_UP","MOVE_DOWN","TRANSFER_TO","TRANSFER_FROM","TRANSFER_ALL_TO","TRANSFER_ALL_FROM","DRAGGEDCLASS","UNIQUE_ID","ID","TABINDEX","COMMAND","MOVE_UP_OFFSET","MOVE_DOWN_OFFSET","DRAGSTART","DRAG","DROP","DRAGEND","DEFAULT_FILTER","RIGHT","BOTTOM","TOOLBAR_POSITION_CLASS_NAMES","getSortedDomIndices","items","indices","map","item","index","isUndefined","value","defaultHint","element","clone","addClass","defaultPlaceholder","ListBox","init","options","that","this","fn","call","_wrapper","_list","_ariaLabel","hide","dataSource","dataTextField","dataValueField","_templates","_selectable","_dataSource","_createToolbar","_createDraggable","_createNavigatable","destroy","isNaN","_listTabIndex","_getList","off","_unbindDataSource","_destroySelectable","_destroyToolbar","wrapper","_target","_draggable","placeholder","setOptions","events","autoBind","selectable","draggable","dropSources","connectWith","navigatable","toolbar","position","tools","messages","remove","moveUp","moveDown","transferTo","transferFrom","transferAllTo","transferAllFrom","add","dataItems","length","itemsLength","list","i","_unbindDataChange","_addItem","_bindDataChange","_bindDataSource","_syncElement","dataItem","templates","itemTemplate","r","itemContent","_setItemId","uid","appendTo","_data","push","_addItemAt","_insertElementAt","insertAfter","children","eq","prepend","on","_click","_keyDown","_blur","_getTabIndex","tabindex","removeAttr","removeClass","e","target","currentTarget","oldTarget","activeEl","_activeElement","isContained","contains","isInputElement","focus","_getNavigatableItem","key","current","filter","first","UP","prevAll","DOWN","nextAll","_scrollIntoView","parent","itemOffsetTop","offsetTop","contentScrollTop","scrollTop","contentOffsetHeight","clientHeight","bottomDistance","offsetHeight","keyCode","shouldPreventDefault","shiftKey","ctrlKey","_shiftSelecting","DELETE","_executeCommand","preventDefault","clearSelection","hasClass","trigger","select","SPACEBAR","LEFT","focusElement","hint","Error","Draggable","isFunction","dragstart","_dragstart","dragcancel","_clear","drag","_drag","dragend","_dragend","draggedElement","eventData","draggableEvent","enabled","is","_findElementUnderCursor","elementUnderCursor","sender","show","_findTarget","elementNode","node","closest","has","listBox","appendToBottom","_searchConnectedListBox","_getElementCenter","center","getOffset","top","left","connectedListBox","originalElement","closestContainer","find","getKendoListBox","inArray","cursorOffset","x","location","y","targetCenter","offsetDelta","direction","Math","round","_movePlaceholder","draggableOptions","append","before","after","draggedItem","placeholderIndex","not","draggedIndex","offset","reorder","dropped","_updateToolbar","_updateAllToolbars","dataItemAtIndex","at","itemAtIndex","listItem","_removeElement","listItems","_getItems","_removeItem","transport","pop","isNew","_destroyed","uniqueIdAttr","getByUid","html","_dataItems","enabledItems","multiple","clear","enable","_enableItem","setDataSource","Array","isArray","fields","field","create","fetch","_changeHandler","bind","unbind","_dataChangeHandler","refresh","wrap","style","cssText","title","insertBefore","className","css","_innerWrapper","firstChild","selectableOptions","parseOptions","inputElm","ul","labelElm","ariaLabel","ariaLabelledBy","labelId","guid","expr","useWithBlock","view","idx","_setItemIds","_option","dataValue","dataText","option","indexOf","replace","htmlEncode","viewLength","aria","selectedClass","change","_onSelect","toolbarOptions","toolbarInsertion","join","toolbarElement","ToolBar","commandName","command","CommandFactory","execute","_updateToolStates","listBoxElements","elementsLength","plugin","_commands","register","commandType","commands","toLowerCase","match","ListBoxCommand","getItems","canExecute","RemoveItemsCommand","MoveItemsCommand","moveItems","indecesInDom","movedItems","makeArray","sort","itemComparer","moveAction","movedItem","item1","item2","indexItem1","indexItem2","MoveUpItemsCommand","domIndices","MoveDownItemsCommand","last","TransferItemsCommand","sourceListBox","getSourceListBox","destinationListBox","getDestinationListBox","updatedSelection","getUpdatedSelection","updateSelection","itemFilter","lastEnabledItem","containsLastItem","itemToSelect","TransferItemsToCommand","TransferItemsFromCommand","TransferAllItemsToCommand","TransferAllItemsFromCommand","_initTemplates","_createTools","_attachEventHandlers","_detachEventHandlers","tool","toolsLength","toolsMessages","toolList","_createToolList","defaultTools","text","_onToolClick","_executeToolCommand","_updateToolState","toolName","toolElement","iconClass","amd","a1","a2","a3"],"mappings":"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"}