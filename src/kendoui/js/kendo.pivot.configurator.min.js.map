{"version":3,"file":"kendo.pivot.configurator.min.js","sources":["kendo.pivot.configurator.js"],"sourcesContent":["/*!\n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n\n*/\n(function(f, define) {\n    define('kendo.pivot.configurator',[ \"./kendo.dom\", \"./kendo.html.chip\", \"./kendo.html.chiplist\", \"./kendo.pivot.common\" ], f);\n})(function() {\n\nvar __meta__ = { // jshint ignore:line\n    id: \"pivot.configurator\",\n    name: \"PivotConfigurator\",\n    category: \"web\",\n    depends: [ \"dropdownlist\", \"treeview\", \"treeview.draganddrop\", \"pivot.fieldmenu\", \"html.chip\", \"html.chiplist\", \"pivot.common\"  ],\n    hidden: true\n};\n\n/*jshint eqnull: true, laxbreak:true */\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        Widget = ui.Widget,\n        common = window.kendo.pivotgrid.common,\n        fetchDiscover = common.fetchDiscover,\n        configuratorReducer = common.configuratorReducer,\n        PIVOT_CONFIGURATOR_ACTION = common.PIVOT_CONFIGURATOR_ACTION,\n        ns = \".kendoPivotConfigurator\",\n        HOVER_EVENTS = \"mouseenter\" + ns + \" mouseleave\" + ns,\n        SETTINGS_TEMPLATE = kendo.template('<div class=\"k-pivotgrid-configurator-header\">' +\n                                            '<div class=\"k-pivotgrid-configurator-header-text\">#:title#</div>' +\n                                          '</div>'),\n        CONTENT_TEMPLATE = kendo.template('<div class=\"k-pivotgrid-configurator-content\">' +\n            '<form class=\"#:formClass#\">' +\n                '#if (horizontal) {# <div class=\"k-form-field-wrapper\"> #}#' +\n                '<div class=\"k-form-field\">' +\n                    '<label class=\"k-label\">Fields</label>' +\n                '</div>' +\n                '<div class=\"k-form-field\">' +\n                  '<div class=\"k-fields-list-wrapper\"></div>' +\n                '</div>' +\n                '#if (horizontal) {# </div><div class=\"k-form-field-wrapper\"> #}#' +\n                '<div class=\"k-form-field\">' +\n                    '<label class=\"k-label\">Columns</label>' +\n                '</div>' +\n                '<div class=\"k-chip-list k-column-fields\"></div>' +\n                '<div class=\"k-form-field\">' +\n                    '<label class=\"k-label\">Rows</label>' +\n                '</div>' +\n                '<div class=\"k-chip-list k-row-fields\"></div>' +\n                '#if (horizontal) {# </div><div class=\"k-form-field-wrapper\"> #}#' +\n                '<div class=\"k-form-field\">' +\n                    '<label class=\"k-label\">Values</label>' +\n                '</div>' +\n                '<div class=\"k-chip-list k-column-fields\"></div>' +\n                '#if (horizontal) {# </div> #}#' +\n            '</form>' +\n        '</div>'),\n        TARGET_ITEM_TEMPLATE = '<span>' +\n                '<span class=\"k-chip-label\">#:name#</span>' +\n                '#if (menuenabled) {# <span class=\"k-icon k-i-more-vertical\"></span> #}#' +\n            '</span>',\n        ACTIONS_TEMPLATE = kendo.template(\n                '<div class=\"k-pivotgrid-configurator-actions k-actions k-hstack k-justify-content-end\">' +\n                  '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\">' +\n                    '<span class=\"k-button-text\">#:cancelText#</span>' +\n                  '</button>' +\n                  '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\">' +\n                    '<span class=\"k-button-text\">#:applyText#</span>' +\n                  '</button>' +\n                '</div>'),\n        SETTING_CONTAINER_TEMPLATE = kendo.template('<div class=\"k-pivotgrid-target k-pivotgrid-configurator-section\"><strong>${name}</strong><div class=\"k-pivotgrid-target-wrap\"></div>');\n\n    function addKPI(data) {\n        var found;\n        var idx = 0;\n        var length = data.length;\n\n        for (; idx < length; idx++) {\n            if (data[idx].type == 2) {\n                found = true;\n                break;\n            }\n        }\n\n        if (found) {\n            data.splice(idx + 1, 0, {\n                caption: \"KPIs\",\n                defaultHierarchy: \"[KPIs]\",\n                name: \"KPIs\",\n                uniqueName: \"[KPIs]\"\n            });\n        }\n    }\n\n    function kpiNode(node) {\n        return {\n            name: node.uniqueName,\n            type: node.type\n        };\n    }\n\n    function normalizeKPIs(data) {\n        for (var idx = 0, length = data.length; idx < length; idx++) {\n            data[idx].uniqueName = data[idx].name;\n            data[idx].type = \"kpi\";\n        }\n\n        return data;\n    }\n\n    function settingTargetFromNode(node) {\n        var target = $(node).closest(\".k-pivot-setting\");\n\n        if (target.length) {\n            return target.data(\"kendoPivotSettingTarget\");\n        }\n        return null;\n    }\n\n    var PivotConfiguratorV2 = Widget.extend({\n        init: function(element, options) {\n            Widget.fn.init.call(this, element, options);\n\n            this.element.addClass(\"k-widget k-pivotgrid-configurator k-pos-relative\");\n\n            this._dataSource();\n\n            this._layout();\n\n            this.refresh();\n\n            if (options.height) {\n                this.element.height(options.height);\n            }\n\n            kendo.notify(this);\n        },\n\n        events: [],\n\n        options: {\n            name: \"PivotConfiguratorV2\",\n            orientation: \"vertical\",\n            filterable: false,\n            sortable: false,\n            messages: {\n                title: \"Settings\",\n                cancelText: \"Cancel\",\n                applyButtonText: \"Apply\",\n                measures: \"Select some fields to begin setup\",\n                columns: \"Select some fields to begin setup\",\n                rows: \"Select some fields to begin setup\"\n            }\n        },\n\n        setDataSource: function(dataSource) {\n            this.options.dataSource = dataSource;\n\n            this._dataSource();\n\n            if (this.measures) {\n                this.measures.setDataSource(dataSource);\n            }\n\n            if (this.rows) {\n                this.rows.setDataSource(dataSource);\n            }\n\n            if (this.columns) {\n                this.columns.setDataSource(dataSource);\n            }\n\n            this.refresh();\n        },\n\n        _dataSource: function() {\n            var that = this;\n\n            if (that.dataSource && that._refreshHandler) {\n                that.dataSource.unbind(\"change\", that._refreshHandler)\n                               .unbind(\"error\", that._errorHandler)\n                               .unbind(\"progress\", that._progressHandler);\n            } else {\n                that._errorHandler = $.proxy(that._error, that);\n                that._refreshHandler = $.proxy(that.refresh, that);\n                that._progressHandler = $.proxy(that._requestStart, that);\n            }\n\n            that.dataSource = kendo.data.PivotDataSourceV2.create(that.options.dataSource);\n            that.dataSource.bind(\"change\", that._refreshHandler)\n                           .bind(\"error\", that._errorHandler)\n                           .bind(\"progress\", that._progressHandler);\n        },\n\n        _layout: function() {\n\n            var that = this;\n            var options = that.options;\n            var messages = options.messages;\n            var horizontal = options.orientation == \"horizontal\";\n\n            var panel = $(\"<div class='k-pivotgrid-configurator-panel k-pivotgrid-configurator-push'></div>\");\n\n            panel.addClass(horizontal ? \"k-pivotgrid-configurator-horizontal\" : \"k-pivotgrid-configurator-vertical\");\n\n            that.element.append(panel);\n\n            that.panel = panel;\n\n            $(SETTINGS_TEMPLATE({ title: this.options.messages.title })).appendTo(that.panel);\n\n            $(CONTENT_TEMPLATE({ formClass: horizontal ? \"k-form k-form-horizontal\" : \"k-form\", filterable: options.filterable, horizontal: horizontal }))\n                .appendTo(that.panel).find(\".k-chip-list\")\n                .each(function(index, elm) {\n                    kendo.html.renderChipList(elm, $.extend({}, options));\n                });\n\n            that._fields();\n            $(ACTIONS_TEMPLATE({ cancelText: messages.cancelText, applyText: messages.applyButtonText })).appendTo(that.panel);\n            that._targets();\n\n            that.element.on(\"click\" + ns, \".k-pivotgrid-configurator-actions > button\", $.proxy(that._actions, that));\n        },\n\n        _actions: function(e) {\n            e.preventDefault();\n\n            var target = $(e.currentTarget);\n            if (target.index()) {\n                this.columns._applyState();\n                this.rows._applyState();\n                this.measures._applyState();\n                this.dataSource.read();\n            } else {\n                this.columns._cancelChanges();\n                this.rows._cancelChanges();\n                this.measures._cancelChanges();\n                this.treeView.dataSource.read();\n            }\n        },\n\n        _targets: function() {\n            var that = this;\n            var columns = that.panel.find(\".k-column-fields\").first();\n            var rows = that.panel.find(\".k-row-fields\");\n            var measures = that.panel.find(\".k-chip-list\").last();\n            var options = this.options;\n\n            var targetItemTemplate = kendo.html.renderChip(TARGET_ITEM_TEMPLATE, $.extend({}, options, {\n                fillMode: \"solid\",\n                themeColor: \"base\",\n                rounded: \"full\",\n                removable: true,\n                removeIcon: \"close-circle\"\n            }));\n\n            this.columns = this._createTarget(columns, {\n                filterable: options.filterable,\n                sortable: options.sortable,\n                template: targetItemTemplate,\n                connectWith: rows,\n                messages: {\n                    empty: options.messages.columns\n                }\n            });\n\n            this.rows = this._createTarget(rows, {\n                filterable: options.filterable,\n                sortable: options.sortable,\n                template: targetItemTemplate,\n                setting: \"rows\",\n                connectWith: columns,\n                messages: {\n                    empty: this.options.messages.rows\n                }\n            });\n\n            this.measures = this._createTarget(measures, {\n                setting: \"measures\",\n                template: targetItemTemplate,\n                messages: {\n                    empty: options.messages.measures\n                }\n            });\n        },\n\n        _createTarget: function(element, options) {\n            var that = this;\n            return new kendo.ui.PivotSettingTargetV2(element, $.extend({\n                dataSource: this.dataSource,\n                hint: function(element) {\n                    return element.clone();\n                },\n                remove: function(e) {\n                    var item = that.treeView.wrapper\n                        .find(\"[data-name='\" + e.name + \"']\")\n                        .closest(\"li\");\n                    var id = item.attr(kendo.attr(\"uid\"));\n                    var dataItem = that.treeView.dataSource.getByUid(id);\n\n                    if (dataItem) {\n                        dataItem.checked = false;\n                        item.find(\"input\").attr(\"checked\", false);\n                    }\n                },\n                template: options.template\n            }, options));\n        },\n\n        _fields: function() {\n            var that = this;\n            var container = that.element.find(\".k-fields-list-wrapper\");\n\n            this.treeView = $(\"<div/>\").appendTo(container)\n                .kendoTreeView({\n                    checkboxes: {\n                        checkChildren: true,\n                        template: '#if ((item.hasChildren || item.aggregator) && item.uniqueName !== \"[KPIs]\" && item.uniqueName !== \"[Measures]\") {# <input type=\"checkbox\" data-name=\"#:item.uniqueName#\" #= item.checked ? \"checked\" : \"\" # class=\"k-checkbox k-checkbox-md k-rounded-md\" id=\"#:item.uid#\" tabindex=\"-1\"> #}#'\n                    },\n                    dataTextField: \"caption\",\n                    autoBind: false,\n                    check: function(e) {\n                      var dataItem = e.sender.dataItem(e.node);\n                      var action = {\n                        type: PIVOT_CONFIGURATOR_ACTION.toggleSelection,\n                        payload: dataItem\n                      };\n                      var state = {\n                        columnAxes: that.columns._state(),\n                        rowAxes: that.rows._state(),\n                        measureAxes: that.measures._state()\n                      };\n                      var result = configuratorReducer(state, action);\n\n                      if (dataItem.defaultHierarchy && dataItem.items.length) {\n                          that._checkMembers([{ name: dataItem.defaultHierarchy }], dataItem.items);\n                          dataItem.items.trigger(\"change\");\n                      }\n\n                      if (result.columnAxes) {\n                          that.columns._state(result.columnAxes);\n                          that.columns._redraw();\n                      }\n                      if (result.rowAxes) {\n                          that.rows._state(result.rowAxes);\n                          that.rows._redraw();\n                      }\n                      if (result.measureAxes) {\n                          that.measures._state(result.measureAxes);\n                          that.measures._redraw();\n                      }\n                    },\n                    dataSource: this._treeViewDataSource()\n                 })\n                .data(\"kendoTreeView\");\n\n            this.treeView.wrapper.off(\"click\", this.treeView._clickHandler);\n        },\n\n        _treeViewDataSource: function() {\n            var that = this;\n\n            return kendo.data.HierarchicalDataSource.create({\n                schema: {\n                    model: {\n                        id: \"uniqueName\",\n                        hasChildren: function(item) {\n                            return !(\"hierarchyUniqueName\" in item) && !(\"aggregator\" in item);\n                        }\n                    }\n                },\n                transport: {\n                    read: function(options) {\n                        var node;\n                        var transport = that.dataSource.transport;\n                        var catalog = transport.catalog();\n                        var cube = transport.cube();\n                        var fetchOptions = {\n                            url: transport.options.read\n                        };\n                        var columns = that.columns._state();\n                        var rows = that.rows._state();\n                        var measures = that.measures._state();\n                        var members = columns.concat(rows).concat(measures);\n\n                        if ($.isEmptyObject(options.data)) {\n                            var fetchOpts = {\n                                connection: {\n                                    catalog: catalog,\n                                    cube: cube\n                                },\n                                restrictions: {\n                                    catalogName: catalog,\n                                    cubeName: cube\n                                },\n                                command: 'schemaDimensions'\n                            };\n\n                            fetchDiscover(fetchOptions, fetchOpts)\n                                .then(function(newFields) {\n                                    that._checkMembers(members, newFields);\n                                    addKPI(newFields);\n                                    options.success(newFields);\n                                 });\n                        } else {\n                            //Hack to get the actual node as the HierarchicalDataSource does not support passing it\n                            node = that.treeView.dataSource.get(options.data.uniqueName);\n\n                            if (node.uniqueName === \"[KPIs]\") {\n                                fetchDiscover(fetchOptions, that._getKPIOptions(catalog, cube))\n                                .then(function(newFields) {\n                                    options.success(normalizeKPIs(newFields));\n                                });\n                            } else if (node.type == \"kpi\") {\n                                options.success(buildKPImeasures(node));\n                            } else {\n                                fetchDiscover(fetchOptions ,that._loadFieldsCommand(node, catalog, cube))\n                                .then(function(newFields) {\n                                    that._checkMembers(members, newFields);\n                                    options.success(newFields);\n                                });\n                            }\n                        }\n                    }\n                }\n            });\n        },\n\n        _checkMembers: function(members, newData) {\n            var hash = {};\n            var index = 0;\n\n            for (index = 0; index < members.length; index++) {\n                hash[members[index].name] = true;\n            }\n\n            for (index = 0; index < newData.length; index++) {\n                if (hash[newData[index].uniqueName]) {\n                    newData[index].checked = true;\n                }\n            }\n        },\n\n        _getKPIOptions: function(catalog, cube) {\n            return {\n                connection: {\n                    catalog: catalog,\n                    cube: cube\n                },\n                restrictions: {\n                    catalogName: catalog,\n                    cubeName: cube\n                },\n                command: 'schemaKPIs'\n            };\n        },\n\n        _loadFieldsCommand: function(field, catalog, cube) {\n            var command;\n            var dimensionUniqueName;\n            var hierarchyUniqueName;\n\n            if (field.type === 2) {\n                command = 'schemaMeasures';\n            } else if (field.dimensionUniqueName) {\n                command = 'schemaLevels';\n                hierarchyUniqueName = field.uniqueName;\n            } else {\n                command = 'schemaHierarchies';\n                dimensionUniqueName = field.uniqueName;\n            }\n\n            var options = {\n                connection: {\n                    catalog: catalog,\n                    cube: cube\n                },\n                restrictions: {\n                    catalogName: catalog,\n                    cubeName: cube,\n                    hierarchyUniqueName: hierarchyUniqueName,\n                    dimensionUniqueName: dimensionUniqueName\n                },\n                command: command\n            };\n\n            return options;\n        },\n\n        _progress: function(toggle) {\n            kendo.ui.progress(this.element, toggle);\n        },\n\n        _error: function() {\n            this._progress(false);\n        },\n\n        _requestStart: function() {\n            this._progress(true);\n        },\n\n        destroy: function() {\n            Widget.fn.destroy.call(this);\n\n            this.dataSource.unbind(\"change\", this._refreshHandler);\n\n            this.element.off(ns);\n\n            this.rows.destroy();\n            this.columns.destroy();\n            this.measures.destroy();\n            this.treeView.destroy();\n\n            this.element = null;\n            this._refreshHandler = null;\n        },\n\n        refresh: function() {\n            if (this.treeView) {\n                this.treeView.dataSource.fetch();\n            }\n\n            this._progress(false);\n        }\n\n    });\n\n    ui.plugin(PivotConfiguratorV2);\n\n    var PivotConfigurator = Widget.extend({\n        init: function(element, options) {\n            Widget.fn.init.call(this, element, options);\n\n            this.element.addClass(\"k-pivotgrid-configurator-panel kendo-jquery\");\n\n            if (this.options.height) {\n                this.element.outerHeight(this.options.height);\n            }\n\n            this._dataSource();\n\n            this._layout();\n\n            this.refresh();\n\n            kendo.notify(this);\n        },\n\n        events: [],\n\n        options: {\n            name: \"PivotConfigurator\",\n            filterable: false,\n            sortable: false,\n            messages: {\n                measures: \"Drop Data Fields Here\",\n                columns: \"Drop Column Fields Here\",\n                rows: \"Drop Rows Fields Here\",\n                measuresLabel: \"Measures\",\n                columnsLabel: \"Columns\",\n                rowsLabel: \"Rows\",\n                fieldsLabel: \"Fields\"\n            }\n        },\n\n        _dataSource: function() {\n            var that = this;\n\n            if (that.dataSource && that._refreshHandler) {\n                that.dataSource.unbind(\"change\", that._refreshHandler)\n                               .unbind(\"error\", that._errorHandler)\n                               .unbind(\"progress\", that._progressHandler);\n            } else {\n                that._errorHandler = $.proxy(that._error, that);\n                that._refreshHandler = $.proxy(that.refresh, that);\n                that._progressHandler = $.proxy(that._requestStart, that);\n            }\n\n            that.dataSource = kendo.data.PivotDataSource.create(that.options.dataSource);\n            that.dataSource.bind(\"change\", that._refreshHandler)\n                           .bind(\"error\", that._errorHandler)\n                           .bind(\"progress\", that._progressHandler);\n        },\n\n        setDataSource: function(dataSource) {\n            this.options.dataSource = dataSource;\n\n            this._dataSource();\n\n            if (this.measures) {\n                this.measures.setDataSource(dataSource);\n            }\n\n            if (this.rows) {\n                this.rows.setDataSource(dataSource);\n            }\n\n            if (this.columns) {\n                this.columns.setDataSource(dataSource);\n            }\n\n            this.refresh();\n        },\n\n        _treeViewDataSource: function() {\n            var that = this;\n\n            return kendo.data.HierarchicalDataSource.create({\n                schema: {\n                    model: {\n                        id: \"uniqueName\",\n                        hasChildren: function(item) {\n                            return !(\"hierarchyUniqueName\" in item) && !(\"aggregator\" in item);\n                        }\n                    }\n                },\n                transport: {\n                    read: function(options) {\n                        var promise;\n                        var node;\n                        var kpi;\n\n                        if ($.isEmptyObject(options.data)) {\n                            promise = that.dataSource.schemaDimensions();\n\n                            promise.done(function(data) {\n                                        if (!that.dataSource.cubeBuilder) {\n                                            addKPI(data);\n                                        }\n                                        options.success(data);\n                                    })\n                                    .fail(options.error);\n                        } else {\n                            //Hack to get the actual node as the HierarchicalDataSource does not support passing it\n                            node = that.treeView.dataSource.get(options.data.uniqueName);\n\n                            if (node.uniqueName === \"[KPIs]\") {\n                                kpi = true;\n                                promise = that.dataSource.schemaKPIs();\n                                promise.done(function(data) {\n                                            options.success(normalizeKPIs(data));\n                                       })\n                                       .fail(options.error);\n                            } else if (node.type == \"kpi\") {\n                                kpi = true;\n                                options.success(buildKPImeasures(node));\n                            }\n\n                            if (!kpi) {\n                                if (node.type == 2) { //measure\n                                    promise = that.dataSource.schemaMeasures();\n                                } else if (node.dimensionUniqueName) { // hierarchy\n                                    promise = that.dataSource.schemaLevels(options.data.uniqueName);\n                                } else { // dimension\n                                    promise = that.dataSource.schemaHierarchies(options.data.uniqueName);\n                                }\n\n                                promise.done(options.success)\n                                        .fail(options.error);\n                            }\n                        }\n                    }\n                }\n            });\n        },\n\n        _progress: function(toggle) {\n            kendo.ui.progress(this.element, toggle);\n        },\n\n        _error: function() {\n            this._progress(false);\n        },\n\n        _requestStart: function() {\n            this._progress(true);\n        },\n\n        _layout: function() {\n            $('<div class=\"k-pivotgrid-configurator\"><div class=\"k-pivotgrid-configurator-content\"></div></div>').appendTo(this.element);\n            this.form = this.element.find('.k-pivotgrid-configurator-content');\n\n            this._fields();\n            this._targets();\n        },\n\n        _fields: function() {\n            var container = $('<div class=\"k-pivotgrid-fields k-pivotgrid-configurator-section\"><strong>' + this.options.messages.fieldsLabel + '</strong><div class=\"k-fields-list-wrapper\"></div></div>').appendTo(this.form);\n\n            var template = '# if (item.type == 2 || item.uniqueName == \"[KPIs]\") { #' +\n                           '<span class=\"k-icon k-i-#= (item.type == 2 ? \\\"sum\\\" : \\\"kpi\\\") #\"></span>' +\n                           '# } else if (item.type && item.type !== \"kpi\") { #' +\n                           '<span class=\"k-icon k-i-arrows-dimensions\"></span>' +\n                           '# } #' +\n                           '#: item.caption || item.name #';\n\n            this.treeView = $(\"<div/>\").appendTo(container.find('.k-fields-list-wrapper'))\n                .kendoTreeView({\n                    template: template,\n                    dataTextField: \"caption\",\n                    dragAndDrop: true,\n                    autoBind: false,\n                    dataSource: this._treeViewDataSource(),\n                    dragstart: function(e) {\n                        var dataItem = this.dataItem(e.sourceNode);\n\n                        if ((!dataItem.hasChildren && !dataItem.aggregator && !dataItem.measure) || (dataItem.type == 2) || dataItem.uniqueName === \"[KPIs]\") {\n                            e.preventDefault();\n                        }\n                    },\n                    drag: function(e) {\n                        var status = \"k-i-cancel\";\n                        var setting = settingTargetFromNode(e.dropTarget);\n\n                        if (setting && setting.validate(this.dataItem(e.sourceNode))) {\n                            status = \"k-i-plus\";\n                        }\n\n                        e.setStatusClass(status);\n                    },\n                    drop: function(e) {\n                        e.preventDefault();\n\n                        var setting = settingTargetFromNode(e.dropTarget);\n                        var node = this.dataItem(e.sourceNode);\n                        var idx, length, measures;\n                        var name;\n\n                        if (setting && setting.validate(node)) {\n                            name = node.defaultHierarchy || node.uniqueName;\n\n                            if (node.type === \"kpi\") {\n                                measures = buildKPImeasures(node);\n                                length = measures.length;\n                                name = [];\n\n                                for (idx = 0; idx < length; idx++) {\n                                    name.push(kpiNode(measures[idx]));\n                                }\n                            } else if (node.kpi) {\n                                name = [kpiNode(node)];\n                            }\n\n                            setting.add(name);\n                        }\n                    }\n                 })\n                .data(\"kendoTreeView\");\n        },\n\n        _createTarget: function(element, options) {\n            var template = '';\n            var sortable = options.sortable;\n            var icons = '';\n\n            if (sortable) {\n                icons += '#if (data.sortIcon) {#';\n                icons += '<span class=\"k-chip-action\"><span class=\"k-icon ${data.sortIcon}-sm\"></span></span>';\n                icons += '#}#';\n            }\n\n            if (options.filterable || sortable) {\n                icons += '<span class=\"k-setting-fieldmenu k-chip-action\"><span class=\"k-icon k-i-more-vertical\"></span></span>';\n            }\n\n            icons += '<span class=\"k-setting-delete k-chip-action\"><span class=\"k-icon k-i-close\"></span></span>';\n\n            template = ''\n                + '<span class=\"k-chip k-chip-md k-rounded-full k-chip-solid k-chip-solid-base\" data-' + kendo.ns + 'name=\"${data.name}\">'\n                    + '<span class=\"k-chip-content\">'\n                        + '<span class=\"k-chip-text\">${data.name}</span>'\n                    + '</span>'\n                    + '<span class=\"k-chip-actions k-field-actions\">' + icons + '</span>'\n                + '</span>';\n\n            return new kendo.ui.PivotSettingTarget(element, $.extend({\n                dataSource: this.dataSource,\n                template: template,\n                emptyTemplate: '<span class=\"k-empty\">${data}</span>'\n            }, options));\n        },\n\n        _targets: function() {\n            var container = $('<div class=\"k-pivotgrid-targets\"/>').appendTo(this.form);\n\n            var columnsContainer = $(SETTING_CONTAINER_TEMPLATE({ name: this.options.messages.columnsLabel, icon: \"k-i-columns\" })).appendTo(container);\n            var columns = $('<div class=\"k-column-fields k-chip-list\" />').appendTo(columnsContainer.find('.k-pivotgrid-target-wrap'));\n\n            var rowsContainer = $(SETTING_CONTAINER_TEMPLATE({ name: this.options.messages.rowsLabel, icon: \"k-i-rows\" })).appendTo(container);\n            var rows = $('<div class=\"k-column-fields k-chip-list\" />').appendTo(rowsContainer.find('.k-pivotgrid-target-wrap'));\n\n            var measuresContainer = $(SETTING_CONTAINER_TEMPLATE({ name: this.options.messages.measuresLabel, icon: \"k-i-sum\" })).appendTo(container);\n            var measures = $('<div class=\"k-column-fields k-chip-list\" />').appendTo(measuresContainer.find('.k-pivotgrid-target-wrap'));\n\n            var options = this.options;\n\n            this.columns = this._createTarget(columns, {\n                filterable: options.filterable,\n                sortable: options.sortable,\n                connectWith: rows,\n                messages: {\n                    empty: options.messages.columns,\n                    fieldMenu: options.messages.fieldMenu\n                }\n            });\n\n            this.rows = this._createTarget(rows, {\n                filterable: options.filterable,\n                sortable: options.sortable,\n                setting: \"rows\",\n                connectWith: columns,\n                messages: {\n                    empty: this.options.messages.rows,\n                    fieldMenu: this.options.messages.fieldMenu\n                }\n            });\n\n            this.measures = this._createTarget(measures, {\n                setting: \"measures\",\n                messages: {\n                    empty: options.messages.measures\n                }\n            });\n\n            columns\n                .add(rows)\n                .add(measures)\n                .on(HOVER_EVENTS, \".k-item:not(.k-empty)\", this._toggleHover);\n        },\n\n        _toggleHover: function(e) {\n            $(e.currentTarget).toggleClass(\"k-state-hover\", e.type === \"mouseenter\");\n        },\n\n        _resize: function() {\n            var element = this.element;\n            var height = this.options.height;\n\n            if (!height) {\n                return;\n            }\n\n            element.outerHeight(height);\n        },\n\n        refresh: function() {\n            var dataSource = this.dataSource;\n\n            if (dataSource.cubeBuilder || this._cube !== dataSource.cube() || this._catalog !== dataSource.catalog()) {\n                this.treeView.dataSource.fetch();\n            }\n\n            this._catalog = this.dataSource.catalog();\n            this._cube = this.dataSource.cube();\n\n            this._resize();\n\n            this._progress(false);\n        },\n\n        destroy: function() {\n            Widget.fn.destroy.call(this);\n\n            this.dataSource.unbind(\"change\", this._refreshHandler);\n\n            this.form.find(\".k-pivot-setting\").off(ns);\n\n            this.rows.destroy();\n            this.columns.destroy();\n            this.measures.destroy();\n            this.treeView.destroy();\n\n            this.element = null;\n            this._refreshHandler = null;\n        }\n    });\n\n    function kpiMeasure(name, measure, type) {\n        return {\n            hierarchyUniqueName: name,\n            uniqueName: measure,\n            caption: measure,\n            measure: measure,\n            name: measure,\n            type: type,\n            kpi: true\n        };\n    }\n\n    function buildKPImeasures(node) {\n        var name = node.name;\n        return [\n            kpiMeasure(name, node.value, \"value\"),\n            kpiMeasure(name, node.goal, \"goal\"),\n            kpiMeasure(name, node.status, \"status\"),\n            kpiMeasure(name, node.trend, \"trend\")\n        ];\n    }\n\n    kendo.cssProperties.registerPrefix(\"HTMLChip\", \"k-chip-\");\n\n    kendo.cssProperties.registerValues(\"HTMLChip\", [{\n        prop: \"rounded\",\n        values: kendo.cssProperties.roundedValues.concat([['full', 'full']])\n    }]);\n\n    ui.plugin(PivotConfigurator);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","hidden","$","window","kendo","jQuery","undefined","ui","Widget","common","pivotgrid","fetchDiscover","configuratorReducer","PIVOT_CONFIGURATOR_ACTION","ns","HOVER_EVENTS","SETTINGS_TEMPLATE","template","CONTENT_TEMPLATE","TARGET_ITEM_TEMPLATE","ACTIONS_TEMPLATE","SETTING_CONTAINER_TEMPLATE","addKPI","data","found","idx","length","type","splice","caption","defaultHierarchy","uniqueName","kpiNode","node","normalizeKPIs","settingTargetFromNode","target","closest","PivotConfiguratorV2","extend","init","element","options","fn","call","this","addClass","_dataSource","_layout","refresh","height","notify","events","orientation","filterable","sortable","messages","title","cancelText","applyButtonText","measures","columns","rows","setDataSource","dataSource","that","_refreshHandler","unbind","_errorHandler","_progressHandler","proxy","_error","_requestStart","PivotDataSourceV2","create","bind","horizontal","panel","append","appendTo","formClass","find","each","index","elm","html","renderChipList","_fields","cancelText","applyText","_targets","on","_actions","e","preventDefault","currentTarget","_applyState","read","_cancelChanges","treeView","first","last","targetItemTemplate","renderChip","fillMode","themeColor","rounded","removable","removeIcon","_createTarget","connectWith","empty","setting","PivotSettingTargetV2","hint","clone","remove","item","wrapper","attr","dataItem","getByUid","checked","container","kendoTreeView","checkboxes","checkChildren","dataTextField","autoBind","check","sender","action","toggleSelection","payload","state","columnAxes","_state","rowAxes","measureAxes","result","items","_checkMembers","trigger","_redraw","_treeViewDataSource","off","_clickHandler","HierarchicalDataSource","schema","model","hasChildren","transport","catalog","cube","fetchOptions","url","members","concat","isEmptyObject","fetchOpts","connection","restrictions","catalogName","cubeName","command","then","newFields","success","get","_getKPIOptions","buildKPImeasures","_loadFieldsCommand","newData","hash","field","dimensionUniqueName","hierarchyUniqueName","_progress","toggle","progress","destroy","fetch","PivotConfigurator","plugin","outerHeight","measuresLabel","columnsLabel","rowsLabel","fieldsLabel","PivotDataSource","promise","kpi","schemaDimensions","done","cubeBuilder","fail","error","schemaKPIs","schemaMeasures","schemaLevels","schemaHierarchies","form","dragAndDrop","dragstart","sourceNode","aggregator","measure","drag","status","dropTarget","validate","setStatusClass","drop","push","add","icons","PivotSettingTarget","emptyTemplate","columnsContainer","icon","rowsContainer","measuresContainer","fieldMenu","_toggleHover","toggleClass","_resize","_cube","_catalog","kpiMeasure","value","goal","trend","cssProperties","registerPrefix","registerValues","prop","values","roundedValues","amd","a1","a2","a3"],"mappings":"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"}
