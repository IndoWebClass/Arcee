{"version":3,"file":"kendo.treelist.min.js","sources":["kendo.treelist.js"],"sourcesContent":["/*!\n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n                                                                                                                                                                                                       \n\n*/\n(function(f, define){\n    define('kendo.treelist',[\n        \"./kendo.dom\",\n        \"./kendo.data\",\n        \"./kendo.columnsorter\",\n        \"./kendo.editable\",\n        \"./kendo.window\",\n        \"./kendo.filtermenu\",\n        \"./kendo.columnmenu\",\n        \"./kendo.selectable\",\n        \"./kendo.resizable\",\n        \"./kendo.treeview.draganddrop\",\n        \"./kendo.pager\",\n        './kendo.filtercell'\n    ], f);\n})(function(){\n\nvar __meta__ = { // jshint ignore:line\n    id: \"treelist\",\n    name: \"TreeList\",\n    category: \"web\",\n    description: \"The TreeList widget displays self-referencing data and offers rich support for interacting with data, sorting, filtering, and selection.\",\n    depends: [ \"dom\", \"data\", \"pager\" ],\n    features: [ {\n        id: \"treelist-sorting\",\n        name: \"Sorting\",\n        description: \"Support for column sorting\",\n        depends: [ \"columnsorter\" ]\n    }, {\n        id: \"treelist-filtering\",\n        name: \"Filtering\",\n        description: \"Support for record filtering\",\n        depends: [ \"filtermenu\" ]\n    }, {\n        id: \"treelist-columnmenu\",\n        name: \"Column menu\",\n        description: \"Support for header column menu\",\n        depends: [ \"columnmenu\" ]\n    }, {\n        id: \"treelist-editing\",\n        name: \"Editing\",\n        description: \"Support for record editing\",\n        depends: [ \"editable\", \"window\" ]\n    }, {\n        id: \"treelist-selection\",\n        name: \"Selection\",\n        description: \"Support for row selection\",\n        depends: [ \"selectable\" ]\n    }, {\n        id: \"treelist-column-resize\",\n        name: \"Column resizing\",\n        description: \"Support for column resizing\",\n        depends: [ \"resizable\" ]\n    }, {\n        id: \"treelist-dragging\",\n        name: \"Drag & Drop\",\n        description: \"Support for drag & drop of rows\",\n        depends: [ \"treeview.draganddrop\" ]\n    }, {\n        id: \"treelist-excel-export\",\n        name: \"Excel export\",\n        description: \"Export data as Excel spreadsheet\",\n        depends: [ \"excel\" ]\n    }, {\n        id: \"treelist-pdf-export\",\n        name: \"PDF export\",\n        description: \"Export data as PDF\",\n        depends: [ \"pdf\", \"drawing\" ]\n    }, {\n        id: \"treelist-paging\",\n        name: \"Paging\",\n        description: \"Support for treelist paging\",\n        depends: [ \"pager\" ]\n    } ]\n};\n\n(function($, undefined) {\n    var data = kendo.data;\n    var kendoDom = kendo.dom;\n    var kendoDomElement = kendoDom.element;\n    var kendoTextElement = kendoDom.text;\n    var kendoHtmlElement = kendoDom.html;\n    var outerWidth = kendo._outerWidth;\n    var keys = kendo.keys;\n    var outerHeight = kendo._outerHeight;\n    var ui = kendo.ui;\n    var DataBoundWidget = ui.DataBoundWidget;\n    var DataSource = data.DataSource;\n    var ObservableArray = data.ObservableArray;\n    var Query = data.Query;\n    var Model = data.Model;\n    var browser = kendo.support.browser;\n    var kendoTemplate = kendo.template;\n    var activeElement = kendo._activeElement;\n    var touchDevice = kendo.support.touch;\n\n    var isArray = Array.isArray;\n    var extend = $.extend;\n    var proxy = $.proxy;\n    var map = $.map;\n    var grep = $.grep;\n    var inArray = $.inArray;\n    var isPlainObject = $.isPlainObject;\n\n    var push = Array.prototype.push;\n\n    var STRING = \"string\";\n    var CHANGE = \"change\";\n    var ITEM_CHANGE = \"itemChange\";\n    var ERROR = \"error\";\n    var PROGRESS = \"progress\";\n    var DOT = \".\";\n    var NS = \".kendoTreeList\";\n    var CLICK = \"click\";\n    var INPUT = \"input\";\n    var BEFORE_EDIT = \"beforeEdit\";\n    var EDIT = \"edit\";\n    var PAGE = \"page\";\n    var PAGE_CHANGE = \"pageChange\";\n    var SAVE = \"save\";\n    var SAVE_CHANGES = \"saveChanges\";\n    var SORT = \"sort\";\n    var EXPAND = \"expand\";\n    var COLLAPSE = \"collapse\";\n    var CELL_CLOSE = \"cellClose\";\n    var REMOVE = \"remove\";\n    var DATA_CELL = \"td:not(.k-group-cell):not(.k-hierarchy-cell):visible\";\n    var FILTER_CELL =\".k-filter-row th:not(.k-group-cell):not(.k-hierarchy-cell):visible\";\n    var DATABINDING = \"dataBinding\";\n    var DATABOUND = \"dataBound\";\n    var CANCEL = \"cancel\";\n    var TABINDEX = \"tabIndex\";\n    var FILTERMENUINIT = \"filterMenuInit\";\n    var FILTERMENUOPEN = \"filterMenuOpen\";\n    var COLUMNHIDE = \"columnHide\";\n    var COLUMNSHOW = \"columnShow\";\n    var HEADERCELLS = \"th.k-header\";\n    var COLUMNREORDER = \"columnReorder\";\n    var COLUMNRESIZE = \"columnResize\";\n    var COLUMNMENUINIT = \"columnMenuInit\";\n    var COLUMNMENUOPEN = \"columnMenuOpen\";\n    var COLUMNLOCK = \"columnLock\";\n    var COLUMNUNLOCK = \"columnUnlock\";\n    var PARENTIDFIELD = \"parentId\";\n    var DRAGSTART = \"dragstart\";\n    var DRAG = \"drag\";\n    var DROP = \"drop\";\n    var DRAGEND = \"dragend\";\n    var NAVROW = \"tr:visible\";\n    var NAVCELL = \"td:visible\";\n    var NAVHEADER = \"th:visible\";\n    var NORECORDSCLASS = \"k-grid-norecords\";\n    var ITEMROW = \"tr:not(.k-footer-template):visible\";\n    var isRtl = false;\n    var HEIGHT = \"height\";\n    var INCELL = \"incell\";\n    var INLINE = \"inline\";\n    var POPUP = \"popup\";\n    var TABLE = \"table\";\n    var CHECKBOX = \"k-checkbox\";\n    var CHECKBOXINPUT = \"input[data-role='checkbox'].\" + CHECKBOX;\n    var SELECTCOLUMNTMPL = '<input class=\"' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select row\" aria-checked=\"false\" type=\"checkbox\">';\n    var SELECTCOLUMNHEADERTMPL = '<input class=\"' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select all rows\" aria-checked=\"false\" type=\"checkbox\">';\n    var SELECTED = \"k-state-selected\";\n    var whitespaceRegExp = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\";\n    var filterRowRegExp = new RegExp(\"(^|\" + whitespaceRegExp + \")\" + \"(k-filter-row)\" + \"(\" + whitespaceRegExp + \"|$)\");\n\n    var classNames = {\n        wrapper: \"k-treelist k-grid k-widget k-grid-display-block\",\n        header: \"k-header\",\n        button: \"k-button\",\n        alt: \"k-alt\",\n        editCell: \"k-edit-cell\",\n        editRow: \"k-grid-edit-row\",\n        dirtyCell: \"k-dirty-cell\",\n        group: \"k-treelist-group\",\n        toolbar: \"k-toolbar\",\n        gridToolbar: \"k-grid-toolbar\",\n        gridHeader: \"k-grid-header\",\n        gridHeaderWrap: \"k-grid-header-wrap\",\n        gridContent: \"k-grid-content\",\n        gridContentWrap: \"k-grid-content\",\n        gridFilter: \"k-grid-filter\",\n        footerTemplate: \"k-footer-template\",\n        focused: \"k-state-focused\",\n        loading: \"k-i-loading\",\n        refresh: \"k-i-reload\",\n        retry: \"k-request-retry\",\n        selected: \"k-state-selected\",\n        status: \"k-status\",\n        link: \"k-link\",\n        filterable: \"k-filterable\",\n        icon: \"k-icon\",\n        iconFilter: \"k-i-filter\",\n        iconCollapse: \"k-i-collapse\",\n        iconExpand: \"k-i-expand\",\n        iconHidden: \"k-i-none\",\n        iconPlaceHolder: \"k-icon k-i-none\",\n        input: \"k-input\",\n        dropPositions: \"k-i-insert-up k-i-insert-down k-i-plus k-i-insert-middle\",\n        dropTop: \"k-i-insert-up\",\n        dropBottom: \"k-i-insert-down\",\n        dropAdd: \"k-i-plus\",\n        dropMiddle: \"k-i-insert-middle\",\n        dropDenied: \"k-i-cancel\",\n        dragStatus: \"k-drag-status\",\n        dragClue: \"k-drag-clue\",\n        dragClueText: \"k-clue-text\",\n        headerCellInner: \"k-cell-inner\",\n        columnTitle: \"k-column-title\"\n    };\n\n    var defaultCommands = {\n        create: {\n            imageClass: \"k-i-plus\",\n            className: \"k-grid-add\",\n            methodName: \"addRow\"\n        },\n        createchild: {\n            imageClass: \"k-i-plus\",\n            className: \"k-grid-add\",\n            methodName: \"addRow\"\n        },\n        destroy: {\n            imageClass: \"k-i-close\",\n            className: \"k-grid-delete\",\n            methodName: \"removeRow\"\n        },\n        edit: {\n            imageClass: \"k-i-edit\",\n            className: \"k-grid-edit\",\n            methodName: \"editRow\"\n        },\n        update: {\n            imageClass: \"k-i-check\",\n            className: \"k-button-solid-primary k-grid-update\",\n            methodName: \"saveRow\"\n        },\n        canceledit: {\n            imageClass: \"k-i-cancel\",\n            className: \"k-grid-cancel\",\n            methodName: \"_cancelEdit\"\n        },\n        cancel: {\n            imageClass: \"k-icon k-i-cancel\",\n            text: \"Cancel changes\",\n            className: \"k-grid-cancel-changes\",\n            methodName: \"cancelChanges\"\n        },\n        save: {\n            imageClass: \"k-icon k-i-check\",\n            text: \"Save changes\",\n            className: \"k-grid-save-changes\",\n            methodName: \"saveChanges\"\n        },\n        excel: {\n            imageClass: \"k-i-file-excel\",\n            className: \"k-grid-excel\",\n            methodName: \"saveAsExcel\"\n        },\n        pdf: {\n            imageClass: \"k-i-file-pdf\",\n            className: \"k-grid-pdf\",\n            methodName: \"saveAsPDF\"\n        },\n        search: {\n            template:\n            \"<span class='k-spacer'></span>\" +\n            \"<span class='k-searchbox k-input k-input-md k-rounded-md k-input-solid k-grid-search'>\" +\n                \"<span class='k-input-icon k-icon k-i-search'></span>\" +\n                \"<input autocomplete='off' placeholder='\" + \"#= message #\" + \"' title='\"+ \"#= message #\" + \"' class='k-input-inner' />\" +\n            \"</span>\"\n        }\n    };\n\n    var TreeView = kendo.Class.extend({\n        init: function(data, options) {\n            var that = this;\n\n            that.data = data || [];\n            that.options = extend(that.options, options);\n        },\n\n        options: {\n            defaultParentId: null,\n            idField: \"id\",\n            parentIdField: PARENTIDFIELD\n        },\n\n        childrenMap: function() {\n            var that = this;\n            var childrenMap = {};\n            var dataLength = that.data.length;\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n            var idField = that.options.idField;\n            var parentIdField = that.options.parentIdField;\n\n            if (that._childrenMap) {\n                return that._childrenMap;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = this.data[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n\n                childrenMap[dataItemId] = childrenMap[dataItemId] || [];\n                childrenMap[dataItemParentId] = childrenMap[dataItemParentId] || [];\n\n                childrenMap[dataItemParentId].push(dataItem);\n            }\n\n            that._childrenMap = childrenMap;\n\n            return childrenMap;\n        },\n\n        idsMap: function() {\n            var that = this;\n            var idsMap = {};\n            var data = that.data;\n            var dataLength = data.length;\n            var dataItem;\n            var idField = that.options.idField;\n\n            if (that._idMap) {\n                return that._idMap;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n                idsMap[dataItem[idField]] = dataItem;\n            }\n\n            that.idsMap = idsMap;\n            return idsMap;\n        },\n\n        dataMaps: function() {\n            var that = this;\n            var childrenMap = {};\n            var data = that.data;\n            var dataLength = data.length;\n            var idsMap = {};\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n            var idField = that.options.idField;\n            var parentIdField = that.options.parentIdField;\n\n            if (that._dataMaps) {\n                return that._dataMaps;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n\n                idsMap[dataItemId] = dataItem;\n\n                childrenMap[dataItemId] = childrenMap[dataItemId] || [];\n                childrenMap[dataItemParentId] = childrenMap[dataItemParentId] || [];\n                childrenMap[dataItemParentId].push(dataItem);\n            }\n\n            that._dataMaps = {\n                children: childrenMap,\n                ids: idsMap\n            };\n\n            return that._dataMaps;\n        },\n\n        rootNodes: function() {\n            var that = this;\n            var data = that.data;\n            var defaultParentId = that.options.defaultParentId;\n            var dataLength = data.length;\n            var rootNodes = [];\n            var dataItem;\n            var parentIdField = that.options.parentIdField;\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n\n                if (dataItem[parentIdField] === defaultParentId) {\n                    rootNodes.push(dataItem);\n                }\n            }\n\n            return rootNodes;\n        },\n\n        removeCollapsedSubtreesFromRootNodes: function(options) {\n            options = options || {};\n            var that = this;\n            var rootNodes = that.rootNodes();\n            var result = [];\n            var prunedTree;\n\n            that._childrenMap = options.childrenMap = options.childrenMap || that.childrenMap();\n            options.maxDepth = options.maxDepth || Infinity;\n\n            for (var i = 0; i < rootNodes.length; i++) {\n                prunedTree = that.removeCollapsedSubtrees(rootNodes[i], options);\n                result = result.concat(prunedTree);\n            }\n\n            return result;\n        },\n\n        removeCollapsedSubtrees: function(rootNode, options) {\n            options = options || {};\n            var that = this;\n            var result = [];\n            var childIdx;\n            var prunedTree;\n            var childrenMap = options.childrenMap || {};\n            var maxDepth = options.maxDepth || Infinity;\n            var idField = that.options.idField;\n            var children = childrenMap[rootNode[idField]] || [];\n            var expanded = isUndefined(rootNode.expanded) ? options.expanded : rootNode.expanded;\n\n            result.push(rootNode);\n\n            if (children && expanded) {\n                for (childIdx = 0; childIdx < children.length; childIdx++) {\n                    if (result.length >= maxDepth) {\n                        break;\n                    }\n\n                    prunedTree = that.removeCollapsedSubtrees(children[childIdx], options);\n                    result = result.concat(prunedTree);\n                }\n            }\n\n            return result;\n        }\n    });\n\n    var TreeQuery = function(data) {\n        this.data = data || [];\n    };\n\n    TreeQuery.prototype = new Query();\n    TreeQuery.prototype.constructor = TreeQuery;\n\n    TreeQuery.process = function(data, options, inPlace) {\n        options = options || {};\n        var query = new TreeQuery(data);\n        var group = options.group;\n        var sort = Query.normalizeGroup(group || []).concat(Query.normalizeSort(options.sort || []));\n        var filterCallback = options.filterCallback;\n        var filter = options.filter;\n        var skip = options.skip;\n        var take = options.take;\n        var total;\n        var childrenMap;\n        var filteredChildrenMap;\n        var view;\n        var prunedData;\n\n        if (sort && inPlace) {\n            query = query.sort(sort, undefined, undefined, inPlace);\n        }\n\n        if (filter) {\n            query = query.filter(filter);\n\n            if (filterCallback) {\n                query = filterCallback(query);\n            }\n\n            total = query.toArray().length;\n        }\n\n        if (sort && !inPlace) {\n            query = query.sort(sort);\n\n            if (group) {\n                data = query.toArray();\n            }\n        }\n\n        if (options.processFromRootNodes) {\n            view = new TreeView(query.toArray(), options);\n\n            if (filter) {\n                filteredChildrenMap = view.childrenMap();\n            }\n\n            prunedData = view.removeCollapsedSubtreesFromRootNodes({\n                // filtering or sorting requires changes to childrenMap\n                childrenMap: filter || (sort && sort.length) ? undefined : options.childrenMap,\n                expanded: options.expanded,\n                maxDepth: (skip + take) || Infinity\n            });\n\n            childrenMap = view.childrenMap();\n\n            query = new TreeQuery(prunedData);\n        }\n\n        if (skip !== undefined && take !== undefined) {\n            query = query.range(skip, take);\n        }\n\n        if (group) {\n            query = query.group(group, data);\n        }\n\n        return {\n            total: total,\n            data: query.toArray(),\n            childrenMap: childrenMap,\n            filteredChildrenMap: filteredChildrenMap\n        };\n    };\n\n    var TreeListModel = Model.define({\n        id: \"id\",\n\n        parentId: PARENTIDFIELD,\n\n        fields: {\n            id: { type: \"number\" },\n            parentId: { type: \"number\", nullable: true }\n        },\n\n        init: function(value) {\n            Model.fn.init.call(this, value);\n\n            this._loaded = false;\n\n            if (!this.parentIdField) {\n                this.parentIdField = PARENTIDFIELD;\n            }\n\n            this.parentId = this.get(this.parentIdField);\n        },\n\n        accept: function(data) {\n            Model.fn.accept.call(this, data);\n\n            this.parentId = this.get(this.parentIdField);\n        },\n\n        set: function(field, value, initiator) {\n            if (field == PARENTIDFIELD && this.parentIdField != PARENTIDFIELD) {\n                this[this.parentIdField] = value;\n            }\n\n            Model.fn.set.call(this, field, value, initiator);\n\n            if (field == this.parentIdField) {\n                this.parentId = this.get(this.parentIdField);\n            }\n        },\n\n        loaded: function(value) {\n            if (value !== undefined) {\n                this._loaded = value;\n            } else {\n                return this._loaded;\n            }\n        },\n\n        shouldSerialize: function(field) {\n            return Model.fn.shouldSerialize.call(this, field) && field !== \"_loaded\" && field != \"_error\" && field != \"_edit\" && !(this.parentIdField !== \"parentId\" && field === \"parentId\");\n        }\n    });\n\n    TreeListModel.parentIdField = PARENTIDFIELD;\n\n    TreeListModel.define = function(base, options) {\n        if (options === undefined) {\n            options = base;\n            base = TreeListModel;\n        }\n\n        var parentId = options.parentId || PARENTIDFIELD;\n\n        options.parentIdField = parentId;\n\n        var model = Model.define(base, options);\n\n        if (parentId) {\n            model.parentIdField = parentId;\n        }\n\n        return model;\n    };\n\n    function is(field) {\n        return function(object) {\n            return object[field];\n        };\n    }\n\n    function not(func) {\n        return function(object) {\n            return !func(object);\n        };\n    }\n\n    var TreeListDataSource = DataSource.extend({\n        init: function(options) {\n            options = options || {};\n            var that = this;\n            that._dataMaps = that._getDataMaps();\n\n            options.schema = extend(true, {}, {\n                modelBase: TreeListModel,\n                model: TreeListModel\n            }, options.schema);\n\n            DataSource.fn.init.call(this, options);\n        },\n\n        _addRange: function() {\n            // empty override for performance - the treelist does not support virtualization\n        },\n\n        _createNewModel: function(data) {\n            var that = this;\n            var model = {};\n            var fromModel = data instanceof Model;\n            var parentIdField = this._modelParentIdField();\n\n            if (fromModel) {\n                model = data;\n            }\n\n            model = DataSource.fn._createNewModel.call(this, model);\n\n            if (!fromModel) {\n                if (data.parentId) {\n                    data[model.parentIdField] = data.parentId;\n                } else if (that._isPageable() && data[parentIdField]) {\n                    data[model.parentIdField] = data[parentIdField];\n                }\n\n                model.accept(data);\n            }\n\n            return model;\n        },\n\n        _shouldWrap: function() {\n            return true;\n        },\n\n        _push: function(result, operation) {\n            var data = DataSource.fn._readData.call(this, result);\n\n            if (!data) {\n                data = result;\n            }\n\n            this[operation](data);\n        },\n\n        _getData: function() {\n            // do not use .data(), which wraps the data items\n            return this._data || [];\n        },\n\n        _readData: function(newData) {\n            var that = this;\n            var data = that._isPageable() ? that._getData().toJSON() : that.data();\n\n            newData = DataSource.fn._readData.call(this, newData);\n\n            this._replaceData(((data.toJSON ? data.toJSON() : data)).concat(newData), data);\n\n            if (newData instanceof ObservableArray) {\n                return newData;\n            }\n\n            return data;\n        },\n\n        _replaceData: function(source, target) {\n            var sourceLength = source.length;\n\n            for (var i = 0; i < sourceLength; i++) {\n                target[i] = source[i];\n            }\n\n            target.length = sourceLength;\n        },\n\n        _readAggregates: function(data) {\n            var result = extend(this._aggregateResult, this.reader.aggregates(data));\n            if (\"\" in result) {\n                result[this._defaultParentId()] = result[\"\"];\n                delete result[\"\"];\n            }\n\n            return result;\n        },\n\n        read: function(data) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._dataMaps = {};\n                if (!that._modelOptions().expanded) {\n                    that._skip = 0;\n                    that._page = 1;\n                    that._collapsedTotal = undefined;\n                }\n            }\n\n            return DataSource.fn.read.call(that, data);\n        },\n\n        remove: function(root) {\n            this._removeChildData(root);\n\n            this._removeFromDataMaps(root);\n\n            return DataSource.fn.remove.call(this, root);\n        },\n\n        _removeChildData: function(model, removePristine) {\n            var that = this;\n            var pageable = that._isPageable();\n            var data = pageable ? this._getData() : this.data();\n            var childrenMap = pageable ? that._getChildrenMap() || that.childrenMap(data) : that._childrenMap(data);\n            var items = this._subtree(childrenMap, model.id);\n            var shouldRemovePristine = isUndefined(removePristine) ? false : removePristine;\n\n            var removedItems = this._removeItems(items, shouldRemovePristine);\n\n            that._removeFromDataMaps(removedItems);\n        },\n\n        pushDestroy: function(items) {\n            var that = this;\n\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            for (var i = 0; i < items.length; i++) {\n                that._removeChildData(items[i], true);\n                that._removeFromDataMaps(items[i]);\n            }\n\n            DataSource.fn.pushDestroy.call(that, items);\n        },\n\n        insert: function(index, model) {\n            var that = this;\n            var newModel = that._createNewModel(model);\n\n            that._insertInDataMaps(newModel);\n\n            return DataSource.fn.insert.call(that, index, newModel);\n        },\n\n        _filterCallback: function(query) {\n            var that = this;\n            var i, item;\n            var map = {};\n            var result = [];\n            var data = query.toArray();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var pageable = that._isPageable();\n            var parentSubtree = [];\n            var parent;\n\n            for (i = 0; i < data.length; i++) {\n                item = data[i];\n\n                if (pageable) {\n                    // return view from root nodes to child nodes\n                    parentSubtree = [];\n\n                    if (!map[item[idField]]) {\n                        map[item[idField]] = true;\n                        parentSubtree.push(item);\n                    }\n\n                    parent = that._parentNode(item);\n\n                    while (parent) {\n                        if (!map[parent[idField]]) {\n                            map[parent[idField]] = true;\n                            parentSubtree.unshift(parent);\n                            parent = that._parentNode(parent);\n                        } else {\n                            // the parent chain is already processed\n                            break;\n                        }\n                    }\n\n                    if (parentSubtree.length) {\n                        result = result.concat(parentSubtree);\n                    }\n                } else {\n                    while (item) {\n                        if (!map[item[idField]]) {\n                            map[item[idField]] = true;\n                            result.push(item);\n                        }\n\n                        if (!map[item[parentIdField]]) {\n                            map[item[parentIdField]] = true;\n                            item = this.parentNode(item);\n\n                            if (item) {\n                                result.push(item);\n                            }\n                        } else {\n                            break;\n                        }\n                    }\n                }\n            }\n\n            return new Query(result);\n        },\n\n        _subtree: function(map, id) {\n            var that = this;\n            var result = map[id] || [];\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n\n            for (var i = 0, len = result.length; i < len; i++) {\n                if (result[i][idField] !== defaultParentId) {\n                    result = result.concat(that._subtree(map, result[i][idField]));\n                }\n            }\n\n            return result;\n        },\n\n        // builds hash id -> children\n        _childrenMap: function(data) {\n            var map = {};\n            var i, item, id, parentId;\n\n            data = this._observeView(data);\n\n            for (i = 0; i < data.length; i++) {\n                item = data[i];\n                id = item.id;\n                parentId = item.parentId;\n\n                map[id] = map[id] || [];\n                map[parentId] = map[parentId] || [];\n                map[parentId].push(item);\n            }\n\n            return map;\n        },\n\n        childrenMap: function(data) {\n            var view = this._createTreeView(data);\n            var map =  view.childrenMap();\n            return map;\n        },\n\n        _getChildrenMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.children;\n        },\n\n        _initIdsMap: function(data) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n\n            if (isUndefined(dataMaps.ids)) {\n                dataMaps.ids = that._idsMap(data);\n            }\n\n            return dataMaps.ids;\n        },\n\n        _idsMap: function(data) {\n            var view = this._createTreeView(data);\n            var map =  view.idsMap();\n            return map;\n        },\n\n        _getIdsMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.ids || {};\n        },\n\n        _getFilteredChildrenMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.filteredChildren;\n        },\n\n        _setFilteredChildrenMap: function(map) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            dataMaps.filteredChildren = map;\n        },\n\n        _initDataMaps: function(data) {\n            var that = this;\n            var view = that._createTreeView(data);\n\n            that._dataMaps = view.dataMaps();\n\n            return that._dataMaps;\n        },\n\n        _initChildrenMapForParent: function(parent) {\n            var that = this;\n            var data = that._getData();\n            var childrenMap = that._getChildrenMap();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var parentId = (parent || {})[idField];\n\n            if (childrenMap && parent) {\n                childrenMap[parentId] = [];\n\n                for (var i = 0; i < data.length; i++) {\n                    if (data[i][parentIdField] === parentId) {\n                        childrenMap[parentId].push(data[i]);\n                    }\n                }\n            }\n        },\n\n        _getDataMaps: function() {\n            var that = this;\n            that._dataMaps = that._dataMaps || {};\n            return that._dataMaps;\n        },\n\n        _createTreeView: function(data, options) {\n            var view = new TreeView(data, extend(options, this._defaultTreeModelOptions()));\n            return view;\n        },\n\n        _defaultTreeModelOptions: function() {\n            var that = this;\n            var modelOptions = that._modelOptions();\n\n            return {\n                defaultParentId: that._defaultParentId(),\n                idField: that._modelIdField(),\n                parentIdField: that._modelParentIdField(),\n                expanded: modelOptions.expanded\n            };\n        },\n\n        _defaultDataItemType: function() {\n            return this.reader.model || kendo.data.ObservableObject;\n        },\n\n        _calculateAggregates: function(data, options) {\n            options = options || {};\n            var that = this;\n            var result = {};\n            var item, subtree, i;\n            var filter = options.filter;\n            var skip = options.skip;\n            var take = options.take;\n            var maxDepth = !isUndefined(skip) && !isUndefined(take) ? (skip + take) : Infinity;\n            var pageable = that._isPageable();\n            var filteredChildrenMap = options.filteredChildrenMap;\n            var childrenMap = options.childrenMap;\n            var pageableChildrenMap;\n\n            if (pageable) {\n                if (isUndefined(options.aggregate)) {\n                    return result;\n                }\n\n                if (filteredChildrenMap) {\n                    pageableChildrenMap = filteredChildrenMap;\n                } else if (childrenMap) {\n                    pageableChildrenMap = childrenMap;\n                } else {\n                    pageableChildrenMap = that.childrenMap(that._getData());\n                }\n            }\n\n            if (!pageable && filter) {\n                data = Query.process(data, {\n                    filter: filter,\n                    filterCallback: proxy(this._filterCallback, this)\n                }).data;\n            }\n\n            var map = pageable ? pageableChildrenMap : that._childrenMap(data);\n\n            // calculate aggregates for each subtree\n            result[this._defaultParentId()] = new Query(this._subtree(map, this._defaultParentId())).aggregate(options.aggregate);\n\n            for (i = 0; i < data.length; i++) {\n                if (i >= maxDepth) {\n                    break;\n                }\n\n                item = data[i];\n                subtree = this._subtree(map, item.id);\n\n                result[item.id] = new Query(subtree).aggregate(options.aggregate);\n            }\n\n            return result;\n        },\n\n        _queryProcess: function(data, options) {\n            var that = this;\n            var result = {};\n            options = options || {};\n            options.filterCallback = proxy(this._filterCallback, this);\n\n            if (that._isPageable()) {\n                return that._processPageableQuery(data, options);\n            } else {\n                var defaultParentId = this._defaultParentId();\n                result = Query.process(data, options);\n                var map = this._childrenMap(result.data);\n                var hasLoadedChildren, i, item, children;\n\n                data = map[defaultParentId] || [];\n\n                for (i = 0; i < data.length; i++) {\n                    item = data[i];\n\n                    if (item.id === defaultParentId) {\n                        continue;\n                    }\n\n                    children = map[item.id];\n                    hasLoadedChildren = !!(children && children.length);\n\n                    if (!item.loaded()) {\n                        item.loaded(hasLoadedChildren || !item.hasChildren);\n                    }\n\n                    if (item.loaded() || item.hasChildren !== true) {\n                        item.hasChildren = hasLoadedChildren;\n                    }\n\n                    if (hasLoadedChildren) {\n                        //cannot use splice due to IE8 bug\n                        data = data.slice(0, i + 1).concat(children, data.slice(i + 1));\n                    }\n                }\n\n                result.data = data;\n            }\n\n            return result;\n        },\n\n        _processPageableQuery: function(data, options) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            var result;\n            var filteredChildrenMap;\n\n            if (that._getData() !== data || !dataMaps.children || !dataMaps.ids) {\n                dataMaps = that._initDataMaps(that._getData());\n            }\n\n            options.childrenMap = dataMaps.children || {};\n            options.idsMap = dataMaps.ids || {};\n\n            result = that._processTreeQuery(data, options);\n\n            that._replaceWithObservedData(result.data, data);\n\n            that._processDataItemsState(result.data, result.childrenMap);\n\n            that._replaceItemsInDataMaps(result.data);\n\n            result.dataToAggregate = that._dataToAggregate(result.data, options);\n\n            if (options.filter || that.filter()) {\n                filteredChildrenMap = result.filteredChildrenMap;\n                that._replaceInMapWithObservedData(filteredChildrenMap, data);\n                that._setFilteredChildrenMap(filteredChildrenMap);\n                options.filteredChildrenMap = filteredChildrenMap;\n                that._calculateCollapsedTotal(result.data);\n            } else {\n                that._collapsedTotal = undefined;\n            }\n\n            return result;\n        },\n\n        _dataToAggregate: function(data) {\n            var that = this;\n            var firstDataItem = data[0] || {};\n            var firstItemParents = that._parentNodes(firstDataItem);\n            var dataToAggregate = firstItemParents.concat(data);\n\n            return dataToAggregate;\n        },\n\n        _replaceItemsInDataMaps: function(observableArray) {\n            var that = this;\n            var view = isArray(observableArray) ? observableArray : [observableArray];\n            var itemType = that._defaultDataItemType();\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var dataMaps = that._getDataMaps();\n            var item;\n            var parents;\n            var directParent;\n\n            for (var viewIndex = 0; viewIndex < view.length; viewIndex++) {\n                item = view[viewIndex];\n\n                if (!(item instanceof itemType)) {\n                    continue;\n                }\n\n                that._insertInIdsMap(item);\n\n                parents = that._parentNodes(item);\n                directParent = parents && parents.length ? parents[parents.length - 1] : undefined;\n\n                if (item[parentIdField] === defaultParentId) {\n                    that._replaceInMap(dataMaps.children, defaultParentId, item, itemType);\n                } else if (directParent) {\n                    that._replaceInMap(dataMaps.children, directParent[idField], item, itemType);\n                }\n            }\n        },\n\n        _replaceInMap: function(map, id, replacement, itemType) {\n            var idField = this._modelIdField();\n            map[id] = map[id] || [];\n            itemType = itemType || this._defaultDataItemType();\n\n            var itemInArray = map[id].filter(function(element) {\n                return replacement[idField] === element[idField];\n            })[0];\n\n            var itemIndex = itemInArray ? map[id].indexOf(itemInArray) : -1;\n\n            if (itemIndex !== -1 && !(itemInArray instanceof itemType)) {\n                map[id][itemIndex] = replacement;\n            }\n        },\n\n        _replaceWithObservedData: function(dataToReplace, replacementArray) {\n            var that = this;\n            var idsMap = that._getDataMaps().ids || {};\n            var idField = that._modelIdField();\n            var itemType = that._defaultDataItemType();\n            var itemToReplace;\n            var itemToReplaceId;\n            var dataItem;\n            var dataItemIndex;\n            var observableItem;\n\n            for (var i = 0; i < dataToReplace.length; i++) {\n                itemToReplace = dataToReplace[i];\n                itemToReplaceId = itemToReplace[idField];\n\n                if (!(itemToReplace instanceof itemType)) {\n                    if (!(idsMap[itemToReplaceId] instanceof itemType)) {\n                        dataItem = that._getById(itemToReplaceId);\n                        dataItemIndex = replacementArray.indexOf(dataItem);\n\n                        if (dataItem && dataItemIndex !== -1) {\n                            observableItem = replacementArray.at(dataItemIndex);\n                            dataToReplace[i] = observableItem;\n                        }\n                    } else {\n                        dataToReplace[i] = idsMap[itemToReplaceId];\n                    }\n                }\n            }\n        },\n\n        _replaceInMapWithObservedData: function(map, replacementArray) {\n            var that = this;\n\n            for (var key in map) {\n                that._replaceWithObservedData(map[key], replacementArray);\n            }\n        },\n\n        _insertInDataMaps: function(item) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._insertInIdsMap(item);\n                that._insertInChildrenMap(item);\n            }\n        },\n\n        _insertInIdsMap: function(item) {\n            var that = this;\n            var idsMap = that._getIdsMap();\n            var idField = that._modelIdField();\n\n            if (!isUndefined(item[idField])) {\n                idsMap[item[idField]] = item;\n            }\n        },\n\n        _insertInChildrenMap: function(item, index) {\n            var that = this;\n            var childrenMap = that._getChildrenMap() || {};\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var itemId = item[idField];\n            var parentId = item[parentIdField];\n            index = index || 0;\n\n            childrenMap[itemId] = childrenMap[itemId] || [];\n            childrenMap[parentId] = childrenMap[parentId] || [];\n            childrenMap[parentId].splice(index, 0, item);\n        },\n\n        _removeFromDataMaps: function(items) {\n            var that = this;\n            items = isArray(items) ? items : [items];\n\n            if (that._isPageable()) {\n                for (var i = 0; i < items.length; i++) {\n                    that._removeFromIdsMap(items[i]);\n                    that._removeFromChildrenMap(items[i]);\n                }\n            }\n        },\n\n        _removeFromIdsMap: function(item) {\n            var that = this;\n            var idsMap = that._getIdsMap();\n            var idField = that._modelIdField();\n\n            if (!isUndefined(item[idField])) {\n                idsMap[item[idField]] = undefined;\n            }\n        },\n\n        _removeFromChildrenMap: function(item) {\n            var that = this;\n            var childrenMap = that._getChildrenMap() || {};\n            var parentIdField = that._modelParentIdField();\n            var parentId = item[parentIdField];\n\n            childrenMap[parentId] = childrenMap[parentId] || [];\n\n            var itemIndex = that._indexInChildrenMap(item);\n\n            if (itemIndex !== -1) {\n                childrenMap[parentId].splice(itemIndex, 1);\n            }\n        },\n\n        _indexInChildrenMap: function(item) {\n            var that = this;\n            return that._itemIndexInMap(item, that._getChildrenMap());\n        },\n\n        _itemIndexInMap: function(item, dataMap) {\n            var that = this;\n            var map = dataMap || {};\n            var parentIdField = that._modelParentIdField();\n            var parentId = item[parentIdField];\n\n            map[parentId] = map[parentId] || [];\n\n            var itemInArray = map[parentId].filter(function(element) {\n                return item.uid === element.uid;\n            })[0];\n\n            var itemIndex = itemInArray ? map[parentId].indexOf(itemInArray) : -1;\n\n            return itemIndex;\n        },\n\n        _getById: function(id) {\n            var that = this;\n            var idField = that._modelIdField();\n            var data = that._getData();\n\n            for (var i = 0; i < data.length; i++) {\n                if (data[i][idField] === id) {\n                    return data[i];\n                }\n            }\n        },\n\n        _isLastItemInView: function(dataItem) {\n            var view = this.view();\n            return view.length && view[view.length - 1] === dataItem;\n        },\n\n        _defaultPageableQueryOptions: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            var options = {\n                skip: that.skip(),\n                take: that.take(),\n                page: that.page(),\n                pageSize: that.pageSize(),\n                sort: that.sort(),\n                filter: that.filter(),\n                group: that.group(),\n                aggregate: that.aggregate(),\n                filterCallback: proxy(that._filterCallback, that),\n                childrenMap: dataMaps.children,\n                idsMap: dataMaps.ids\n            };\n\n            return options;\n        },\n\n        _isPageable: function() {\n            var pageSize = this.pageSize();\n            return (!isUndefined(pageSize) && pageSize > 0 && !this.options.serverPaging);\n        },\n\n        _updateTotalForAction: function(action, items) {\n            var that = this;\n\n            DataSource.fn._updateTotalForAction.call(that, action, items);\n\n            if (that._isPageable()) {\n                that._updateCollapsedTotalForAction(action, items);\n            }\n        },\n\n        _updateCollapsedTotalForAction: function(action, items) {\n            var that = this;\n            var total = parseInt(that._collapsedTotal, 10);\n\n            if (!isNumber(that._collapsedTotal)) {\n                that._calculateCollapsedTotal();\n                return;\n            }\n\n            if (action === \"add\") {\n                total += items.length;\n            } else if (action === \"remove\") {\n                total -= items.length;\n            } else if (action !== \"itemchange\" && action !== \"sync\" && !that.options.serverPaging) {\n                total = that._calculateCollapsedTotal();\n            } else if (action === \"sync\") {\n                total = that._calculateCollapsedTotal();\n            }\n\n            that._collapsedTotal = total;\n        },\n\n        _setFilterTotal: function(filterTotal, setDefaultValue) {\n            var that = this;\n\n            DataSource.fn._setFilterTotal.call(that, filterTotal, setDefaultValue);\n\n        },\n\n        collapsedTotal: function() {\n            var that = this;\n\n            if (!isUndefined(that._collapsedTotal)) {\n                return that._collapsedTotal;\n            }\n\n            return that._calculateCollapsedTotal();\n        },\n\n        _calculateCollapsedTotal: function(filteredData) {\n            var that = this;\n            var data = that._dataWithoutCollapsedSubtrees(filteredData);//\n\n            if (data.length) {\n                that._collapsedTotal = data.length;\n            }\n\n            return that._collapsedTotal;\n        },\n\n        _dataWithoutCollapsedSubtrees: function(filteredData) {\n            return this._removeCollapsedSubtrees(filteredData || this._getData());\n        },\n\n        _removeCollapsedSubtrees: function(data) {\n            var that = this;\n            var view = that._createTreeView(data);\n            var result = view.removeCollapsedSubtreesFromRootNodes({\n                expanded: that._modelOptions().expanded,\n                childrenMap: that.filter() ? that._getFilteredChildrenMap() : that._getChildrenMap()\n            });\n\n            return result;\n        },\n\n        _processTreeQuery: function(data, options) {\n            var result = TreeQuery.process(data, extend(options, this._defaultTreeModelOptions(), {\n                processFromRootNodes: true\n            }));\n\n            return result;\n        },\n\n        _processDataItemsState: function(data, childrenMap) {\n            var dataLength = data.length;\n            var i;\n\n            for (i = 0; i < dataLength; i++) {\n                this._processDataItemState(data[i], childrenMap);\n            }\n        },\n\n        _processDataItemState: function(dataItem, childrenMap) {\n            var defaultParentId = this._defaultParentId();\n\n            if (dataItem.id === defaultParentId) {\n                return;\n            }\n\n            var children = childrenMap[dataItem.id] || [];\n            var hasLoadedChildren = !!(children && children.length);\n\n            if (!dataItem.loaded) {\n                return;\n            }\n\n            if (!dataItem.loaded()) {\n                dataItem.loaded(hasLoadedChildren || !dataItem.hasChildren);\n            }\n\n            if (dataItem.loaded() || dataItem.hasChildren !== true) {\n                dataItem.hasChildren = hasLoadedChildren;\n            }\n        },\n\n        _queueRequest: function(options, callback) {\n            // allow simultaneous requests (loading multiple items at the same time)\n            callback.call(this);\n        },\n\n        _modelLoaded: function(id) {\n            var model = this.get(id);\n            model.loaded(true);\n            model.hasChildren = this.childNodes(model).length > 0;\n        },\n\n        _modelError: function(id, e) {\n            this.get(id)._error = e;\n        },\n\n        success: function(data, requestParams) {\n            if (!requestParams || typeof requestParams.id == \"undefined\") {\n                this._data = this._observe([]);\n            }\n\n            DataSource.fn.success.call(this, data, requestParams);\n\t\t\tthis._total = this._data.length;\n        },\n\n        load: function(model) {\n            var method = \"_query\";\n            var remote = this.options.serverSorting || this.options.serverPaging || this.options.serverFiltering || this.options.serverGrouping || this.options.serverAggregates;\n            var defaultPromise = $.Deferred().resolve().promise();\n\n            if (model.loaded()) {\n                if (remote) {\n                    return defaultPromise;\n                }\n            } else if (model.hasChildren) {\n                method = \"read\";\n                this._removeChildData(model);\n            }\n\n            return this[method]({ id: model.id })\n                .done(proxy(this._modelLoaded, this, model.id))\n                .fail(proxy(this._modelError, this, model.id));\n        },\n\n        contains: function(root, child) {\n            var that = this;\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var rootId = root[idField];\n            var pageable = that._isPageable();\n\n            while (child) {\n                if (child[parentIdField] === rootId) {\n                    return true;\n                }\n\n                child = pageable ? that._parentNode(child) : that.parentNode(child);\n            }\n\n            return false;\n        },\n\n        _byParentId: function(id, defaultId) {\n            var result = [];\n            var view = this.view();\n            var current;\n\n            if (id === defaultId) {\n                return [];\n            }\n\n            for (var i = 0; i < view.length; i++) {\n                current = view.at(i);\n\n                if (current.parentId == id) {\n                    result.push(current);\n                }\n            }\n\n            return result;\n        },\n\n        _defaultParentId: function() {\n            return this.reader.model.fn.defaults[this.reader.model.parentIdField];\n        },\n\n        _modelOptions: function() {\n            var modelOptions = ((this.options.schema || {}).model || {});\n            return modelOptions;\n        },\n\n        _modelIdField: function() {\n            var modelOptions = this._modelOptions();\n            return modelOptions.id || \"id\";\n        },\n\n        _modelParentIdField: function() {\n            var modelOptions = this._modelOptions();\n            return modelOptions.parentId || PARENTIDFIELD;\n        },\n\n        childNodes: function(model) {\n            return this._byParentId(model.id, this._defaultParentId());\n        },\n\n        allChildNodes: function(model, result){\n            var directChildren = this.data().filter(function(item){\n                return  item.parentId === model.id;\n            });\n\n            for (var i =0; i < directChildren.length; i++) {\n                result.push(directChildren[i]);\n                this.allChildNodes(directChildren[i], result);\n            }\n        },\n\n        rootNodes: function() {\n            return this._byParentId(this._defaultParentId());\n        },\n\n        _rootNode: function(child) {\n            return this._parentNodes(child)[0];\n        },\n\n        _pageableRootNodes: function(options) {\n            options = options || {};\n            var that = this;\n            var defaultParentId = that._defaultParentId();\n            var parentIdField = that._modelParentIdField();\n            var result = [];\n            var nodesWithoutParentInView = that._nodesWithoutParentInView(options);\n            var node;\n            var root;\n\n            for (var i = 0; i < nodesWithoutParentInView.length; i++) {\n                node = nodesWithoutParentInView[i];\n\n                if (node[parentIdField] === defaultParentId) {\n                    result.push(node);\n                } else {\n                    root = that._rootNode(node);\n\n                    if (root && result.indexOf(root) === -1) {\n                        result.push(root);\n                    }\n                }\n            }\n\n            return result;\n        },\n\n        parentNode: function(model) {\n            return this.get(model.parentId);\n        },\n\n        _parentNode: function(child) {\n            var that = this;\n            var parentIdField = that._modelParentIdField();\n            var idsMap = that._initIdsMap(that._getData());\n            var parentId = child[parentIdField];\n            var parent = idsMap[parentId] || that._getById(parentId);\n\n            return parent;\n        },\n\n        _parentNodes: function(child) {\n            var that = this;\n            var parent = that._parentNode(child);\n            var parents = [];\n\n            while (parent) {\n                parents.unshift(parent);\n                parent = that._parentNode(parent);\n            }\n\n            return parents;\n        },\n\n        _parentNodesNotInView: function() {\n            var that = this;\n            var view = that.view();\n            var result = [];\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var parentInView;\n            var parents = [];\n            var directParent;\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n\n            for (var i = 0; i < view.length; i++) {\n                dataItem = view[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n                parentInView = that._parentInView(dataItemParentId);\n\n                if (!parentInView && dataItemParentId !== defaultParentId) {\n                    parents = that._parentNodes(dataItem);\n\n                    directParent = parents && parents.length ? parents[parents.length - 1] : that._getById(dataItemParentId);\n\n                    if (directParent && result.indexOf(directParent) === -1) {\n                        result.push(directParent);\n                    }\n                }\n            }\n\n            return result;\n        },\n\n        _nodesWithoutParentInView: function(options) {\n            options = options || {};\n            var that = this;\n            var view = that.view();\n            var childrenMap = options.childrenMap || that.childrenMap(that._getData());\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var dataItem;\n            var parentInView;\n            var children = [];\n            var result = [];\n\n            for (var i = 0; i < view.length; i++) {\n                dataItem = view[i];\n                children = childrenMap[dataItem[idField]];\n                parentInView = that._parentInView(dataItem[parentIdField]);\n\n                if (!parentInView) {\n                    result.push(dataItem);\n                }\n            }\n\n            return result;\n        },\n\n        _parentInView: function(parentId) {\n            var view = this.view();\n\n            for (var i = 0; i < view.length; i++) {\n                if (view[i].id === parentId) {\n                    return view[i];\n                }\n            }\n        },\n\n        level: function(model) {\n            var result = -1;\n\n            if (!(model instanceof TreeListModel)) {\n                model = this.get(model);\n            }\n\n            do {\n                model = this.parentNode(model);\n                result++;\n            } while (model);\n\n            return result;\n        },\n\n        _pageableModelLevel: function(model) {\n            var that = this;\n\n            if (!model || !that._isPageable()) {\n                return 0;\n            }\n\n            var parents = that._parentNodes(model);\n\n            return parents.length;\n        },\n\n        filter: function(value) {\n            var baseFilter = DataSource.fn.filter;\n\n            if (value === undefined) {\n                return baseFilter.call(this, value);\n            }\n\n            baseFilter.call(this, value);\n        },\n\n        _pageableQueryOptions: function(options) {\n            var dataMaps = this._getDataMaps();\n\n            options.childrenMap = dataMaps.children;\n            options.idsMap = dataMaps.ids;\n\n            return options;\n        },\n\n        _flatData: function(data, skip) {\n            skip = this._isPageable() ? true : skip;\n            return DataSource.fn._flatData.call(this, data, skip);\n        },\n\n        data: function(data) {\n            var that = this;\n            var result = DataSource.fn.data.call(that, data);\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n                that._calculateCollapsedTotal();\n            }\n\n            return result;\n        },\n\n        cancelChanges: function(model) {\n            var that = this;\n\n            DataSource.fn.cancelChanges.call(that, model);\n\n            that._restorePageSizeAfterAddChild();\n        },\n\n        _modelCanceled: function(model) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._removeFromDataMaps(model);\n            }\n        },\n\n        _changesCanceled: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n            }\n        },\n\n        _setAddChildPageSize: function() {\n            var that = this;\n            var queryOptions = {};\n\n            if (that._isPageable()) {\n                // increase the page size to make the new item visible in view\n                that._addChildPageSize = that.pageSize() + 1;\n\n                queryOptions = that._defaultPageableQueryOptions();\n                queryOptions.take = that._addChildPageSize;\n                queryOptions.pageSize = that._addChildPageSize;\n                that._query(queryOptions);\n            }\n        },\n\n        _restorePageSizeAfterAddChild: function() {\n            var that = this;\n            var queryOptions = {};\n\n            if (that._isPageable()) {\n                if (!isUndefined(that._addChildPageSize)) {\n                    queryOptions = that._defaultPageableQueryOptions();\n                    queryOptions.take = that._addChildPageSize - 1;\n                    queryOptions.pageSize = that._addChildPageSize - 1;\n                    that._query(queryOptions);\n                }\n            }\n\n            that._addChildPageSize = undefined;\n        },\n\n        sync: function() {\n            var that = this;\n\n            return DataSource.fn.sync.call(that)\n                .then(function() {\n                    that._restorePageSizeAfterAddChild();\n                });\n        },\n\n        _syncEnd: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n            }\n        }\n    });\n\n    TreeListDataSource.create = function(options) {\n        if (Array.isArray(options)) {\n            options = { data: options };\n        } else if (options instanceof ObservableArray) {\n            options = { data: options.toJSON() };\n        }\n\n        return options instanceof TreeListDataSource ? options : new TreeListDataSource(options);\n    };\n\n    function isCellVisible() {\n        return this.style.display !== \"none\";\n    }\n\n    function sortCells(cells) {\n        var indexAttr = kendo.attr(\"index\");\n        return cells.sort(function(a, b) {\n            a = $(a);\n            b = $(b);\n\n            var indexA = a.attr(indexAttr);\n            var indexB = b.attr(indexAttr);\n\n            if (indexA === undefined) {\n                indexA = $(a).index();\n            }\n            if (indexB === undefined) {\n                indexB = $(b).index();\n            }\n\n            indexA = parseInt(indexA, 10);\n            indexB = parseInt(indexB, 10);\n            return indexA > indexB ? 1 : (indexA < indexB ? -1 : 0);\n        });\n    }\n\n    function leafDataCells(container) {\n        var rows = container.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        var cells = $();\n        if (rows.length > 1) {\n            cells = rows.find(\"th[data-index]\")\n                .filter(filter);\n        }\n\n        cells = cells.add(rows.last().find(\"th\").filter(filter));\n\n        return sortCells(cells);\n    }\n\n    function createPlaceholders(options) {\n        var spans = [];\n        var className = options.className;\n\n        for (var i = 0, level = options.level; i < level; i++) {\n            spans.push(kendoDomElement(\"span\", { className: className }));\n        }\n\n        return spans;\n    }\n\n    function columnsWidth(cols) {\n        var colWidth, width = 0;\n\n        for (var idx = 0, length = cols.length; idx < length; idx++) {\n            colWidth = cols[idx].style.width;\n            if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                width += parseInt(colWidth, 10);\n            }\n        }\n\n        return width;\n    }\n\n    function syncTableHeight(table1, table2) {\n       table1 = table1[0];\n       table2 = table2[0];\n\n       if (table1.rows.length && table2.rows.length && table1.rows.length !== table2.rows.length) {\n           var lockedHeigth = table1.offsetHeight;\n           var tableHeigth = table2.offsetHeight;\n\n           var row;\n           var diff;\n           if (lockedHeigth > tableHeigth) {\n               row = table2.rows[table2.rows.length - 1];\n\n               if (filterRowRegExp.test(row.className)) {\n                   row = table2.rows[table2.rows.length - 2];\n               }\n\n               diff = lockedHeigth - tableHeigth;\n           } else {\n               row = table1.rows[table1.rows.length - 1];\n\n                if (filterRowRegExp.test(row.className)) {\n                    row = table1.rows[table1.rows.length - 2];\n                }\n\n               diff = tableHeigth - lockedHeigth;\n           }\n           row.style.height = row.offsetHeight + diff + \"px\";\n       }\n    }\n\n    var TreeListPager = ui.Pager.extend({\n        options: {\n            name: \"TreeListPager\"\n        },\n\n        totalPages: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource && dataSource._filter) {\n                return ui.Pager.fn.totalPages.call(that);\n            }\n\n            return Math.ceil((that._collapsedTotal() || 0) / (that.pageSize() || 1));\n        },\n\n        _createDataSource: function(options) {\n            this.dataSource = kendo.data.TreeListDataSource.create(options.dataSource);\n        },\n\n        _collapsedTotal: function() {\n            var dataSource = this.dataSource;\n            return dataSource ? (dataSource.collapsedTotal() || 0) : 0;\n        }\n    });\n\n    var Editor = kendo.Observable.extend({\n        init: function(element, options) {\n            kendo.Observable.fn.init.call(this);\n\n            options = this.options = extend(true, {}, this.options, options);\n\n            this.element = element;\n\n            this.bind(this.events, options);\n\n            this.model = this.options.model;\n\n            this.fields = this._fields(this.options.columns);\n\n            this._initContainer();\n\n            this.createEditable();\n        },\n\n        events: [],\n\n        _initContainer: function() {\n            this.wrapper = this.element;\n        },\n\n        createEditable: function() {\n            var options = this.options;\n\n            this.editable = new ui.Editable(this.wrapper, {\n                fields: this.fields,\n                target: options.target,\n                clearContainer: options.clearContainer,\n                model: this.model,\n                change: options.change\n            });\n        },\n\n        _isEditable: function(column) {\n            return isColumnEditable(column, this.model);\n        },\n\n        _fields: function(columns) {\n            var fields = [];\n            var idx, length, column;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (this._isEditable(column)) {\n                    fields.push({\n                        field: column.field,\n                        format: column.format,\n                        editor: column.editor\n                    });\n                }\n            }\n\n            return fields;\n        },\n\n        end: function() {\n            return this.editable.end();\n        },\n\n        close: function() {\n            this.destroy();\n        },\n\n        destroy: function() {\n            this.editable.destroy();\n            this.editable.element\n                .find(\"[\" + kendo.attr(\"container-for\") + \"]\")\n                .empty()\n                .end()\n                .removeAttr(kendo.attr(\"role\"));\n\n            this.model = this.wrapper = this.element = this.columns = this.editable = null;\n        }\n    });\n\n    var PopupEditor = Editor.extend({\n        init: function(element, options) {\n            Editor.fn.init.call(this, element, options);\n\n            this._attachHandlers();\n            kendo.cycleForm(this.wrapper);\n\n            this.open();\n        },\n\n        events: [\n            CANCEL,\n            SAVE\n        ],\n\n        options: {\n            window: {\n                modal: true,\n                resizable: false,\n                draggable: true,\n                title: \"Edit\",\n                visible: false\n            }\n        },\n\n        _initContainer: function() {\n            var options = this.options;\n            var formContent = [];\n\n            this.wrapper = $('<div class=\"k-popup-edit-form\"/>')\n                .attr(kendo.attr(\"uid\"), this.model.uid)\n                .append('<div class=\"k-edit-form-container\"/>');\n\n            if (options.template) {\n                this._appendTemplate(formContent);\n                this.fields = [];\n            } else {\n                this._appendFields(formContent);\n            }\n            this._appendButtons(formContent);\n\n            new kendoDom.Tree(this.wrapper.children()[0]).render(formContent);\n\n            this.wrapper.appendTo(options.appendTo);\n\n            this.window = new ui.Window(this.wrapper, options.window);\n        },\n\n        _appendTemplate: function(form) {\n            var template = this.options.template;\n\n            if (typeof template === STRING) {\n                template = kendo.unescape(template);\n            }\n\n            template = kendo.template(template)(this.model);\n\n            form.push(kendoHtmlElement(template));\n        },\n\n        _appendFields: function(form) {\n            var idx, length, column;\n            var columns = this.options.columns;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (column.selectable) {\n                    continue;\n                }\n\n                if (column.command) {\n                    continue;\n                }\n\n                form.push(kendoHtmlElement('<div class=\"k-edit-label\"><label for=\"' + column.field + '\">' + (column.title || column.field || \"\") + '</label></div>'));\n\n                if (this._isEditable(column)) {\n                    form.push(kendoHtmlElement('<div ' + kendo.attr(\"container-for\") + '=\"' + column.field +\n                                '\" class=\"k-edit-field\"></div>'));\n                } else {\n                    form.push(kendoDomElement(\"div\", {\n                            \"class\": \"k-edit-field\"\n                        },\n                        [ this.options.fieldRenderer(column, this.model) ]));\n                }\n            }\n        },\n\n        _appendButtons: function(form) {\n            form.push(kendoDomElement(\"div\", {\n                \"class\": \"k-edit-buttons\"\n            }, this.options.commandRenderer()));\n        },\n\n        _attachHandlers: function() {\n            var closeHandler = this._cancelProxy = proxy(this._cancel, this);\n            this.wrapper.on(CLICK + NS, \".k-grid-cancel\", this._cancelProxy);\n\n            this._saveProxy = proxy(this._save, this);\n            this.wrapper.on(CLICK + NS, \".k-grid-update\", this._saveProxy);\n\n            this.window.bind(\"close\", function(e) {\n                if (e.userTriggered) {\n                    closeHandler(e);\n                }\n            });\n        },\n\n        _detachHandlers: function() {\n            this._cancelProxy = null;\n            this._saveProxy = null;\n            this.wrapper.off(NS);\n        },\n\n        _cancel: function(e) {\n            this.trigger(CANCEL, e);\n        },\n\n        _save: function() {\n            this.trigger(SAVE);\n        },\n\n        open: function() {\n            this.window.center().open();\n        },\n\n        close: function() {\n            this.window.bind(\"deactivate\", proxy(this.destroy, this)).close();\n        },\n\n        destroy: function() {\n            this.window.destroy();\n            this.window = null;\n            this._detachHandlers();\n\n            Editor.fn.destroy.call(this);\n        }\n    });\n\n    var IncellEditor = Editor.extend({\n        destroy: function() {\n            var that = this;\n\n            that.editable.destroy();\n\n            that.editable.element\n                .off()\n                .empty()\n                .removeAttr(kendo.attr(\"role\"));\n\n            that.model = that.wrapper = that.element = that.columns = that.editable = null;\n        }\n    });\n\n    var TreeList = DataBoundWidget.extend({\n        init: function(element, options, events) {\n            DataBoundWidget.fn.init.call(this, element, options);\n\n            if (events) {\n                this._events = events;\n            }\n\n            isRtl = kendo.support.isRtl(element);\n            this._dataSource(this.options.dataSource);\n            this._aria();\n            this._columns();\n            this._layout();\n            this._navigatable();\n            this._selectable();\n            this._sortable();\n            this._resizable();\n            this._filterable();\n            this._filterRow();\n            this._attachEvents();\n            this._toolbar();\n            this._scrollable();\n            this._reorderable();\n            this._columnMenu();\n            this._minScreenSupport();\n            this._draggable();\n            this._pageable();\n\n            if (this.options.autoBind) {\n                this.dataSource.fetch();\n            }\n\n            if (this._hasLockedColumns) {\n                var widget = this;\n                this.wrapper.addClass(\"k-grid-lockedcolumns\");\n                this._resizeHandler = function()  { widget.resize(); };\n                $(window).on(\"resize\" + NS, this._resizeHandler);\n            }\n\n            kendo.notify(this);\n        },\n\n        _draggable: function() {\n            var that = this;\n            var editable = this.options.editable;\n            var dataSource = that.dataSource;\n            var idField = dataSource._modelIdField();\n            var parentIdField = dataSource._modelParentIdField();\n            var pageable = that._isPageable();\n            var reorderable;\n\n            if (!editable || !editable.move) {\n                return;\n            }\n\n            reorderable = editable.move.reorderable;\n\n            this._dragging = new kendo.ui.HierarchicalDragAndDrop(this.wrapper, {\n                $angular: this.$angular,\n                autoScroll: true,\n                holdToDrag: touchDevice,\n                filter: \"tbody>tr\",\n                itemSelector: \"tr\",\n                allowedContainers: this.wrapper,\n                hintText: function(row) {\n                    var text = function() { return $(this).text(); };\n                    var separator = \"<span class='k-drag-separator'></span>\";\n                    return row.children(\"td\").map(text).toArray().join(separator);\n                },\n                contains: proxy(function(source, destination) {\n                    var dest = this.dataItem(destination);\n                    var src = this.dataItem(source);\n\n                    return src == dest || this.dataSource.contains(src, dest);\n                }, this),\n                itemFromTarget: function(target) {\n                    var tr = target.closest(\"tr\");\n                    var prevRow = tr.prev();\n                    var nextRow = tr.next();\n                    var first;\n                    var last;\n\n                    if (prevRow) {\n                        first =  !that.sameLevel(prevRow, tr);\n                    }\n\n                    if (nextRow) {\n                        last = !that.sameLevel(nextRow, tr);\n                    }\n\n                    return {\n                        item: tr,\n                        content: tr,\n                        first: first,\n                        last: last\n                    };\n                },\n                dragstart: proxy(function(source) {\n                    this.wrapper.addClass(\"k-treelist-dragging\");\n\n                    if (this.wrapper.find('.k-grid-content').length) {\n                        this.wrapper.find('.k-grid-content table, .k-grid-content-locked table').css(\"position\", \"relative\");\n                    }\n\n                    var model = this.dataItem(source);\n\n                    return this.trigger(DRAGSTART, { source: model });\n                }, this),\n                drag: proxy(function(e) {\n                    e.source = this.dataItem(e.source);\n\n                    this.trigger(DRAG, e);\n                }, this),\n                drop: proxy(function(e) {\n                    e.source = this.dataItem(e.source);\n                    e.destination = this.dataItem(e.destination);\n\n                    this.wrapper.removeClass(\"k-treelist-dragging\");\n\n                    if (this.wrapper.find('.k-grid-content').length) {\n                        this.wrapper.find('.k-grid-content table, .k-grid-content-locked table').css(\"position\", \"static\");\n                    }\n\n                    return this.trigger(DROP, e);\n                }, this),\n                dragend: proxy(function(e) {\n                    var dest = this.dataItem(e.destination);\n                    var src = this.dataItem(e.source);\n                    var originalSrcParentId = src[parentIdField];\n                    var originalSrcIndex = dataSource._indexInChildrenMap(src);\n                    var position = e.position;\n\n                    if (position == \"over\") {\n                        if (pageable) {\n                            dataSource._removeFromChildrenMap(src);\n                            src[parentIdField] = dest ? dest[idField] : null;\n\n                            dataSource._initChildrenMapForParent(dest);\n\n                            // src.set() below will not work as the parent id is already set\n                            src[parentIdField] = originalSrcParentId;\n                        }\n\n                        var isPrevented = src.set(\"parentId\", dest ? dest.id : null);\n\n                        if (pageable && isPrevented) {\n                            dataSource._removeFromChildrenMap(src);\n                            src[parentIdField] = originalSrcParentId;\n                            dataSource._removeFromChildrenMap(src);\n                            dataSource._insertInChildrenMap(src, originalSrcIndex);\n                        }\n\n\n                    } else {\n                        if (position == \"before\") {\n                            that.insertBefore(src, dest);\n                        } else if (position == \"after\") {\n                            that.insertAfter(src, dest);\n                        }\n                    }\n\n                    e.source = src;\n                    e.destination = dest;\n\n                    this.trigger(DRAGEND, e);\n                }, this),\n                reorderable: reorderable,\n                dropHintContainer: function(item) {\n                    return item.children(\"td:visible\").eq(0);\n                },\n                dropPositionFrom: function(dropHint) {\n                    var contents;\n                    var length;\n                    var i;\n                    var dropHintElement;\n                    var isAfterText = false;\n\n                    if(dropHint.parent().find('.k-i-none').length) {\n                        return dropHint.prevAll(\".k-i-none\").length > 0 ? \"after\" : \"before\";\n                    } else {\n                        contents = dropHint.parent().contents();\n                        length = contents.length;\n                        dropHintElement = dropHint[0];\n\n                        for (i = 0; i < length; i++) {\n                            if (contents[i] === dropHintElement) {\n                                break;\n                            }\n\n                            if (contents[i].nodeType === 3) {\n                                isAfterText = true;\n                            }\n                        }\n\n                        return isAfterText ? \"after\" : \"before\";\n                    }\n                }\n            });\n        },\n\n        sameLevel: function () {\n           return arguments[0].find(\".\" + classNames.iconHidden).length === arguments[1].find(\".\" + classNames.iconHidden).length;\n        },\n\n        insertAfter: function(nodeData, referenceNode) {\n            this.insertAction(nodeData, referenceNode, 1);\n        },\n\n        insertBefore: function(nodeData, referenceNode) {\n            this.insertAction(nodeData, referenceNode, 0);\n        },\n\n        insertAction: function(nodeData, referenceNode, indexOffset){\n            var that = this;\n            var dataSource = that.dataSource;\n            var parentIdField = dataSource._modelParentIdField();\n            var referenceNodeIndex;\n            var nodeDataIndex = dataSource.indexOf(nodeData);\n            var pageable = that._isPageable();\n            var originalDestIndex = dataSource._indexInChildrenMap(referenceNode);\n            var destIndex;\n            var childrenMap = dataSource._getChildrenMap() || {};\n            var parentId = nodeData[parentIdField];\n\n            that._unbindDataSource();\n            that._unbindDataChange();\n\n            if (pageable) {\n                dataSource._removeFromChildrenMap(nodeData);\n            }\n\n            if (nodeData[parentIdField] != referenceNode[parentIdField]) {\n                 nodeData.set(\"parentId\", referenceNode && referenceNode.parentId ? referenceNode.parentId : null);\n            }\n\n            dataSource._data.splice(nodeDataIndex, 1);\n            referenceNodeIndex = dataSource.indexOf(referenceNode);\n            destIndex = referenceNodeIndex + indexOffset;\n\n            if (pageable) {\n                originalDestIndex += indexOffset;\n\n                if (childrenMap[parentId].length <= originalDestIndex) {\n                    originalDestIndex = childrenMap[parentId].length;\n                }\n                dataSource._insertInChildrenMap(nodeData, originalDestIndex);\n            }\n\n            dataSource._data.splice(destIndex, 0, nodeData);\n            dataSource._destroyed.pop();\n            that._bindDataChange();\n            that._bindDataSource();\n            that.refresh();\n        },\n\n        _bindDataChange: function () {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.bind(CHANGE, dataSource._changeHandler);\n                dataSource._data.trigger(CHANGE);\n            }\n        },\n\n        _unbindDataChange: function () {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.unbind(CHANGE, dataSource._changeHandler);\n            }\n        },\n\n        _bindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.bind(CHANGE, that._refreshHandler);\n            }\n        },\n\n        _unbindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.unbind(CHANGE, that._refreshHandler);\n            }\n        },\n\n        itemFor: function(model) {\n            if (typeof model == \"number\") {\n                model = this.dataSource.get(model);\n            }\n\n            return this.tbody.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n        },\n\n        _itemFor: function(model) {\n            var that = this;\n            var table = that.lockedContent ? that.lockedTable : that.table;\n\n            if (typeof model == \"number\") {\n                model = this.dataSource.get(model);\n            }\n\n            return table.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n        },\n\n        _scrollable: function() {\n            if (this.options.scrollable) {\n                var scrollables = this.thead.closest(\".k-grid-header-wrap\");\n                var lockedContent = $(this.lockedContent)\n                    .on(\"DOMMouseScroll\" + NS + \" mousewheel\" + NS, proxy(this._wheelScroll, this));\n\n                this.content.on(\"scroll\" + NS, function() {\n                    kendo.scrollLeft(scrollables, this.scrollLeft);\n                    lockedContent.scrollTop(this.scrollTop);\n                });\n\n\n                var touchScroller = kendo.touchScroller(this.content);\n\n                if (touchScroller && touchScroller.movable) {\n                    this._touchScroller = touchScroller;\n\n                    touchScroller.movable.bind(\"change\", function(e) {\n                        kendo.scrollLeft(scrollables, -e.sender.x);\n                        if (lockedContent) {\n                            lockedContent.scrollTop(-e.sender.y);\n                        }\n                    });\n                }\n            }\n        },\n\n        _wheelScroll: function (e) {\n            if (e.ctrlKey) {\n                return;\n            }\n\n            var delta = kendo.wheelDeltaY(e);\n            var lockedDiv = $(e.currentTarget);\n\n            if (delta) {\n                if (lockedDiv[0].scrollHeight > lockedDiv[0].clientHeight &&\n                    (lockedDiv[0].scrollTop < lockedDiv[0].scrollHeight - lockedDiv[0].clientHeight && delta < 0 ||\n                    lockedDiv[0].scrollTop > 0 && delta > 0)) {\n                    e.preventDefault();\n                }\n                //In Firefox DOMMouseScroll event cannot be canceled\n                lockedDiv.one(\"wheel\" + NS, false);\n\n                this.content.scrollTop(this.content.scrollTop() + (-delta));\n            }\n        },\n\n        _progress: function() {\n            var messages = this.options.messages;\n\n            if (!this.tbody.find(\"tr\").length) {\n                this._showStatus(\n                    kendo.template(\n                        \"<span class='#= className #'></span> #: messages.loading #\"\n                    )({\n                        className: classNames.icon + \" \" + classNames.loading,\n                        messages: messages\n                    })\n                );\n            }\n        },\n\n        _error: function(e) {\n            if (!this.dataSource.rootNodes().length) {\n                this._render({ error: e });\n            }\n        },\n\n        refresh: function(e) {\n            var that = this;\n            e = e || {};\n\n            if (e.action == \"itemchange\" && this.editor) {\n                return;\n            }\n\n            if (this.trigger(DATABINDING)) {\n                return;\n            }\n            var current = $(this.current());\n            var isCurrentInHeader = false;\n            var currentIndex;\n\n            this._cancelEditor();\n\n            this._render();\n\n            this._adjustHeight();\n\n            if (this.options.navigatable) {\n                if (this._isActiveInTable() || this.editor) {\n                    isCurrentInHeader = current.is(\"th\");\n                    currentIndex = Math.max(this.cellIndex(current), 0);\n                }\n                this._restoreCurrent(currentIndex, isCurrentInHeader);\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.items(), true);\n            }\n\n            this.trigger(DATABOUND);\n        },\n\n        _angularFooters: function(command) {\n            var i, footer, aggregates;\n            var allAggregates = this.dataSource.aggregates();\n            var footerRows = this._footerItems();\n\n            for (i = 0; i < footerRows.length; i++) {\n                footer = footerRows.eq(i);\n                aggregates = allAggregates[footer.attr(\"data-parentId\")];\n\n                this._angularFooter(command, footer.find(\"td\").get(), aggregates);\n            }\n        },\n\n        _angularFooter: function(command, cells, aggregates) {\n            var columns = this.columns;\n            this.angular(command, function() {\n                return {\n                    elements: cells,\n                    data: map(columns, function(col){\n                        return {\n                            column: col,\n                            aggregate: aggregates && aggregates[col.field]\n                        };\n                    })\n                };\n            });\n        },\n\n        items: function() {\n            if (this._hasLockedColumns) {\n                return this._items(this.tbody).add(this._items(this.lockedTable));\n            } else {\n                return this._items(this.tbody);\n            }\n        },\n\n        _items: function(container) {\n            return container.find(\"tr[data-uid]\").filter(function() {\n                return !$(this).hasClass(classNames.footerTemplate);\n            });\n        },\n\n        _footerItems: function() {\n            var container = this.tbody;\n            if (this._hasLockedColumns) {\n                container = container.add(this.lockedTable);\n            }\n\n            return container.find(\"tr\").filter(function() {\n                return $(this).hasClass(classNames.footerTemplate);\n            });\n        },\n\n        dataItems: function() {\n            var dataItems = kendo.ui.DataBoundWidget.fn.dataItems.call(this);\n            if (this._hasLockedColumns) {\n                var n = dataItems.length, tmp = new Array(2 * n);\n                for (var i = n; --i >= 0;) {\n                    tmp[i] = tmp[i + n] = dataItems[i];\n                }\n                dataItems = tmp;\n            }\n\n            return dataItems;\n        },\n\n        _showNoRecordsTemplate: function () {\n            var wrapper = '<div class=\"{0}\">{1}</div>';\n            var defaultTemplate = '<div class=\"k-grid-norecords-template\"{1}>{0}</div>';\n            var scrollableNoGridHeightStyles = (this.options.scrollable && !this.wrapper[0].style.height) ? ' style=\"margin:0 auto;position:static;\"' : '';\n            var template;\n\n            this._contentTree.render([]);\n            if (this._hasLockedColumns) {\n                this._lockedContentTree.render([]);\n            }\n\n            template = kendo.format(defaultTemplate, this.options.messages.noRows, scrollableNoGridHeightStyles);\n\n            $(kendo.template(kendo.format(wrapper, NORECORDSCLASS, template))({})).insertAfter(this.table);\n        },\n\n        _showStatus: function(message) {\n            var status = this.element.find(\".k-status\");\n            var content = $(this.content).add(this.lockedContent);\n\n            if (!status.length) {\n                status = $(\"<div class='k-status' role='alert' aria-live='polite' />\").appendTo(this.element);\n            }\n\n            this._contentTree.render([]);\n            if (this._hasLockedColumns) {\n                this._lockedContentTree.render([]);\n            }\n\n            content.hide();\n\n            status.html(message);\n        },\n\n        _hideStatus: function() {\n            this.element.find(\".k-status\").remove();\n            this._hideNoRecordsTempalte();\n\n            $(this.content).add(this.lockedContent).show();\n        },\n\n        _hideNoRecordsTempalte: function() {\n            this.element.find(\".\"+NORECORDSCLASS).remove();\n        },\n\n        _adjustHeight: function() {\n            var that = this;\n            var element = this.element;\n            var contentWrap = element.find(DOT + classNames.gridContentWrap);\n            var header = element.find(DOT + classNames.gridHeader);\n            var toolbar = element.find(DOT + classNames.gridToolbar);\n            var status = element.find(DOT + classNames.status);\n            var pagerHeight = that._isPageable() && that.pager && that.pager.element.is(\":visible\") ? outerHeight(that.pager.element) : 0;\n            var height;\n            var scrollbar = kendo.support.scrollbar();\n\n            element.css(HEIGHT, this.options.height);\n\n            // identical code found in grid & scheduler :(\n            var isHeightSet = function(el) {\n                var initialHeight, newHeight;\n                if (el[0].style.height) {\n                    return true;\n                } else {\n                    initialHeight = el.height();\n                }\n\n                el.height(\"auto\");\n                newHeight = el.height();\n                el.height(\"\");\n\n                return (initialHeight != newHeight);\n            };\n\n            if (isHeightSet(element)) {\n                height = element.height() - outerHeight(header) - outerHeight(toolbar) - outerHeight(status) - pagerHeight;\n\n                contentWrap.height(height);\n\n                if (this._hasLockedColumns) {\n                    scrollbar = this.table[0].offsetWidth > this.table.parent()[0].clientWidth ? scrollbar : 0;\n                    this.lockedContent.height(height - scrollbar);\n                }\n            }\n        },\n\n        _resize: function(size, force) {\n            this._applyLockedContainersWidth();\n            this._adjustHeight();\n\n            if (this.pager && this.pager.element) {\n                this.pager.resize(force);\n            }\n        },\n\n        _minScreenSupport: function() {\n            var any = this.hideMinScreenCols();\n\n            if (any) {\n                this.minScreenResizeHandler = proxy(this.hideMinScreenCols, this);\n                $(window).on(\"resize\", this.minScreenResizeHandler);\n            }\n        },\n\n        _iterateMinScreenCols: function (cols, screenWidth) {\n            var any = false;\n\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                var minWidth = col.minScreenWidth;\n                if (minWidth !== undefined && minWidth !== null) {\n                    any = true;\n                    if (minWidth > screenWidth) {\n                        this.hideColumn(col);\n                    } else {\n                        this.showColumn(col);\n                    }\n                }\n                if (!col.hidden && col.columns) {\n                    any = this._iterateMinScreenCols(col.columns, screenWidth) || any;\n                }\n            }\n            return any;\n        },\n\n        hideMinScreenCols: function() {\n            var cols = this.columns,\n                screenWidth = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n\n            return this._iterateMinScreenCols(cols, screenWidth);\n        },\n\n        destroy: function() {\n            this._destroyColumnAttachments();\n\n            DataBoundWidget.fn.destroy.call(this);\n\n            var dataSource = this.dataSource;\n\n            dataSource.unbind(CHANGE, this._refreshHandler);\n            dataSource.unbind(ERROR, this._errorHandler);\n            dataSource.unbind(PROGRESS, this._progressHandler);\n\n            this._navigatableTables = null;\n            this._current = null;\n\n            if (this._resizeHandler) {\n                $(window).off(\"resize\" + NS, this._resizeHandler);\n            }\n\n            if (this._dragging) {\n                this._dragging.destroy();\n                this._dragging = null;\n            }\n\n            if (this.resizable) {\n                this.resizable.destroy();\n                this.resizable = null;\n            }\n\n            if (this.reorderable) {\n                this.reorderable.destroy();\n                this.reorderable = null;\n            }\n\n            if (this._draggableInstance && this._draggableInstance.element) {\n                this._draggableInstance.destroy();\n                this._draggableInstance = null;\n            }\n\n            if(this.selectable){\n                this.selectable.destroy();\n            }\n\n            if (this._userEvents) {\n                this._userEvents.destroy();\n                this._userEvents = null;\n            }\n\n            if (this.minScreenResizeHandler) {\n                $(window).off(\"resize\", this.minScreenResizeHandler);\n            }\n\n            this._destroyEditor();\n\n            this.element.off(NS);\n            if (this.wrapper) {\n                this.wrapper.off(NS);\n            }\n\n            if (this._touchScroller) {\n                this._touchScroller.destroy();\n            }\n\n            this._destroyPager();\n\n            if (dataSource) {\n                dataSource._dataMaps = null;\n            }\n\n            this._autoExpandable = null;\n\n            this._refreshHandler = this._errorHandler = this._progressHandler = this._dataSourceFetchProxy = null;\n\n            this.thead =\n                this.content =\n                this.tbody =\n                this.table =\n                this.element =\n                this.lockedHeader =\n                this.lockedContent = null;\n\n            this._statusTree =\n                this._headerTree =\n                this._contentTree =\n                this._lockedHeaderColsTree =\n                this._lockedContentColsTree =\n                this._lockedHeaderTree =\n                this._lockedContentTree = null;\n\n            kendo.destroy(this.wrapper);\n        },\n\n        options: {\n            name: \"TreeList\",\n            columns: [],\n            autoBind: true,\n            scrollable: true,\n            selectable: false,\n            sortable: false,\n            toolbar: null,\n            height: null,\n            columnMenu: false,\n            messages: {\n                noRows: \"No records to display\",\n                loading: \"Loading...\",\n                requestFailed: \"Request failed.\",\n                retry: \"Retry\",\n                commands: {\n                    edit: \"Edit\",\n                    update: \"Update\",\n                    canceledit: \"Cancel\",\n                    create: \"Add new record\",\n                    createchild: \"Add child record\",\n                    destroy: \"Delete\",\n                    excel: \"Export to Excel\",\n                    pdf: \"Export to PDF\",\n                    search: \"Search...\"\n                }\n            },\n            excel: {\n                hierarchy: true\n            },\n            resizable: false,\n            search: false,\n            filterable: false,\n            editable: false,\n            reorderable: false,\n            pageable: false,\n            renderAllRows: true,\n            rowTemplate: \"\",\n            altRowTemplate: \"\"\n        },\n\n        events: [\n            CHANGE,\n            BEFORE_EDIT,\n            EDIT,\n            PAGE,\n            SAVE,\n            SAVE_CHANGES,\n            REMOVE,\n            EXPAND,\n            COLLAPSE,\n            DATABINDING,\n            DATABOUND,\n            CANCEL,\n            DRAGSTART,\n            DRAG,\n            DROP,\n            DRAGEND,\n            FILTERMENUINIT,\n            ITEM_CHANGE,\n            CELL_CLOSE,\n            FILTERMENUOPEN,\n            COLUMNHIDE,\n            COLUMNSHOW,\n            COLUMNREORDER,\n            COLUMNRESIZE,\n            COLUMNMENUINIT,\n            COLUMNMENUOPEN,\n            COLUMNLOCK,\n            COLUMNUNLOCK\n        ],\n\n        getOptions: function() {\n            var options = this.options;\n            options.dataSource = null;\n\n            var result = extend(true, {}, this.options);\n            result.columns = kendo.deepExtend([], this.columns);\n\n            var dataSource = this.dataSource;\n\n            var initialData = dataSource.options.data && dataSource._data;\n            dataSource.options.data = null;\n\n            result.dataSource = $.extend(true, {}, dataSource.options);\n\n            dataSource.options.data = initialData;\n\n            result.dataSource.data = initialData;\n            result.dataSource.page = dataSource.page();\n            result.dataSource.filter = $.extend(true, {}, dataSource.filter());\n            result.dataSource.pageSize = dataSource.pageSize();\n            result.dataSource.sort = dataSource.sort();\n            result.dataSource.group = dataSource.group();\n            result.dataSource.aggregate = dataSource.aggregate();\n\n            if (result.dataSource.transport) {\n                result.dataSource.transport.dataSource = null;\n            }\n\n            if (result.pageable && result.pageable.pageSize) {\n                result.pageable.pageSize = dataSource.pageSize();\n            }\n\n            result.$angular = undefined;\n\n            return result;\n        },\n\n        setOptions: function(options) {\n            var currentOptions = this.getOptions();\n            kendo.deepExtend(currentOptions, options);\n            if (!options.dataSource) {\n                currentOptions.dataSource = this.dataSource;\n            }\n            var wrapper = this.wrapper;\n            var events = this._events;\n            var element = this.element;\n\n            this.destroy();\n            this.options = null;\n            if (wrapper[0] !== element[0]) {\n                wrapper.before(element);\n                wrapper.remove();\n            }\n            element.empty();\n\n            this.init(element, currentOptions, events);\n            this._setEvents(currentOptions);\n        },\n\n        _destroyColumnAttachments: function() {\n            var that = this;\n\n            if (!that.thead) {\n                return;\n            }\n\n            this.angular(\"cleanup\", function(){\n                return { elements: that.thead.get() };\n            });\n\n            that.thead.add(that.lockedHeader).find(\"th\").each(function(){\n                var th = $(this),\n                    filterMenu = th.data(\"kendoFilterMenu\"),\n                    sortable = th.data(\"kendoColumnSorter\"),\n                    columnMenu = th.data(\"kendoColumnMenu\");\n\n                if (filterMenu) {\n                    filterMenu.destroy();\n                }\n\n                if (sortable) {\n                    sortable.destroy();\n                }\n\n                if (columnMenu) {\n                    columnMenu.destroy();\n                }\n            });\n        },\n\n        _toggle: function(model, expand) {\n            var that = this;\n            var defaultPromise = $.Deferred().resolve().promise();\n            var loaded = model.loaded();\n\n             if (that._isIncellEditable() && that.editor) {\n                // manually trigger change as the expand/collapse icons are not focusable\n                $(activeElement()).change();\n                that.closeCell();\n            }\n\n            // reset error state\n            if (model._error) {\n                model.expanded = false;\n                model._error = undefined;\n            }\n\n            // do not load items that are currently loading\n            if (!loaded && model.expanded) {\n                return defaultPromise;\n            }\n\n            // toggle expanded state\n            if (typeof expand == \"undefined\") {\n                expand = !model.expanded;\n            }\n\n            model.expanded = expand;\n\n            function afterModelLoaded() {\n                that._toggleData();\n                if (that._isPageable()) {\n                    that.refresh();\n                } else {\n                    that._render();\n                }\n                that._syncLockedContentHeight();\n            }\n\n            if (!loaded) {\n                defaultPromise = this.dataSource.load(model)\n                    .always(proxy(function() {\n                        afterModelLoaded();\n                    }, this));\n            }\n\n            afterModelLoaded();\n\n            return defaultPromise;\n        },\n\n        _toggleData: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._togglePageableData();\n            }\n        },\n\n        _togglePageableData: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n            var data = dataSource._getData();\n            var result;\n            var queryOptions = dataSource._defaultPageableQueryOptions();\n\n            that._renderProgress(true);\n\n            var childrenMap = dataSource._getChildrenMap() || dataSource.childrenMap(dataSource._getData());\n\n            dataSource._processDataItemsState(data, childrenMap);\n\n            result = dataSource._processPageableQuery(data, queryOptions);\n\n            queryOptions.childrenMap = result.childrenMap;\n            queryOptions.filteredChildrenMap = result.filteredChildrenMap;\n\n            dataSource._aggregateResult = dataSource._calculateAggregates(result.dataToAggregate, queryOptions);\n\n            dataSource.view(result.data);\n\n            if (!dataSource.filter()) {\n                dataSource._calculateCollapsedTotal();\n            }\n\n            that._refreshPager();\n\n            that._renderProgress(false);\n        },\n\n        _refreshPager: function() {\n            var pager = this.pager;\n\n            if (pager) {\n                pager.refresh();\n            }\n        },\n\n        expand: function(row) {\n            return this._toggle(this.dataItem(row), true);\n        },\n\n        collapse: function(row) {\n            return this._toggle(this.dataItem(row), false);\n        },\n\n        _toggleChildren: function(e) {\n            var icon = $(e.target);\n            var model = this.dataItem(icon);\n\n            if (!model) {\n                return;\n            }\n\n            var event = !model.expanded ? EXPAND : COLLAPSE;\n\n            if (!this.trigger(event, { model: model })) {\n                this._toggle(model);\n            }\n\n            e.preventDefault();\n        },\n\n        _navigatable: function() {\n            var that = this;\n\n            if (!that.options.navigatable) {\n                return;\n            }\n            var tables = that.table.add(that.lockedTable);\n\n            var headerTables = that.thead.parent().add($(\">table\", that.lockedHeader));\n            if (that.options.scrollable) {\n                //add the header table when the widget is scrollable\n                tables = tables.add(headerTables);\n                //data tables will recive first focus on TAB\n                headerTables.attr(TABINDEX, -1);\n            }\n\n            this._navigatableTables = tables;\n\n            tables\n                //handle click on tables, will attempt to focus the table\n                .on((kendo.support.touch ? \"touchstart\" + NS : \"mousedown\" + NS), NAVROW + \">:visible\", proxy(that._tableClick, that))\n                .on(\"focus\" + NS, proxy(that._tableFocus, that))\n                .on(\"focusout\" + NS, proxy(that._tableBlur, that))\n                .on(\"keydown\" + NS, proxy(that._tableKeyDown, that));\n        },\n\n        cellIndex: function(td) {\n            var lockedColumnOffset = 0;\n\n            if (this.lockedTable && !$.contains(this.lockedTable[0], td[0])) {\n                lockedColumnOffset = leafColumns(lockedColumns(this.columns)).length;\n            }\n\n            return $(td).parent().children().index(td) + lockedColumnOffset;\n        },\n\n        _isActiveInTable: function() {\n            var active = kendo._activeElement();\n\n            if (!active) { return false; }\n\n            return this.table[0] === active ||\n                $.contains(this.table[0], active) ||\n                (this.lockedTable &&\n                    (this.lockedTable[0] === active || $.contains(this.lockedTable[0], active))\n                );\n        },\n\n        _restoreCurrent: function(currentIndex, isCurrentInHeader) {\n            var rowIndex;\n            var row;\n            var td;\n\n            if (currentIndex === undefined || currentIndex < 0) {\n                return;\n            }\n\n            if (this._current) {\n                this._current.removeClass(\"k-state-focused\");\n            }\n\n            if (isCurrentInHeader) {\n                this.current(this.thead.find(\"th\").eq(currentIndex));\n            } else {\n                rowIndex = 0;\n                currentIndex = 0;\n\n                row = $();\n\n                if (this.lockedTable) {\n                    row = this.lockedTable.find(\">tbody>tr:visible\").eq(rowIndex);\n                }\n                row = row.add(this.tbody.children().eq(rowIndex));\n\n                td = row.find(\">td:visible\")\n                    .eq(currentIndex);\n\n                this.current(td);\n            }\n\n            if (this._current) {\n                focusTable(this._current.closest(\"table\")[0], true);\n            }\n        },\n\n        current: function (newCurrent) {\n            var current = this._current;\n            newCurrent = $(newCurrent);\n\n            if(newCurrent.length && (!current || current[0] !== newCurrent[0])) {\n                this._updateCurrentAttr(current, newCurrent);\n\n                this._scrollCurrent();\n            }\n\n            if (newCurrent && newCurrent.length) {\n                this._lastCellIndex = newCurrent.parent().children(DATA_CELL).index(newCurrent);\n            }\n\n            return this._current;\n        },\n\n        _setCurrent: function(newCurrent) {\n            var that = this;\n            newCurrent = $(newCurrent);\n\n            if (newCurrent[0]) {\n                that._current = newCurrent;\n                that._updateCurrentAttr(that._current, newCurrent);\n                that._scrollCurrent();\n            }\n\n            return that._current;\n        },\n\n        _scrollCurrent: function() {\n            var current = this._current;\n            var scrollable = this.options.scrollable;\n\n            if (!current || !scrollable) {\n                return;\n            }\n\n            var row = current.parent();\n            var tableContainer = row.closest(\"table\").parent();\n\n            var isInLockedContainer = tableContainer.is(\".k-grid-content-locked,.k-grid-header-locked\");\n            var isInContent = tableContainer.is(\".k-grid-content-locked,.k-grid-content\");\n\n            var scrollableContainer = $(this.content)[0];\n\n            //adjust scroll vertically\n            if (isInContent) {\n                this._scrollTo(this._relatedRow(row)[0], scrollableContainer);\n            }\n\n            if (this.lockedContent) {\n                //sync locked and non-locked content scrollTop\n                this.lockedContent[0].scrollTop = scrollableContainer.scrollTop;\n            }\n\n            //adjust scroll horizontally, if not inside locked tables\n            if (!isInLockedContainer) {\n                this._scrollTo(current[0], scrollableContainer);\n            }\n        },\n\n        _findCurrentCell: function() {\n            var that = this;\n            var current = that.current();\n            var elements = $(that.table).add(that.header).add(that.lockedTable).add(that.lockedHeader);\n\n            if (current && elements.find(current).length > 0) {\n                return current;\n            } else {\n                return elements.find(DOT + classNames.focused);\n            }\n        },\n\n        _scrollTo: function(element, container) {\n            var elementToLowercase = element.tagName.toLowerCase();\n            var isHorizontal =  elementToLowercase === \"td\" || elementToLowercase === \"th\";\n            var table = $(element).closest(\"table\")[0];\n            var elementOffsetDir = element[isHorizontal ? \"offsetWidth\" : \"offsetHeight\"];\n            var containerScroll = container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"];\n            var containerOffsetDir = container[isHorizontal ? \"clientWidth\" : \"clientHeight\"];\n            var elementOffset = $(element).css(\"position\") === \"relative\" && isRtl && isHorizontal ? Math.abs(table.offsetLeft - element.offsetLeft) : element[isHorizontal ? \"offsetLeft\" : \"offsetTop\"];\n            var bottomDistance = elementOffset + elementOffsetDir;\n            var result = 0;\n            var ieCorrection = 0;\n            var firefoxCorrection = 0;\n\n            if (isRtl && isHorizontal) {\n                if (browser.msie || browser.edge) {\n                    ieCorrection = table.offsetLeft;\n                } else if (browser.mozilla || (browser.webkit && (browser.version > 85))) {\n                    firefoxCorrection = table.offsetLeft - kendo.support.scrollbar();\n                }\n            }\n            containerScroll = Math.abs(containerScroll + ieCorrection - firefoxCorrection);\n            if (containerScroll > elementOffset) {\n                result = elementOffset;\n            } else if (bottomDistance > (containerScroll + containerOffsetDir)) {\n                if (elementOffsetDir <= containerOffsetDir) {\n                    result = (bottomDistance - containerOffsetDir);\n                } else {\n                    result = elementOffset;\n                }\n            } else {\n                result = containerScroll;\n            }\n            result = Math.abs(result + ieCorrection) + firefoxCorrection;\n            container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"] = result;\n        },\n\n        _aria: function() {\n            var id = this.element.attr(\"id\") || \"aria\";\n\n            if (id) {\n                this._elementId = id + \"_active_element\";\n            }\n        },\n\n        _currentDataIndex: function(table, current) {\n            var index = current.attr(\"data-index\");\n\n            if (!index) {\n                return undefined;\n            }\n\n            var lockedColumnsCount = lockedColumns(this.columns).length;\n            if (lockedColumnsCount && !table.closest(\"div\").hasClass(\"k-grid-content-locked\")[0]) {\n                return index - lockedColumnsCount;\n            }\n\n            return index;\n        },\n\n        _prevVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var cellSelector = DATA_CELL + \",\" + FILTER_CELL;\n\n            //current is in the header, but not at the last level of multi-level columns\n            if (index || current.hasClass(\"k-header\")) {\n                cells = parentColumnsCells(current);\n                return cells.eq(cells.length - 2);\n            }\n\n            index = Math.max(row.children(cellSelector).index(current), this._lastCellIndex || 0);\n\n            //if current is inside filter row\n            if (row.hasClass(\"k-filter-row\")) {\n                return leafDataCells(container).filter(isCellVisible).eq(index);\n            }\n\n            //move up to header container\n            if (rowIndex == -1) {\n                //is there filter row in the header container\n                row = container.find(\"tr.k-filter-row:visible\");\n                if (!row[0]) {\n                    return leafDataCells(container).filter(isCellVisible).eq(index);\n                }\n            } else {\n                row =  rowIndex === 0 ? $() : rows.eq(rowIndex - 1);\n            }\n\n            cells = row.children(cellSelector);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _nextVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var cellSelector = DATA_CELL + \",\" + FILTER_CELL;\n\n            //current is in the header, but not at the last level of multi-level columns\n            //and we are not changing the table\n            if (rowIndex != -1 && index === undefined && current.hasClass(\"k-header\")) {\n                return childColumnsCells(current).eq(1);\n            }\n\n            index = index ? parseInt(index, 10) : row.children(cellSelector).index(current);\n            index = Math.max(index, this._lastCellIndex || 0);\n\n            //move down to data container\n            if (rowIndex == -1) {\n                row = rows.eq(0);\n            } else {\n                row = rows.eq(rowIndex + current[0].rowSpan);\n            }\n\n            var tmpIndex = index;\n            //in case of last level of multi-level columns the index should be updated depending on the hidden columns\n            if (this._currentDataIndex(container, current) !== undefined) {\n                var currentRowCells = row.children(\":not(.k-group-cell):not(.k-hierarchy-cell)\");\n                var hiddenColumns = currentRowCells.filter(\":hidden\");\n                for(var idx = 0, length = hiddenColumns.length; idx < length; idx++) {\n                    if (currentRowCells.index(hiddenColumns[idx]) < index) {\n                        tmpIndex--;\n                    }\n                }\n            }\n            index = tmpIndex;\n\n            cells = row.children(cellSelector);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _verticalContainer: function(container, up) {\n            var table = container.parent();\n            var length = this._navigatableTables.length;\n            var step = Math.floor(length / 2);\n            var index = inArray(table[0], this._navigatableTables);\n\n            if (up) {\n                step *= -1;\n            }\n            index += step;\n\n            if (index >= 0 || index < length) {\n                table = this._navigatableTables.eq(index);\n            }\n\n            return table.find(up ? \"thead\" : \"tbody\");\n        },\n\n        _updateCurrentAttr: function(current, next) {\n            var headerId = $(current).data(\"headerId\");\n\n            $(current)\n                .removeClass(classNames.focused)\n                .closest(\"table\")\n                .removeAttr(\"aria-activedescendant\");\n\n            if(headerId){\n                headerId = headerId.replace(this._elementId, \"\");\n                $(current).attr(\"id\", headerId);\n            }else{\n                $(current).removeAttr(\"id\");\n            }\n\n            next\n                .data(\"headerId\", next.attr(\"id\"))\n                .attr(\"id\", this._elementId)\n                .addClass(classNames.focused)\n                .closest(\"table\")\n                .attr(\"aria-activedescendant\", this._elementId);\n\n            this._current = next;\n        },\n\n        _tableKeyDown: function(e) {\n            var handled = false;\n            var current = this.current();\n            var target = $(e.target);\n            var canHandle = !e.isDefaultPrevented() && !target.is(\":button,a,:input,a>.k-icon\");\n\n            current = current ? current : $(this.lockedTable).add(this.table).find(NAVROW + \" > td:visible\").first();\n\n            if (canHandle && e.keyCode == keys.UP) {\n                handled = this._moveUp(current, e.shiftKey);\n            }\n\n            if (canHandle && e.keyCode == keys.DOWN) {\n                handled = this._moveDown(current, e.shiftKey);\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.LEFT : keys.RIGHT)) {\n                if (e.altKey) {\n                    handled = this._handleExpand(current);\n                } else {\n                    handled = this._moveRight(current);\n                }\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.RIGHT : keys.LEFT)) {\n                if (e.altKey) {\n                    handled = this._handleCollapse(current);\n                } else {\n                    handled = this._moveLeft(current);\n                }\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEDOWN) {\n                handled = this._handlePageDown();\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEUP) {\n                handled = this._handlePageUp();\n            }\n\n            if (e.keyCode == keys.ENTER || e.keyCode == keys.F2) {\n                handled = this._handleEnterKey(current, e.currentTarget, target);\n            }\n\n            if (e.keyCode == keys.ESC) {\n                handled = this._handleEscKey(current, e.currentTarget);\n            }\n\n            if (canHandle && e.keyCode == keys.HOME) {\n                handled = this._handleHome(current, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == keys.END) {\n                handled = this._handleEnd(current, e.ctrlKey);\n            }\n\n            if (e.keyCode == keys.TAB) {\n                handled = this._handleTabKey(current, e.currentTarget, e.shiftKey);\n            }\n\n            if (handled) {\n                //prevent scrolling while pressing the keys\n                e.preventDefault();\n                //required in hierarchy\n                e.stopPropagation();\n            }\n        },\n\n        _handleExpand: function(current) {\n            var that = this;\n            var row = current.parent();\n            var model = that.dataItem(row);\n\n            if (current.hasClass(\"k-header\")) {\n                return false;\n            }\n\n            if (model && model.hasChildren && !model.expanded && !that.trigger(EXPAND, { model: model })) {\n                this.expand(row);\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleCollapse: function(current) {\n            var that = this;\n            var row = current.parent();\n            var model = that.dataItem(row);\n\n            if (current.hasClass(\"k-header\")) {\n                return false;\n            }\n\n            if (model && model.hasChildren && model.expanded && !that.trigger(COLLAPSE, { model: model })) {\n                that.collapse(row);\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleHome: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var prev;\n\n            if (ctrl) {\n                if (this.lockedTable) {\n                    prev = this.lockedTable.find(NAVROW + \" > td:visible\").first();\n                } else {\n                    prev = this.table.find(NAVROW + \" > td:visible\").first();\n                }\n            } else if (isInBody || isInLockedTable) {\n                if (isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                prev = row.children(NAVCELL).first();\n            }\n\n            if (prev && prev.length) {\n                this.current(prev);\n                return true;\n            }\n        },\n\n        _handleEnd: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var next;\n\n            if (ctrl) {\n                next = this.table.find(ITEMROW).last().children(NAVCELL).last();\n            } else if (isInBody || isInLockedTable) {\n                if (!isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                next = row.children(NAVCELL).last();\n            }\n\n            if (next && next.length) {\n                this.current(next);\n                return true;\n            }\n        },\n\n        _handlePageDown: function() {\n            var that = this;\n\n            if (!that._isPageable()) {\n                return false;\n            }\n\n            that.dataSource._restorePageSizeAfterAddChild();\n            that.dataSource.page(that.dataSource.page() + 1);\n\n            return true;\n        },\n\n        _handlePageUp: function() {\n            var that = this;\n\n            if (!that._isPageable()) {\n                return false;\n            }\n\n            that.dataSource._restorePageSizeAfterAddChild();\n            that.dataSource.page(that.dataSource.page() - 1);\n\n            return true;\n        },\n\n        _handleEscKey: function(current, currentTable) {\n            var active = kendo._activeElement();\n            var currentIndex;\n            var that = this;\n            var row;\n            var rowIndex;\n            var cellIndex;\n            var tbody;\n\n            if (!current || !current.parent().hasClass(\"k-grid-edit-row\")) {\n                if (current.has(active).length) {\n                    // return focus back to the table\n                    focusTable(currentTable, true);\n\n                    return true;\n                }\n                return false;\n            }\n\n            if (that._isIncellEditable()) {\n                row = current.parent();\n                cellIndex = current.index();\n                rowIndex = row.index();\n                tbody = row.closest(\"tbody\");\n\n                that.closeCell(true);\n\n                // refresh the current element as the DOM element reference can be changed after render()\n                // moving this to closeCell() causes flickering when clicking on a cell and then on another\n                // as 'k-state-focused' is shown for the closing cell and then added to the newly edited cell\n                that._setCurrent(tbody.children().eq(rowIndex).children().eq(cellIndex));\n            } else {\n                currentIndex = $(current).parent().index();\n                if (active) {\n                    active.blur();\n                }\n                this.cancelRow();\n                if (currentIndex >= 0) {\n                    this.current(this.items().eq(currentIndex).children(NAVCELL).first());\n                }\n            }\n\n            focusTable(currentTable, true);\n\n            return true;\n        },\n\n        _handleEnterKey: function(current, currentTable, target) {\n            var editable = this.options.editable;\n            var container = target.closest(\"[role=gridcell]\");\n            var focusable;\n\n            if (!target.is(\"table\") && !$.contains(current[0], target[0])) {\n                current = container;\n            }\n\n            if (current.is(\"th\")) {\n                // sort the column, if possible\n                current.find(\".k-link\").click();\n                return true;\n            }\n\n            focusable = current.find(\":kendoFocusable\").first();\n            if (focusable[0] && current.hasClass(\"k-state-focused\")) {\n                focusable.trigger(\"focus\");\n\n                return true;\n            }\n\n            if (editable && !target.is(\":button,.k-button,textarea\")) {\n                if (!container[0]) {\n                    container = current;\n                }\n\n                this._handleEditing(container, false, currentTable);\n\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleTabKey: function(current, currentTable, shiftKey) {\n            var that = this;\n            var incellEditing = that.options.editable && that._isIncellEditable();\n            var cell;\n\n            if (!incellEditing || current.is(\"th\")) {\n                return false;\n            }\n\n            cell = $(activeElement()).closest(DOT + classNames.editCell);\n\n            if (cell[0] && cell[0] !== current[0]) {\n                current = cell;\n            }\n\n            cell = that._tabNext(current, currentTable, shiftKey);\n\n            if (cell.length) {\n                that._handleEditing(current, cell, cell.closest(TABLE));\n                return true;\n            } else {\n                that._preventPageSizeRestore = false;\n            }\n\n            return false;\n        },\n\n        _tabNext: function (current, currentTable, back) {\n            var that = this;\n            var switchRow = true;\n            var next = back ? current.prevAll(DATA_CELL).first() : current.nextAll(\":visible\").first();\n\n            if (!next.length) {\n                next = current.parent();\n                if (that.lockedTable) {\n                    switchRow = (back && currentTable == that.lockedTable[0]) || (!back && currentTable == that.table[0]);\n                    next = that._relatedRow(next);\n                }\n\n                if (switchRow) {\n                    next = next[back ? \"prevAll\" : \"nextAll\"](\"tr:not(.k-grouping-row):not(.k-detail-row):visible\").first();\n                }\n\n                if(back) {\n                    next = next.children(DATA_CELL).last();\n                } else {\n                    next = next.children(DATA_CELL).first();\n                }\n\n\n                that.dataSource._restorePageSizeAfterAddChild();\n            }\n\n            return next;\n        },\n\n        _handleEditing: function(current, next, table) {\n            var that = this,\n                active = $(kendo._activeElement()),\n                isIE = browser.msie,\n                editContainer,\n                focusable,\n                isEdited;\n            var editable = that.options.editable && that.options.editable.update !== false;\n            var incellEditing = that._isIncellEditable();\n            var nextFocusableCellRowIndex = $(next).parents(\"tr\").index();\n            var nextFocusableCellIndex = $(next).index();\n            var currentFocusedCellRowIndex = $(current).parents(\"tr\").index();\n            var currentFocusedCellIndex = current.index();\n            var editedCell;\n\n            table = $(table);\n\n            if (incellEditing) {\n                isEdited = current.hasClass(classNames.editCell);\n            } else {\n                isEdited = current.parent().hasClass(\"k-grid-edit-row\");\n            }\n\n            if (that.editor) {\n                editContainer = that.editor.wrapper;\n                if (editContainer && $.contains(editContainer[0], active[0])) {\n                    if (browser.opera) {\n                        active.trigger(\"blur\").change().triggerHandler(\"blur\");\n                    } else {\n                        active.trigger(\"blur\");\n                        if (isIE) {\n                            //IE10 with jQuery 1.9.x does not trigger blur handler\n                            //numeric textbox does trigger change\n                            active.trigger(\"blur\");\n                        }\n                    }\n                }\n\n                if (!that.editor) {\n                    focusTable(table);\n                    return;\n                }\n\n                if (that.editor.end()) {\n                    if (incellEditing) {\n                        that._preventPageSizeRestore = true;\n                        that.closeCell();\n                        that._preventPageSizeRestore = false;\n\n                        if ($(that.table).add(that.lockedTable).find(DOT + classNames.editCell).length === 0) {\n                            that.current(table.find(\"tbody\").children().eq(currentFocusedCellRowIndex).children().eq(currentFocusedCellIndex));\n                        }\n                    } else {\n                        that.saveRow();\n                        isEdited = true;\n                    }\n                } else {\n                    if (incellEditing) {\n                        that.current(editContainer);\n                    } else {\n                        that.current(editContainer.children().filter(NAVCELL).first());\n                    }\n\n                    focusable = editContainer.find(\":kendoFocusable\").first()[0];\n                    if (focusable) {\n                        focusable.focus();\n                    }\n                    return;\n                }\n            }\n\n            // the next cell to focus might be re-rendered, so update the reference to it if it is an element\n            next = $(next).length && table.find(next).length === 0 ? table.find(\"tbody\").children().eq(nextFocusableCellRowIndex).children().eq(nextFocusableCellIndex) : next;\n\n            if (next) {\n                that.current(next);\n            }\n\n            focusTable(table, true);\n\n            if (!editable) {\n                return;\n            }\n\n            if ((!isEdited && !next) || next) {\n                var currentIndex = that.current().index();\n\n                if (incellEditing) {\n                    that.editCell(that.current());\n\n                    editedCell = $(that.table).add(that.lockedTable).find(DOT + classNames.editCell)[0];\n\n                    if (editedCell) {\n                        that._current = $(editedCell);\n                    } else {\n                        that.current(that._findCurrentCell());\n                    }\n                } else {\n                    that.editRow(that.current().parent());\n                    that.current(that.editor.wrapper.children().eq(currentIndex));\n                    that.current().removeClass(\"k-state-focused\");\n                }\n            } else {\n                that.dataSource._restorePageSizeAfterAddChild();\n            }\n        },\n\n        _moveRight: function(current) {\n            var next = current.nextAll(NAVCELL).first();\n            var row = current.parent();\n            var rowIndex = row.index();\n\n            if (current.hasClass(\"k-header\") || row.is('.k-filter-row')) {\n                next = current.nextAll(NAVHEADER).first();\n                if(!next[0] && this.lockedTable && current.closest(\"table\")[0] === this.lockedHeader.find(\"table\")[0]) {\n                    next = this.thead.find(\"tr\").eq(rowIndex).find(NAVHEADER).first();\n                }\n            }\n\n            if (!next[0] && this.lockedTable && current.closest(\"table\")[0] === this.lockedTable[0]) {\n               next = this._relatedRow(row).children(NAVCELL).first();\n            }\n\n            if (next[0] && next[0] !== current[0]) {\n                focusTable(next.closest(\"table\"), true);\n            }\n\n            this.current(next);\n\n            return true;\n        },\n\n        _moveLeft: function(current) {\n            var prev = current.prevAll(NAVCELL).first();\n            var row = current.parent();\n            var rowIndex = row.index();\n\n            if (current.hasClass(\"k-header\") || row.is('.k-filter-row')) {\n                prev = current.prevAll(NAVHEADER).first();\n                if(!prev[0] && this.lockedTable && current.closest(\"table\")[0] === this.thead.parent()[0]) {\n                    prev = this.lockedHeader.find(\">table>thead>tr\").eq(rowIndex).children(NAVHEADER).last();\n                }\n            }\n\n            if (!prev[0] && this.lockedTable && current.closest(\"table\")[0] === this.table[0]) {\n               prev = this._relatedRow(row).children(NAVCELL).last();\n            }\n\n            if (prev[0] && prev[0] !== current[0]) {\n                focusTable(prev.closest(\"table\"), true);\n            }\n\n            this.current(prev);\n\n            return true;\n        },\n\n        _moveUp: function(current, shiftKey) {\n            var container = current.parent().parent();\n            var prev;\n\n            if (shiftKey) {\n               prev = current.parent();\n               prev = prev.prevAll(ITEMROW).first();\n               prev = current.parent().is(ITEMROW) ? prev.children().eq(current.index()) : prev.children(DATA_CELL).last();\n            } else {\n               prev = this._prevVerticalCell(container, current);\n               if (!prev[0]) {\n                  this._lastCellIndex = 0;\n                  container = this._verticalContainer(container, true);\n\n                  prev = this._prevVerticalCell(container, current);\n\n                  if (prev[0]) {\n                      focusTable(container.parent(), true);\n                  }\n               }\n            }\n\n            var tmp = this._lastCellIndex || 0;\n            this.current(prev);\n            this._lastCellIndex = tmp;\n\n            return true;\n        },\n\n        _moveDown: function(current, shiftKey) {\n            var container = current.parent().parent();\n            var next;\n\n            if (shiftKey) {\n                next = current.parent();\n                next = next.nextAll(ITEMROW).first();\n                next = current.parent().is(ITEMROW)? next.children().eq(current.index()) : next.children(DATA_CELL).first();\n            } else {\n                next = this._nextVerticalCell(container, current);\n                if (!next[0]) {\n                    this._lastCellIndex = 0;\n                    container = this._verticalContainer(container);\n\n                    next = this._nextVerticalCell(container, current);\n                    if (next[0]) {\n                        focusTable(container.parent(), true);\n                    }\n                }\n            }\n            var tmp = this._lastCellIndex || 0;\n            this.current(next);\n            this._lastCellIndex = tmp;\n            return true;\n        },\n\n        _tableClick: function(e) {\n            var currentTarget = $(e.currentTarget),\n                isHeader = currentTarget.is(\"th\"),\n                table = this.table.add(this.lockedTable),\n                headerTable = this.thead.parent().add($(\">table\", this.lockedHeader)),\n                isInput = isInputElement(e.target),\n                currentTable = currentTarget.closest(\"table\")[0];\n\n            if (kendo.support.touch) {\n                return;\n            }\n\n            if (currentTable !== table[0] && currentTable !== table[1] && currentTable !== headerTable[0] && currentTable !== headerTable[1]) {\n                return;\n            }\n\n            if (this.options.navigatable) {\n                this.current(currentTarget);\n            }\n\n            if (isHeader || !isInput) {\n                setTimeout(function() {\n                   if (!isInputElement(kendo._activeElement()) || !$.contains(currentTable, kendo._activeElement())) {\n                       focusTable(currentTable, true);\n                   }\n                });\n            }\n\n            if (isHeader) {\n                e.preventDefault(); //if any problem occurs, call preventDefault only for the clicked header links\n            }\n        },\n\n        _setTabIndex: function(table) {\n            this._navigatableTables.attr(TABINDEX, -1);\n\n            table.attr(TABINDEX, 0);\n        },\n\n        _tableFocus: function(e) {\n            var current = this.current();\n            var table = $(e.currentTarget);\n\n            if (current && current.is(\":visible\")) {\n                current.addClass(classNames.focused);\n            } else {\n                this.current(table.find(NAVROW + \" > td:visible\").first());\n            }\n\n            this._setTabIndex(table);\n        },\n\n        _tableBlur: function() {\n            var current = this.current();\n\n            if (current) {\n                current.removeClass(classNames.focused);\n            }\n        },\n\n        _attachEvents: function() {\n            var that = this;\n            var retryButton = DOT + classNames.retry;\n\n            that._userEvents = new kendo.UserEvents(that.element, {\n                press: proxy(that._onPress, that),\n                allowSelection: true\n            });\n\n            this.element\n                .on(CLICK + NS, retryButton, this._dataSourceFetchProxy)\n                .on(CLICK + NS, \".k-button[data-command]\", proxy(this._commandClick, this))\n                .on(INPUT + NS, \".k-grid-search input\", proxy(this._search, this));\n\n            this._attachCellEditingEventHandlers();\n        },\n\n        _onPress: function (e) {\n            var that = this;\n            var icons = DOT + classNames.iconCollapse +\n                \", .\" + classNames.iconExpand +\n                \", .\" + classNames.refresh;\n\n            if ($(e.event.target).is(icons)) {\n                that._toggleChildren.call(that, e.event);\n            }\n        },\n\n        _attachCellEditingEventHandlers: function() {\n            var that = this;\n            var editable = that.options.editable;\n            var selectable = that.selectable && that.selectable.options.multiple;\n            var closeCell = function(e) {\n                var target = activeElement();\n                var editor = that.editor || {};\n                var cell = editor.element;\n\n                if (cell && !$.contains(cell[0], target) && cell[0] !== target && !$(target).closest(\".k-animation-container\").length) {\n                    if (editor.end()) {\n                        if (!e.relatedTarget && that._isPageable() && !isUndefined(that.dataSource._addChildPageSize)) {\n                            that._preventPageSizeRestore = false;\n                        }\n\n                        that.closeCell();\n                    }\n                }\n\n                that._preventPageSizeRestore = false;\n            };\n\n            if (that._isIncellEditable() && editable.update !== false) {\n                that.wrapper\n                    .on(CLICK + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                        var td = $(this),\n                            isLockedCell = that.lockedTable && td.closest(\"table\")[0] === that.lockedTable[0];\n\n                        if (td.hasClass(classNames.editCell) ||\n                            td.has(\"a.k-grid-delete\").length ||\n                            td.has(\"button.k-grid-delete\").length ||\n                            (td.closest(\"tbody\")[0] !== that.tbody[0] && !isLockedCell) ||\n                            $(e.target).is(\":input\") ||\n                            $(e.target).hasClass(classNames.iconExpand) ||\n                            $(e.target).hasClass(classNames.iconCollapse)) {\n\n                            if (!that.editor) {\n                                that.dataSource._restorePageSizeAfterAddChild();\n                            }\n\n                            that._preventPageSizeRestore = false;\n\n                            return;\n                        }\n\n                        if (that.editor) {\n                            if (that.editor.end()) {\n                                if (selectable) {\n                                    $(activeElement()).trigger(\"blur\");\n                                }\n                                that.closeCell();\n                                that.editCell(td);\n                            }\n                        } else {\n                            that.editCell(td);\n                        }\n                    })\n                    .on(\"mousedown\" + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                        // cache the result on \"mousedown\", which is fired before \"focusout\" and \"click\"\n                        if (that.editor && that._isPageable() && !isUndefined(that.dataSource._addChildPageSize)) {\n                            that._preventPageSizeRestore = $(e.target).parents(DOT + classNames.editRow).length > 0;\n                        } else {\n                            that._preventPageSizeRestore = false;\n                        }\n                    })\n                    .on(\"focusin\" + NS, function() {\n                        // fix focus issue in IE\n                        if (!$.contains(this, activeElement())) {\n                            clearTimeout(that._closeCellTimeout);\n                            that._closeCellTimeout = null;\n                        }\n                    })\n                    .on(\"focusout\" + NS, function(e) {\n                        that._closeCellTimeout = setTimeout(function() {\n                            closeCell(e);\n                        }, 1);\n                    });\n            }\n        },\n\n        _commandByName: function(name) {\n            var columns = this.columns;\n            var toolbar = Array.isArray(this.options.toolbar) ? this.options.toolbar : [];\n            var i, j, commands, currentName;\n\n            name = name.toLowerCase();\n\n            if (defaultCommands[name]) {\n                return defaultCommands[name];\n            }\n\n            // command not found in defaultCommands, must be custom\n            for (i = 0; i < columns.length; i++) {\n                commands = columns[i].command;\n                if (commands) {\n                    for (j = 0; j < commands.length; j++) {\n                        currentName = commands[j].name;\n\n                        if (!currentName) {\n                            continue;\n                        }\n\n                        if (currentName.toLowerCase() == name) {\n                            return commands[j];\n                        }\n                    }\n                }\n            }\n\n            // custom command in toolbar\n            for (i = 0; i < toolbar.length; i++) {\n                currentName = toolbar[i].name;\n\n                if (!currentName) {\n                    continue;\n                }\n\n                if (currentName.toLowerCase() == name) {\n                    return toolbar[i];\n                }\n            }\n        },\n\n        _commandClick: function(e) {\n            var button = $(e.currentTarget);\n            var commandName = button.attr(\"data-command\");\n            var command = this._commandByName(commandName);\n            var row = button.parentsUntil(this.wrapper, \"tr\");\n\n            row = row.length ? row : undefined;\n\n            if (command) {\n                if (command.methodName) {\n                    this[command.methodName](row);\n                } else if (command.click) {\n                    command.click.call(this, e);\n                }\n\n                e.preventDefault();\n            }\n        },\n\n        _search: function(e) {\n            var that = this;\n            var input = e.currentTarget;\n            clearTimeout(that._searchTimeOut);\n            that._searchTimeOut = setTimeout(function () {\n                that._searchTimeOut = null;\n                var options = that.options;\n                var searchFields = options.search ? options.search.fields : null;\n                var expression = { filters:[], logic:\"or\" };\n                var value = input.value;\n\n                if (!searchFields) {\n                    searchFields = getColumnsFields(options.columns);\n                }\n\n                if (value) {\n                    for (var i = 0; i < searchFields.length; i++) {\n                        expression.filters.push({ field: searchFields[i], operator: \"contains\", value: value });\n                    }\n                } else {\n                    expression = {};\n                }\n\n                that.dataSource.filter(expression);\n\n            }, 300);\n        },\n\n        _ensureExpandableColumn: function() {\n            if (this._autoExpandable) {\n                delete this._autoExpandable.expandable;\n            }\n\n            var visibleColumns = grep(this.columns, not(is(\"hidden\")));\n            visibleColumns = grep(visibleColumns, not(is(\"command\")));\n            visibleColumns = grep(visibleColumns, not(is(\"selectable\")));\n            var expandableColumns = grep(visibleColumns, is(\"expandable\"));\n\n            if (this.columns.length && !expandableColumns.length) {\n                this._autoExpandable = visibleColumns[0];\n                visibleColumns[0].expandable = true;\n            }\n        },\n\n        _columns: function() {\n            var that = this;\n            var columns = this.options.columns || [];\n\n            this.columns = map(columns, function(column) {\n                column = (typeof column === \"string\") ? { field: column } : column;\n\n                return extend({ encoded: true }, column);\n            });\n\n            var lockedCols = lockedColumns(columns);\n            if (lockedCols.length > 0) {\n                if (this.options.rowTemplate || this.options.altRowTemplate) {\n                    throw new Error(\"Having both row template and locked columns is not supported\");\n                }\n                this._hasLockedColumns = true;\n                this.columns = lockedCols.concat(nonLockedColumns(this.columns));\n            }\n\n            this.columns = normalizeColumns(this.columns);\n\n            this._ensureExpandableColumn();\n\n            this._columnTemplates();\n            this._columnAttributes();\n\n            if ($.grep(leafColumns(that.columns), function (col) {\n                if (col.selectable) {\n                    that._includeChildren = col.includeChildren;\n                }\n                return col.selectable;\n            }).length) {\n                that._checkBoxSelection = true;\n                that.element.on(CLICK + NS, \"tbody > tr \" + CHECKBOXINPUT, proxy(that._checkboxClick, that));\n                that.element.on(CLICK + NS, \"thead > tr \" + CHECKBOXINPUT, proxy(that._headerCheckboxClick, that));\n            }\n        },\n\n        _columnTemplates: function() {\n            var idx, length, column;\n            var columns = leafColumns(this.columns);\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n                if (column.template) {\n                    column.template = kendo.template(column.template);\n                }\n\n                if (this._isIncellEditable()) {\n                    column.dirtyCellTemplate = this._createDirtyColumnTemplate(column);\n                    column.dirtyIndicatorTemplate = this._createIndicatorTemplate(column);\n                }\n\n                if (column.headerTemplate) {\n                    column.headerTemplate = kendo.template(column.headerTemplate);\n                }\n\n                if (column.footerTemplate) {\n                    column.footerTemplate = kendo.template(column.footerTemplate);\n                }\n            }\n        },\n\n        _columnAttributes: function() {\n            // column style attribute is string, kendo.dom expects object\n            var idx, length;\n            var columns = this.columns;\n\n            function convertStyle(attr) {\n                var properties, i, declaration;\n\n                if (attr && attr.style && attr.style.split) {\n                    properties = attr.style.split(\";\");\n                    attr.style = {};\n\n                    for (i = 0; i < properties.length; i++) {\n                        declaration = properties[i].split(\":\");\n\n                        var name = kendo.trim(declaration[0]);\n\n                        if (name) {\n                            attr.style[$.camelCase(name)] = kendo.trim(declaration[1]);\n                        }\n                    }\n                }\n            }\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                convertStyle(columns[idx].attributes);\n                convertStyle(columns[idx].headerAttributes);\n            }\n        },\n\n        _clearSortClasses: function () {\n            var that = this;\n\n            if (that.content) {\n                that.content.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").removeClass(\"k-sorted\");\n            }\n\n            if (that.lockedContent) {\n                that.lockedContent.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").removeClass(\"k-sorted\");\n            }\n        },\n\n        _layout: function () {\n            var columns = this.columns;\n            var element = this.element;\n            var layout = \"\";\n\n            this.wrapper = element.addClass(classNames.wrapper);\n\n            layout = \"<div class='#= gridHeader #'>\";\n\n            if (this._hasLockedColumns) {\n                layout += \"<div class='k-grid-header-locked'>\" +\n                                \"<table role='grid'>\" +\n                                    \"<colgroup></colgroup>\"+\n                                    \"<thead role='rowgroup'></thead>\" +\n                                \"</table>\" +\n                            \"</div>\";\n            }\n\n            layout += \"<div class='#= gridHeaderWrap #'>\" +\n                            \"<table role='grid'>\" +\n                                \"<colgroup></colgroup>\"+\n                                \"<thead role='rowgroup'></thead>\" +\n                            \"</table>\" +\n                        \"</div>\"+\n                        \"</div>\";\n\n            if (this._hasLockedColumns) {\n                layout += \"<div class='k-grid-content-locked'>\" +\n                                \"<table role='treegrid' tabindex='0'>\" +\n                                    \"<colgroup></colgroup>\"+\n                                    \"<tbody></tbody>\" +\n                                \"</table>\" +\n                            \"</div>\";\n            }\n\n            layout += \"<div class='#= gridContentWrap # k-auto-scrollable'>\" +\n                            \"<table role='treegrid' tabindex='0'>\" +\n                                \"<colgroup></colgroup>\"+\n                                \"<tbody></tbody>\" +\n                            \"</table>\" +\n                        \"</div>\";\n\n            if (!this.options.scrollable) {\n                layout =\n                    \"<table role='treegrid' tabindex='0'>\" +\n                        \"<colgroup></colgroup>\"+\n                        \"<thead class='#= gridHeader #' role='rowgroup'></thead>\" +\n                        \"<tbody></tbody>\" +\n                    \"</table>\";\n            }\n\n            if (this.options.toolbar) {\n                layout = \"<div class='#= toolbar # #= gridToolbar #'></div>\" + layout;\n            }\n\n            element.append(\n                kendo.template(layout)(classNames) +\n                \"<div class='k-status' role='alert' aria-live='polite'></div>\"\n            );\n\n            this.toolbar = element.find(DOT + classNames.gridToolbar);\n\n            var header = element.find(DOT + classNames.gridHeader).find(\"thead\").addBack().filter(\"thead\");\n            this.thead = header.last();\n\n            if (this.options.scrollable) {\n                var rtl = kendo.support.isRtl(element);\n\n                element.find(\"div.\" + classNames.gridHeader)\n                    .css(rtl ? \"padding-left\" : \"padding-right\", kendo.support.scrollbar());\n            }\n\n\n            var content = element.find(DOT + classNames.gridContentWrap);\n            if (!content.length) {\n                content = element;\n            } else {\n                this.content = content;\n            }\n\n            this.table = content.find(\">table\");\n            this.tbody = this.table.find(\">tbody\");\n\n            if (this._hasLockedColumns) {\n                this.lockedHeader = header.first().closest(\".k-grid-header-locked\");\n                this.lockedContent = element.find(\".k-grid-content-locked\");\n                this.lockedTable = this.lockedContent.children();\n            }\n\n            this._initVirtualTrees();\n\n            this._renderCols();\n            this._renderHeader();\n\n            this.angular(\"compile\", function() {\n                return {\n                    elements: header.find(\"th.k-header\").get(),\n                    data: map(columns, function(col) { return { column: col }; })\n                };\n            });\n        },\n\n        _initVirtualTrees: function() {\n            this._headerColsTree = new kendoDom.Tree(this.thead.prev()[0]);\n            this._contentColsTree = new kendoDom.Tree(this.tbody.prev()[0]);\n            this._headerTree = new kendoDom.Tree(this.thead[0]);\n            this._contentTree = new kendoDom.Tree(this.tbody[0]);\n            this._statusTree = new kendoDom.Tree(this.element.children(\".k-status\")[0]);\n\n            if (this.lockedHeader){\n                this._lockedHeaderColsTree = new kendoDom.Tree(this.lockedHeader.find(\"colgroup\")[0]);\n                this._lockedContentColsTree = new kendoDom.Tree(this.lockedTable.find(\">colgroup\")[0]);\n                this._lockedHeaderTree = new kendoDom.Tree(this.lockedHeader.find(\"thead\")[0]);\n                this._lockedContentTree = new kendoDom.Tree(this.lockedTable.find(\">tbody\")[0]);\n            }\n        },\n\n        _toolbar: function() {\n            var options = this.options.toolbar;\n            var toolbar = this.toolbar;\n\n            if (!options) {\n                return;\n            }\n\n            if (Array.isArray(options)) {\n                var buttons = this._buildCommands(options);\n                new kendoDom.Tree(toolbar[0]).render(buttons);\n            } else {\n                toolbar.append(kendo.template(options)({}));\n            }\n\n            this.angular(\"compile\", function() {\n                return { elements: toolbar.get() };\n            });\n        },\n\n        _lockedColumns: function() {\n            return grep(this.columns, is(\"locked\"));\n        },\n\n        _nonLockedColumns: function() {\n            return grep(this.columns, not(is(\"locked\")));\n        },\n\n        _templateColumns: function() {\n            return grep(this.columns, is(\"template\"));\n        },\n\n        _flushCache: function() {\n            if (this.options.$angular && this._templateColumns().length) {\n                this._contentTree.render([]);\n                if (this._hasLockedColumns) {\n                    this._lockedContentTree.render([]);\n                }\n            }\n        },\n\n        _render: function(options) {\n            var that = this;\n            options = options || {};\n            options = that._renderOptions(options);\n            var messages = this.options.messages;\n            var pageable = that._isPageable();\n            var dataSource = that.dataSource;\n\n            var maps = { children: (options.filteredChildrenMap || options.childrenMap), ids: options.idsMap };\n            var dataMaps = pageable ? (maps && maps.children && maps.ids ? maps : dataSource._initDataMaps(dataSource._getData())) : {};\n            var childrenMap = dataMaps.children;\n            var idsMap = dataMaps.ids;\n            options.childrenMap = childrenMap;\n            options.idsMap = idsMap;\n\n            var data = that._dataToRender(options);\n            var level = that._renderedModelLevel(data[0], options);\n            var uidAttr = kendo.attr(\"uid\");\n            var hasFooterTemplate;\n            var selected = this.select().removeClass(\"k-state-selected\").map(function(_, row) {\n                return $(row).attr(uidAttr);\n            });\n            var viewChildrenMap;\n\n            this._absoluteIndex = 0;\n\n            this._angularItems(\"cleanup\");\n            this._angularFooters(\"cleanup\");\n            this._flushCache();\n\n            that._clearRenderMap();\n\n            if (options.error) {\n                // root-level error message\n                this._showStatus(kendo.template(\n                    \"#: messages.requestFailed # \" +\n                    \"<button class='#= buttonClass # k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>#: messages.retry #</span></button>\"\n                )({\n                    buttonClass: [classNames.button, classNames.retry].join(\" \"),\n                    messages: messages\n                }));\n            } else if (!data.length) {\n                // no rows message\n                this._hideStatus();\n                this._showNoRecordsTemplate();\n            } else {\n                if (pageable) {\n                    viewChildrenMap = that._viewChildrenMap(options);\n                }\n\n                // render rows\n                this._hideStatus();\n\n                hasFooterTemplate = this._hasFooterTemplate();\n\n                this._contentTree.render(this._trs({\n                    columns: leafColumns(nonLockedColumns(this.columns)),\n                    editedColumn: options.editedColumn,\n                    editedColumnIndex: options.editedColumnIndex,\n                    aggregates: options.aggregates,\n                    selected: selected,\n                    data: data,\n                    childrenMap: childrenMap,\n                    viewChildrenMap: viewChildrenMap,\n                    hasFooterTemplate: hasFooterTemplate,\n                    visible: true,\n                    level: 0\n                }));\n\n                if (this._hasLockedColumns) {\n                    this._absoluteIndex = 0;\n                    this._lockedContentTree.render(this._trs({\n                        columns: leafColumns(lockedColumns(this.columns)),\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        aggregates: options.aggregates,\n                        selected: selected,\n                        data: data,\n                        childrenMap: childrenMap,\n                        viewChildrenMap: viewChildrenMap,\n                        hasFooterTemplate: hasFooterTemplate,\n                        visible: true,\n                        level: level\n                    }));\n                }\n            }\n\n            if (this._touchScroller) {\n                this._touchScroller.contentResized();\n            }\n\n            this._muteAngularRebind(function() {\n                this._angularItems(\"compile\");\n                this._angularFooters(\"compile\");\n            });\n\n            this.items().filter(function() {\n                return $.inArray($(this).attr(uidAttr), selected) >= 0;\n            })\n            .addClass(\"k-state-selected\");\n\n            this._syncLockedContentHeight();\n\n            that._togglePagerVisibility();\n\n            that._setExpanderElement();\n        },\n\n        _setExpanderElement: function() {\n            var that = this,\n                hiddenDivClass = 'k-grid-content-expander',\n                hiddenDiv = '<div class=\"' + hiddenDivClass + '\"></div>',\n                expander;\n\n            if (that.options.scrollable && that.wrapper.is(\":visible\")) {\n                expander = that.table.parent().children('.' + hiddenDivClass);\n                if (!that.dataSource || !that.dataSource.view().length) {\n                    if (!expander[0]) {\n                        expander = $(hiddenDiv).appendTo(that.table.parent());\n                    }\n                    if (that.thead) {\n                        expander.width(that.thead.width());\n                    }\n                } else if (expander[0]) {\n                    expander.remove();\n                }\n            }\n        },\n\n        _renderProgress: function(toggle) {\n            kendo.ui.progress(this.wrapper, toggle);\n        },\n\n        _renderOptions: function(options) {\n            options = options || {};\n            var that = this;\n            var dataMaps = that.dataSource._getDataMaps();\n            var filter = that.dataSource.filter();\n\n            if (that._isPageable()) {\n                options.childrenMap = dataMaps.children;\n                options.idsMap = dataMaps.ids;\n\n                if (filter) {\n                    options.filteredChildrenMap = dataMaps.filteredChildren;\n                }\n            }\n\n            return options;\n        },\n\n        _renderedModelLevel: function(model, options) {\n            return !this._isPageable() ? 0 : this.dataSource._pageableModelLevel(model, options);\n        },\n\n        _viewChildrenMap: function(options) {\n            options = options || {};\n            var that = this;\n            var dataSource = that.dataSource;\n            var viewChildrenMap = dataSource.childrenMap(dataSource.view());\n            var idField = dataSource._modelIdField();\n            var parentsNotInView = dataSource._parentNodesNotInView();\n            var parentNotInView;\n            var parentNotInViewId;\n            var parents;\n            var parent;\n            var parentId;\n            var child;\n            var childId;\n            var parentsCopy;\n\n            that._clearRenderMap();\n\n            for (var i = 0; i < parentsNotInView.length; i++) {\n                parentNotInView = parentsNotInView[i];\n                parentNotInViewId = parentNotInView[idField];\n\n                that._markNodeAsNonRenderable(parentNotInViewId);\n\n                viewChildrenMap[parentNotInViewId] = viewChildrenMap[parentNotInViewId] || [];\n\n                parents = dataSource._parentNodes(parentNotInView);\n\n                // copy the items to avoid mutating the original collection\n                parentsCopy = parents.slice();\n                parentsCopy.push(parentNotInView);\n\n                for (var parentIndex = 0; parentIndex < parentsCopy.length - 1; parentIndex++) {\n                    parent = parentsCopy[parentIndex];\n                    parentId = parent[idField];\n                    that._markNodeAsNonRenderable(parentId);\n                    viewChildrenMap[parentId] = viewChildrenMap[parentId] || [];\n\n                    child = parentsCopy[parentIndex + 1];\n                    childId = child[idField];\n                    that._markNodeAsNonRenderable(childId);\n                    viewChildrenMap[childId] = viewChildrenMap[childId] || [];\n\n                    if (viewChildrenMap[parentId].indexOf(child) === -1) {\n                        viewChildrenMap[parentId].unshift(child);\n                    }\n                }\n            }\n\n            return viewChildrenMap;\n        },\n\n        _clearRenderMap: function() {\n            this._skipRenderingMap = {};\n        },\n\n        _dataToRender: function(options) {\n            var that = this;\n\n            if (that._isPageable()) {\n                return that.dataSource._pageableRootNodes(options);\n            }\n\n            return that.dataSource.rootNodes();\n        },\n\n        _markNodeAsNonRenderable: function(nodeId) {\n            this._skipRenderingMap[nodeId] = true;\n        },\n\n        _adjustRowsHeight: function(table1, table2) {\n            if (!this._hasLockedColumns) {\n                return;\n            }\n\n            var rows = table1[0].rows;\n            var length = rows.length;\n            var idx;\n            var rows2 = table2[0].rows;\n            var containers = table1.add(table2);\n            var containersLength = containers.length;\n            var heights = [];\n\n            for (idx = 0; idx < length; idx++) {\n                if (!rows2[idx]) {\n                    break;\n                }\n\n                if (rows[idx].style.height) {\n                    rows[idx].style.height = rows2[idx].style.height = \"\";\n                }\n            }\n\n            for (idx = 0; idx < length; idx++) {\n                if (!rows2[idx]) {\n                    break;\n                }\n\n                var offsetHeight1 = rows[idx].offsetHeight;\n                var offsetHeight2 = rows2[idx].offsetHeight;\n                var height = 0;\n\n                if (offsetHeight1 > offsetHeight2) {\n                    height = offsetHeight1;\n                } else if (offsetHeight1 < offsetHeight2) {\n                    height = offsetHeight2;\n                }\n\n                heights.push(height);\n            }\n\n            for (idx = 0; idx < containersLength; idx++) {\n                containers[idx].style.display = \"none\";\n            }\n\n            for (idx = 0; idx < length; idx++) {\n                if (heights[idx]) {\n                    //add one to resolve row misalignment in IE\n                    rows[idx].style.height = rows2[idx].style.height = (heights[idx] + 1) + \"px\";\n                }\n            }\n\n            for (idx = 0; idx < containersLength; idx++) {\n                containers[idx].style.display = \"\";\n            }\n        },\n\n        _ths: function(columns, rowSpan) {\n            var ths = [];\n            var column, title, children, cellClasses, attr, headerContent;\n            var index;\n            var leafs;\n\n            for (var i = 0, length = columns.length; i < length; i++) {\n                column = columns[i];\n                children = [];\n                cellClasses = [classNames.header];\n\n                if (column.selectable) {\n                    leafs = leafColumns(columns);\n                    index = inArray(column, leafs);\n                    attr = {\n                        scope: \"col\",\n                        role: \"columnheader\",\n                        className: cellClasses.join(\" \")\n                    };\n\n                    if (column.headerTemplate) {\n                        title = column.headerTemplate({});\n                    }\n\n                    title = column.headerTemplate ? title: kendo.template(SELECTCOLUMNHEADERTMPL)({});\n\n\n                    if (rowSpan && !column.colSpan) {\n                        attr.rowSpan = rowSpan;\n                    }\n\n                    if (index > -1) {\n                        attr[kendo.attr(\"index\")] = index;\n                    }\n\n                    children.push(kendoHtmlElement(title));\n\n                    ths.push(kendoDomElement(\"th\", $.extend(true, {}, attr, column.headerAttributes), children));\n                    continue;\n                }\n\n                if (column.headerTemplate) {\n                    title = column.headerTemplate({});\n                } else {\n                    title = column.title || column.field || \"\";\n                }\n\n                if (column.headerTemplate) {\n                    headerContent = kendoHtmlElement(title);\n                } else {\n                    headerContent = kendoTextElement(title);\n                }\n\n                if (this.options.sortable) {\n                    children.push(kendoDomElement(\"span\", { className: classNames.headerCellInner }, [\n                        kendoDomElement(\"span\", { className: classNames.link }, [\n                            kendoDomElement(\"span\", { className: classNames.columnTitle }, [\n                                headerContent\n                            ])\n                        ])\n                    ]));\n                } else {\n                    children.push(headerContent);\n                }\n\n                attr = {\n                    \"data-field\": column.field,\n                    \"data-title\": column.title,\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {},\n                    className: cellClasses.join(\" \"),\n                    \"role\": \"columnheader\"\n                };\n\n                if (!column.columns) {\n                    attr.rowSpan = rowSpan ? rowSpan : 1;\n                }\n\n                if (column.headerAttributes) {\n                    if (column.headerAttributes.colSpan === 1) {\n                        delete column.headerAttributes.colSpan;\n                    }\n                    if (column.headerAttributes[\"class\"]) {\n                        attr.className += \" \" + column.headerAttributes[\"class\"];\n                        delete column.headerAttributes[\"class\"];\n                    }\n                }\n\n                if (column[\"data-index\"] > -1) {\n                    attr[\"data-index\"] = column[\"data-index\"];\n                }\n\n                attr = extend(true, {}, attr, column.headerAttributes);\n\n                ths.push(kendoDomElement(\"th\", attr, children));\n            }\n\n            return ths;\n        },\n\n        _cols: function(columns) {\n            var cols = [];\n            var width, attr;\n\n            for (var i = 0; i < columns.length; i++) {\n                if (columns[i].hidden === true) {\n                    continue;\n                }\n\n                width = columns[i].width;\n                attr = {};\n\n                if (width && parseInt(width, 10) !== 0) {\n                    attr.style = {\n                        width: typeof width === \"string\" ? width : width + \"px\"\n                    };\n                }\n\n                cols.push(kendoDomElement(\"col\", attr));\n            }\n\n            return cols;\n        },\n\n        _clearColsCache: function () {\n            this._headerColsTree.render([]);\n            if (this.options.scrollable) {\n                this._contentColsTree.render([]);\n            }\n            if (this._hasLockedColumns) {\n                this._lockedHeaderColsTree.render([]);\n                this._lockedContentColsTree.render([]);\n            }\n        },\n\n        _renderCols: function() {\n            var columns = nonLockedColumns(this.columns);\n            this._headerColsTree.render(this._cols(leafColumns(columns)));\n\n            if (this.options.scrollable) {\n                this._contentColsTree.render(this._cols(leafColumns(columns)));\n            }\n\n            if (this._hasLockedColumns) {\n                columns = lockedColumns(this.columns);\n                this._lockedHeaderColsTree.render(this._cols(leafColumns(columns)));\n                this._lockedContentColsTree.render(this._cols(leafColumns(columns)));\n            }\n        },\n\n        _retrieveFirstColumn: function(columns, rows) {\n            var result = $();\n\n            if (rows.length && columns[0]) {\n                var column = columns[0];\n\n                while(column.columns && column.columns.length) {\n                    column = column.columns[0];\n                    rows = rows.filter(\":not(:first)\");\n                }\n\n                result = result.add(rows);\n            }\n\n            return result;\n        },\n\n        _updateFirstColumnClass: function() {\n            var that = this;\n            var columns = that.columns || [];\n            var tr = that.thead.find(\">tr:not(:first, .k-filter-row)\");\n            var rows;\n\n            columns = nonLockedColumns(columns);\n\n            rows = that._retrieveFirstColumn(columns, tr);\n\n            if (that.lockedHeader) {\n                tr = that.lockedHeader.find(\"thead>tr:not(.k-filter-row):not(:first)\");\n                columns = lockedColumns(that.columns);\n\n                rows = rows.add(that._retrieveFirstColumn(columns, tr));\n            }\n\n            rows.each(function() {\n                var ths = $(this).find(\"th\");\n                ths.removeClass(\"k-first\");\n                ths.eq(0).addClass(\"k-first\");\n            });\n        },\n\n        _updateRowSpans: function(rows) {\n            for (var i = rows.length - 1; i >= 0; i--) {\n                var included = visibleChildColumns(rows[i].cells).length > 0;\n\n                if (included) {\n                    rows[i].rowSpan = rows.length - i;\n                }\n            }\n        },\n\n        _setColumnDataIndexes: function(columns) {\n            for (var i = 0; i < columns.length; i++) {\n               columns[i][\"data-index\"] = i;\n            }\n        },\n\n        _updateColumnCellIndex: function() {\n            var header;\n            var offset = 0;\n\n            if (this.lockedHeader) {\n                header = this.lockedHeader.find(\"thead\");\n                offset = updateCellIndex(header, lockedColumns(this.columns));\n            }\n            updateCellIndex(this.thead, nonLockedColumns(this.columns), offset);\n        },\n\n        _setParentsVisibility: function(column, visible) {\n            var columns = this.columns;\n            var idx;\n            var parents = [];\n            var parent;\n\n            var predicate = visible ?\n                function(p) { return visibleColumns(p.columns).length && p.hidden; } :\n                function(p) { return !visibleColumns(p.columns).length && !p.hidden; };\n\n\n            if (columnParents(column, columns, parents) && parents.length) {\n                for (idx = parents.length - 1; idx >= 0; idx--) {\n                    parent = parents[idx];\n\n                    if (predicate(parent)) {\n                        parent.hidden = !visible;\n                    }\n                }\n            }\n        },\n\n        _prepareColumns: function(rows, columns, parentCell, parentRow, parentColumn) {\n            var row = parentRow || rows[rows.length - 1];\n\n            var childRow = rows[row.index + 1];\n            var totalColSpan = 0;\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                var cell = $.extend({}, columns[idx],  { headerAttributes: columns[idx].headerAttributes || {} } );\n                row.cells.push(cell);\n\n                if (columns[idx].columns && columns[idx].columns.length) {\n                    if (!childRow) {\n                        childRow = { rowSpan: 0, cells: [], index: rows.length };\n                        rows.push(childRow);\n                    }\n                    if (columns[idx].columns.length) {\n                        cell.headerAttributes.colSpan = visibleChildColumns(columns[idx].columns).length || 1;\n                        cell.headerAttributes[\"data-colspan\"] = leafColumns(columns[idx].columns).length;\n                    }\n                    this._prepareColumns(rows, columns[idx].columns, cell, childRow, columns[idx]);\n                    if (!cell.hidden) {\n                        totalColSpan += cell.headerAttributes.colSpan - 1;\n                    }\n                    row.rowSpan = rows.length - row.index;\n                }\n                columns[idx].rowIndex = row.index;\n                if (parentColumn) {\n                    columns[idx].parentColumn = parentColumn;\n                }\n                columns[idx].cellIndex = row.cells.length - 1;\n            }\n            if (parentCell) {\n                parentCell.headerAttributes.colSpan += totalColSpan;\n            }\n        },\n\n        _renderHeaderTree: function(tree, columns, hasMultiColumnHeaders) {\n            var idx;\n            var rows = [];\n            var rowsToRender = [];\n            var filterThs = [];\n\n            if (hasMultiColumnHeaders) {\n                rows = [{ rowSpan: 1, cells: [], index: 0 }];\n                this._prepareColumns(rows, columns);\n                this._updateRowSpans(rows);\n                for (idx = 0; idx< rows.length; idx++) {\n                    rowsToRender.push(kendoDomElement(\"tr\", { \"role\": \"row\" }, this._ths(rows[idx].cells, rows[idx].rowSpan)));\n                }\n            } else {\n                rowsToRender.push(kendoDomElement(\"tr\", { \"role\": \"row\" }, this._ths(columns)));\n            }\n\n            if (this._hasFilterRow()) {\n                this._filterThs(columns, filterThs);\n                rowsToRender.push(kendoDomElement(\"tr\", {\"class\": \"k-filter-row\"}, filterThs));\n            }\n\n            tree.render(rowsToRender);\n        },\n\n        _renderHeader: function() {\n            var columns = nonLockedColumns(this.columns);\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n            this._setColumnDataIndexes(leafColumns(this.columns));\n            this._renderHeaderTree(this._headerTree, columns, hasMultiColumnHeaders);\n\n            if (this._hasLockedColumns) {\n                columns = lockedColumns(this.columns);\n                this._renderHeaderTree(this._lockedHeaderTree, columns, hasMultiColumnHeaders);\n\n                this._applyLockedContainersWidth();\n                this._syncLockedHeaderHeight();\n            }\n            this._updateFirstColumnClass();\n        },\n\n        _filterThs: function (columns, ths) {\n            var column;\n            var attr;\n            var uidAttr = kendo.attr('uid');\n\n            for (var i = 0, length = columns.length; i < length; i++) {\n                column = columns[i];\n\n                if (column.columns) {\n                    this._filterThs(column.columns, ths);\n                }\n\n                if (column.columns && column.columns.length) {\n                    continue;\n                }\n\n                attr = {\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n                };\n                attr[uidAttr] = column.headerAttributes.id;\n                ths.push(kendoDomElement(\"th\", attr));\n            }\n        },\n\n        _updateFilterThs: function (before, column, refColumn) {\n            var columns = leafColumns([column]);\n            var filterRowThs = $(this.lockedHeader).add(this.thead).find(\"tr.k-filter-row th\");\n            var refIndex;\n            var currIndex;\n            var uidAttr = kendo.attr('uid');\n\n            function thIndex(ths, uid) {\n                for (var i = 0; i < ths.length; i++) {\n                    if (ths.eq(i).attr(uidAttr) === uid) {\n                        return i;\n                    }\n                }\n            }\n\n            for (var i = columns.length - 1; i >= 0 ; i--) {\n                column = columns[i];\n                currIndex = thIndex(filterRowThs, column.headerAttributes.id);\n                refIndex = thIndex(filterRowThs, refColumn.headerAttributes.id);\n                filterRowThs.eq(currIndex)[before ? \"insertBefore\" : \"insertAfter\"](filterRowThs.eq(refIndex));\n            }\n        },\n\n        _applyLockedContainersWidth: function() {\n            if (!this._hasLockedColumns) {\n                return;\n            }\n\n            var lockedWidth = columnsWidth(this.lockedHeader.find(\">table>colgroup>col\"));\n\n            var headerTable = this.thead.parent();\n            var nonLockedWidth = columnsWidth(headerTable.find(\">colgroup>col\"));\n\n            var wrapperWidth = this.wrapper[0].clientWidth;\n            var scrollbar = kendo.support.scrollbar();\n\n            if (lockedWidth >= wrapperWidth) {\n                lockedWidth = wrapperWidth - 3 * scrollbar;\n            }\n\n            this.lockedHeader\n                .add(this.lockedContent)\n                .width(lockedWidth);\n\n            headerTable.add(this.table).width(nonLockedWidth);\n\n            var width = wrapperWidth - lockedWidth;\n            this.content.width(width - 1);\n            headerTable.parent().width(width - scrollbar - 2);\n        },\n\n        _trs: function(options) {\n            var that = this;\n            var model, attr, className, hasChildren, childNodes, i, length;\n            var modelId;\n            var rows = [];\n            var level = options.level;\n            var data = options.data;\n            var dataSource = this.dataSource;\n            var aggregates = dataSource.aggregates() || {};\n            var idField = dataSource._modelIdField();\n            var parentIdField = dataSource._modelParentIdField();\n            var columns = options.columns;\n            var pageable = that._isPageable();\n            var childrenMap = options.childrenMap || dataSource.childrenMap(dataSource._getData());\n\n            for (i = 0, length = data.length; i < length; i++) {\n                className = [];\n\n                model = data[i];\n                modelId = model[idField];\n\n                childNodes = pageable ? childrenMap[modelId] : (model.loaded() ? dataSource.childNodes(model) : []);\n                hasChildren = childNodes && childNodes.length;\n\n                attr = { \"role\": \"row\" };\n\n                attr[kendo.attr(\"uid\")] = model.uid;\n\n                if (hasChildren) {\n                    attr[\"aria-expanded\"] = !!model.expanded;\n                }\n\n                if (options.visible) {\n                    if (!pageable || (pageable && !that._skipRenderingMap[modelId])) {\n                        if (this._absoluteIndex % 2 !== 0) {\n                            className.push(classNames.alt);\n                        }\n\n                        this._absoluteIndex++;\n                    }\n                } else {\n                    attr.style = { display: \"none\" };\n                }\n\n                if ($.inArray(model.uid, options.selected) >= 0) {\n                    className.push(classNames.selected);\n                }\n\n                if (hasChildren) {\n                    className.push(classNames.group);\n                }\n\n                if (model._edit) {\n                    className.push(\"k-grid-edit-row\");\n                }\n\n                attr.className = className.join(\" \");\n\n                if (!that._skipRenderingMap[modelId]) {\n                    var row;\n                    var rowOptions = {\n                        model: model,\n                        attr: attr,\n                        level: pageable ? that._renderedModelLevel(model, options) : level,\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        hasChildren: hasChildren,\n                        visible: options.visible,\n                        isAlt: this._absoluteIndex % 2 === 0\n                    };\n\n                    if (that.options.rowTemplate) {\n                        row = this. _trFromTemplate(rowOptions);\n                    } else {\n                        row = this._tds(rowOptions, columns, proxy(this._td, this));\n                    }\n\n                    rows.push(row);\n                }\n\n\n                if (hasChildren && (that.options.renderAllRows || !!model.expanded)) {\n                    if (pageable) {\n                        // render the child nodes in the paged view only\n                        childNodes = (options.viewChildrenMap || {})[modelId] || [];\n                    }\n\n                    if (childNodes.length === 0) {\n                        continue;\n                    }\n\n                    rows = rows.concat(this._trs({\n                        columns: columns,\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        aggregates: aggregates,\n                        selected: options.selected,\n                        visible: pageable ? options.visible : (options.visible && !!model.expanded),\n                        data: childNodes,\n                        childrenMap: options.childrenMap || childrenMap,\n                        hasFooterTemplate: options.hasFooterTemplate,\n                        viewChildrenMap: options.viewChildrenMap,\n                        level: level + 1\n                    }));\n                }\n            }\n\n            if (options.hasFooterTemplate && model) {\n                attr = {\n                    className: classNames.footerTemplate,\n                    \"data-parentId\": model[parentIdField]\n                };\n\n                if (!options.visible) {\n                    attr.style = { display: \"none\" };\n                }\n\n                rows.push(this._tds({\n                    model: aggregates[model[parentIdField]],\n                    attr: attr,\n                    level: level,\n                    editedColumn: options.editedColumn,\n                    editedColumnIndex: options.editedColumnIndex\n                }, columns, this._footerId));\n            }\n\n            return rows;\n        },\n\n        _trFromTemplate: function(options) {\n            var rowTemplate = this.options.rowTemplate;\n            var altRowTemplate = this.options.altRowTemplate;\n            var row;\n            var template;\n\n            altRowTemplate = altRowTemplate ? altRowTemplate : rowTemplate;\n\n            if (!kendo.isFunction(rowTemplate)) {\n                rowTemplate = kendo.template(rowTemplate);\n            }\n\n            if (!kendo.isFunction(altRowTemplate)) {\n                altRowTemplate = kendo.template(altRowTemplate);\n            }\n\n            if (this._absoluteIndex % 2 !== 0) {\n                template = rowTemplate(options);\n            } else {\n                template = altRowTemplate(options);\n            }\n\n            if (!$(template).length) {\n                return kendoTextElement(template);\n            }\n\n            row = this.parseRowTemplate($(template)[0], options);\n\n            return row;\n        },\n\n        parseRowTemplate: function(element, options) {\n            var nodeName = element.nodeName.toLocaleLowerCase();\n            var childNodes = element.childNodes;\n            var children = [];\n            var currElement;\n            var attributes;\n\n            attributes = this.parseAttributes(element);\n\n            for (var i = 0; i < childNodes.length; i++) {\n                if (!/\\S/.test(childNodes[i].nodeValue)) {\n                   continue;\n                }\n                if (childNodes[i].nodeName.toLocaleLowerCase() === \"td\") {\n                    children.push(this._createCellElement(childNodes[i]));\n                }\n            }\n\n            if (options && !options.visible) {\n               attributes.style = attributes.style || {};\n               attributes.style = $.extend(true, attributes.style, { display: \"none\" });\n            }\n\n            if (this._isTextNode(nodeName)) {\n                currElement = kendoTextElement(element.nodeValue);\n            } else {\n                currElement = kendoDomElement(nodeName, attributes, children);\n            }\n\n            return currElement;\n        },\n\n        _createCellElement: function (element) {\n            var attributes = this.parseAttributes(element);\n            var spaceElements = $(element).find('.' + classNames.iconHidden).remove();\n            var iconElement = $(element).find('.' + classNames.iconExpand + ',.' + classNames.iconCollapse).remove()[0];\n            var children = [];\n\n            for (var i = 0; i < spaceElements.length; i++) {\n                children.push(kendoDomElement(\"span\", this.parseAttributes(spaceElements[i])));\n            }\n\n            if (iconElement) {\n                children.push(kendoDomElement(\"span\", this.parseAttributes(iconElement)));\n            }\n            children.push(kendoHtmlElement($(element).html()));\n\n            return kendoDomElement(\"td\", attributes, children);\n        },\n\n        parseAttributes: function(element) {\n            if (this._isTextNode(element.nodeName)) {\n                return null;\n            }\n\n            element = $(element)[0];\n            var attributes = element.attributes;\n            var length = attributes.length;\n            var result = {};\n\n            for (var i = 0; i < length; i++) {\n                result[attributes[i].name] = attributes[i].value;\n            }\n\n            return result;\n        },\n\n        _isTextNode: function (nodeName) {\n            return nodeName.indexOf('text') >= 0;\n        },\n\n        _footerId: function(options) {\n            var content = [];\n            var column = options.column;\n            var template = options.column.footerTemplate || $.noop;\n            var aggregates = options.model[column.field] || {};\n            var attr = {\n                \"role\": \"gridcell\",\n                \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n            };\n\n            if (column.expandable) {\n                content = content.concat(createPlaceholders({\n\n                    level: options.level + 1,\n                    className: classNames.iconPlaceHolder\n                }));\n            }\n\n            if (column.attributes) {\n                extend(true, attr, column.attributes, {\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n                });\n            }\n\n            content.push(kendoHtmlElement(template(aggregates) || \"\"));\n\n            return kendoDomElement(\"td\", attr, content);\n        },\n\n        _hasFooterTemplate: function() {\n            return !!grep(leafColumns(this.columns), function(c) {\n                return c.footerTemplate;\n            }).length;\n        },\n\n        _tds: function(options, columns, renderer) {\n            var children = [];\n            var column;\n            var editedColumnField = (options.editedColumn || {}).field;\n            var incellEditing = this._isIncellEditable();\n            var length = columns.length;\n\n            for (var i = 0; i < length; i++) {\n                column = columns[i];\n\n                var col = renderer({\n                    model: options.model,\n                    column: column,\n                    editColumn: !incellEditing || (incellEditing && column.field === editedColumnField && options.editedColumnIndex === i),\n                    level: options.level\n                });\n\n                children.push(col);\n            }\n\n            return kendoDomElement(\"tr\", options.attr, children);\n        },\n\n        _td: function(options) {\n            var children = [];\n            var model = options.model;\n            var column = options.column;\n            var iconClass;\n            var attr = {\n                \"role\": \"gridcell\",\n                \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n            };\n            var incellEditing = this._isIncellEditable();\n            var columnHasEditCommand = false;\n\n            if (column.attributes) {\n                extend(true, attr, column.attributes);\n            }\n\n            if (!!column.headerAttributes && !!column.headerAttributes.id) {\n                attr[\"aria-describedby\"] = column.headerAttributes.id;\n            }\n\n            if (model._edit && column.field && options.editColumn && (incellEditing || (!incellEditing && isColumnEditable(column, model)))) {\n                attr[kendo.attr(\"container-for\")] = column.field;\n\n                if (incellEditing) {\n                    if (attr.className && attr.className.indexOf(classNames.editCell) !== -1) {\n                        attr.className += \" \" + classNames.editCell;\n                    } else if (!attr.className) {\n                        attr.className = classNames.editCell;\n                    }\n                }\n            } else {\n                if (column.expandable) {\n                    children = createPlaceholders({ level: options.level, className: classNames.iconPlaceHolder });\n                    iconClass = [classNames.icon];\n\n                    if (model.hasChildren) {\n                        iconClass.push(model.expanded ? classNames.iconCollapse : classNames.iconExpand);\n                    } else {\n                        iconClass.push(classNames.iconHidden);\n                    }\n\n                    if (model._error) {\n                        iconClass.push(classNames.refresh);\n                    } else if (!model.loaded() && model.expanded) {\n                        iconClass.push(classNames.loading);\n                        attr[\"aria-busy\"] = true;\n                    }\n\n                    children.push(kendoDomElement(\"span\", { className: iconClass.join(\" \") }));\n\n                    attr.style[\"white-space\"] = \"nowrap\";\n                }\n\n                if (isDirtyColumn(column, model)) {\n                    if (attr.className) {\n                        attr.className += classNames.dirtyCell;\n                    } else if (!attr.className) {\n                        attr.className = classNames.dirtyCell;\n                    }\n                }\n\n                if (column.command) {\n                    if (attr.className && attr.className.indexOf(\"k-command-cell\") !== -1 ) {\n                        attr.className += \" k-command-cell\";\n                    } else if (!attr.className) {\n                        attr.className = \"k-command-cell\";\n                    }\n\n                    columnHasEditCommand = grep(column.command, function(command) {\n                        return command === EDIT || command.name === EDIT;\n                    }).length > 0;\n\n                    if (model._edit && !this._isIncellEditable() && columnHasEditCommand) {\n                        children = this._buildCommands([\"update\", \"canceledit\"]);\n                    } else {\n                        children = this._buildCommands(column.command);\n                    }\n                } else  {\n                    children.push(this._cellContent(column, model));\n                }\n\n                attr.className = [attr[\"class\"], attr.className].join(\" \").trim();\n            }\n\n            return kendoDomElement(\"td\", attr, children);\n        },\n\n        _cellContent: function(column, model) {\n            var that = this;\n            var value;\n            var incellEditing = that._isIncellEditable();\n            var dirtyIndicator;\n\n            if (column.selectable) {\n                return kendoHtmlElement(SELECTCOLUMNTMPL);\n            }\n\n            if (column.template) {\n                value = that._evalColumnTemplate(column, model);\n            } else if (column.field) {\n                value = model.get(column.field);\n                dirtyIndicator = incellEditing ? column.dirtyIndicatorTemplate(model) : \"\";\n                if (value !== null && !isUndefined(value)) {\n                    if (column.format) {\n                        value = kendo.format(column.format, value);\n                    }\n\n                    value = dirtyIndicator + value;\n                } else {\n                    value = dirtyIndicator;\n                }\n            } else if (value === null || isUndefined(value)) {\n                value = \"\";\n            }\n\n            if (column.template || !column.encoded) {\n                return kendoHtmlElement(value);\n            } else {\n                if (incellEditing) {\n                    return kendoHtmlElement(value);\n                } else {\n                    return kendoTextElement(value);\n                }\n            }\n        },\n\n        _evalColumnTemplate: function(column, model) {\n            if (this._isIncellEditable()) {\n                return column.dirtyCellTemplate(model);\n            } else {\n                return column.template(model);\n            }\n        },\n\n        _createDirtyColumnTemplate: function(column) {\n            var that = this;\n            var templateSettings = that._customTemplateSettings();\n            var columnTemplateAlias = \"#=this.columnTemplate(\" + templateSettings.paramName + \")#\";\n\n            var templateString = that._dirtyIndicatorTemplate(column.field) + columnTemplateAlias;\n            var templateFunction = proxy(kendoTemplate(templateString, templateSettings), { columnTemplate: column.template });\n\n            return templateFunction;\n        },\n\n        _createIndicatorTemplate: function(column) {\n            var dirtyIndicatorTemplate = this._dirtyIndicatorTemplate(column.field);\n\n            return kendoTemplate(dirtyIndicatorTemplate);\n        },\n\n        _dirtyIndicatorTemplate: function(field) {\n            var that = this;\n            var dirtyField;\n            var templateSettings = that._customTemplateSettings();\n            var paramName = templateSettings.paramName;\n\n            if (field && paramName) {\n                dirtyField = field.charAt(0) === \"[\" ? kendo.expr(field, paramName + \".dirtyFields\") : paramName + \".dirtyFields['\" + field + \"']\";\n\n                return \"#= \" + paramName + \" && \" + paramName + \".dirty && \" + paramName + \".dirtyFields && \" + dirtyField +\n                        \" ? '<span class=\\\"k-dirty\\\"></span>' : '' #\";\n            }\n\n            return \"\";\n        },\n\n        _customTemplateSettings: function() {\n            return extend({}, kendo.Template, this.options.templateSettings);\n        },\n\n        _buildCommands: function(commands) {\n            var i, result = [];\n\n            for (i = 0; i < commands.length; i++) {\n                result.push(this._handleCommand(commands[i]));\n            }\n\n            return result;\n        },\n\n        _handleCommand: function(command) {\n            var name = (command.name || command).toLowerCase();\n            var text = this.options.messages.commands[name];\n            var icon = [];\n\n            command = extend({}, defaultCommands[name], { text: text }, command);\n\n            if (command.imageClass) {\n                icon.push(kendoDomElement(\"span\", {\n                    className: [ \"k-icon\", \"k-button-icon\", command.imageClass ].join(\" \")\n                }));\n            }\n\n            if(command.template) {\n                return kendoHtmlElement(kendo.template(command.template)({ message: command.text || this.options.messages.commands.search }));\n            } else {\n                return this._button(command, name, icon);\n            }\n        },\n\n        _button: function(command, name, icon) {\n            if (command.className && command.className.indexOf(\"k-primary\") > -1) {\n                command.className = command.className.replace(\"k-primary\", \"k-button-solid-primary\");\n            }\n\n            if (!command.className || command.className.indexOf(\"k-button-solid-primary\") === -1) {\n                command.className += \" k-button-solid-base\";\n            }\n\n            var button = kendoDomElement(\n                \"button\", {\n                    \"type\": \"button\",\n                    \"data-command\": name,\n                    className: [ \"k-button k-button-md k-rounded-md k-button-solid\", command.className ].join(\" \")\n                }, icon.concat([ kendoDomElement(\"span\", {\n                    type: \"span\",\n                    className: \"k-button-text\"\n                }, [ kendoTextElement(command.text || command.name) ]) ])\n            );\n\n            return button;\n        },\n\n        _positionResizeHandle: function(e) {\n            var th = $(e.currentTarget);\n            var resizeHandle = this.resizeHandle;\n            var position = th.position();\n            var left;\n            var rtlCorrection = 0;\n            var headerWrap;\n            var ieCorrection;\n            var webkitCorrection;\n            var firefoxCorrection;\n            var leftMargin;\n            var invisibleSpace;\n            var leftBorderWidth;\n            var scrollLeft;\n            var cellWidth = outerWidth(th);\n            var container = th.closest(\"div\");\n            var button = typeof e.buttons !== \"undefined\" ? e.buttons : (e.which || e.button);\n            var indicatorWidth = this.options.columnResizeHandleWidth || 3;\n            var halfResizeHandle = (indicatorWidth * 3) / 2;\n\n            left = cellWidth;\n\n            if (typeof button !== \"undefined\" && button !== 0) {\n                //do not create a new resize handle if a mouse button is still pressed\n                //this happens during resizing or before UserEvents trigger \"start\"\n                return;\n            }\n\n            if (!resizeHandle) {\n                resizeHandle = this.resizeHandle = $(\n                    '<div class=\"k-resize-handle\"><div class=\"k-resize-handle-inner\"></div></div>'\n                );\n            }\n\n            var cells = leafDataCells(th.closest(\"thead\")).filter(\":visible\");\n            if (isRtl) {\n                scrollLeft = kendo.scrollLeft(container);\n\n                if (browser.mozilla || (browser.webkit && browser.version >= 85)) {\n                    scrollLeft = scrollLeft * -1;\n                }\n                leftBorderWidth = parseFloat(container.css(\"borderLeftWidth\"));\n                left = th.offset().left + scrollLeft - parseFloat(th.css(\"marginLeft\")) - (container.offset().left + leftBorderWidth);\n                rtlCorrection = (left <= scrollLeft ? halfResizeHandle : 0);// when shown on first column headers are misaligned due to the width of the resize handler\n                headerWrap = th.closest(\".k-grid-header-wrap, .k-grid-header-locked\");\n                invisibleSpace = headerWrap[0].scrollWidth - headerWrap[0].offsetWidth; // the difference between the entire width and the visible area\n                leftMargin = parseFloat(headerWrap.css(\"marginLeft\"));\n                ieCorrection = browser.msie ? 2*kendo.scrollLeft(headerWrap) + leftBorderWidth - leftMargin - rtlCorrection: 0;\n                webkitCorrection = browser.webkit && (browser.version < 85) ? (invisibleSpace - rtlCorrection - leftMargin + leftBorderWidth) : -rtlCorrection; //margin left is added due to a margin that avoids double borders\n                firefoxCorrection = browser.mozilla ? leftBorderWidth - leftMargin - rtlCorrection : 0;\n                left -= webkitCorrection + firefoxCorrection + ieCorrection;\n            } else {\n                for (var idx = 0; idx < cells.length; idx++) {\n                    if (cells[idx] == th[0]) {\n                        break;\n                    }\n                    left += cells[idx].offsetWidth;\n                }\n            }\n\n            container.append(resizeHandle);\n\n            resizeHandle\n                .show()\n                .css({\n                    top: position.top,\n                    left: left - halfResizeHandle,\n                    height: outerHeight(th),\n                    width: indicatorWidth * 3\n                })\n                .data(\"th\", th);\n\n            var that = this;\n            resizeHandle.off(\"dblclick\" + NS).on(\"dblclick\" + NS, function () {\n                //TODO handle frozen columns index\n                var index= th.index();\n                if ($.contains(that.thead[0], th[0])) {\n                    index += grep(that.columns, function (val) { return val.locked && !val.hidden; }).length;\n                }\n                that.autoFitColumn(index);\n            });\n        },\n\n        autoFitColumn: function (column) {\n            var that = this,\n                options = that.options,\n                columns = that.columns,\n                index,\n                th,\n                headerTable,\n                isLocked,\n                visibleLocked = that.lockedHeader ? leafDataCells(that.lockedHeader.find(\">table>thead\")).filter(isCellVisible).length : 0,\n                col;\n\n            //  retrieve the column object, depending on the method argument\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(columns, function (item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(columns, function (item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            index = inArray(column, columns);\n            isLocked = column.locked;\n\n            if (isLocked) {\n                headerTable = that.lockedHeader.children(\"table\");\n            } else {\n                headerTable = that.thead.parent();\n            }\n\n            th = headerTable.find(\"[data-index='\" + index + \"']\");\n\n            var contentTable = isLocked ? that.lockedTable : that.table,\n                footer = that.footer || $();\n\n            if (that.footer && that.lockedContent) {\n                footer = isLocked ? that.footer.children(\".k-grid-footer-locked\") : that.footer.children(\".k-grid-footer-wrap\");\n            }\n\n            var footerTable = footer.find(\"table\").first();\n\n            if (that.lockedHeader && visibleLocked >= index && !isLocked) {\n                index -= visibleLocked;\n            }\n\n            // adjust column index, depending on previous hidden columns\n            for (var j = 0; j < columns.length; j++) {\n                if (columns[j] === column) {\n                    break;\n                } else {\n                    if (columns[j].hidden) {\n                        index--;\n                    }\n                }\n            }\n\n            // get col elements\n            if (options.scrollable) {\n                col = headerTable.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index)\n                    .add(contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index))\n                    .add(footerTable.find(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index));\n            } else {\n                col = contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index);\n            }\n\n            var tables = headerTable.add(contentTable).add(footerTable);\n\n            var oldColumnWidth = outerWidth(th);\n\n            // reset the table and autofitted column widths\n            // if scrolling is disabled, we need some additional repainting of the table\n            col.width(\"\");\n            tables.css(\"table-layout\", \"fixed\");\n            col.width(\"auto\");\n            tables.addClass(\"k-autofitting\");\n            tables.css(\"table-layout\", \"\");\n\n            var newColumnWidth = Math.ceil(\n                    Math.max(\n                        outerWidth(th),\n                        outerWidth(contentTable.find(\"tr\").eq(0).children(\"td:visible\").eq(index)),\n                        outerWidth(footerTable.find(\"tr\").eq(0).children(\"td:visible\").eq(index))\n            ));\n\n            col.width(newColumnWidth);\n            column.width = newColumnWidth;\n\n            // if all visible columns have widths, the table needs a pixel width as well\n            if (options.scrollable) {\n                var cols = headerTable.find(\"col\"),\n                    colWidth,\n                    totalWidth = 0;\n                for (var idx = 0, length = cols.length; idx < length; idx += 1) {\n                    colWidth = cols[idx].style.width;\n                    if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                        totalWidth += parseInt(colWidth, 10);\n                    } else {\n                        totalWidth = 0;\n                        break;\n                    }\n                }\n\n                if (totalWidth) {\n                    tables.each(function () {\n                        this.style.width = totalWidth + \"px\";\n                    });\n                }\n            }\n\n            tables.removeClass(\"k-autofitting\");\n\n            that.trigger(COLUMNRESIZE, {\n                column: column,\n                oldWidth: oldColumnWidth,\n                newWidth: newColumnWidth\n            });\n\n            that._applyLockedContainersWidth();\n            that._syncLockedContentHeight();\n            that._syncLockedHeaderHeight();\n        },\n\n        _adjustLockedHorizontalScrollBar: function() {\n            var table = this.table,\n                content = table.parent();\n\n            var scrollbar = table[0].offsetWidth > content[0].clientWidth ? kendo.support.scrollbar() : 0;\n            this.lockedContent.height(outerHeight(content) - scrollbar);\n        },\n\n        _syncLockedContentHeight: function() {\n            if (this.lockedTable) {\n                if (!this._touchScroller) {\n                    this._adjustLockedHorizontalScrollBar();\n                }\n                this._adjustRowsHeight(this.table, this.lockedTable);\n                this._syncLockedScroll();\n            }\n        },\n\n        _syncLockedHeaderHeight: function() {\n            if (this.lockedHeader) {\n                var lockedTable = this.lockedHeader.children(\"table\");\n                var table = this.thead.parent();\n\n                this._adjustRowsHeight(lockedTable, table);\n\n                syncTableHeight(lockedTable, table);\n            }\n        },\n\n        _syncLockedScroll: function () {\n            if (!this.options.scrollable) {\n                return;\n            }\n            this.lockedContent[0].scrollTop = this.content[0].scrollTop;\n        },\n\n        _resizable: function() {\n            if (!this.options.resizable) {\n                return;\n            }\n\n            if (this.resizable) {\n                this.resizable.destroy();\n            }\n\n            var treelist = this;\n\n            $(this.lockedHeader).find(\"thead\").add(this.thead)\n                .on(\"mousemove\" + NS, \"tr:not(.k-filter-row) > th\", $.proxy(this._positionResizeHandle, this));\n\n            this.resizable = new kendo.ui.Resizable(this.wrapper, {\n                handle: \".k-resize-handle\",\n                start: function(e) {\n                    var th = $(e.currentTarget).data(\"th\");\n                    var index = $.inArray(th[0], leafDataCells(th.closest(\"thead\")).filter(\":visible\"));\n                    var header, contentTable;\n\n                    treelist.wrapper.addClass(\"k-grid-column-resizing\");\n\n                    if (treelist.lockedHeader && $.contains(treelist.lockedHeader[0], th[0])) {\n                        header = treelist.lockedHeader;\n                        contentTable = treelist.lockedTable;\n                    } else {\n                        header = treelist.thead.parent();\n                        contentTable = treelist.table;\n                    }\n\n                    this.col = contentTable.children(\"colgroup\").find(\"col\").eq(index)\n                          .add(header.find(\"col\").eq(index));\n                    this.th = th;\n                    this.startLocation = e.x.location;\n                    this.columnWidth = outerWidth(th);\n                    this.table = this.col.closest(\"table\");\n                    this.totalWidth = this.table.width();\n                },\n                resize: function(e) {\n                    var rtlModifier = isRtl ? -1 : 1;\n                    var minColumnWidth = 11;\n                    var delta = (e.x.location * rtlModifier) - (this.startLocation * rtlModifier);\n\n                    if (this.columnWidth + delta < minColumnWidth) {\n                        delta = minColumnWidth - this.columnWidth;\n                    }\n\n                    this.table.width(this.totalWidth + delta);\n                    this.col.width(this.columnWidth + delta);\n                },\n                resizeend: function() {\n                    treelist.wrapper.removeClass(\"k-grid-column-resizing\");\n\n                    var field = this.th.attr(\"data-field\");\n                    var column = grep(leafColumns(treelist.columns), function(c) {\n                        return c.field == field;\n                    });\n                    var newWidth = Math.floor(outerWidth(this.th));\n\n                    column[0].width = newWidth;\n                    treelist._resize();\n                    treelist._syncLockedContentHeight();\n                    treelist._syncLockedHeaderHeight();\n                    treelist.trigger(COLUMNRESIZE, {\n                        column: column,\n                        oldWidth: this.columnWidth,\n                        newWidth: newWidth\n                    });\n\n                    this.table = this.col = this.th = null;\n                }\n            });\n        },\n\n        _sortable: function() {\n            var columns;\n            var column;\n            var sortableInstance;\n            var cells;\n            var cell, idx, length;\n            var sortable = this.options.sortable;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (!sortable) {\n                return;\n            }\n\n            if (hasMultiColumnHeaders) {\n                if (this.lockedHeader) {\n                    cells = sortCells(leafDataCells(this.lockedHeader.find(\">table>thead\")).add(leafDataCells(this.thead)));\n                } else {\n                    cells = leafDataCells(this.thead);\n                }\n            } else {\n                cells = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n            columns = leafColumns(this.columns);\n\n            for (idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (column.sortable !== false && !column.command && column.field && !column.selectable) {\n                    cell = cells.eq(idx);\n\n                    sortableInstance = cell.data(\"kendoColumnSorter\");\n                    if (sortableInstance) {\n                        sortableInstance.destroy();\n                    }\n\n                    cell.kendoColumnSorter(\n                            extend({}, sortable, column.sortable, {\n                                dataSource: this.dataSource\n                            })\n                        );\n                }\n            }\n        },\n\n        _filterable: function() {\n            var cells;\n            var filterable = this.options.filterable;\n            var idx;\n            var length;\n            var columns;\n            var column;\n            var cell;\n            var filterMenuInstance;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (!filterable || this.options.columnMenu) {\n                return;\n            }\n\n            var filterInit = proxy(function(e) {\n                this.trigger(FILTERMENUINIT, { field: e.field, container: e.container });\n            }, this);\n\n            var filterOpen = proxy(function(e) {\n                this.trigger(FILTERMENUOPEN, { field: e.field, container: e.container });\n            }, this);\n\n            if (hasMultiColumnHeaders) {\n                if (this.lockedHeader) {\n                    cells = leafDataCells(this.lockedHeader.find(\">table>thead\").add(this.thead));\n                } else {\n                    cells = leafDataCells(this.thead);\n                }\n            } else {\n                cells = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n            columns = leafColumns(this.columns);\n\n            if (filterable && typeof filterable.mode == STRING && filterable.mode.indexOf(\"menu\") == -1) {\n                filterable = false;\n            }\n\n            if (!filterable) {\n                return;\n            }\n\n            for (idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n                cell = cells.eq(idx);\n\n                filterMenuInstance = cell.data(\"kendoFilterMenu\");\n                if (filterMenuInstance) {\n                    filterMenuInstance.destroy();\n                }\n\n                if (column.command || column.filterable === false || column.selectable) {\n                    continue;\n                }\n\n                cell.kendoFilterMenu(extend(true, {}, filterable, column.filterable, {\n                    dataSource: this.dataSource,\n                    init: filterInit,\n                    open: filterOpen,\n                    appendTo: DOT + classNames.headerCellInner\n                }));\n            }\n        },\n\n        _filterRow: function() {\n            var that = this;\n            if (!that._hasFilterRow()) {\n               return;\n            }\n\n            var settings;\n            var $angular = that.options.$angular;\n            var uidAttr = kendo.attr('uid');\n            var columns = leafColumns(that.columns),\n                filterable = that.options.filterable,\n                filterHandler = function(e) {\n                    if (that.trigger(\"filter\", { filter: e.filter, field: e.field })) {\n                        e.preventDefault();\n                    }\n                },\n                existingInstance;\n\n            for (var i = 0; i < columns.length; i++) {\n                var suggestDataSource,\n                    col = columns[i],\n                    operators = that.options.filterable.operators,\n                    customDataSource = false,\n                    th = this.wrapper.find('.k-grid-header .k-filter-row th[' + uidAttr +'=\"' + col.headerAttributes.id + '\"]'),\n                    field = col.field,\n                    parentColumn = col.parentColumn;\n\n                delete col.parentColumn;\n\n                if (field && col.filterable !== false) {\n                    var cellOptions = col.filterable && col.filterable.cell || {};\n                    existingInstance = th.find('.k-filtercell').data('kendoFilterCell');\n\n                    if (existingInstance) {\n                        existingInstance.destroy();\n                        th.empty();\n                    }\n\n                    suggestDataSource = that.options.dataSource;\n                    if (suggestDataSource instanceof DataSource) {\n                        suggestDataSource = that.options.dataSource.options;\n                    }\n\n                    var messages = extend(true, {}, filterable.messages);\n                    if (col.filterable) {\n                        extend(true, messages, col.filterable.messages);\n                    }\n\n                    if (cellOptions.enabled === false) {\n                        th.html(\"&nbsp;\");\n                        continue;\n                    }\n                    if (cellOptions.dataSource) {\n                        suggestDataSource = cellOptions.dataSource;\n                        customDataSource = true;\n                    }\n                    if (col.filterable && col.filterable.operators) {\n                        operators =  col.filterable.operators;\n                    }\n\n                    settings = {\n                        column: col,\n                        dataSource: that.dataSource,\n                        suggestDataSource: suggestDataSource,\n                        customDataSource: customDataSource,\n                        field: field,\n                        messages: messages,\n                        values: col.values,\n                        template: cellOptions.template,\n                        delay: cellOptions.delay,\n                        inputWidth: cellOptions.inputWidth,\n                        suggestionOperator: cellOptions.suggestionOperator,\n                        minLength: cellOptions.minLength,\n                        dataTextField: cellOptions.dataTextField,\n                        operator: cellOptions.operator,\n                        operators: operators,\n                        showOperators: cellOptions.showOperators,\n                        change: filterHandler\n                    };\n\n                    if ($angular) {\n                        settings.$angular = $angular;\n                    }\n\n                    $(\"<span/>\").attr(kendo.attr(\"field\"), field)\n                        .appendTo(th)\n                        .kendoFilterCell(settings);\n                    col.parentColumn = parentColumn;\n                } else {\n                    th.html(\"&nbsp;\");\n                }\n            }\n        },\n\n        _hasFilterRow: function() {\n            var filterable = this.options.filterable;\n            var hasFiltering = filterable &&\n                    typeof filterable.mode == STRING &&\n                    filterable.mode.indexOf(\"row\") != -1;\n            var columns = this.columns;\n            var columnsWithoutFiltering = $.grep(columns, function(col) {\n                return col.filterable === false;\n            });\n\n            if (columns.length && columnsWithoutFiltering.length == columns.length) {\n                hasFiltering = false;\n            }\n\n            return hasFiltering;\n        },\n\n        _change: function() {\n            var that = this;\n            var selectedValues;\n\n            if (that._checkBoxSelection) {\n                selectedValues = that.selectable.value();\n                that._uncheckCheckBoxes();\n                that._checkRows(selectedValues);\n                if (selectedValues.length && selectedValues.length === that.items().length) {\n                    that._toggleHeaderCheckState(true);\n                } else {\n                    that._toggleHeaderCheckState(false);\n                }\n            }\n            this.trigger(CHANGE);\n        },\n\n        _isLocked: function() {\n            return this.lockedHeader !== null;\n        },\n\n        _selectable: function() {\n            var that = this;\n            var selectable = this.options.selectable;\n            var filter;\n            var element = this.table;\n            var useAllItems;\n            var isLocked = that._isLocked();\n            var multi;\n            var cell;\n\n            if (selectable) {\n                selectable = kendo.ui.Selectable.parseOptions(selectable);\n\n                if (this._hasLockedColumns) {\n                    element = element.add(this.lockedTable);\n                    useAllItems = selectable.multiple && selectable.cell;\n                }\n\n                filter = \">tbody>tr:not(.k-footer-template)\";\n\n                if (selectable.cell) {\n                    filter = filter + \">td\";\n                }\n\n                this.selectable = new kendo.ui.Selectable(element, {\n                    filter: filter,\n                    aria: true,\n                    multiple: selectable.multiple,\n                    change: proxy(this._change, this),\n                    useAllItems: useAllItems,\n                    continuousItems: proxy(this._continuousItems, this, filter, selectable.cell),\n                    relatedTarget: !selectable.cell && this._hasLockedColumns ? proxy(this._selectableTarget, this) : undefined\n                });\n\n                if (that.options.navigatable) {\n                    multi = selectable.multiple;\n                    cell = selectable.cell;\n\n                    element.on(\"keydown\" + NS, function(e) {\n                        var current = that.current();\n                        var target = e.target;\n                        if (e.keyCode === keys.SPACEBAR && !e.shiftKey && $.inArray(target, element) > -1 &&\n                            !current.is(\".k-header\")) {\n\n                                e.preventDefault();\n                                e.stopPropagation();\n                                current = cell ? current : current.parent();\n\n                                if (isLocked && !cell) {\n                                    current = current.add(that._relatedRow(current));\n                                }\n\n                                if (multi) {\n                                    if(!e.ctrlKey) {\n                                        that.selectable.clear();\n                                    } else {\n                                        if (current.hasClass(classNames.selected)) {\n                                            current.removeClass(classNames.selected);\n                                            that.trigger(CHANGE);\n                                            return;\n                                        }\n                                    }\n                                } else {\n                                    that.selectable.clear();\n                                }\n                                if (!cell) {\n                                    that.selectable._lastActive = current;\n                                }\n\n                                that.selectable.value(current);\n                        } else if (!cell && ((e.shiftKey && e.keyCode == keys.LEFT)||\n                                    (e.shiftKey && e.keyCode == keys.RIGHT)||\n                                    (e.shiftKey && e.keyCode == keys.UP)||\n                                    (e.shiftKey && e.keyCode == keys.DOWN)||\n                                    (e.keyCode === keys.SPACEBAR && e.shiftKey))) {\n\n                            e.preventDefault();\n                            e.stopPropagation();\n                            current = current.parent();\n\n                            if (isLocked) {\n                                current = current.add(that._relatedRow(current));\n                            }\n\n                            if (multi) {\n                                if(!that.selectable._lastActive) {\n                                    that.selectable._lastActive = current;\n                                }\n                                that.selectable.selectRange(that.selectable._firstSelectee(), current);\n                            } else {\n                                that.selectable.clear();\n                                that.selectable.value(current);\n                            }\n                        }\n                    });\n                }\n            }\n        },\n\n        _continuousItems: function(filter, cell) {\n            if (!this.lockedContent) {\n                return;\n            }\n\n            var lockedItems = $(filter, this.lockedTable);\n            var nonLockedItems = $(filter, this.table);\n            var columns = cell ? lockedColumns(this.columns).length : 1;\n            var nonLockedColumns = cell ? this.columns.length - columns : 1;\n            var result = [];\n\n            for (var idx = 0; idx < lockedItems.length; idx += columns) {\n                push.apply(result, lockedItems.slice(idx, idx + columns));\n                push.apply(result, nonLockedItems.splice(0, nonLockedColumns));\n            }\n\n            return result;\n        },\n\n        _selectableTarget: function(items) {\n            var related;\n            var result = $();\n            for (var idx = 0, length = items.length; idx < length; idx ++) {\n                related = this._relatedRow(items[idx]);\n\n                if (inArray(related[0], items) < 0) {\n                    result = result.add(related);\n                }\n            }\n\n            return result;\n        },\n\n        _relatedRow: function(row) {\n            var lockedTable = this.lockedTable;\n            row = $(row);\n\n            if (!lockedTable) {\n                return row;\n            }\n\n            var table = row.closest(this.table.add(this.lockedTable));\n            var index = table.find(\">tbody>tr\").index(row);\n\n            table = table[0] === this.table[0] ? lockedTable : this.table;\n\n            return table.find(\">tbody>tr\").eq(index);\n        },\n\n        select: function(value) {\n            var that = this;\n            var selectable = this.selectable;\n\n            if (that._checkBoxSelection) {\n                if (value) {\n                    that._checkRows(value);\n                    if (that.select().length === that.items().length) {\n                        that._toggleHeaderCheckState(true);\n                    }\n                }\n\n                return that.items().filter(\".\" + SELECTED);\n            }\n\n            if (!selectable) {\n                return $();\n            }\n\n            if (typeof value !== \"undefined\") {\n                if (!selectable.options.multiple) {\n                    selectable.clear();\n\n                    value = value.first();\n                }\n\n                if (this._hasLockedColumns) {\n                    value = value.add($.map(value, proxy(this._relatedRow, this)));\n                }\n            }\n\n            return selectable.value(value);\n        },\n\n        clearSelection: function() {\n            var that = this;\n\n            if (that.selectable && !that._checkBoxSelection) {\n                that.selectable.clear();\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.select(), true);\n                return;\n            }\n        },\n\n        _uncheckCheckBoxes: function () {\n            var that= this;\n            var tables = that.table.add(that.lockedTable);\n\n            tables.find(\"tbody \" + CHECKBOXINPUT).attr(\"aria-checked\", false)\n                .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n\n        },\n\n        _deselectCheckRows: function(items, preventChange) {\n            var that = this;\n            items = that.table.add(that.lockedTable).find(items);\n\n            if (that._isLocked()) {\n                items = items.add(items.map(function() {\n                    return that._relatedRow(this);\n                }));\n            }\n\n            items.each(function() {\n                $(this).removeClass(SELECTED).find(CHECKBOXINPUT).attr(\"aria-checked\", false)\n                    .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n            });\n            that._toggleHeaderCheckState(false);\n\n            if (!preventChange) {\n                that.trigger(CHANGE);\n            }\n        },\n\n        _headerCheckboxClick: function(e) {\n            var that = this,\n                checkBox = $(e.target),\n                checked = checkBox.prop(\"checked\"),\n                parentGrid = checkBox.closest(\".k-grid.k-widget\").getKendoTreeList();\n\n            if (that !== parentGrid) {\n                return;\n            }\n\n            if (checked) {\n                that.select(parentGrid.items());\n            } else {\n                that.clearSelection();\n            }\n            that.trigger(CHANGE);\n        },\n\n        _checkboxClick: function(e) {\n            var that = this,\n                row =  $(e.target).closest(\"tr\"),\n                isSelecting = !row.hasClass(SELECTED),\n                dataItem = that.dataItem(row),\n                children = [],\n                selector = \"\";\n\n            if (that !== row.closest(\".k-grid.k-widget\").getKendoTreeList()) {\n                return;\n            }\n\n            if (that._includeChildren) {\n                that.dataSource.allChildNodes(dataItem, children);\n\n                for (var i = 0; i < children.length; i++){\n                    selector += \"tr[data-uid='\" +\tchildren[i].uid + \"'],\";\n                }\n            }\n\n            selector += \"tr[data-uid='\" +\tdataItem.uid + \"']\";\n            row = $(selector);\n\n            if (isSelecting) {\n                that.select(row);\n                that.trigger(CHANGE);\n            } else {\n                that._deselectCheckRows(row);\n            }\n        },\n\n        _checkRows: function(items) {\n            items.each(function() {\n                $(this).addClass(SELECTED).find(CHECKBOXINPUT).prop(\"checked\", true)\n                    .attr(\"aria-label\", \"Deselect row\").attr(\"aria-checked\", true);\n            });\n        },\n\n        _toggleHeaderCheckState: function(checked) {\n            var that = this;\n            if (checked) {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", true).attr(\"aria-checked\", true)\n                    .attr(\"aria-label\", \"Deselect all rows\");\n            } else {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", false).attr(\"aria-checked\", false)\n                    .attr(\"aria-label\", \"Select all rows\");\n            }\n        },\n\n        _dataSource: function(dataSource) {\n            var that = this;\n            var ds = this.dataSource;\n            var pageable = that.options.pageable;\n\n            if (ds) {\n                ds.unbind(CHANGE, this._refreshHandler);\n                ds.unbind(ERROR, this._errorHandler);\n                ds.unbind(SORT, this._sortHandler);\n                ds.unbind(PROGRESS, this._progressHandler);\n            }\n\n            this._refreshHandler = proxy(this.refresh, this);\n            this._errorHandler = proxy(this._error, this);\n            this._sortHandler = proxy(this._clearSortClasses, this);\n            this._progressHandler = proxy(this._progress, this);\n\n\n            if (isPlainObject(dataSource)) {\n                extend(dataSource, { table: that.table, fields: that.columns });\n\n                if (isPlainObject(pageable) && pageable.pageSize !== undefined) {\n                    dataSource.pageSize = pageable.pageSize;\n                }\n            }\n\n            ds = this.dataSource = TreeListDataSource.create(dataSource);\n\n            if (pageable) {\n                ds._collapsedTotal = undefined;\n            }\n\n            ds.bind(CHANGE, this._refreshHandler);\n            ds.bind(ERROR, this._errorHandler);\n            ds.bind(SORT, this._sortHandler);\n            ds.bind(PROGRESS, this._progressHandler);\n\n            this._dataSourceFetchProxy = proxy(function() {\n                this.dataSource.fetch();\n            }, this);\n        },\n\n        setDataSource: function(dataSource) {\n            this._dataSource(dataSource);\n            this._sortable();\n            this._filterable();\n            this._filterRow();\n            this._columnMenu();\n            this._pageable();\n\n            this._contentTree.render([]);\n\n            if (this.options.autoBind) {\n                this.dataSource.fetch();\n            }\n        },\n\n        dataItem: function(element) {\n            if (element instanceof TreeListModel) {\n                return element;\n            }\n\n            var row = $(element).closest(\"tr\");\n            var uid = row.attr(kendo.attr(\"uid\"));\n            var model = isUndefined(uid) ? null : this.dataSource.getByUid(uid);\n\n            return model;\n        },\n\n        editRow: function(row) {\n            var that = this;\n            var model;\n\n            if (this._isIncellEditable() || !this.options.editable) {\n                return;\n            }\n\n            if (typeof row === STRING) {\n                row = this.tbody.find(row);\n            }\n\n            if (that._isPageable() && that._isPopupEditable() && row instanceof TreeListModel) {\n                // popup editor can be created without a rendered row\n                model = row;\n            } else {\n                model = this.dataItem(row);\n            }\n\n            if (!model) {\n                return;\n            }\n\n            if (that.editor) {\n                model._edit = true;\n                this._render();\n                this._cancelEditor();\n            } else {\n                that._preventPageSizeRestore = false;\n\n            }\n\n            if (this._editMode() != \"popup\") {\n                model._edit = true;\n            }\n\n            if (this.trigger(BEFORE_EDIT, { model: model })) {\n                that.dataSource._restorePageSizeAfterAddChild();\n                return;\n            }\n\n            this._render();\n\n            this._createEditor(model);\n\n            this.trigger(EDIT, {\n                container: this.editor.wrapper,\n                model: model\n            });\n        },\n\n        _cancelEdit: function(e) {\n            if (!this.editor) {\n                return;\n            }\n            var currentIndex;\n\n            e = extend(e, {\n                container: this.editor.wrapper,\n                model: this.editor.model\n            });\n\n            if (this.trigger(CANCEL, e)) {\n                return;\n            }\n\n            if (this.options.navigatable) {\n                currentIndex = this.items().index($(this.current()).parent());\n            }\n\n            this.cancelRow();\n\n            if (this.options.navigatable) {\n                this.current(this.items().eq(currentIndex).children().filter(NAVCELL).first());\n                focusTable(this.table, true);\n            }\n        },\n\n        cancelRow: function() {\n            if (this._isIncellEditable()) {\n                return;\n            }\n\n            this._cancelEditor();\n\n            this._render();\n        },\n\n        saveRow: function() {\n            var editor = this.editor;\n            var args;\n\n            if (this._isIncellEditable()) {\n                return;\n            }\n\n            if (!editor) {\n                return ;\n            }\n\n            args = {\n                model: editor.model,\n                container: editor.wrapper\n            };\n\n            if (editor.end() && !this.trigger(SAVE, args)) {\n                this.dataSource.sync();\n            }\n        },\n\n        addRow: function(parent) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var pageable = that._isPageable();\n            var incellEditing = that._isIncellEditable();\n            var inlineEditing = that._isInlineEditable();\n            var editor = this.editor;\n            var index = 0;\n            var model = {};\n\n            if ((editor && !editor.end()) || !this.options.editable) {\n                return;\n            }\n\n            if (parent) {\n                if (!(parent instanceof TreeListModel)) {\n                    parent = this.dataItem(parent);\n                }\n\n                model[parent.parentIdField] = parent.id;\n                index = this.dataSource.indexOf(parent) + 1;\n\n                this.expand(parent)\n                    .then(function() {\n                        var showNewModelInView = pageable && dataSource._isLastItemInView(parent) && (incellEditing || inlineEditing);\n                        that._insertAt(model, index, showNewModelInView);\n                    });\n\n                return;\n            }\n\n            this._insertAt(model, index);\n        },\n\n        _insertAt: function(model, index, showNewModelInView) {\n            var that = this;\n            var dataSource = that.dataSource;\n            model = that.dataSource.insert(index, model);\n\n            if (showNewModelInView) {\n                dataSource._setAddChildPageSize();\n            }\n\n            var row = this._itemFor(model);\n            var cell;\n\n            if (that._isIncellEditable()) {\n                cell = row.children(\"td\").eq(that._firstEditableColumnIndex(row));\n                that.editCell(cell);\n            } else if (row && row[0]) {\n                that.editRow(row);\n            } else if (that._isPageable() && that._isPopupEditable()) {\n                that.editRow(model);\n            }\n        },\n\n        _firstEditableColumnIndex: function(container) {\n            var that = this;\n            var model = that.dataItem(container);\n            var columns = leafColumns(that.columns);\n            var length = columns.length;\n            var column;\n            var idx;\n\n            for (idx = 0; idx < length; idx++) {\n                column = columns[idx];\n\n                if (model && (!model.editable || model.editable(column.field)) && !column.command && column.field && column.hidden !== true) {\n                    return idx;\n                }\n            }\n\n            return -1;\n        },\n\n        removeRow: function(row) {\n            var model = this.dataItem(row);\n            var args = {\n                model: model,\n                row: row\n            };\n\n            if (this.options.editable && model && !this.trigger(REMOVE, args)) {\n                if (document.activeElement === $(row).find(\".k-grid-delete\")[0]) {\n                    $(row).find(\".k-grid-delete\").trigger(\"blur\");\n                }\n                this.dataSource.remove(model);\n\n                if (!this._isIncellEditable()) {\n                    this.dataSource.sync();\n                }\n            }\n        },\n\n        _cancelEditor: function() {\n            var that = this;\n            var model;\n            var editor = that.editor;\n\n            if (editor) {\n                model = editor.model;\n\n                that._destroyEditor();\n\n                if (!that._isIncellEditable()) {\n                    that.dataSource.cancelChanges(model);\n                } else if (that._shouldRestorePageSize()) {\n                    that.dataSource._restorePageSizeAfterAddChild();\n                }\n\n                model._edit = false;\n            }\n\n            that._preventPageSizeRestore = false;\n        },\n\n        _shouldRestorePageSize: function() {\n            var that = this;\n            return that._isPageable() && that._isIncellEditable() && !that._preventPageSizeRestore;\n        },\n\n        _destroyEditor: function() {\n            if (!this.editor) {\n                return;\n            }\n\n            this.editor.close();\n            this.editor = null;\n        },\n\n        _createEditor: function(model) {\n            var row = this.itemFor(model);\n            var columns = leafColumns(this.columns);\n            var leafCols = [];\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                leafCols.push(extend({}, columns[idx]));\n                delete leafCols[idx].parentColumn;\n            }\n\n            row = row.add(this._relatedRow(row));\n\n            var mode = this._editMode();\n\n            var options = {\n                columns: leafCols,\n                model: model,\n                target: this,\n                clearContainer: false,\n                template: this.options.editable.template\n            };\n\n            if (mode == \"inline\") {\n                this.editor = new Editor(row, options);\n            } else {\n                extend(options, {\n                    window: this.options.editable.window,\n                    commandRenderer: proxy(function() {\n                        return this._buildCommands([\"update\", \"canceledit\"]);\n                    }, this),\n                    fieldRenderer: proxy(this._cellContent, this),\n                    save: proxy(this.saveRow, this),\n                    cancel: proxy(this._cancelEdit, this),\n                    appendTo: this.wrapper\n                });\n\n                this.editor = new PopupEditor(row, options);\n            }\n        },\n\n        _createIncellEditor: function(cell, options) {\n            var that = this;\n            var column = extend({}, options.columns[0]);\n\n            delete column.parentColumn;\n\n            return new IncellEditor(cell, extend({}, {\n                fieldRenderer: proxy(that._cellContent, that),\n                appendTo: that.wrapper,\n                clearContainer: false,\n                target: that,\n                columns: [column],\n                model: options.model,\n                change: options.change\n            }));\n        },\n\n        editCell: function(cell) {\n            var that = this;\n            cell = $(cell);\n            var column = leafColumns(that.columns)[that.cellIndex(cell)];\n            var model = that.dataItem(cell);\n\n            if (that._isIncellEditable() && model && isColumnEditable(column, model)) {\n                that._editCell(cell, column, model);\n            }\n        },\n\n        _editCell: function(cell, column, model) {\n            var that = this;\n            var editedCell;\n\n            if (that.trigger(BEFORE_EDIT, { model: model })) {\n                that.dataSource._restorePageSizeAfterAddChild();\n                return;\n            }\n\n            that.closeCell();\n\n            model._edit = true;\n\n            that._cancelEditor();\n\n            that._render({\n                editedColumn: column,\n                editedColumnIndex: cell.index()\n            });\n\n            editedCell = that.table.add(that.lockedTable).find(DOT + classNames.editCell).first();\n\n            that.editor = that._createIncellEditor(editedCell, {\n                columns: [column],\n                model: model,\n                change: function(e) {\n                    if (that.trigger(SAVE, { values: e.values, container: cell, model: model } )) {\n                        e.preventDefault();\n                    }\n\n                }\n            });\n\n            // refresh the current element as the DOM element reference can be changed after render()\n            that._current = editedCell;\n\n            that.trigger(EDIT, { container: cell, model: model });\n        },\n\n        closeCell: function(isCancel) {\n            var that = this;\n            var cell = (that.editor || {}).element;\n            var tr;\n            var model;\n\n            if (!cell || !cell[0] || !that._isIncellEditable()) {\n                return;\n            }\n\n            model = that.dataItem(cell);\n\n            if (isCancel && that.trigger(CANCEL, { container: cell, model: model })) {\n                return;\n            }\n\n            that.trigger(CELL_CLOSE, { type: isCancel ? CANCEL: SAVE, model: model, container: cell });\n\n            that._cancelEditor();\n\n            cell.removeClass(classNames.editCell);\n\n            tr = cell.parent().removeClass(classNames.editRow);\n\n            if (that.lockedContent) {\n                that._relatedRow(tr).removeClass(classNames.editRow);\n            }\n\n            that._render();\n\n            that.trigger(ITEM_CHANGE, { item: tr, data: model, ns: ui });\n\n            if (that.lockedContent) {\n                adjustRowHeight(tr.css(\"height\", \"\")[0], that._relatedRow(tr).css(\"height\", \"\")[0]);\n            }\n        },\n\n        cancelChanges: function() {\n            this.dataSource.cancelChanges();\n        },\n\n        saveChanges: function() {\n            var that = this;\n            var editable = (that.editor || {}).editable;\n            var valid = editable && editable.end();\n\n            if ((valid || !editable) && !that.trigger(SAVE_CHANGES)) {\n                that.dataSource.sync();\n            }\n        },\n\n        _editMode: function() {\n            var mode = \"inline\",\n                editable = this.options.editable;\n\n            if (editable !== true) {\n                if (typeof editable == \"string\") {\n                    mode = editable;\n                } else {\n                    mode = editable.mode || mode;\n                }\n            }\n\n            return mode.toLowerCase();\n        },\n\n        _isIncellEditable: function() {\n            return this._editMode() === INCELL;\n        },\n\n        _isInlineEditable: function() {\n            return this._editMode() === INLINE;\n        },\n\n        _isPopupEditable: function() {\n            return this._editMode() === POPUP;\n        },\n\n        hideColumn: function(column) {\n            this._toggleColumnVisibility(column, true);\n        },\n\n        showColumn: function(column) {\n            this._toggleColumnVisibility(column, false);\n        },\n\n        _toggleColumnVisibility: function(column, hidden) {\n            column = this._findColumn(column);\n\n            if (!column || column.hidden === hidden) {\n                return;\n            }\n\n            column.hidden = hidden;\n            this._setParentsVisibility(column, !hidden);\n\n            this._ensureExpandableColumn();\n            this._clearColsCache();\n            this._renderCols();\n            this._renderHeader();\n            this._render();\n\n            this._adjustTablesWidth();\n\n            this.trigger(hidden ? COLUMNHIDE : COLUMNSHOW, { column: column });\n\n            if (!hidden && !column.width) {\n                this.table\n                    .add(this.thead.closest(\"table\"))\n                    .width(\"\");\n            }\n            this._updateFirstColumnClass();\n        },\n\n        _findColumn: function(column) {\n            if (typeof column == \"number\") {\n                column = this.columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(leafColumns(this.columns), function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(leafColumns(this.columns), function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            return column;\n        },\n\n        _adjustTablesWidth: function() {\n            var idx, length;\n            var cols = this.thead.prev().children();\n            var colWidth, width = 0;\n\n            for (idx = 0, length = cols.length; idx < length; idx++ ) {\n                colWidth = cols[idx].style.width;\n                if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                    width += parseInt(colWidth, 10);\n                } else {\n                    width = 0;\n                    break;\n                }\n            }\n\n\n            if (width) {\n                this.table\n                    .add(this.thead.closest(\"table\"))\n                    .width(width);\n            }\n        },\n\n        _reorderable: function() {\n            if (!this.options.reorderable) {\n                return;\n            }\n\n            var scrollable = this.options.scrollable === true;\n            var selector = (scrollable ? \".k-grid-header:first \" : \"table:first>.k-grid-header \") + HEADERCELLS;\n            var that = this;\n\n            this._draggableInstance = new ui.Draggable(this.wrapper, {\n                group: kendo.guid(),\n                filter: selector,\n                hint: function(target) {\n                    return $('<div class=\"k-reorder-clue k-drag-clue\" />')\n                    .html(target.attr(kendo.attr(\"title\")) || target.attr(kendo.attr(\"field\")) || target.text())\n                    .prepend('<span class=\"k-icon k-drag-status k-i-cancel\" />');\n                }\n            });\n\n            this.reorderable = new ui.Reorderable(this.wrapper, {\n                draggable: this._draggableInstance,\n                dragOverContainers: proxy(this._allowDragOverContainers, this),\n                inSameContainer: function(e) {\n                    return $(e.source).parent()[0] === $(e.target).parent()[0] && targetParentContainerIndex(flatColumnsInDomOrder(that.columns), that.columns, e.sourceIndex, e.targetIndex) > -1;\n                },\n                change: function(e) {\n                    var columns = flatColumnsInDomOrder(that.columns);\n                    var column = columns[e.oldIndex];\n                    var newIndex = targetParentContainerIndex(columns, that.columns, e.oldIndex, e.newIndex);\n\n                    that.trigger(COLUMNREORDER, {\n                        newIndex: newIndex,\n                        oldIndex: inArray(column, columns),\n                        column: column\n                    });\n\n                    that.reorderColumn(newIndex, column, e.position === \"before\");\n                }\n            });\n        },\n\n        _allowDragOverContainers: function(sourceIndex, targetIndex) {\n            var columns = flatColumnsInDomOrder(this.columns);\n            return columns[sourceIndex].lockable !== false && targetParentContainerIndex(columns, this.columns, sourceIndex, targetIndex) > -1;\n        },\n\n        _reorderTrees: function(destSources, destContainer, destDomTree, sources, sourcesContainer, sourcesDomTree, before, depth) {\n            var ths = $();\n            var source = sourcesContainer.find(\"tr\").eq(sources[0].rowIndex);\n            var sourceDOM = sourcesDomTree.children[sources[0].rowIndex];\n            var sourceChildren = source.children();\n            var destDomChildren;\n            var currentIndex;\n            var destColumn = before? destSources[0] : destSources[destSources.length -1];\n            var destRow;\n            var sourcesLeafs;\n            var destLeafs;\n            var reorderTaget;\n            var destThs;\n\n            for (var idx = 0; idx < sources.length; idx++) {\n                currentIndex = sources[idx].cellIndex;\n                ths = ths.add(sourceChildren.eq(currentIndex));\n                destDomChildren = destDomTree.children[destColumn.rowIndex].children;\n                if (destDomTree === sourcesDomTree && before) {\n                    currentIndex += idx;\n                }\n\n                destDomChildren.splice(before ? destColumn.cellIndex + idx : destColumn.cellIndex + 1+ idx, 0, sourceDOM.children[currentIndex]);\n            }\n\n            if (destDomTree === sourcesDomTree && before) {\n                sourceDOM.children.splice(sources[0].cellIndex + sources.length, sources.length);\n            } else {\n                sourceDOM.children.splice(sources[0].cellIndex, sources.length);\n            }\n            destRow = destContainer.find(\"tr\").eq(destColumn.rowIndex);\n            destThs = destRow.find(\">th.k-header\").eq(destColumn.cellIndex);\n\n            if (destThs.length && ths[0] !== destThs[0]) {\n                ths[before ? \"insertBefore\" : \"insertAfter\"](destThs);\n            }\n\n            if (depth >= sources[0].rowIndex + 1 && depth != 1) {\n                sourcesLeafs = [];\n                for (idx = 0; idx < sources.length; idx++) {\n                    if (sources[idx].columns) {\n                        sourcesLeafs = sourcesLeafs.concat(sources[idx].columns);\n                    }\n                }\n                if (!sourcesLeafs.length) {\n                    return;\n                }\n\n                destLeafs = [];\n\n                for (idx = 0; idx < destSources.length; idx++) {\n                    if (destSources[idx].columns) {\n                        destLeafs = destLeafs.concat(destSources[idx].columns);\n                    }\n                }\n\n                if (!destLeafs.length && (destContainer !== sourcesContainer || (destColumn.cellIndex - sources[0].cellIndex > 1 || sources[0].cellIndex - destColumn.cellIndex > 1))) {\n                    reorderTaget = findReorderTarget(this.columns, destColumn, sources[0], before, this.columns);\n\n                    destLeafs = [reorderTaget];\n                    if (!reorderTaget && sourcesLeafs.length && destContainer.find(\"tr\").length > sources[0].rowIndex + 1) {\n                        this._insertTree(sourcesLeafs, sourcesContainer, sourcesDomTree, destContainer, destDomTree);\n                        return;\n                    }\n                }\n\n                if (!destLeafs.length) {\n                    return;\n                }\n\n                this._reorderTrees(destLeafs, destContainer, destDomTree, sourcesLeafs, sourcesContainer, sourcesDomTree, before, depth);\n            }\n        },\n\n        _insertTree: function(columns, sourcesContainer, sourcesDomTree, destContainer, destDomTree) {\n            var leafs = [];\n            var row;\n            var ths = $();\n            var domTr;\n\n            row = sourcesContainer.find(\"tr\").eq(columns[0].rowIndex);\n            domTr = sourcesDomTree.children[columns[0].rowIndex];\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                if (columns[idx].columns) {\n                    leafs = leafs.concat(columns[idx].columns);\n                }\n                destDomTree.children[columns[0].rowIndex].children.splice(idx, 0, domTr.children[columns[idx].rowIndex]);\n                ths = ths.add(row.find(\">th.k-header\").eq(columns[idx].cellIndex));\n            }\n\n            sourcesDomTree.children[columns[0].rowIndex].children.splice(columns[0].cellIndex, columns.length);\n            destContainer.find(\"tr\").eq(columns[0].rowIndex).append(ths);\n\n            if (leafs.length) {\n                this._insertTree(leafs, sourcesContainer, sourcesDomTree, destContainer, destDomTree);\n            }\n        },\n\n        _reorderHeader: function(destColumn, column, before) {\n            var sourcesDepth = column.columns ? depth([column]) : 1;\n            var targetDepth = destColumn.columns ? depth([destColumn]) : 1;\n            var sourceLocked = isLocked(column);\n            var destLocked = isLocked(destColumn);\n            var destContainer = destLocked ? this.lockedHeader : this.thead;\n            var sourcesContainer = sourceLocked ? this.lockedHeader : this.thead;\n            var destDomTree = destLocked ? this._lockedHeaderTree : this._headerTree;\n            var sourcesDomTree = sourceLocked ? this._lockedHeaderTree : this._headerTree;\n            var rowsToAdd;\n            var destRows = destContainer.find(\"tr:not(.k-filter-row)\");\n            var destTarget;\n\n\n            if (sourcesDepth === targetDepth || sourcesDepth < destRows.length ) {\n                this._reorderTrees([destColumn], destContainer, destDomTree , [column], sourcesContainer ,sourcesDomTree, before, sourcesDepth);\n                updateRowSpans(destContainer, destDomTree);\n                removeEmptyRows(sourcesContainer, sourcesDomTree);\n            } else {\n                if (destContainer !== sourcesContainer) {\n                    rowsToAdd = sourcesDepth - destRows.length;\n\n                    destRows.each(function (idx) {\n                        var cells = this.cells;\n                        for (var i = 0; i < cells.length; i++) {\n                            if (cells[i].colSpan <= 1 && cells[i].attributes.rowspan) {\n                                destDomTree.children[idx].children[i].attr.rowSpan += rowsToAdd;\n                                cells[i].rowSpan += rowsToAdd;\n                            }\n                        }\n                    });\n\n                    for (var j = 0; j < rowsToAdd ; j++) {\n                       destDomTree.children.push(kendoDomElement(\"tr\", { \"role\": \"row\" }));\n                       if (destContainer.is(\"thead\")) {\n                           destTarget = destContainer;\n                       } else {\n                          destTarget = destContainer.find(\"thead\");\n                       }\n\n                       if (this._hasFilterRow()) {\n                           $(\"<tr role='row'></tr>\").insertBefore(destTarget.find('tr.k-filter-row'));\n                       } else {\n                           destTarget.append(\"<tr role='row'></tr>\");\n                       }\n                    }\n                }\n\n                this._reorderTrees([destColumn], destContainer, destDomTree , [column], sourcesContainer ,sourcesDomTree, before, sourcesDepth);\n                removeEmptyRows(sourcesContainer, sourcesDomTree);\n             }\n        },\n\n        reorderColumn: function(destIndex, column, before) {\n            var lockChanged;\n            var parent = column.parentColumn;\n            var columns = parent ? parent.columns : this.columns;\n            var sourceIndex = inArray(column, columns);\n            var destColumn = columns[destIndex];\n            var isLocked = !!destColumn.locked;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n            var nonLockedColumnsLength = nonLockedColumns(columns).length;\n\n            if (sourceIndex === destIndex) {\n                return;\n            }\n\n            if (isLocked && !column.locked && nonLockedColumnsLength == 1) {\n                return;\n            }\n\n            if (!isLocked && column.locked && (columns.length - nonLockedColumnsLength == 1)) {\n                return;\n            }\n\n            if (before === undefined) {\n                before = destIndex < sourceIndex;\n            }\n\n            if (hasMultiColumnHeaders) {\n                this._reorderHeader(destColumn, column, before);\n            }\n\n            lockChanged = !!column.locked;\n            lockChanged = lockChanged != isLocked;\n\n            column.locked = isLocked;\n            columns.splice(before ? destIndex : destIndex + 1, 0, column);\n            columns.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n            this._setColumnDataIndexes(leafColumns(this.columns));\n            this._clearColsCache();\n            this._renderCols();\n\n            //reorder column header manually\n            if (!hasMultiColumnHeaders) {\n                var ths = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n\n                ths.eq(sourceIndex)[before ? \"insertBefore\" : \"insertAfter\"](ths.eq(destIndex));\n\n                var dom = this._headerTree.children[0].children;\n                if (this._hasLockedColumns) {\n                    dom = this._lockedHeaderTree.children[0].children.concat(dom);\n                }\n                dom.splice(before ? destIndex : destIndex + 1, 0, dom[sourceIndex]);\n                dom.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n                if (this._hasLockedColumns) {\n                    this._lockedHeaderTree.children[0].children = dom.splice(0, lockedColumns(columns).length);\n                    this._headerTree.children[0].children = dom;\n                }\n            } else {\n                if (this.lockedHeader) {\n                    columns = nonLockedColumns(this.columns);\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], columns);\n                    columns = lockedColumns(this.columns);\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], columns);\n                } else {\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], this.columns);\n                }\n            }\n            this._updateColumnCellIndex();\n            this._applyLockedContainersWidth();\n            this._syncLockedHeaderHeight();\n            this._updateFirstColumnClass();\n\n            if (this._hasFilterRow()) {\n                this._updateFilterThs(before, column, destColumn);\n            }\n\n            this.refresh();\n\n            if(!lockChanged) {\n                return;\n            }\n\n            if (isLocked) {\n                this.trigger(COLUMNLOCK, {\n                    column: column\n                });\n            } else {\n                this.trigger(COLUMNUNLOCK, {\n                    column: column\n                });\n            }\n        },\n\n        lockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length - 1;\n            this.reorderColumn(index, column, false);\n        },\n\n        unlockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length;\n            this.reorderColumn(index, column, true);\n        },\n\n        _columnMenu: function() {\n            var ths = $(this.lockedHeader).add(this.thead).find(\"th\");\n            var columns = this.columns;\n            var options = this.options;\n            var columnMenu = options.columnMenu;\n            var column, menu, menuOptions, sortable, filterable;\n            var initHandler = proxy(this._columnMenuInit, this);\n            var openHandler = proxy(this._columnMenuOpen, this);\n            var hasLockableColumns = grep(this.columns, function(item) {\n                return item.lockable !== false;\n            }).length > 0;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (hasMultiColumnHeaders) {\n                columns = leafColumns(columns);\n                if (this.lockedHeader) {\n                    ths = sortCells(leafDataCells(this.lockedHeader.find(\">table>thead\")).add(leafDataCells(this.thead)));\n                } else {\n                    ths = leafDataCells(this.thead);\n                }\n            } else {\n                ths = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n\n            if (!columnMenu) {\n                return;\n            }\n\n            if (typeof columnMenu == \"boolean\") {\n                columnMenu = {};\n            }\n\n            for (var i = 0; i < ths.length; i++) {\n                column = columns[i];\n                if (!column.field) {\n                    continue;\n                }\n\n                menu = ths.eq(i).data(\"kendoColumnMenu\");\n                if (menu) {\n                    menu.destroy();\n                }\n\n                sortable = false;\n                if (column.sortable !== false && columnMenu.sortable !== false && options.sortable !== false) {\n                    sortable = extend({}, options.sortable, { compare: (column.sortable || {}).compare });\n                }\n\n                filterable = false;\n                if (options.filterable && column.filterable !== false && columnMenu.filterable !== false) {\n                    filterable = extend({ pane: this.pane }, column.filterable, options.filterable);\n                }\n\n                menuOptions = {\n                    dataSource: this.dataSource,\n                    values: column.values,\n                    columns: columnMenu.columns,\n                    sortable: sortable,\n                    filterable: filterable,\n                    messages: columnMenu.messages,\n                    owner: this,\n                    closeCallback: $.noop,\n                    init: initHandler,\n                    open: openHandler,\n                    pane: this.pane,\n                    hasLockableColumns: lockedColumns(columns).length > 0 && hasLockableColumns && !hasMultiColumnHeaders,\n                    appendTo: DOT + classNames.headerCellInner\n                };\n\n                if (options.$angular) {\n                    menuOptions.$angular = options.$angular;\n                }\n\n                ths.eq(i).kendoColumnMenu(menuOptions);\n            }\n        },\n\n        _columnMenuInit: function(e) {\n            this.trigger(COLUMNMENUINIT, { field: e.field, container: e.container });\n        },\n\n        _columnMenuOpen: function(e) {\n            this.trigger(COLUMNMENUOPEN, { field: e.field, container: e.container });\n        },\n\n        _pageable: function() {\n            var that = this,\n                wrapper,\n                pageable = that.options.pageable;\n\n            if (pageable) {\n                wrapper = that.wrapper.children(\"div.k-grid-pager\");\n\n                if (!wrapper.length) {\n                    wrapper = $('<div class=\"k-pager-wrap k-grid-pager\"/>').appendTo(that.wrapper);\n                }\n\n                that._destroyPager();\n\n                if (typeof pageable === \"object\" && pageable instanceof kendo.ui.TreeListPager) {\n                    that.pager = pageable;\n                } else if (that.dataSource && !that.dataSource.options.serverPaging) {\n                    that._createPager(wrapper);\n                }\n\n                if (that.pager) {\n                    that.pager.bind(PAGE_CHANGE, function(e) {\n                        if (that.trigger(PAGE, { page: e.index })) {\n                            e.preventDefault();\n                        }\n                    });\n                }\n            }\n        },\n\n        _createPager: function(element, options) {\n            var that = this;\n\n            that.pager = new TreeListPager(element, extend({}, that.options.pageable, {\n                dataSource: that.dataSource,\n                navigatable: that.options.navigatable\n            }, options));\n        },\n\n        _destroyPager: function() {\n            if (this.pager) {\n                this.pager.destroy();\n                this.pager = null;\n            }\n        },\n\n        _isPageable: function() {\n            var that = this;\n            return that.options.pageable && (!that.dataSource || (that.dataSource && that.dataSource._isPageable()));\n        },\n\n        _togglePagerVisibility: function() {\n            var that = this;\n            var pageable = that.options.pageable;\n\n            if (pageable && (isPlainObject(pageable) || pageable instanceof TreeListPager) && pageable.alwaysVisible === false) {\n                that.wrapper.find(\".k-grid-pager\").toggle((that.dataSource.collapsedTotal() || 0) >= that.dataSource.pageSize());\n            }\n        }\n    });\n\n    function isInputElement(element) {\n       return $(element).is(\":button,a,:input,a>.k-icon,textarea,span.k-select,span.k-icon,span.k-link,.k-input,.k-multiselect-wrap,.k-tool-icon\");\n    }\n\n    function isLocked(column) {\n        if (!column.parentColumn) {\n            return !!column.locked;\n        }\n        return !!isLocked(column.parentColumn);\n    }\n\n    function findParentColumnWithChildren(columns, index, source, rtl) {\n        var target;\n        var locked = !!source.locked;\n        var targetLocked;\n\n        do {\n            target = columns[index];\n            index += rtl ? 1 : -1;\n            targetLocked = !!target.locked;\n        } while(target && index > -1 && index < columns.length && target != source && !target.columns && targetLocked === locked);\n\n        return target;\n    }\n\n    function findReorderTarget(columns, target, source, before, masterColumns) {\n        if (target.columns) {\n            target = target.columns;\n            return target[before ? 0 : target.length - 1];\n        } else {\n            var parent = columnParent(target, columns);\n            var parentColumns;\n\n            if (parent) {\n                parentColumns = parent.columns;\n            } else {\n                parentColumns = columns;\n            }\n\n            var index = inArray(target, parentColumns);\n            if (index === 0 && before && parentColumns.length !== 1) {\n                index++;\n            } else if (index == parentColumns.length - 1 && !before && index !== 0) {\n                index--;\n            } else if (index > 0 || (index === 0 && !before && index !== 0)) {\n                index += before ? -1 : 1;\n            }\n\n            var sourceIndex = inArray(source, parentColumns);\n            target = findParentColumnWithChildren(parentColumns, index, source, sourceIndex > index);\n            var targetIndex = inArray(target, masterColumns);\n            if (target.columns && (!targetIndex || targetIndex === parentColumns.length -1)) {\n                return null;\n            }\n\n            if (target && target != source && target.columns) {\n                return findReorderTarget(columns, target, source, before, masterColumns);\n            }\n        }\n        return null;\n    }\n\n    function leafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (!columns[idx].columns) {\n                result.push(columns[idx]);\n                continue;\n            }\n            result = result.concat(leafColumns(columns[idx].columns));\n        }\n\n        return result;\n    }\n\n    function getColumnsFields(columns) {\n        var result = [];\n        columns = leafColumns(columns);\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (typeof columns[idx] === \"string\") {\n                result.push(columns[idx]);\n            } else if (columns[idx].field) {\n                result.push(columns[idx].field);\n            }\n        }\n        return result;\n    }\n\n    function visibleChildColumns(columns) {\n        return grep(columns, function(column) {\n            return !column.hidden;\n        });\n    }\n\n    function isVisible(column) {\n        return visibleColumns([column]).length > 0;\n    }\n\n    function visibleColumns(columns) {\n        return grep(columns, function(column) {\n            var result = !column.hidden;\n            if (result && column.columns) {\n                result = visibleColumns(column.columns).length > 0;\n            }\n            return result;\n        });\n    }\n\n    function normalizeColumns(columns, hide, parentIds) {\n        return map(columns, function(column) {\n            var hidden;\n\n            column.parentIds = parentIds;\n\n            if (!isVisible(column) || hide) {\n                hidden = true;\n            }\n\n            var uid = kendo.guid();\n            column.headerAttributes = extend({headers: parentIds}, column.headerAttributes);\n            if (!column.headerAttributes || !column.headerAttributes.id) {\n                column.headerAttributes = extend({id: uid}, column.headerAttributes);\n            } else {\n                uid = column.headerAttributes.id;\n            }\n\n            if (column.columns) {\n                column.columns = normalizeColumns(column.columns, hidden, parentIds ? (parentIds + \" \" + uid): uid);\n            }\n            return extend({ hidden: hidden }, column);\n        });\n    }\n\n    function flatColumnsInDomOrder(columns) {\n        var result = flatColumns(lockedColumns(columns));\n        return result.concat(flatColumns(nonLockedColumns(columns)));\n    }\n\n    function targetParentContainerIndex(flatColumns, columns, sourceIndex, targetIndex) {\n        var column = flatColumns[sourceIndex];\n        var target = flatColumns[targetIndex];\n\n        var parent = columnParent(column, columns);\n        columns = parent ? parent.columns : columns;\n\n        return inArray(target, columns);\n    }\n\n    function parentColumnsCells(cell) {\n        var container = cell.closest(\"table\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr\");\n        var level = headerRows.index(row);\n        if (level > 0) {\n            var parent = headerRows.eq(level - 1);\n            var parentCellsWithChildren = parent.find(\"th\").filter(function() {\n                return !$(this).attr(\"rowspan\");\n            });\n\n            var offset = 0;\n            var index = row.find(\"th\").index(cell);\n\n            var prevCells = cell.prevAll().filter(function() {\n                return this.colSpan > 1;\n            });\n\n            for (var idx = 0; idx < prevCells.length; idx++) {\n                offset += prevCells[idx].colSpan || 1;\n            }\n\n            index += Math.max(offset - 1, 0);\n\n            offset = 0;\n            for (idx = 0; idx < parentCellsWithChildren.length; idx++) {\n                var parentCell = parentCellsWithChildren.eq(idx);\n                if (parentCell.attr(\"data-colspan\")) {\n                    offset += parentCell[0].getAttribute(\"data-colspan\");\n                } else {\n                    offset += 1;\n                }\n                if (index >= idx && index < offset) {\n                    result = parentColumnsCells(parentCell).add(result);\n                    break;\n                }\n            }\n        }\n        return result;\n    }\n\n    function childColumnsCells(cell) {\n        var container = cell.closest(\"thead\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr\");\n        var level = headerRows.index(row) + cell[0].rowSpan;\n        var colSpanAttr = kendo.attr(\"colspan\");\n\n        if (level <= headerRows.length - 1) {\n            var child = row.next();\n            var prevCells = cell.prevAll();\n\n            var idx;\n\n            prevCells = prevCells.filter(function() {\n                return !this.rowSpan || this.rowSpan === 1;\n            });\n\n            var offset = 0;\n\n            for (idx = 0; idx < prevCells.length; idx++) {\n                offset += parseInt(prevCells.eq(idx).attr(colSpanAttr), 10) || 1;\n            }\n\n            var cells = child.find(\"th\");\n            var colSpan = parseInt(cell.attr(colSpanAttr), 10) || 1;\n\n            idx = 0;\n\n            while (idx < colSpan) {\n                child = cells.eq(idx + offset);\n                result = result.add(childColumnsCells(child));\n                var value = parseInt(child.attr(colSpanAttr), 10);\n                if (value > 1) {\n                    colSpan -= value - 1;\n                }\n                idx++;\n            }\n        }\n\n        return result;\n    }\n\n    function columnParent(column, columns) {\n        var parents = [];\n        columnParents(column, columns, parents);\n        return parents[parents.length - 1];\n    }\n\n    function columnParents(column, columns, parents) {\n        parents = parents || [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (column === columns[idx]) {\n                return true;\n            } else if (columns[idx].columns) {\n                var inserted = parents.length;\n                parents.push(columns[idx]);\n                if (!columnParents(column, columns[idx].columns, parents)) {\n                    parents.splice(inserted, parents.length - inserted);\n                } else {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    function flatColumns(columns) {\n        var result = [];\n        var children = [];\n        for (var idx = 0; idx < columns.length; idx++) {\n            result.push(columns[idx]);\n            if (columns[idx].columns) {\n                children = children.concat(columns[idx].columns);\n            }\n\n        }\n        if (children.length) {\n            result = result.concat(flatColumns(children));\n        }\n        return result;\n    }\n\n    function columnPosition(column, columns, row, cellCounts) {\n        var result;\n        var idx;\n\n        row = row || 0;\n        cellCounts = cellCounts || {};\n        cellCounts[row] = cellCounts[row] || 0;\n\n        for (idx = 0; idx < columns.length; idx++) {\n           if (columns[idx] == column) {\n                result = { cell: cellCounts[row], row: row };\n                break;\n           } else if (columns[idx].columns) {\n               result = columnPosition(column, columns[idx].columns, row + 1, cellCounts);\n               if (result) {\n                    break;\n               }\n           }\n\n           cellCounts[row]++;\n        }\n        return result;\n    }\n\n    function updateCellIndex(thead, columns, offset) {\n        offset = offset || 0;\n\n        var position;\n        var cell;\n        var allColumns = columns;\n        columns = leafColumns(columns);\n\n        var cells = {};\n        var rows = thead.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        for (var idx = 0, length = columns.length; idx < length; idx++) {\n            position = columnPosition(columns[idx], allColumns);\n\n            if (!cells[position.row]) {\n                cells[position.row] = rows.eq(position.row)\n                    .find(\".k-header\")\n                    .filter(filter);\n            }\n\n            cell = cells[position.row].eq(position.cell);\n            cell.attr(kendo.attr(\"index\"), offset + idx);\n        }\n\n        return columns.length;\n    }\n\n    function depth(columns) {\n        var result = 1;\n        var max = 0;\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].columns) {\n                var temp = depth(columns[idx].columns);\n                if (temp > max) {\n                    max = temp;\n                }\n            }\n        }\n        return result + max;\n    }\n\n    function lockedColumns(columns) {\n        return grep(columns, is(\"locked\"));\n    }\n\n    function nonLockedColumns(columns) {\n        return grep(columns, not(is(\"locked\")));\n    }\n\n    function updateRowSpans(container, containerDOMtree) {\n        var rows = container.find(\"tr:not(.k-filter-row)\");\n        var length = rows.length;\n\n        rows.each(function (idx) {\n            var cells = this.cells;\n            for (var i = 0; i < cells.length; i++) {\n                if (cells[i].colSpan <= 1 && cells[i].attributes.rowspan) {\n                    containerDOMtree.children[idx].children[i].attr.rowSpan = length - idx;\n                    cells[i].rowSpan = length - idx;\n                }\n            }\n        });\n    }\n\n    function removeEmptyRows(container, containerDOMtree) {\n        var rows = container.find(\"tr\");\n        var emptyRows = [];\n\n        rows.filter(function(idx) {\n            var shouldRemove = !$(this).children().length;\n            if (shouldRemove) {\n                emptyRows.push(idx);\n\n            }\n            return shouldRemove;\n        }).remove();\n\n        for (var i = emptyRows.length - 1; i >= 0; i--) {\n            containerDOMtree.children.splice(emptyRows[i], 1);\n        }\n\n        updateRowSpans(container, containerDOMtree);\n    }\n\n    function focusTable(table, direct) {\n      if (direct === true) {\n         table = $(table);\n         var scrollTop, scrollLeft;\n         scrollTop = table.parent().scrollTop();\n         scrollLeft = kendo.scrollLeft(table.parent());\n\n        kendo.focusElement(table);\n\n        kendo.scrollLeft(table.parent().scrollTop(scrollTop), scrollLeft);\n\n      } else {\n         $(table).one(\"focusin\", function(e) { e.preventDefault(); }).trigger(\"focus\");\n      }\n    }\n\n    function adjustRowHeight(row1, row2) {\n       var height;\n       var offsetHeight1 = row1.offsetHeight;\n       var offsetHeight2 = row2.offsetHeight;\n\n       if (offsetHeight1 > offsetHeight2) {\n           height = offsetHeight1 + \"px\";\n       } else if (offsetHeight1 < offsetHeight2) {\n           height = offsetHeight2 + \"px\";\n       }\n\n       if (height) {\n           row1.style.height = row2.style.height = height;\n       }\n    }\n\n    function isColumnEditable(column, model) {\n        if (!column || !model || !column.field || column.selectable || column.command || (column.editable && !column.editable(model))) {\n            return false;\n        }\n\n        return (column.field && model.editable && model.editable(column.field));\n    }\n\n    function isDirtyColumn(column, model) {\n        var field = (column || {}).field || \"\";\n        return (model.dirty && model.dirtyFields && model.dirtyFields[field] && isColumnEditable(column, model));\n    }\n\n    function isUndefined(value) {\n        return typeof(value) === \"undefined\";\n    }\n\n    function isNumber(value) {\n        return typeof value === \"number\" && !isNaN(value);\n    }\n\n    if (kendo.ExcelMixin) {\n        kendo.ExcelMixin.extend(TreeList.prototype);\n    }\n\n    if (kendo.PDFMixin) {\n        kendo.PDFMixin.extend(TreeList.prototype);\n\n       TreeList.prototype._drawPDF = function(progress) {\n           var treeList = this;\n\n           if (treeList.options.pdf.paperSize && treeList.options.pdf.paperSize != \"auto\") {\n               return treeList._drawPDF_autoPageBreak(progress);\n           }\n\n           var result = new $.Deferred();\n           var dataSource = treeList.dataSource;\n           var allPages = treeList.options.pdf.allPages;\n\n           this._initPDFProgress(progress);\n\n           // This group will be our document containing all pages\n           var doc = new kendo.drawing.Group();\n           var startingPage = dataSource.page();\n\n           function resolve() {\n               if (allPages && startingPage !== undefined) {\n                   dataSource.unbind(\"change\", exportPage);\n                   dataSource.one(\"change\", function() {\n                       result.resolve(doc);\n                   });\n\n                   dataSource.page(startingPage);\n               } else {\n                   result.resolve(doc);\n               }\n           }\n\n           function exportPage() {\n                treeList._drawPDFShadow({\n                    width: treeList.wrapper.width()\n                }, {\n                    avoidLinks: treeList.options.pdf.avoidLinks\n                })\n                .done(function(group) {\n                    var pageNum = dataSource.page();\n                    var totalPages = allPages ? dataSource.totalPages() : 1;\n\n                    var args = {\n                        page: group,\n                        pageNumber: pageNum,\n                        progress: pageNum / totalPages,\n                        totalPages: totalPages\n                    };\n\n                    progress.notify(args);\n                    doc.append(args.page);\n\n                    if (pageNum < totalPages) {\n                        dataSource.page(pageNum + 1);\n                    } else {\n                        resolve();\n                    }\n                })\n                .fail(function(err) {\n                    result.reject(err);\n                });\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", exportPage);\n                dataSource.page(1);\n            } else {\n                exportPage();\n            }\n\n            return result.promise();\n        };\n\n        TreeList.prototype._initPDFProgress = function(deferred) {\n            var loading = $(\"<div class='k-loading-pdf-mask'><div class='k-loading-color'></div></div>\");\n            loading.prepend(this.wrapper.clone().css({\n                position: \"absolute\", top: 0, left: 0\n            }));\n\n            this.wrapper.append(loading);\n\n            var progressBar = $(\"<div class='k-loading-pdf-progress'>\")\n                .appendTo(loading)\n                .kendoProgressBar({\n                    type: \"chunk\",\n                    chunkCount: 10,\n                    min: 0,\n                    max: 1,\n                    value: 0\n                }).data(\"kendoProgressBar\");\n\n            deferred.progress(function(e) {\n                progressBar.value(e.progress);\n            })\n            .always(function() {\n                kendo.destroy(loading);\n                loading.remove();\n            });\n        };\n\n        TreeList.prototype._drawPDF_autoPageBreak = function(progress) {\n            var treeList = this;\n            var result = new $.Deferred();\n            var dataSource = treeList.dataSource;\n            var allPages = treeList.options.pdf.allPages;\n            var origBody = treeList.wrapper.find('table[role=\"treeList\"] > tbody');\n            var cont = $(\"<div>\")\n                .css({ position: \"absolute\", left: -10000, top: -10000 });\n            var clone = treeList.wrapper.clone().css({\n                height: \"auto\", width: \"auto\"\n            }).appendTo(cont);\n            clone.find(\".k-grid-content\").css({ height: \"auto\", width: \"auto\", overflow: \"visible\" });\n            clone.find('table[role=\"treeList\"], .k-grid-footer table').css({ height: \"auto\", width: \"100%\", overflow: \"visible\" });\n            clone.find(\".k-grid-pager, .k-grid-toolbar, .k-grouping-header\").remove();\n            clone.find(\".k-grid-header, .k-grid-footer\").css({ paddingRight: 0 });\n\n            this._initPDFProgress(progress);\n\n            var body = clone.find('table[role=\"treeList\"] > tbody').empty();\n            var startingPage = dataSource.page();\n\n            function resolve() {\n                if (allPages && startingPage !== undefined) {\n                    dataSource.one(\"change\", draw);\n                    dataSource.page(startingPage);\n                } else {\n                    treeList.refresh();\n                    draw();\n                }\n            }\n\n            function draw() {\n                cont.appendTo(document.body);\n                var options = $.extend({}, treeList.options.pdf, {\n                    _destructive: true,\n                    progress: function(p) {\n                        progress.notify({\n                            page: p.page,\n                            pageNumber: p.pageNum,\n                            progress: 0.5 + p.pageNum / p.totalPages / 2,\n                            totalPages: p.totalPages\n                        });\n                    }\n                });\n                kendo.drawing.drawDOM(clone, options)\n                    .always(function(){\n                        cont.remove();\n                    })\n                    .then(function(group){\n                        result.resolve(group);\n                    })\n                    .fail(function(err){\n                        result.reject(err);\n                    });\n            }\n\n            function renderPage() {\n                var pageNum = dataSource.page();\n                var totalPages = allPages ? dataSource.totalPages() : 1;\n                body.append(origBody.find(\"tr\"));\n                if (pageNum < totalPages) {\n                    dataSource.page(pageNum + 1);\n                } else {\n                    dataSource.unbind(\"change\", renderPage);\n                    resolve();\n                }\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", renderPage);\n                dataSource.page(1);\n            } else {\n                renderPage();\n            }\n\n            return result.promise();\n        };\n    }\n\n    extend(true, kendo.data, {\n        TreeListDataSource: TreeListDataSource,\n        TreeListModel: TreeListModel\n    });\n\n    ui.plugin(TreeList);\n    ui.plugin(TreeListPager);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","features","$","window","kendo","jQuery","undefined","data","kendoDom","dom","kendoDomElement","element","kendoTextElement","text","kendoHtmlElement","html","outerWidth","_outerWidth","keys","outerHeight","_outerHeight","ui","DataBoundWidget","DataSource","ObservableArray","Query","Model","browser","support","kendoTemplate","template","activeElement","_activeElement","touchDevice","touch","isArray","Array","extend","proxy","map","grep","inArray","isPlainObject","push","prototype","STRING","CHANGE","ITEM_CHANGE","ERROR","PROGRESS","DOT","NS","CLICK","INPUT","BEFORE_EDIT","EDIT","PAGE","PAGE_CHANGE","SAVE","SAVE_CHANGES","SORT","EXPAND","COLLAPSE","CELL_CLOSE","REMOVE","DATA_CELL","FILTER_CELL","DATABINDING","DATABOUND","CANCEL","TABINDEX","FILTERMENUINIT","FILTERMENUOPEN","COLUMNHIDE","COLUMNSHOW","HEADERCELLS","COLUMNREORDER","COLUMNRESIZE","COLUMNMENUINIT","COLUMNMENUOPEN","COLUMNLOCK","COLUMNUNLOCK","PARENTIDFIELD","DRAGSTART","DRAG","DROP","DRAGEND","NAVROW","NAVCELL","NAVHEADER","NORECORDSCLASS","ITEMROW","isRtl","HEIGHT","INCELL","INLINE","POPUP","TABLE","CHECKBOX","CHECKBOXINPUT","SELECTCOLUMNTMPL","SELECTCOLUMNHEADERTMPL","SELECTED","whitespaceRegExp","filterRowRegExp","RegExp","classNames","wrapper","header","button","alt","editCell","editRow","dirtyCell","group","toolbar","gridToolbar","gridHeader","gridHeaderWrap","gridContent","gridContentWrap","gridFilter","footerTemplate","focused","loading","refresh","retry","selected","status","link","filterable","icon","iconFilter","iconCollapse","iconExpand","iconHidden","iconPlaceHolder","input","dropPositions","dropTop","dropBottom","dropAdd","dropMiddle","dropDenied","dragStatus","dragClue","dragClueText","headerCellInner","columnTitle","defaultCommands","create","imageClass","className","methodName","createchild","destroy","edit","update","canceledit","cancel","save","excel","pdf","search","TreeView","Class","init","options","that","this","defaultParentId","idField","parentIdField","childrenMap","dataLength","length","dataItem","dataItemId","dataItemParentId","_childrenMap","i","idsMap","_idMap","dataMaps","_dataMaps","children","ids","rootNodes","removeCollapsedSubtreesFromRootNodes","result","prunedTree","maxDepth","Infinity","removeCollapsedSubtrees","concat","rootNode","childIdx","expanded","isUndefined","TreeQuery","TreeListModel","constructor","process","inPlace","query","sort","normalizeGroup","normalizeSort","filterCallback","filter","skip","take","total","filteredChildrenMap","view","prunedData","toArray","processFromRootNodes","range","parentId","fields","type","nullable","value","fn","call","_loaded","get","accept","set","field","initiator","loaded","shouldSerialize","is","object","not","func","base","model","TreeListDataSource","_getDataMaps","schema","modelBase","_addRange","_createNewModel","fromModel","_modelParentIdField","_isPageable","_shouldWrap","_push","operation","_readData","_getData","_data","newData","toJSON","_replaceData","source","target","sourceLength","_readAggregates","_aggregateResult","reader","aggregates","_defaultParentId","read","_modelOptions","_skip","_page","_collapsedTotal","remove","root","_removeChildData","_removeFromDataMaps","removePristine","pageable","_getChildrenMap","items","_subtree","shouldRemovePristine","removedItems","_removeItems","pushDestroy","insert","index","newModel","_insertInDataMaps","_filterCallback","item","_modelIdField","parentSubtree","parent","_parentNode","unshift","parentNode","len","_observeView","_createTreeView","_initIdsMap","_idsMap","_getIdsMap","_getFilteredChildrenMap","filteredChildren","_setFilteredChildrenMap","_initDataMaps","_initChildrenMapForParent","_defaultTreeModelOptions","modelOptions","_defaultDataItemType","ObservableObject","_calculateAggregates","subtree","pageableChildrenMap","aggregate","_queryProcess","_processPageableQuery","hasLoadedChildren","hasChildren","slice","_processTreeQuery","_replaceWithObservedData","_processDataItemsState","_replaceItemsInDataMaps","dataToAggregate","_dataToAggregate","_replaceInMapWithObservedData","_calculateCollapsedTotal","firstDataItem","firstItemParents","_parentNodes","observableArray","itemType","parents","directParent","viewIndex","_insertInIdsMap","_replaceInMap","replacement","itemInArray","itemIndex","indexOf","dataToReplace","replacementArray","itemToReplace","itemToReplaceId","dataItemIndex","observableItem","_getById","at","key","_insertInChildrenMap","itemId","splice","_removeFromIdsMap","_removeFromChildrenMap","_indexInChildrenMap","_itemIndexInMap","dataMap","uid","_isLastItemInView","_defaultPageableQueryOptions","page","pageSize","serverPaging","_updateTotalForAction","action","_updateCollapsedTotalForAction","parseInt","isNumber","_setFilterTotal","filterTotal","setDefaultValue","collapsedTotal","filteredData","_dataWithoutCollapsedSubtrees","_removeCollapsedSubtrees","_processDataItemState","_queueRequest","callback","_modelLoaded","childNodes","_modelError","e","_error","success","requestParams","_observe","_total","load","method","remote","serverSorting","serverFiltering","serverGrouping","serverAggregates","defaultPromise","Deferred","resolve","promise","done","fail","contains","child","rootId","_byParentId","defaultId","current","defaults","allChildNodes","directChildren","_rootNode","_pageableRootNodes","nodesWithoutParentInView","_nodesWithoutParentInView","node","_parentNodesNotInView","parentInView","_parentInView","level","_pageableModelLevel","baseFilter","_pageableQueryOptions","_flatData","cancelChanges","_restorePageSizeAfterAddChild","_modelCanceled","_changesCanceled","_setAddChildPageSize","queryOptions","_addChildPageSize","_query","sync","then","_syncEnd","isCellVisible","style","display","sortCells","cells","indexAttr","attr","a","b","indexA","indexB","leafDataCells","container","rows","find","el","hasClass","add","last","createPlaceholders","spans","columnsWidth","cols","colWidth","width","idx","syncTableHeight","table1","table2","lockedHeigth","offsetHeight","tableHeigth","row","diff","test","height","TreeListPager","Pager","totalPages","dataSource","_filter","Math","ceil","_createDataSource","Editor","Observable","bind","events","_fields","columns","_initContainer","createEditable","editable","Editable","clearContainer","change","_isEditable","column","isColumnEditable","format","editor","end","close","empty","removeAttr","PopupEditor","_attachHandlers","cycleForm","open","modal","resizable","draggable","title","visible","formContent","append","_appendTemplate","_appendFields","_appendButtons","Tree","render","appendTo","Window","form","unescape","selectable","command","class","fieldRenderer","commandRenderer","closeHandler","_cancelProxy","_cancel","on","_saveProxy","_save","userTriggered","_detachHandlers","off","trigger","center","IncellEditor","TreeList","_events","_dataSource","_aria","_columns","_layout","_navigatable","_selectable","_sortable","_resizable","_filterable","_filterRow","_attachEvents","_toolbar","_scrollable","_reorderable","_columnMenu","_minScreenSupport","_draggable","_pageable","autoBind","fetch","_hasLockedColumns","widget","addClass","_resizeHandler","resize","notify","reorderable","move","_dragging","HierarchicalDragAndDrop","$angular","autoScroll","holdToDrag","itemSelector","allowedContainers","hintText","separator","join","destination","dest","src","itemFromTarget","tr","closest","prevRow","prev","nextRow","next","first","sameLevel","content","dragstart","css","drag","drop","removeClass","dragend","originalSrcParentId","originalSrcIndex","position","isPrevented","insertBefore","insertAfter","dropHintContainer","eq","dropPositionFrom","dropHint","contents","dropHintElement","isAfterText","prevAll","nodeType","arguments","nodeData","referenceNode","insertAction","indexOffset","referenceNodeIndex","nodeDataIndex","originalDestIndex","destIndex","_unbindDataSource","_unbindDataChange","_destroyed","pop","_bindDataChange","_bindDataSource","_changeHandler","unbind","_refreshHandler","itemFor","tbody","_itemFor","table","lockedContent","lockedTable","scrollable","scrollables","thead","_wheelScroll","scrollLeft","scrollTop","touchScroller","movable","_touchScroller","sender","x","y","ctrlKey","delta","wheelDeltaY","lockedDiv","currentTarget","scrollHeight","clientHeight","preventDefault","one","_progress","messages","_showStatus","_render","error","isCurrentInHeader","currentIndex","_cancelEditor","_adjustHeight","navigatable","_isActiveInTable","max","cellIndex","_restoreCurrent","_checkBoxSelection","_deselectCheckRows","_angularFooters","footer","allAggregates","footerRows","_footerItems","_angularFooter","angular","elements","col","_items","dataItems","n","tmp","_showNoRecordsTemplate","defaultTemplate","scrollableNoGridHeightStyles","_contentTree","_lockedContentTree","noRows","message","hide","_hideStatus","_hideNoRecordsTempalte","show","contentWrap","pagerHeight","pager","scrollbar","isHeightSet","initialHeight","newHeight","offsetWidth","clientWidth","_resize","size","force","_applyLockedContainersWidth","any","hideMinScreenCols","minScreenResizeHandler","_iterateMinScreenCols","screenWidth","minWidth","minScreenWidth","hideColumn","showColumn","hidden","innerWidth","screen","_destroyColumnAttachments","_errorHandler","_progressHandler","_navigatableTables","_current","_draggableInstance","_userEvents","_destroyEditor","_destroyPager","_autoExpandable","_dataSourceFetchProxy","lockedHeader","_statusTree","_headerTree","_lockedHeaderColsTree","_lockedContentColsTree","_lockedHeaderTree","sortable","columnMenu","requestFailed","commands","hierarchy","renderAllRows","rowTemplate","altRowTemplate","getOptions","deepExtend","initialData","transport","setOptions","currentOptions","before","_setEvents","each","th","filterMenu","_toggle","expand","_isIncellEditable","closeCell","afterModelLoaded","_toggleData","_syncLockedContentHeight","always","_togglePageableData","_renderProgress","_refreshPager","collapse","_toggleChildren","event","tables","headerTables","_tableClick","_tableFocus","_tableBlur","_tableKeyDown","td","lockedColumnOffset","leafColumns","lockedColumns","active","rowIndex","focusTable","newCurrent","_updateCurrentAttr","_scrollCurrent","_lastCellIndex","_setCurrent","tableContainer","isInLockedContainer","isInContent","scrollableContainer","_scrollTo","_relatedRow","_findCurrentCell","elementToLowercase","tagName","toLowerCase","isHorizontal","elementOffsetDir","containerScroll","containerOffsetDir","elementOffset","abs","offsetLeft","bottomDistance","ieCorrection","firefoxCorrection","msie","edge","mozilla","webkit","version","_elementId","_currentDataIndex","lockedColumnsCount","_prevVerticalCell","cellSelector","parentColumnsCells","_nextVerticalCell","childColumnsCells","rowSpan","tmpIndex","currentRowCells","hiddenColumns","_verticalContainer","up","step","floor","headerId","replace","handled","canHandle","isDefaultPrevented","keyCode","UP","_moveUp","shiftKey","DOWN","_moveDown","LEFT","RIGHT","altKey","_handleExpand","_moveRight","_handleCollapse","_moveLeft","PAGEDOWN","_handlePageDown","PAGEUP","_handlePageUp","ENTER","F2","_handleEnterKey","ESC","_handleEscKey","HOME","_handleHome","END","_handleEnd","TAB","_handleTabKey","stopPropagation","ctrl","rowContainer","isInLockedTable","isInBody","currentTable","has","blur","cancelRow","focusable","click","_handleEditing","incellEditing","cell","_tabNext","_preventPageSizeRestore","back","switchRow","nextAll","isIE","editContainer","isEdited","nextFocusableCellRowIndex","nextFocusableCellIndex","currentFocusedCellRowIndex","currentFocusedCellIndex","editedCell","opera","triggerHandler","saveRow","focus","isHeader","headerTable","isInput","isInputElement","setTimeout","_setTabIndex","retryButton","UserEvents","press","_onPress","allowSelection","_commandClick","_search","_attachCellEditingEventHandlers","icons","multiple","relatedTarget","isLockedCell","clearTimeout","_closeCellTimeout","_commandByName","j","currentName","commandName","parentsUntil","_searchTimeOut","searchFields","expression","filters","logic","getColumnsFields","operator","_ensureExpandableColumn","expandable","visibleColumns","expandableColumns","encoded","lockedCols","Error","nonLockedColumns","normalizeColumns","_columnTemplates","_columnAttributes","_includeChildren","includeChildren","_checkboxClick","_headerCheckboxClick","dirtyCellTemplate","_createDirtyColumnTemplate","dirtyIndicatorTemplate","_createIndicatorTemplate","headerTemplate","convertStyle","properties","declaration","split","trim","camelCase","attributes","headerAttributes","_clearSortClasses","layout","addBack","rtl","_initVirtualTrees","_renderCols","_renderHeader","_headerColsTree","_contentColsTree","buttons","_buildCommands","_lockedColumns","_nonLockedColumns","_templateColumns","_flushCache","_renderOptions","maps","_dataToRender","_renderedModelLevel","uidAttr","hasFooterTemplate","select","_","viewChildrenMap","_absoluteIndex","_angularItems","_clearRenderMap","buttonClass","_viewChildrenMap","_hasFooterTemplate","_trs","editedColumn","editedColumnIndex","contentResized","_muteAngularRebind","_togglePagerVisibility","_setExpanderElement","hiddenDivClass","hiddenDiv","expander","toggle","progress","parentsNotInView","parentNotInView","parentNotInViewId","childId","parentsCopy","_markNodeAsNonRenderable","parentIndex","_skipRenderingMap","nodeId","_adjustRowsHeight","rows2","containers","containersLength","heights","offsetHeight1","offsetHeight2","_ths","ths","cellClasses","headerContent","leafs","scope","role","colSpan","data-field","data-title","_cols","_clearColsCache","_retrieveFirstColumn","_updateFirstColumnClass","_updateRowSpans","included","visibleChildColumns","_setColumnDataIndexes","_updateColumnCellIndex","offset","updateCellIndex","_setParentsVisibility","predicate","p","columnParents","_prepareColumns","parentCell","parentRow","parentColumn","childRow","totalColSpan","_renderHeaderTree","tree","hasMultiColumnHeaders","rowsToRender","filterThs","_hasFilterRow","_filterThs","_syncLockedHeaderHeight","_updateFilterThs","refColumn","filterRowThs","refIndex","currIndex","thIndex","lockedWidth","nonLockedWidth","wrapperWidth","modelId","_edit","rowOptions","isAlt","_trFromTemplate","_tds","_td","data-parentId","_footerId","isFunction","parseRowTemplate","nodeName","toLocaleLowerCase","currElement","parseAttributes","nodeValue","_createCellElement","_isTextNode","spaceElements","iconElement","noop","c","renderer","editedColumnField","editColumn","iconClass","columnHasEditCommand","isDirtyColumn","_cellContent","dirtyIndicator","_evalColumnTemplate","templateSettings","_customTemplateSettings","columnTemplateAlias","paramName","templateString","_dirtyIndicatorTemplate","templateFunction","columnTemplate","dirtyField","charAt","expr","Template","_handleCommand","_button","data-command","_positionResizeHandle","resizeHandle","left","rtlCorrection","headerWrap","webkitCorrection","leftMargin","invisibleSpace","leftBorderWidth","cellWidth","which","indicatorWidth","columnResizeHandleWidth","halfResizeHandle","parseFloat","scrollWidth","top","val","locked","autoFitColumn","isLocked","visibleLocked","contentTable","footerTable","oldColumnWidth","newColumnWidth","totalWidth","oldWidth","newWidth","_adjustLockedHorizontalScrollBar","_syncLockedScroll","treelist","Resizable","handle","start","startLocation","location","columnWidth","rtlModifier","minColumnWidth","resizeend","sortableInstance","kendoColumnSorter","filterMenuInstance","filterInit","filterOpen","mode","kendoFilterMenu","settings","filterHandler","existingInstance","suggestDataSource","operators","customDataSource","cellOptions","enabled","values","delay","inputWidth","suggestionOperator","minLength","dataTextField","showOperators","kendoFilterCell","hasFiltering","columnsWithoutFiltering","_change","selectedValues","_uncheckCheckBoxes","_checkRows","_toggleHeaderCheckState","_isLocked","useAllItems","multi","Selectable","parseOptions","aria","continuousItems","_continuousItems","_selectableTarget","SPACEBAR","clear","_lastActive","selectRange","_firstSelectee","lockedItems","nonLockedItems","apply","related","clearSelection","prop","preventChange","checkBox","checked","parentGrid","getKendoTreeList","isSelecting","selector","ds","_sortHandler","setDataSource","getByUid","_isPopupEditable","_editMode","_createEditor","_cancelEdit","args","addRow","inlineEditing","_isInlineEditable","showNewModelInView","_insertAt","_firstEditableColumnIndex","removeRow","document","_shouldRestorePageSize","leafCols","_createIncellEditor","_editCell","isCancel","ns","adjustRowHeight","saveChanges","valid","_toggleColumnVisibility","_findColumn","_adjustTablesWidth","Draggable","guid","hint","prepend","Reorderable","dragOverContainers","_allowDragOverContainers","inSameContainer","targetParentContainerIndex","flatColumnsInDomOrder","sourceIndex","targetIndex","oldIndex","newIndex","reorderColumn","lockable","_reorderTrees","destSources","destContainer","destDomTree","sources","sourcesContainer","sourcesDomTree","depth","sourceDOM","sourceChildren","destDomChildren","destColumn","destRow","sourcesLeafs","destLeafs","reorderTaget","destThs","findReorderTarget","_insertTree","domTr","_reorderHeader","sourcesDepth","targetDepth","sourceLocked","destLocked","rowsToAdd","destRows","destTarget","updateRowSpans","removeEmptyRows","rowspan","lockChanged","nonLockedColumnsLength","lockColumn","unlockColumn","menu","menuOptions","initHandler","_columnMenuInit","openHandler","_columnMenuOpen","hasLockableColumns","compare","pane","owner","closeCallback","kendoColumnMenu","_createPager","alwaysVisible","findParentColumnWithChildren","targetLocked","masterColumns","columnParent","parentColumns","isVisible","parentIds","headers","flatColumns","headerRows","parentCellsWithChildren","prevCells","getAttribute","colSpanAttr","inserted","columnPosition","cellCounts","allColumns","temp","containerDOMtree","emptyRows","shouldRemove","direct","focusElement","row1","row2","dirty","dirtyFields","isNaN","ExcelMixin","PDFMixin","_drawPDF","treeList","paperSize","_drawPDF_autoPageBreak","allPages","_initPDFProgress","doc","drawing","Group","startingPage","exportPage","_drawPDFShadow","avoidLinks","pageNum","pageNumber","err","reject","deferred","clone","progressBar","kendoProgressBar","chunkCount","min","origBody","cont","overflow","paddingRight","body","draw","_destructive","drawDOM","renderPage","plugin","amd","a1","a2","a3"],"mappings":"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"}